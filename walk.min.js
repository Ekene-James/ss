/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

    HTTP Live Streaming: https://github.com/video-dev/hls.js
    Copyright (c) 2017 Dailymotion (http://www.dailymotion.com), Apache 2.0 License

    node-qrcode: https://github.com/soldair/node-qrcode
    Copyright (c) 2012 Ryan Day,  MIT License

    Brotli: https://github.com/google/brotli
    Copyright (c) 2009, 2010, 2013-2016 by the Brotli Authors,  MIT License

  and the following open fonts:

    Noto Sans: https://fonts.google.com/specimen/Noto+Sans?query=noto+sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),e=$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(f){f.done?d(f.value):Promise.resolve(f.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(f){return f instanceof e?f:new e(function(h,k){h(f)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(f)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(f){d(f,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var h=0;h<f.length;++h){var k=f[h];f[h]=null;try{k()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var e=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var h=this.createResolveAndReject_();
try{f(h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.createResolveAndReject_=function(){function f(l){return function(m){k||(k=!0,l.call(h,m))}}var h=this,k=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var h=null!=f;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(f):
this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(f){var h=void 0;try{h=f.then}catch(k){this.reject_(k);return}"function"==typeof h?this.settleSameAsThenable_(h,f):this.fulfill_(f)};e.prototype.reject_=function(f){this.settle_(2,f)};e.prototype.fulfill_=function(f){this.settle_(1,f)};e.prototype.settle_=function(f,h){if(0!=this.state_)throw Error("Cannot settle("+f+", "+h+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=h;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;d(function(){if(f.notifyUnhandledRejection_()){var h=$jscomp.global.console;"undefined"!==typeof h&&h.error(f.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=$jscomp.global.CustomEvent,h=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):
"function"===typeof h?f=new h("unhandledrejection",{cancelable:!0}):(f=$jscomp.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return k(f)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)g.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(f){var h=this.createResolveAndReject_();
f.callWhenSettled_(h.resolve,h.reject)};e.prototype.settleSameAsThenable_=function(f,h){var k=this.createResolveAndReject_();try{f.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};e.prototype.then=function(f,h){function k(q,u){return"function"==typeof q?function(p){try{l(q(p))}catch(w){m(w)}}:u}var l,m,n=new e(function(q,u){l=q;m=u});this.callWhenSettled_(k(f,l),k(h,m));return n};e.prototype.catch=function(f){return this.then(void 0,f)};e.prototype.callWhenSettled_=function(f,h){function k(){switch(l.state_){case 1:f(l.result_);
break;case 2:h(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?g.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(f){return new e(function(h,k){k(f)})};e.race=function(f){return new e(function(h,k){for(var l=$jscomp.makeIterator(f),m=l.next();!m.done;m=l.next())c(m.value).callWhenSettled_(h,k)})};e.all=function(f){var h=$jscomp.makeIterator(f),k=h.next();return k.done?c([]):new e(function(l,
m){function n(p){return function(w){q[p]=w;u--;0==u&&l(q)}}var q=[],u=0;do q.push(void 0),u++,c(k.value).callWhenSettled_(n(q.length-1),m),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),m=Object.seal({}),n=new a([[l,2],[m,3]]);if(2!=n.get(l)||3!=n.get(m))return!1;n.delete(l);n.set(m,4);return!n.has(l)&&4==n.get(m)}catch(q){return!1}}function c(){}function d(l){var m=typeof l;return"object"===m&&null!==l||"function"===m}function e(l){if(!$jscomp.owns(l,f)){var m=new c;$jscomp.defineProperty(l,f,{value:m})}}function g(l){if(!$jscomp.ISOLATE_POLYFILLS){var m=Object[l];m&&(Object[l]=
function(n){if(n instanceof c)return n;Object.isExtensible(n)&&e(n);return m(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var f="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var h=0,k=function(l){this.id_=(h+=Math.random()+1).toString();if(l){l=$jscomp.makeIterator(l);for(var m;!(m=l.next()).done;)m=m.value,this.set(m[0],m[1])}};k.prototype.set=function(l,m){if(!d(l))throw Error("Invalid WeakMap key");
e(l);if(!$jscomp.owns(l,f))throw Error("WeakMap key fail: "+l);l[f][this.id_]=m;return this};k.prototype.get=function(l){return d(l)&&$jscomp.owns(l,f)?l[f][this.id_]:void 0};k.prototype.has=function(l){return d(l)&&$jscomp.owns(l,f)&&$jscomp.owns(l[f],this.id_)};k.prototype.delete=function(l){return d(l)&&$jscomp.owns(l,f)&&$jscomp.owns(l[f],this.id_)?delete l[f][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var k=Object.seal({x:4}),l=new a($jscomp.makeIterator([[k,"s"]]));if("s"!=l.get(k)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var m=l.entries(),n=m.next();if(n.done||n.value[0]!=k||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(q){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(k){this.data_={};this.head_=f();this.size=0;if(k){k=$jscomp.makeIterator(k);for(var l;!(l=k.next()).done;)l=l.value,this.set(l[0],l[1])}};d.prototype.set=function(k,l){k=0===k?0:k;var m=e(this,k);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=l:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:k,value:l},m.list.push(m.entry),
this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};d.prototype.delete=function(k){k=e(this,k);return k.entry&&k.list?(k.list.splice(k.index,1),k.list.length||delete this.data_[k.id],k.entry.previous.next=k.entry.next,k.entry.next.previous=k.entry.previous,k.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};d.prototype.has=function(k){return!!e(this,k).entry};d.prototype.get=function(k){return(k=
e(this,k).entry)&&k.value};d.prototype.entries=function(){return g(this,function(k){return[k.key,k.value]})};d.prototype.keys=function(){return g(this,function(k){return k.key})};d.prototype.values=function(){return g(this,function(k){return k.value})};d.prototype.forEach=function(k,l){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,k.call(l,n[1],n[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(k,l){var m=l&&typeof l;"object"==m||"function"==m?c.has(l)?m=c.get(l):
(m=""+ ++h,c.set(l,m)):m="p_"+l;var n=k.data_[m];if(n&&$jscomp.owns(k.data_,m))for(k=0;k<n.length;k++){var q=n[k];if(l!==l&&q.key!==q.key||l===q.key)return{id:m,list:n,index:k,entry:q}}return{id:m,list:n,index:-1,entry:void 0}},g=function(k,l){var m=k.head_;return $jscomp.iteratorPrototype(function(){if(m){for(;m.head!=k.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:l(m)};m=null}return{done:!0,value:void 0}})},f=function(){var k={};return k.previous=k.next=k.head=k},h=0;
return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a($jscomp.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var g=e.entries(),f=g.next();if(f.done||f.value[0]!=d||f.value[1]!=d)return!1;f=g.next();return f.done||f.value[0]==d||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:g.next().done}catch(h){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};c.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,e){var g=this;this.map_.forEach(function(f){return d.call(e,f,f,g)})};return c},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");
$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");
$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var f=0;f<g&&c<e;)if(d[c++]!=b[f++])return!1;return f>=g}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");(function(){function a(N,ia,Aa){return N.call.apply(N.bind,arguments)}function b(N,ia,Aa){if(!N)throw Error();if(2<arguments.length){var V=Array.prototype.slice.call(arguments,2);return function(){var ta=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(ta,V);return N.apply(ia,ta)}}return function(){return N.apply(ia,arguments)}}function c(N,ia,Aa){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(N,
ia){this.a=N;this.m=ia||N;this.c=this.m.document}function e(N,ia,Aa,V){ia=N.c.createElement(ia);if(Aa)for(var ta in Aa)Aa.hasOwnProperty(ta)&&("style"==ta?ia.style.cssText=Aa[ta]:ia.setAttribute(ta,Aa[ta]));V&&ia.appendChild(N.c.createTextNode(V));return ia}function g(N,ia,Aa){(N=N.c.getElementsByTagName(ia)[0])||(N=document.documentElement);N.insertBefore(Aa,N.lastChild)}function f(N){N.parentNode&&N.parentNode.removeChild(N)}function h(N,ia,Aa){ia=ia||[];Aa=Aa||[];for(var V=N.className.split(/\s+/),
ta=0;ta<ia.length;ta+=1){for(var Ia=!1,Ea=0;Ea<V.length;Ea+=1)if(ia[ta]===V[Ea]){Ia=!0;break}Ia||V.push(ia[ta])}ia=[];for(ta=0;ta<V.length;ta+=1){Ia=!1;for(Ea=0;Ea<Aa.length;Ea+=1)if(V[ta]===Aa[Ea]){Ia=!0;break}Ia||ia.push(V[ta])}N.className=ia.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function k(N,ia){N=N.className.split(/\s+/);for(var Aa=0,V=N.length;Aa<V;Aa++)if(N[Aa]==ia)return!0;return!1}function l(N){if("string"===typeof N.f)return N.f;var ia=N.m.location.protocol;"about:"==ia&&
(ia=N.a.location.protocol);return"https:"==ia?"https:":"http:"}function m(N){return N.m.location.hostname||N.a.location.hostname}function n(N,ia,Aa){function V(){na&&ta&&Ia&&(na(Ea),na=null)}ia=e(N,"link",{rel:"stylesheet",href:ia,media:"all"});var ta=!1,Ia=!0,Ea=null,na=Aa||null;Ca?(ia.onload=function(){ta=!0;V()},ia.onerror=function(){ta=!0;Ea=Error("Stylesheet failed to load");V()}):setTimeout(function(){ta=!0;V()},0);g(N,"head",ia)}function q(N,ia,Aa,V){var ta=N.c.getElementsByTagName("head")[0];
if(ta){var Ia=e(N,"script",{src:ia}),Ea=!1;Ia.onload=Ia.onreadystatechange=function(){Ea||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(Ea=!0,Aa&&Aa(null),Ia.onload=Ia.onreadystatechange=null,"HEAD"==Ia.parentNode.tagName&&ta.removeChild(Ia))};ta.appendChild(Ia);setTimeout(function(){Ea||(Ea=!0,Aa&&Aa(Error("Script load timeout")))},V||5E3);return Ia}return null}function u(){this.a=0;this.c=null}function p(N){N.a++;return function(){N.a--;v(N)}}function w(N,ia){N.c=ia;
v(N)}function v(N){0==N.a&&N.c&&(N.c(),N.c=null)}function y(N){this.a=N||"-"}function D(N,ia){this.c=N;this.f=4;this.a="n";(N=(ia||"n4").match(/^([nio])([1-9])$/i))&&(this.a=N[1],this.f=parseInt(N[2],10))}function A(N){return H(N)+" "+(N.f+"00 300px ")+G(N.c)}function G(N){var ia=[];N=N.split(/,\s*/);for(var Aa=0;Aa<N.length;Aa++){var V=N[Aa].replace(/['"]/g,"");-1!=V.indexOf(" ")||/^\d/.test(V)?ia.push("'"+V+"'"):ia.push(V)}return ia.join(",")}function I(N){return N.a+N.f}function H(N){var ia="normal";
"o"===N.a?ia="oblique":"i"===N.a&&(ia="italic");return ia}function P(N,ia){this.c=N;this.f=N.m.document.documentElement;this.h=ia;this.a=new y("-");this.j=!1!==ia.events;this.g=!1!==ia.classes}function U(N){N.g&&h(N.f,[N.a.c("wf","loading")]);C(N,"loading")}function fa(N){if(N.g){var ia=k(N.f,N.a.c("wf","active")),Aa=[],V=[N.a.c("wf","loading")];ia||Aa.push(N.a.c("wf","inactive"));h(N.f,Aa,V)}C(N,"inactive")}function C(N,ia,Aa){if(N.j&&N.h[ia])if(Aa)N.h[ia](Aa.c,I(Aa));else N.h[ia]()}function Q(){this.c=
{}}function da(N,ia,Aa){var V=[],ta;for(ta in ia)if(ia.hasOwnProperty(ta)){var Ia=N.c[ta];Ia&&V.push(Ia(ia[ta],Aa))}return V}function aa(N,ia){this.c=N;this.f=ia;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function X(N){g(N.c,"body",N.a)}function S(N){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+G(N.c)+";font-style:"+(H(N)+";font-weight:"+(N.f+
"00;"))}function O(N,ia,Aa,V,ta,Ia){this.g=N;this.j=ia;this.a=V;this.c=Aa;this.f=ta||3E3;this.h=Ia||void 0}function la(N,ia,Aa,V,ta,Ia,Ea){this.v=N;this.B=ia;this.c=Aa;this.a=V;this.s=Ea||"BESbswy";this.f={};this.w=ta||3E3;this.u=Ia||null;this.o=this.j=this.h=this.g=null;this.g=new aa(this.c,this.s);this.h=new aa(this.c,this.s);this.j=new aa(this.c,this.s);this.o=new aa(this.c,this.s);N=new D(this.a.c+",serif",I(this.a));N=S(N);this.g.a.style.cssText=N;N=new D(this.a.c+",sans-serif",I(this.a));N=
S(N);this.h.a.style.cssText=N;N=new D("serif",I(this.a));N=S(N);this.j.a.style.cssText=N;N=new D("sans-serif",I(this.a));N=S(N);this.o.a.style.cssText=N;X(this.g);X(this.h);X(this.j);X(this.o)}function R(){if(null===Ka){var N=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Ka=!!N&&(536>parseInt(N[1],10)||536===parseInt(N[1],10)&&11>=parseInt(N[2],10))}return Ka}function ra(N,ia,Aa){for(var V in za)if(za.hasOwnProperty(V)&&ia===N.f[za[V]]&&Aa===N.f[za[V]])return!0;return!1}function ma(N){var ia=
N.g.a.offsetWidth,Aa=N.h.a.offsetWidth,V;(V=ia===N.f.serif&&Aa===N.f["sans-serif"])||(V=R()&&ra(N,ia,Aa));V?ja()-N.A>=N.w?R()&&ra(N,ia,Aa)&&(null===N.u||N.u.hasOwnProperty(N.a.c))?T(N,N.v):T(N,N.B):xa(N):T(N,N.v)}function xa(N){setTimeout(c(function(){ma(this)},N),50)}function T(N,ia){setTimeout(c(function(){f(this.g.a);f(this.h.a);f(this.j.a);f(this.o.a);ia(this.a)},N),0)}function ka(N,ia,Aa){this.c=N;this.a=ia;this.f=0;this.o=this.j=!1;this.s=Aa}function ua(N){0==--N.f&&N.j&&(N.o?(N=N.a,N.g&&h(N.f,
[N.a.c("wf","active")],[N.a.c("wf","loading"),N.a.c("wf","inactive")]),C(N,"active")):fa(N.a))}function wa(N){this.j=N;this.a=new Q;this.h=0;this.f=this.g=!0}function K(N,ia,Aa,V,ta){var Ia=0==--N.h;(N.f||N.g)&&setTimeout(function(){var Ea=ta||null,na=V||{};if(0===Aa.length&&Ia)fa(ia.a);else{ia.f+=Aa.length;Ia&&(ia.j=Ia);var Ua,Xa=[];for(Ua=0;Ua<Aa.length;Ua++){var Na=Aa[Ua],eb=na[Na.c],qb=ia.a,Ab=Na;qb.g&&h(qb.f,[qb.a.c("wf",Ab.c,I(Ab).toString(),"loading")]);C(qb,"fontloading",Ab);qb=null;null===
ya&&(ya=window.FontFace?(Ab=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(Ab[1],10):!0:!1);ya?qb=new O(c(ia.g,ia),c(ia.h,ia),ia.c,Na,ia.s,eb):qb=new la(c(ia.g,ia),c(ia.h,ia),ia.c,Na,ia.s,Ea,eb);Xa.push(qb)}for(Ua=0;Ua<Xa.length;Ua++)Xa[Ua].start()}},0)}function J(N,ia,Aa){var V=[],ta=Aa.timeout;U(ia);V=da(N.a,Aa,N.c);var Ia=new ka(N.c,ia,ta);N.h=V.length;ia=0;for(Aa=V.length;ia<Aa;ia++)V[ia].load(function(Ea,na,Ua){K(N,Ia,Ea,na,Ua)})}function ha(N,ia){this.c=N;this.a=ia}function W(N,
ia,Aa){var V=l(N.c);N=(N.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return V+"//"+N+"/"+ia+".js"+(Aa?"?v="+Aa:"")}function Da(N,ia){this.c=N;this.a=ia}function Ba(N,ia,Aa){N?this.c=N:this.c=ia+Oa;this.a=[];this.f=[];this.g=Aa||""}function Ga(N,ia){for(var Aa=ia.length,V=0;V<Aa;V++){var ta=ia[V].split(":");3==ta.length&&N.f.push(ta.pop());var Ia="";2==ta.length&&""!=ta[1]&&(Ia=":");N.a.push(ta.join(Ia))}}function Ha(N){if(0==N.a.length)throw Error("No fonts to load!");if(-1!=
N.c.indexOf("kit="))return N.c;for(var ia=N.a.length,Aa=[],V=0;V<ia;V++)Aa.push(N.a[V].replace(/ /g,"+"));ia=N.c+"?family="+Aa.join("%7C");0<N.f.length&&(ia+="&subset="+N.f.join(","));0<N.g.length&&(ia+="&text="+encodeURIComponent(N.g));return ia}function pa(N){this.f=N;this.a=[];this.c={}}function ea(N){for(var ia=N.f.length,Aa=0;Aa<ia;Aa++){var V=N.f[Aa].split(":"),ta=V[0].replace(/\+/g," "),Ia=["n4"];if(2<=V.length){var Ea=V[1];var na=[];if(Ea){Ea=Ea.split(",");for(var Ua=Ea.length,Xa=0;Xa<Ua;Xa++){var Na=
Ea[Xa];if(Na.match(/^[\w-]+$/)){var eb=xb.exec(Na.toLowerCase());if(null==eb)Na="";else{Na=eb[2];Na=null==Na||""==Na?"n":Za[Na];eb=eb[1];if(null==eb||""==eb)eb="4";else{var qb=$a[eb];eb=qb?qb:isNaN(eb)?"4":eb.substr(0,1)}Na=[Na,eb].join("")}}else Na="";Na&&na.push(Na)}}0<na.length&&(Ia=na);3==V.length&&(V=V[2],na=[],V=V?V.split(","):na,0<V.length&&(V=Ja[V[0]])&&(N.c[ta]=V))}N.c[ta]||(V=Ja[ta])&&(N.c[ta]=V);for(V=0;V<Ia.length;V+=1)N.a.push(new D(ta,Ia[V]))}}function Y(N,ia){this.c=N;this.a=ia}function va(N,
ia){this.c=N;this.a=ia}function L(N,ia){this.c=N;this.f=ia;this.a=[]}var ja=Date.now||function(){return+new Date},Ca=!!window.FontFace;y.prototype.c=function(N){for(var ia=[],Aa=0;Aa<arguments.length;Aa++)ia.push(arguments[Aa].replace(/[\W_]+/g,"").toLowerCase());return ia.join(this.a)};O.prototype.start=function(){var N=this.c.m.document,ia=this,Aa=ja(),V=new Promise(function(Ia,Ea){function na(){ja()-Aa>=ia.f?Ea():N.fonts.load(A(ia.a),ia.h).then(function(Ua){1<=Ua.length?Ia():setTimeout(na,25)},
function(){Ea()})}na()}),ta=new Promise(function(Ia,Ea){setTimeout(Ea,ia.f)});Promise.race([ta,V]).then(function(){ia.g(ia.a)},function(){ia.j(ia.a)})};var za={D:"serif",C:"sans-serif"},Ka=null;la.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=ja();ma(this)};var ya=null;ka.prototype.g=function(N){var ia=this.a;ia.g&&h(ia.f,[ia.a.c("wf",N.c,I(N).toString(),"active")],[ia.a.c("wf",N.c,I(N).toString(),"loading"),ia.a.c("wf",N.c,I(N).toString(),
"inactive")]);C(ia,"fontactive",N);this.o=!0;ua(this)};ka.prototype.h=function(N){var ia=this.a;if(ia.g){var Aa=k(ia.f,ia.a.c("wf",N.c,I(N).toString(),"active")),V=[],ta=[ia.a.c("wf",N.c,I(N).toString(),"loading")];Aa||V.push(ia.a.c("wf",N.c,I(N).toString(),"inactive"));h(ia.f,V,ta)}C(ia,"fontinactive",N);ua(this)};wa.prototype.load=function(N){this.c=new d(this.j,N.context||this.j);this.g=!1!==N.events;this.f=!1!==N.classes;J(this,new P(this.c,N),N)};ha.prototype.load=function(N){function ia(){if(Ia["__mti_fntLst"+
V]){var Ea=Ia["__mti_fntLst"+V](),na=[],Ua;if(Ea)for(var Xa=0;Xa<Ea.length;Xa++){var Na=Ea[Xa].fontfamily;void 0!=Ea[Xa].fontStyle&&void 0!=Ea[Xa].fontWeight?(Ua=Ea[Xa].fontStyle+Ea[Xa].fontWeight,na.push(new D(Na,Ua))):na.push(new D(Na))}N(na)}else setTimeout(function(){ia()},50)}var Aa=this,V=Aa.a.projectId,ta=Aa.a.version;if(V){var Ia=Aa.c.m;q(this.c,W(Aa,V,ta),function(Ea){Ea?N([]):(Ia["__MonotypeConfiguration__"+V]=function(){return Aa.a},ia())}).id="__MonotypeAPIScript__"+V}else N([])};Da.prototype.load=
function(N){var ia,Aa=this.a.urls||[],V=this.a.families||[],ta=this.a.testStrings||{},Ia=new u;var Ea=0;for(ia=Aa.length;Ea<ia;Ea++)n(this.c,Aa[Ea],p(Ia));var na=[];Ea=0;for(ia=V.length;Ea<ia;Ea++)if(Aa=V[Ea].split(":"),Aa[1])for(var Ua=Aa[1].split(","),Xa=0;Xa<Ua.length;Xa+=1)na.push(new D(Aa[0],Ua[Xa]));else na.push(new D(Aa[0]));w(Ia,function(){N(na,ta)})};var Oa="//fonts.googleapis.com/css",Ja={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",
khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},$a={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Za={i:"i",italic:"i",n:"n",normal:"n"},xb=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,
Db={Arimo:!0,Cousine:!0,Tinos:!0};Y.prototype.load=function(N){var ia=new u,Aa=this.c,V=new Ba(this.a.api,l(Aa),this.a.text),ta=this.a.families;Ga(V,ta);var Ia=new pa(ta);ea(Ia);n(Aa,Ha(V),p(ia));w(ia,function(){N(Ia.a,Ia.c,Db)})};va.prototype.load=function(N){var ia=this.a.id,Aa=this.c.m;ia?q(this.c,(this.a.api||"https://use.typekit.net")+"/"+ia+".js",function(V){if(V)N([]);else if(Aa.Typekit&&Aa.Typekit.config&&Aa.Typekit.config.fn){V=Aa.Typekit.config.fn;for(var ta=[],Ia=0;Ia<V.length;Ia+=2)for(var Ea=
V[Ia],na=V[Ia+1],Ua=0;Ua<na.length;Ua++)ta.push(new D(Ea,na[Ua]));try{Aa.Typekit.load({events:!1,classes:!1,async:!0})}catch(Xa){}N(ta)}},2E3):N([])};L.prototype.load=function(N){var ia=this.f.id,Aa=this.c.m,V=this;ia?(Aa.__webfontfontdeckmodule__||(Aa.__webfontfontdeckmodule__={}),Aa.__webfontfontdeckmodule__[ia]=function(ta,Ia){ta=0;for(var Ea=Ia.fonts.length;ta<Ea;++ta){var na=Ia.fonts[ta],Ua=V.a,Xa=Ua.push,Na=na.name;na="font-weight:"+na.weight+";font-style:"+na.style;var eb=4,qb="n",Ab=null;
na&&((Ab=na.match(/(normal|oblique|italic)/i))&&Ab[1]&&(qb=Ab[1].substr(0,1).toLowerCase()),(Ab=na.match(/([1-9]00|normal|bold)/i))&&Ab[1]&&(/bold/i.test(Ab[1])?eb=7:/[1-9]00/.test(Ab[1])&&(eb=parseInt(Ab[1].substr(0,1),10))));Xa.call(Ua,new D(Na,qb+eb))}N(V.a)},q(this.c,l(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+m(this.c)+"/"+ia+".js",function(ta){ta&&N([])})):N([])};var nb=new wa(window);nb.a.c.custom=function(N,ia){return new Da(ia,N)};nb.a.c.fontdeck=function(N,ia){return new L(ia,N)};
nb.a.c.monotype=function(N,ia){return new ha(ia,N)};nb.a.c.typekit=function(N,ia){return new va(ia,N)};nb.a.c.google=function(N,ia){return new Y(ia,N)};var db={load:c(nb.load,nb)};"function"===typeof define&&define.amd?define(function(){return db}):"undefined"!==typeof module&&module.exports?module.exports=db:(window.WebFont=db,window.WebFontConfig&&nb.load(window.WebFontConfig))})();var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;
THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;
THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;
THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(e,g,f){0>f&&(f+=1);1<f&&--f;return f<1/6?e+6*(g-e)*f:
.5>f?g:f<2/3?e+6*(g-e)*(2/3-f):e};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,
parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;
return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),g=Math.min(b,c,d),f,h=(g+e)/2;if(g===e)g=f=0;else{var k=e-g;g=.5>=h?k/(e+g):k/(2-e-g);switch(e){case b:f=(c-d)/k+(c<d?6:0);break;case c:f=(d-b)/k+2;break;case d:f=(b-c)/k+4}f/=6}a.h=f;a.s=g;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+
","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,
b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),g=Math.sin(a._x/2),f=Math.sin(a._y/2),h=Math.sin(a._z/2);"XYZ"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e-g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e-g*f*h):"YXZ"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e-g*d*h,this._z=
c*d*h-g*f*e,this._w=c*d*e+g*f*h):"ZXY"===a.order?(this._x=g*d*e-c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e-g*f*h):"ZYX"===a.order?(this._x=g*d*e-c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h-g*f*e,this._w=c*d*e+g*f*h):"YZX"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h-g*f*e,this._w=c*d*e-g*f*h):"XZY"===a.order&&(this._x=g*d*e-c*f*h,this._y=c*f*e-g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e+g*f*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],g=b[5],f=b[9],h=b[2],k=b[6];b=b[10];var l=c+g+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-f)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(k-f)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(f+k)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(f+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var g=b._x,f=b._y,h=b._z;b=b._w;this._x=c*b+a*g+d*h-e*f;this._y=d*b+a*f+e*g-c*h;this._z=e*b+a*h+c*f-d*g;this._w=a*b-c*g-d*f-e*h;this.onChangeCallback();return this},multiplyVector3:function(a){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,g=this._w,f=g*a._w+c*a._x+d*a._y+e*a._z;0>f?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,f=-f):this.copy(a);if(1<=f)return this._w=g,this._x=c,this._y=d,this._z=e,this;a=Math.acos(f);var h=Math.sqrt(1-f*f);if(.001>Math.abs(h))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;f=Math.sin((1-b)*a)/h;b=
Math.sin(b*a)/h;this._w=g*f+this._w*b;this._x=c*f+this._x*b;this._y=d*f+this._y*b;this._z=e*f+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,
c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*
c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,g=a.y,f=a.z;a=a.w;var h=a*b+g*d-f*c,k=a*c+f*b-e*d,l=a*d+e*c-g*b;b=-e*b-g*c-f*d;this.x=h*a+b*-e+k*-f-l*-g;this.y=k*a+b*-g+l*-e-h*-f;this.z=l*a+b*-f+h*-g-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),
unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=
a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,
b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=
d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,g=b.y;b=b.z;this.x=d*b-a*g;this.y=a*e-c*b;this.z=c*g-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(a,b){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
b){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;
return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+
2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],g=a[5],f=a[9];var h=a[2];var k=a[6];var l=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(f-k)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(f+k)&&.1>Math.abs(b+g+l-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;g=(g+1)/2;l=(l+1)/2;c=(c+e)/4;d=(d+h)/4;f=(f+k)/4;b>g&&b>l?.01>b?(k=0,c=h=.707106781):
(k=Math.sqrt(b),h=c/k,c=d/k):g>l?.01>g?(k=.707106781,h=0,c=.707106781):(h=Math.sqrt(g),k=c/h,c=f/h):.01>l?(h=k=.707106781,c=0):(c=Math.sqrt(l),k=d/c,h=f/c);this.set(k,h,c,a);return this}a=Math.sqrt((k-f)*(k-f)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(k-f)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+g+l-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};
THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var g=e[4],f=e[8],h=e[1],k=e[5],l=e[9],m=e[2],n=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-g,a)):(this._x=Math.atan2(n,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(f,e),this._z=Math.atan2(h,
k)):(this._y=Math.atan2(-m,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(-m,e),this._z=Math.atan2(-g,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(n,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-g,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(f,e))):"XZY"===b?(this._z=
Math.asin(-d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(n,k),this._y=Math.atan2(f,a)):(this._x=Math.atan2(-l,e),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,
b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){b=b||new THREE.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=THREE.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};
THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},
center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<
this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<
this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);
a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};
THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,g,f,h,k){var l=this.elements;l[0]=a;l[3]=b;l[6]=c;l[1]=d;l[4]=e;l[7]=g;l[2]=f;l[5]=h;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],f=a[5],h=a[6],k=a[7];a=a[8];return b*g*a-b*f*k-c*e*a+c*f*h+d*e*k-d*g*h},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];
a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,g,f,h,k,l,m,n,q,u,p,w){var v=this.elements;v[0]=a;v[4]=b;v[8]=c;v[12]=d;v[1]=e;v[5]=g;v[9]=f;v[13]=h;v[2]=k;v[6]=l;v[10]=m;v[14]=n;v[3]=q;v[7]=u;v[11]=p;v[15]=w;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
g=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*g;c[9]=b[9]*g;c[10]=b[10]*g;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,g=Math.cos(c);c=Math.sin(c);var f=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=g*h;var k=
g*e,l=c*h,m=c*e;b[0]=f*h;b[4]=-f*e;b[8]=d;b[1]=k+l*d;b[5]=a-m*d;b[9]=-c*f;b[2]=m-a*d;b[6]=l+k*d;b[10]=g*f}else"YXZ"===a.order?(a=f*h,k=f*e,l=d*h,m=d*e,b[0]=a+m*c,b[4]=l*c-k,b[8]=g*d,b[1]=g*e,b[5]=g*h,b[9]=-c,b[2]=k*c-l,b[6]=m+a*c,b[10]=g*f):"ZXY"===a.order?(a=f*h,k=f*e,l=d*h,m=d*e,b[0]=a-m*c,b[4]=-g*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=g*h,b[9]=m-a*c,b[2]=-g*d,b[6]=c,b[10]=g*f):"ZYX"===a.order?(a=g*h,k=g*e,l=c*h,m=c*e,b[0]=f*h,b[4]=l*d-k,b[8]=a*d+m,b[1]=f*e,b[5]=m*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*f,b[10]=g*
f):"YZX"===a.order?(a=g*f,k=g*d,l=c*f,m=c*d,b[0]=f*h,b[4]=m-a*e,b[8]=l*e+k,b[1]=e,b[5]=g*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-m*e):"XZY"===a.order&&(a=g*f,k=g*d,l=c*f,m=c*d,b[0]=f*h,b[4]=-e,b[8]=d*h,b[1]=a*e+m,b[5]=g*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=m*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,g=a.w,f=c+c,h=d+d,k=e+e;a=c*f;var l=c*h;c*=k;var m=d*h;d*=k;e*=k;f*=g;h*=g;g*=k;b[0]=1-(m+e);b[4]=l-g;b[8]=c+h;b[1]=l+g;b[5]=1-(a+e);b[9]=d-f;b[2]=c-h;b[6]=d+f;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g){var f=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(g,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);f[0]=a.x;f[4]=b.x;f[8]=c.x;f[1]=a.y;f[5]=b.y;f[9]=c.y;f[2]=a.z;f[6]=b.z;f[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],g=
c[8],f=c[12],h=c[1],k=c[5],l=c[9],m=c[13],n=c[2],q=c[6],u=c[10],p=c[14],w=c[3],v=c[7],y=c[11];c=c[15];var D=d[0],A=d[4],G=d[8],I=d[12],H=d[1],P=d[5],U=d[9],fa=d[13],C=d[2],Q=d[6],da=d[10],aa=d[14],X=d[3],S=d[7],O=d[11];d=d[15];b[0]=a*D+e*H+g*C+f*X;b[4]=a*A+e*P+g*Q+f*S;b[8]=a*G+e*U+g*da+f*O;b[12]=a*I+e*fa+g*aa+f*d;b[1]=h*D+k*H+l*C+m*X;b[5]=h*A+k*P+l*Q+m*S;b[9]=h*G+k*U+l*da+m*O;b[13]=h*I+k*fa+l*aa+m*d;b[2]=n*D+q*H+u*C+p*X;b[6]=n*A+q*P+u*Q+p*S;b[10]=n*G+q*U+u*da+p*O;b[14]=n*I+q*fa+u*aa+p*d;b[3]=w*D+
v*H+y*C+c*X;b[7]=w*A+v*P+y*Q+c*S;b[11]=w*G+v*U+y*da+c*O;b[15]=w*I+v*fa+y*aa+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=
a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],g=a[1],f=a[5],h=a[9],k=a[13],l=a[2],m=a[6],n=a[10],q=a[14];return a[3]*(+e*h*m-d*k*m-e*f*n+c*k*n+d*f*q-c*h*q)+a[7]*(+b*h*q-b*k*n+e*g*n-d*g*q+d*k*l-e*h*l)+a[11]*(+b*k*m-b*f*q-e*g*m+c*g*q+e*f*l-c*k*l)+a[15]*(-d*f*l-b*h*m+b*f*n+d*g*m-c*g*n+c*h*l)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],g=d[8],f=d[12],h=d[1],k=d[5],l=d[9],m=d[13],n=d[2],q=d[6],u=d[10],p=d[14],w=d[3],v=d[7],y=d[11];d=d[15];c[0]=l*p*v-m*u*v+m*q*y-k*p*y-l*q*d+k*u*d;c[4]=f*u*v-g*p*v-f*q*y+e*p*y+g*q*d-e*u*d;c[8]=g*m*v-f*l*v+f*k*y-e*m*y-g*k*d+e*l*d;c[12]=f*l*q-g*m*q-f*k*u+e*m*u+g*k*p-e*l*p;c[1]=m*u*w-l*
p*w-m*n*y+h*p*y+l*n*d-h*u*d;c[5]=g*p*w-f*u*w+f*n*y-a*p*y-g*n*d+a*u*d;c[9]=f*l*w-g*m*w-f*h*y+a*m*y+g*h*d-a*l*d;c[13]=g*m*n-f*l*n+f*h*u-a*m*u-g*h*p+a*l*p;c[2]=k*p*w-m*q*w+m*n*v-h*p*v-k*n*d+h*q*d;c[6]=f*q*w-e*p*w-f*n*v+a*p*v+e*n*d-a*q*d;c[10]=e*m*w-f*k*w+f*h*v-a*m*v-e*h*d+a*k*d;c[14]=f*k*n-e*m*n-f*h*q+a*m*q+e*h*p-a*k*p;c[3]=l*q*w-k*u*w-l*n*v+h*u*v+k*n*y-h*q*y;c[7]=e*u*w-g*q*w+g*n*v-a*u*v-e*n*y+a*q*y;c[11]=g*k*w-e*l*w-g*h*v+a*l*v+e*h*y-a*k*y;c[15]=e*l*n-g*k*n+g*h*q-a*l*q-e*h*u+a*k*u;c=a*c[0]+h*c[4]+n*
c[8]+w*c[12];if(0==c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,
c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,g=a.y;a=a.z;var f=d*e,h=d*g;this.set(f*e+c,f*g-b*a,f*a+b*
g,0,f*g+b*a,h*g+c,h*a-b*e,0,f*a-b*g,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var g=this.elements,f=a.set(g[0],g[1],g[2]).length(),h=a.set(g[4],g[5],g[6]).length(),k=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(f=-f);c.x=
g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);c=1/f;g=1/h;var l=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=f;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,g){var f=this.elements;f[0]=2*e/(b-a);f[4]=0;f[8]=(b+a)/(b-a);f[12]=0;f[1]=0;f[5]=2*e/(d-c);f[9]=(d+c)/(d-c);f[13]=0;f[2]=0;f[6]=0;f[10]=-(g+e)/(g-e);f[14]=-2*g*e/(g-e);f[3]=0;f[7]=
0;f[11]=-1;f[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,g){var f=this.elements,h=b-a,k=c-d,l=g-e;f[0]=2/h;f[4]=0;f[8]=0;f[12]=-((b+a)/h);f[1]=0;f[5]=2/k;f[9]=0;f[13]=-((c+d)/k);f[2]=0;f[6]=0;f[10]=-2/l;f[14]=-((g+e)/l);f[3]=0;f[7]=0;f[11]=0;f[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};
THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g,f,h){a.subVectors(f,e);b.subVectors(g,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);g=a.dot(c);var k=b.dot(b);f=b.dot(c);var l=d*k-e*e;h=h||new THREE.Vector3;if(0==l)return h.set(-2,-1,-1);l=1/l;k=(k*g-e*f)*l;d=(d*f-e*g)*l;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new THREE.Vector3;b.subVectors(a,this.origin);
a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g,f){a.copy(d).add(e).multiplyScalar(.5);
b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),m=-c.dot(b),n=c.lengthSq(),q=Math.abs(1-k*k);if(0<q){d=k*m-l;e=k*l-m;var u=h*q;0<=d?e>=-u?e<=u?(h=1/q,d*=h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*m)+n):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+n):(e=-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+n):e<=-u?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-m),h),k=-d*d+e*(e+2*m)+n):e<=u?(d=0,e=Math.min(Math.max(-h,-m),h),k=
e*(e+2*m)+n):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-m),h),k=-d*d+e*(e+2*m)+n)}else e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+n;g&&g.copy(this.direction).multiplyScalar(d).add(this.origin);f&&f.copy(b).multiplyScalar(e).add(a);return k}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*
b.radius;if(e>b)return null;b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,
b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,g=this.origin;if(0<=c){var f=(a.min.x-g.x)*c;c*=a.max.x-g.x}else f=(a.max.x-g.x)*c,c*=a.min.x-g.x;if(0<=d){var h=(a.min.y-g.y)*d;d*=a.max.y-g.y}else h=(a.max.y-g.y)*d,d*=a.min.y-g.y;if(f>d||h>c)return null;if(h>f||f!==f)f=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-g.z)*e,a=(a.max.z-g.z)*
e):(h=(a.max.z-g.z)*e,a=(a.min.z-g.z)*e);if(f>a||h>c)return null;if(h>f||f!==f)f=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=f?f:c,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,g,f,h,k){b.subVectors(g,e);c.subVectors(f,e);d.crossVectors(b,c);g=this.direction.dot(d);if(0<g){if(h)return null;h=1}else if(0>g)h=-1,g=-g;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>
e)return null;f=h*this.direction.dot(b.cross(a));if(0>f||e+f>g)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/g,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,g=b.length;e<g;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new THREE.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){c=c||new THREE.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var g=this.coplanarPoint(b);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},
scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",
a),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),
this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=
this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,d,e,g){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==g?g:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<
e;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&
(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,g=c.length;e<g;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var f=0;e=0;for(g=c.length;e<g;e+=3)b.set(c[e],c[e+1],c[e+2]),f=Math.max(f,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(f);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var g=new THREE.Vector3,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3;if(a.index)for(var m=a.index.array,n=0<this.offsets.length?this.offsets:[{start:0,count:m.length,index:0}],q=0,u=n.length;q<
u;++q){e=n[q].start;var p=n[q].count;var w=n[q].index;d=e;for(e+=p;d<e;d+=3){p=3*(w+m[d]);var v=3*(w+m[d+1]);var y=3*(w+m[d+2]);g.fromArray(b,p);f.fromArray(b,v);h.fromArray(b,y);k.subVectors(h,f);l.subVectors(g,f);k.cross(l);c[p]+=k.x;c[p+1]+=k.y;c[p+2]+=k.z;c[v]+=k.x;c[v+1]+=k.y;c[v+2]+=k.z;c[y]+=k.x;c[y+1]+=k.y;c[y+2]+=k.z}}else for(d=0,e=b.length;d<e;d+=9)g.fromArray(b,d),f.fromArray(b,d+3),h.fromArray(b,d+6),k.subVectors(h,f),l.subVectors(g,f),k.cross(l),c[d]=k.x,c[d+1]=k.y,c[d+2]=k.z,c[d+3]=
k.x,c[d+4]=k.y,c[d+5]=k.z,c[d+6]=k.x,c[d+7]=k.y,c[d+8]=k.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(ha,W,Da){n.fromArray(d,3*ha);q.fromArray(d,3*W);u.fromArray(d,3*Da);p.fromArray(g,2*ha);w.fromArray(g,2*W);v.fromArray(g,2*Da);y=q.x-n.x;D=u.x-n.x;A=q.y-n.y;G=u.y-n.y;I=q.z-n.z;H=u.z-n.z;P=w.x-p.x;U=v.x-p.x;fa=w.y-p.y;C=v.y-p.y;Q=1/(P*C-U*fa);da.set((C*y-fa*D)*Q,(C*A-fa*G)*Q,(C*I-fa*H)*Q);aa.set((P*D-U*y)*Q,(P*G-U*A)*Q,(P*H-U*I)*Q);k[ha].add(da);k[W].add(da);
k[Da].add(da);l[ha].add(aa);l[W].add(aa);l[Da].add(aa)}function b(ha){ka.fromArray(e,3*ha);ua.copy(ka);K=k[ha];xa.copy(K);xa.sub(ka.multiplyScalar(ka.dot(K))).normalize();T.crossVectors(ua,K);J=T.dot(l[ha]);wa=0>J?-1:1;h[4*ha]=xa.x;h[4*ha+1]=xa.y;h[4*ha+2]=xa.z;h[4*ha+3]=wa}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,g=this.attributes.uv.array,f=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*f),4));for(var h=this.attributes.tangent.array,k=[],l=[],m=0;m<f;m++)k[m]=new THREE.Vector3,l[m]=new THREE.Vector3;var n=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector2,w=new THREE.Vector2,v=new THREE.Vector2,y,D,A,G,I,H,
P,U,fa,C,Q,da=new THREE.Vector3,aa=new THREE.Vector3,X;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var S=this.drawcalls;m=0;for(X=S.length;m<X;++m){var O=S[m].start;var la=S[m].count;var R=S[m].index;f=O;for(O+=la;f<O;f+=3){la=R+c[f];var ra=R+c[f+1];var ma=R+c[f+2];a(la,ra,ma)}}var xa=new THREE.Vector3,T=new THREE.Vector3,ka=new THREE.Vector3,ua=new THREE.Vector3,wa,K,J;m=0;for(X=S.length;m<X;++m)for(O=S[m].start,la=S[m].count,R=S[m].index,f=O,O+=la;f<O;f+=3)la=R+c[f],ra=R+c[f+1],ma=
R+c[f+2],b(la),b(ra),b(ma)}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,g=a.length;e<g;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new THREE.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,g){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=g;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(THREE.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,e,g){THREE.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};
THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
THREE.BoxBufferGeometry=function(a,b,c,d,e,g){function f(q,u,p,w,v,y,D,A,G,I){var H=y/G,P=D/I,U=y/2,fa=D/2,C=A/2;D=G+1;var Q=I+1;y=0;var da,aa,X=new THREE.Vector3;for(aa=0;aa<Q;aa++){var S=aa*P-fa;for(da=0;da<D;da++)X[q]=(da*H-U)*w,X[u]=S*v,X[p]=C,k.push(X.x,X.y,X.z),X[q]=0,X[u]=0,X[p]=0<A?1:-1,l.push(X.x,X.y,X.z),m.push(da/G),m.push(1-aa/I),y+=1}for(aa=0;aa<I;aa++)for(da=0;da<G;da++)q=n+da+D*(aa+1),u=n+(da+1)+D*(aa+1),p=n+(da+1)+D*aa,h.push(n+da+D*aa,q,p),h.push(q,u,p);n+=y}THREE.BufferGeometry.call(this);
this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:g};d=Math.floor(d)||1;e=Math.floor(e)||1;g=Math.floor(g)||1;var h=[],k=[],l=[],m=[],n=0;f("z","y","x",-1,-1,c,b,a,g,e);f("z","y","x",1,-1,c,b,-a,g,e);f("x","z","y",1,1,a,c,b,d,g);f("x","z","y",1,-1,a,c,-b,d,g);f("x","y","z",1,-1,a,b,c,d,e);f("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=k.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(h),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(k),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(l),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(m),2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.SphereBufferGeometry=function(a,b,c,d,e,g,f){THREE.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:g,thetaLength:f};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;g=void 0!==g?g:0;f=void 0!==f?f:Math.PI;var h=g+f,k,l,m=0,n=[],q=new THREE.Vector3,u=new THREE.Vector3,p=[],w=[],v=[],y=[];for(l=0;l<=c;l++){var D=[],A=l/c;for(k=0;k<=b;k++){var G=k/b;q.x=-a*Math.cos(d+
G*e)*Math.sin(g+A*f);q.y=a*Math.cos(g+A*f);q.z=a*Math.sin(d+G*e)*Math.sin(g+A*f);w.push(q.x,q.y,q.z);u.set(q.x,q.y,q.z).normalize();v.push(u.x,u.y,u.z);y.push(G,1-A);D.push(m++)}n.push(D)}for(l=0;l<c;l++)for(k=0;k<b;k++)a=n[l][k+1],d=n[l][k],e=n[l+1][k],f=n[l+1][k+1],(0!==l||0<g)&&p.push(a,d,f),(l!==c-1||h<Math.PI)&&p.push(d,e,f);console.assert(65536>=w.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(p),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(w),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(v),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(y),2))};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,g=b/2;c=c||1;d=d||1;var f=c+1,h=d+1,k=a/c,l=b/d;b=new Float32Array(f*h*3);a=new Float32Array(f*h*3);for(var m=new Float32Array(f*h*2),n=0,q=0,u=0;u<h;u++)for(var p=u*l-g,w=0;w<f;w++)b[n]=w*k-e,b[n+1]=-p,a[n+2]=1,m[q]=w/c,m[q+1]=1-u/d,n+=3,q+=2;n=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(u=0;u<d;u++)for(w=
0;w<c;w++)g=w+f*(u+1),h=w+1+f*(u+1),k=w+1+f*u,e[n]=w+f*u,e[n+1]=g,e[n+2]=k,e[n+3]=g,e[n+4]=h,e[n+5]=k,n+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(m,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,d,e,g,f,h){function k(v){var y,D=new THREE.Vector2,A=new THREE.Vector3,G=!0===v?a:b,I=!0===v?1:-1;var H=u;for(y=1;y<=d;y++)m.push(0,w*I,0),n.push(0,I,0),q.push(.5,.5),u++;var P=u;for(y=0;y<=d;y++){var U=y/d*h+f,fa=Math.cos(U);U=Math.sin(U);A.x=G*U;A.y=w*I;A.z=G*fa;m.push(A.x,A.y,A.z);n.push(0,I,0);D.x=.5*fa+.5;D.y=.5*U*I+.5;q.push(D.x,D.y);u++}for(y=0;y<d;y++)D=H+y,A=P+y,!0===v?l.push(A,A+1,D):l.push(A+1,A,D)}THREE.BufferGeometry.call(this);this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:g,thetaStart:f,thetaLength:h};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;g=void 0!==g?g:!1;f=void 0!==f?f:0;h=void 0!==h?h:2*Math.PI;var l=[],m=[],n=[],q=[],u=0,p=[],w=c/2;(function(){var v,y,D=new THREE.Vector3,A=new THREE.Vector3,G=(b-a)/c;for(y=0;y<=e;y++){var I=[],H=y/e,P=H*(b-a)+a;for(v=0;v<=d;v++){var U=v/d,fa=U*h+f,C=Math.sin(fa);fa=Math.cos(fa);A.x=P*C;A.y=-H*
c+w;A.z=P*fa;m.push(A.x,A.y,A.z);D.set(C,G,fa).normalize();n.push(D.x,D.y,D.z);q.push(U,1-H);I.push(u++)}p.push(I)}for(v=0;v<d;v++)for(y=0;y<e;y++)D=p[y+1][v],A=p[y+1][v+1],G=p[y][v+1],l.push(p[y][v],D,G),l.push(D,A,G)})();!1===g&&(0<a&&k(!0),0<b&&k(!1));console.assert(65536>=m.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(l),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(m),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),
3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(q),2))};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var g=[],f=[],h=[],k=[],l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,q,u;for(q=0;q<=c;q++)for(u=0;u<=d;u++){var p=u/d*e,w=q/c*Math.PI*2;m.x=(a+b*Math.cos(w))*Math.cos(p);m.y=(a+b*Math.cos(w))*Math.sin(p);m.z=b*Math.sin(w);f.push(m.x,m.y,m.z);l.x=a*Math.cos(p);l.y=a*
Math.sin(p);n.subVectors(m,l).normalize();h.push(n.x,n.y,n.z);k.push(u/d);k.push(q/c)}for(q=1;q<=c;q++)for(u=1;u<=d;u++)a=(d+1)*(q-1)+u-1,b=(d+1)*(q-1)+u,e=(d+1)*q+u,g.push((d+1)*q+u-1,a,e),g.push(a,b,e);console.assert(65536>=f.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(g),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(f),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;(function(){function a(){var c={},d=window.location.hash;d&&d.substring(1).split("&").forEach(function(e){var g=e.indexOf("=");0<=g?c[e.substring(0,g)]=e.substring(g+1):c[e]=void 0});return c}function b(c){return c in a()}window.WALK={EDIT_MODE:b("editor"),DEBUG:b("debug"),DEBUG_SHARED_BUFFERS:b("debugbuffers"),ALWAYS_RENDER:!1,LOG_INFO:b("log"),LOG_TO_SERVER:!1,LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,CONTEXT_LOST_RESTORE_LIMIT:4,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,NO_ANISOTROPY:1,
FORCE_FXAA:!1,FORCE_WEBGL1:b("webgl1"),FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR:.05,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,MAX_GROUND_SEARCH_DEPTH:5.5,MATERIAL_PICKER_BALL_MAX_SIZE:.1,COVER_JSON_URL:"./cover.json",
AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_TARGET_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",EDITOR_SELECTION_COLOR:(new THREE.Color(5021401)).convertGammaToLinear(),
ALLOW_MOBILE_VR:!0,VR_FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:b("nomergetransparent"),urlHashContains:b,urlHashGetArgument:function(c){var d=a();return c in d&&void 0!==d[c]?decodeURI(d[c]):null},urlHashRemoveArgument:function(c){var d=a();return Object.keys(d).filter(function(e){return e!==c}).map(function(e){var g=d[e];return e+(void 0===g?"":"="+g)}).join("&")},TELEPORT_TO_VIEW_MAX_TIME:3,
TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_TO_VIEW_ACCELERATION:4,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},AVATAR_COLORS:"#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" ")};window.WebXRConfig={cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,
DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,
UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,
COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808}})();/*
 Copyright (C) 2014-present Shapespark
*/
(function(){function a(c,d,e){return function(){c!==d.length&&(e(d[c]),WALK.defer(a(c+1,d,e)))}}var b=2*Math.PI;WALK.defer=function(c){setTimeout(c,0)};WALK.iterateAsync=function(c,d){WALK.defer(a(0,c,d))};WALK.find=function(c,d){for(var e=0;e<c.length;e+=1){var g=c[e];if(d(g))return g}};WALK.filter=function(c,d){for(var e=c.length,g=[],f=0;f<e;f+=1)d(c[f])&&g.push(c[f]);return g};WALK.indexOfMax=function(c,d){if(0===c.length)return null;for(var e=0,g=d?d(c[0]):c[0],f=1;f<c.length;f+=1){var h=d?d(c[f]):
c[f];h>g&&(e=f,g=h)}return e};WALK.any=function(c,d){for(var e=c.length,g=0;g<e;g+=1)if(d(c[g]))return!0;return!1};WALK.removeFromArray=function(c,d){c=d.indexOf(c);console.assert(-1!==c);return d.splice(c,1)};WALK.copyProperties=function(c,d,e){for(var g=0;g<d.length;g+=1){var f=d[g],h=c[f];void 0!==h&&(e[f]=h)}};WALK.normalizeRotation=function(c){c%=b;return c>Math.PI?-b+c:c<-Math.PI?b+c:c};WALK.setTextContent=function(c,d){void 0!==c.textContent?c.textContent=d:void 0!==c.innerText?c.innerText=
d:console.warn("textContent and innerText properties are missing")};WALK.log2=function(c){return Math.log(c)/Math.log(2)};WALK.mipsCount=function(c,d){return WALK.log2(d)-WALK.log2(c)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(c){return c.ctrlKey||c.altKey||c.metaKey};WALK.round=function(c,d){void 0===d&&(d=3);return+(Math.round(c+"e+"+d)+"e-"+d)};WALK.preloadImage=function(c){var d=new Image;d.src=c;return d};
WALK.onVideoDataReady=function(c,d){function e(){c.readyState>=c.HAVE_CURRENT_DATA&&(c.removeEventListener("playing",e),c.removeEventListener("timeupdate",e),d(c))}c.readyState>=c.HAVE_CURRENT_DATA?d(c):(c.addEventListener("playing",e),c.addEventListener("timeupdate",e))};WALK.cloneObject=function(c){return JSON.parse(JSON.stringify(c))};WALK.readOnlyCopy=function(c){return"object"===typeof c?Object.freeze(WALK.cloneObject(c)):c};WALK.deepEqual=function(c,d){if(c===d)return!0;if("object"!==typeof c||
null===c||"object"!==typeof d||null===d||Object.keys(c).length!==Object.keys(d).length)return!1;for(var e=$jscomp.makeIterator(Object.keys(c)),g=e.next();!g.done;g=e.next())if(g=g.value,!d.hasOwnProperty(g)||!WALK.deepEqual(c[g],d[g]))return!1;return!0};WALK.executableOnlyOnce=function(c){var d=!1,e;return function(){if(d)return e;e=c();c=null;d=!0;return e}}})();(function(){function a(e,g,f){WALK.ICONS[e]={name:e,value:g,fontFamily:f}}function b(e,g){a(e,g,"FontAwesomeSolid")}function c(e,g){a(e,g,"FontAwesomeRegular")}function d(e,g){a(e,g,"FontAwesomeBrands")}WALK.ICONS={};b("address-book","\uf2b9");b("address-card","\uf2bb");b("area-chart","\uf1fe");b("arrows","\uf0b2");b("arrow-up","\uf062");b("arrow-down","\uf063");b("assistive-listening-systems","\uf2a2");b("asterisk","\uf069");b("audio-description","\uf29e");b("at","\uf1fa");b("bars","\uf0c9");b("bell",
"\uf0f3");b("book","\uf02d");b("bookmark","\uf02e");b("bullhorn","\uf0a1");b("calculator","\uf1ec");b("camera","\uf030");b("chart-bar","\uf080");b("chart-pie","\uf200");b("chevron-up","\uf077");b("chevron-down","\uf078");b("cloud","\uf0c2");b("cog","\uf013");b("comment","\uf075");c("compass","\uf14e");c("credit-card","\uf09d");b("crosshairs","\uf05b");b("desktop","\uf108");b("download","\uf019");b("envelope","\uf0e0");b("expand","\uf424");b("external-link","\uf35d");c("eye","\uf06e");b("eye-dropper",
"\uf1fb");b("film","\uf008");b("flag","\uf024");b("folder","\uf07b");b("gift","\uf06b");b("headphones","\uf025");b("highlighter","\uf591");b("home","\uf015");c("image","\uf03e");b("sign-in","\uf2f6");b("info","\uf129");c("lightbulb","\uf0eb");b("magic","\uf0d0");b("magnet","\uf076");b("map-marker","\uf3c5");b("map-pin","\uf276");b("map-signs","\uf277");b("paint-brush","\uf1fc");b("pencil","\uf303");b("pen","\uf304");b("phone","\uf095");b("question","\uf128");b("search","\uf002");b("share","\uf064");
b("share-alt","\uf1e0");b("shopping-cart","\uf07a");b("sliders","\uf1de");b("star","\uf005");c("sticky-note","\uf249");b("sync","\uf2f1");c("edit","\uf044");b("tachometer","\uf3fd");b("tag","\uf02b");b("video","\uf03d");b("wrench","\uf0ad");b("palette","\uf53f");b("paint-roller","\uf5aa");b("play","\uf04b");b("plus","\uf067");d("youtube","\uf167");d("vimeo","\uf40a");d("facebook","\uf09a");d("twitter","\uf099");d("instagram","\uf16d");d("linkedin","\uf08c");d("skype","\uf17e");d("whatsapp","\uf232");
d("facebook-messenger","\uf39f");d("telegram","\uf2c6");d("slack","\uf198")})();(function(){function a(l,m){return function(n){h.finished(l);m(n)}}function b(l){this.method=l;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===l?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelay=.5+Math.random()):this.retryDelay=this.retriesLeft=0}function c(l,m,n,q,u){setTimeout(function(){d(l,m,n,q,u)},m.retryDelay);m.retryScheduled()}function d(l,m,n,q,u){function p(D,A){var G;0<=y.getAllResponseHeaders().toLowerCase().indexOf("content-encoding:")&&(G=y.getResponseHeader("content-encoding"));
"br"!==G?A(D):k.decode(D,A)}function w(){var D=y.status||0;D="GET"===m.method&&(500<=D||0===D)?0!==m.retriesLeft:!1;console.warn("Failed to "+m.method+": "+l+" ("+y.status+")"+(D?", retrying in "+m.retryDelay+"s":""));if(D)c(l,m,n,q,u);else if(void 0!==q){try{var A=JSON.parse(y.responseText).message}catch(G){A=void 0}q(y.status,A)}m=y=null}function v(){if(void 0!==n)if(m.binaryResult)p(y.response,n);else{var D=y.getResponseHeader("content-type"),A=y.responseText;A&&-1!==D.indexOf("text/plain")?p(A,
n):A?p(A,function(G){n(JSON.parse(G))}):n()}m=y=null}var y=new XMLHttpRequest;void 0!==u&&y.addEventListener("progress",u,!1);y.addEventListener("load",function(){200<=y.status&&300>y.status||0===y.status?v():w()},!1);y.addEventListener("error",w,!1);y.addEventListener("abort",w,!1);y.open(m.method,l,!0);m.binaryResult&&(y.responseType="arraybuffer");m.dataContentType&&y.setRequestHeader("Content-Type",m.dataContentType);"POST"===m.method&&y.setRequestHeader("X-Requested-By","Shapespark");y.send(m.data)}
function e(l,m,n,q,u){function p(){l(m,n,q,u)}return function(){console.warn("Failed to get: "+m+(p?", retrying in "+n.retryDelay+"s":""));0<n.retriesLeft?(setTimeout(p,n.retryDelay),n.retryScheduled()):u()}}function g(l,m,n,q){var u=new Image;u.onload=function(){n(u);u=null};u.onerror=e(g,l,m,n,q);u.crossOrigin="anonymous";u.src=l}function f(l,m,n,q){var u=document.createElement("video");u.autoplay=!0;u.muted=!0;u.loop=!0;u.setAttribute("playsinline","");u.setAttribute("webkit-playsinline","");u.crossOrigin=
"anonymous";u.onerror=e(f,l,m,n,q);WALK.onVideoDataReady(u,function(){u.onerror=void 0;n(u);u=null});u.src=l;u.play().catch(function(){})}var h=new function(){function l(){for(q+=1;q<m.length;q+=1){var u=m[q];if(0<u.length){for(var p=0;p<u.length;p+=1)n[q]+=1,WALK.defer(u[p]);u.length=0;break}}}var m=[],n=[],q=Infinity;(function(){var u=0,p;for(p in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(p)&&(u=Math.max(u,WALK.LOAD_PRIORITY[p]));for(p=0;p<=u;p+=1)m[p]=[],n[p]=0})();this.add=function(u,
p){u<=q?(n[u]+=1,q=u,WALK.defer(p)):(m[u].push(p),0===n[q]&&l())};this.finished=function(u){--n[u];var p=n[u];console.assert(0<=p);u===q&&0===p&&l()}},k=new function(){function l(q){q=new Int8Array(q);return(new BrotliDecode(q)).buffer}var m=[],n=!1;this.decode=function(q,u){!1===WALK.DETECTOR.brotliJsDecode?u(q):!0===n?u(l(q)):(m.push([u,q]),1===m.length&&WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/brotli.min.js"),function(){n=!0;for(var p=0;p<m.length;p+=1){var w=$jscomp.makeIterator(m[p]),
v=w.next().value;w=w.next().value;v(l(w))}m=null},function(){return WALK.USER_MSG.error("Cannot load required library")}))}};b.prototype={constructor:b,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelay*=2}};WALK.ajaxGet=function(l,m,n,q,u){var p=new b("GET");p.binaryResult=m;d(l,p,n,q,u)};WALK.queueAjaxGet=function(l,m,n,q,u,p){h.add(l,function(){WALK.ajaxGet(m,n,a(l,q),a(l,u),p)})};WALK.ajaxPost=function(l,m,n,q,u,p){var w=new b("POST");w.data=n;w.dataContentType=
m;d(l,w,q,u,p)};WALK.queueImageGet=function(l,m,n,q){h.add(l,function(){var u=new b("GET");g(m,u,a(l,n),a(l,q))})};WALK.queueVideoGet=function(l,m,n,q){h.add(l,function(){var u=new b("GET");f(m,u,a(l,n),a(l,q))})};WALK.loadScriptAndExecute=function(){function l(u){n.add(u);var p=q.get(u);q.delete(u);p.forEach(function(w){try{(0,w.onSuccess)()}catch(v){console.log(v)}})}function m(u){var p=q.get(u);q.delete(u);console.error("Can't load script : "+u);p.forEach(function(w){if(void 0!==w.onError){w=w.onError.bind(null,
u);try{w()}catch(v){console.log(v)}}})}var n=new Set,q=new Map;return function(u,p,w){if(n.has(u))p();else if(q.has(u))q.get(u).push({onSuccess:p,onError:w});else{q.set(u,[{onSuccess:p,onError:w}]);p=l.bind(this,u);w=m.bind(this,u);var v=document.createElement("script");v.onload=p;v.onerror=w;v.src=u;v.type="text/javascript";document.body.appendChild(v)}}}();WALK.loadScriptsUrlAndExecute=function(l,m,n){function q(u){return new Promise(function(p,w){WALK.loadScriptAndExecute(u,p,w)})}l=l.map(function(u){return q(u)});
Promise.all(l).then(m).catch(function(u){void 0!==n&&n(u)})}})();(function(){function a(c,d){for(c=c.toString();c.length<d;)c="0"+c;return c}function b(c){var d=console[c].bind(console);console[c]=function(){for(var e="",g="",f=0;f<arguments.length;++f)g+=(0===f?"":" ")+arguments[f];WALK.LOG_TIME&&(e=new Date,e=a(e.getHours(),2)+":"+a(e.getMinutes(),2)+":"+a(e.getSeconds(),2)+","+a(e.getMilliseconds(),3)+" ");f=e+c.toUpperCase()+" "+g;WALK.LOG_TO_SERVER&&WALK.ajaxPost("/log","application/json",JSON.stringify({message:f}));d(e+g)}}WALK.log=WALK.LOG_INFO?function(c){for(var d=
[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];console.log.apply(console,$jscomp.arrayFromIterable(d))}:function(){};if(WALK.LOG_TO_SERVER||WALK.LOG_TIME)b("log"),b("info"),b("warn"),b("error")})();/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.WebXRPolyfill=b()})(this,function(){function a(){var r=new O(16);O!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0);r[0]=1;r[5]=1;r[10]=1;r[15]=1;return r}function b(r){r[0]=1;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=1;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=0;r[13]=0;r[14]=0;r[15]=1;return r}function c(r,
x){var E=x[0],F=x[1],ba=x[2],qa=x[3],sa=x[4],La=x[5],Sa=x[6],Va=x[7],Ta=x[8],fb=x[9],tb=x[10],jb=x[11],kb=x[12],ib=x[13],ub=x[14];x=x[15];var bb=E*La-F*sa,Wa=E*Sa-ba*sa,lb=E*Va-qa*sa,mb=F*Sa-ba*La,Ya=F*Va-qa*La,Gb=ba*Va-qa*Sa,Mb=Ta*ib-fb*kb,Nb=Ta*ub-tb*kb,Kb=Ta*x-jb*kb,Ob=fb*ub-tb*ib,Pb=fb*x-jb*ib,Lb=tb*x-jb*ub,pb=bb*Lb-Wa*Pb+lb*Ob+mb*Kb-Ya*Nb+Gb*Mb;if(!pb)return null;pb=1/pb;r[0]=(La*Lb-Sa*Pb+Va*Ob)*pb;r[1]=(ba*Pb-F*Lb-qa*Ob)*pb;r[2]=(ib*Gb-ub*Ya+x*mb)*pb;r[3]=(tb*Ya-fb*Gb-jb*mb)*pb;r[4]=(Sa*Kb-
sa*Lb-Va*Nb)*pb;r[5]=(E*Lb-ba*Kb+qa*Nb)*pb;r[6]=(ub*lb-kb*Gb-x*Wa)*pb;r[7]=(Ta*Gb-tb*lb+jb*Wa)*pb;r[8]=(sa*Pb-La*Kb+Va*Mb)*pb;r[9]=(F*Kb-E*Pb-qa*Mb)*pb;r[10]=(kb*Ya-ib*lb+x*bb)*pb;r[11]=(fb*lb-Ta*Ya-jb*bb)*pb;r[12]=(La*Nb-sa*Ob-Sa*Mb)*pb;r[13]=(E*Ob-F*Nb+ba*Mb)*pb;r[14]=(ib*Wa-kb*mb-ub*bb)*pb;r[15]=(Ta*mb-fb*Wa+tb*bb)*pb;return r}function d(r,x,E){var F=x[0],ba=x[1],qa=x[2],sa=x[3],La=x[4],Sa=x[5],Va=x[6],Ta=x[7],fb=x[8],tb=x[9],jb=x[10],kb=x[11],ib=x[12],ub=x[13],bb=x[14];x=x[15];var Wa=E[0],lb=
E[1],mb=E[2],Ya=E[3];r[0]=Wa*F+lb*La+mb*fb+Ya*ib;r[1]=Wa*ba+lb*Sa+mb*tb+Ya*ub;r[2]=Wa*qa+lb*Va+mb*jb+Ya*bb;r[3]=Wa*sa+lb*Ta+mb*kb+Ya*x;Wa=E[4];lb=E[5];mb=E[6];Ya=E[7];r[4]=Wa*F+lb*La+mb*fb+Ya*ib;r[5]=Wa*ba+lb*Sa+mb*tb+Ya*ub;r[6]=Wa*qa+lb*Va+mb*jb+Ya*bb;r[7]=Wa*sa+lb*Ta+mb*kb+Ya*x;Wa=E[8];lb=E[9];mb=E[10];Ya=E[11];r[8]=Wa*F+lb*La+mb*fb+Ya*ib;r[9]=Wa*ba+lb*Sa+mb*tb+Ya*ub;r[10]=Wa*qa+lb*Va+mb*jb+Ya*bb;r[11]=Wa*sa+lb*Ta+mb*kb+Ya*x;Wa=E[12];lb=E[13];mb=E[14];Ya=E[15];r[12]=Wa*F+lb*La+mb*fb+Ya*ib;r[13]=
Wa*ba+lb*Sa+mb*tb+Ya*ub;r[14]=Wa*qa+lb*Va+mb*jb+Ya*bb;r[15]=Wa*sa+lb*Ta+mb*kb+Ya*x;return r}function e(r,x,E){var F=x[0],ba=x[1],qa=x[2],sa=x[3],La=F+F,Sa=ba+ba,Va=qa+qa;x=F*La;var Ta=F*Sa;F*=Va;var fb=ba*Sa;ba*=Va;qa*=Va;La*=sa;Sa*=sa;sa*=Va;r[0]=1-(fb+qa);r[1]=Ta+sa;r[2]=F-Sa;r[3]=0;r[4]=Ta-sa;r[5]=1-(x+qa);r[6]=ba+La;r[7]=0;r[8]=F+Sa;r[9]=ba-La;r[10]=1-(x+fb);r[11]=0;r[12]=E[0];r[13]=E[1];r[14]=E[2];r[15]=1;return r}function g(r,x){r[0]=x[12];r[1]=x[13];r[2]=x[14];return r}function f(r,x){var E=
x[0]+x[5]+x[10];0<E?(E=2*Math.sqrt(E+1),r[3]=.25*E,r[0]=(x[6]-x[9])/E,r[1]=(x[8]-x[2])/E,r[2]=(x[1]-x[4])/E):x[0]>x[5]&&x[0]>x[10]?(E=2*Math.sqrt(1+x[0]-x[5]-x[10]),r[3]=(x[6]-x[9])/E,r[0]=.25*E,r[1]=(x[1]+x[4])/E,r[2]=(x[8]+x[2])/E):x[5]>x[10]?(E=2*Math.sqrt(1+x[5]-x[0]-x[10]),r[3]=(x[8]-x[2])/E,r[0]=(x[1]+x[4])/E,r[1]=.25*E,r[2]=(x[6]+x[9])/E):(E=2*Math.sqrt(1+x[10]-x[0]-x[5]),r[3]=(x[1]-x[4])/E,r[0]=(x[8]+x[2])/E,r[1]=(x[6]+x[9])/E,r[2]=.25*E);return r}function h(r,x,E,F,ba){x=1/Math.tan(x/2);
r[0]=x/E;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=x;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[11]=-1;r[12]=0;r[13]=0;r[15]=0;null!=ba&&Infinity!==ba?(E=1/(F-ba),r[10]=(ba+F)*E,r[14]=2*ba*F*E):(r[10]=-1,r[14]=-2*F);return r}function k(){var r=new O(3);O!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0);return r}function l(r){var x=new O(3);x[0]=r[0];x[1]=r[1];x[2]=r[2];return x}function m(r,x,E){var F=new O(3);F[0]=r;F[1]=x;F[2]=E;return F}function n(r,x){r[0]=x[0];r[1]=x[1];r[2]=x[2];return r}function q(r,x,E){r[0]=x[0]+E[0];r[1]=
x[1]+E[1];r[2]=x[2]+E[2];return r}function u(r,x,E){r[0]=x[0]*E;r[1]=x[1]*E;r[2]=x[2]*E;return r}function p(r,x){var E=x[0],F=x[1],ba=x[2];E=E*E+F*F+ba*ba;0<E&&(E=1/Math.sqrt(E),r[0]=x[0]*E,r[1]=x[1]*E,r[2]=x[2]*E);return r}function w(r,x){return r[0]*x[0]+r[1]*x[1]+r[2]*x[2]}function v(r,x,E){var F=x[0],ba=x[1];x=x[2];var qa=E[0],sa=E[1];E=E[2];r[0]=ba*E-x*sa;r[1]=x*qa-F*E;r[2]=F*sa-ba*qa;return r}function y(r,x,E){var F=E[0],ba=E[1],qa=E[2],sa=x[0],La=x[1];x=x[2];var Sa=ba*x-qa*La,Va=qa*sa-F*x,
Ta=F*La-ba*sa;E=2*E[3];r[0]=sa+Sa*E+2*(ba*Ta-qa*Va);r[1]=La+Va*E+2*(qa*Sa-F*Ta);r[2]=x+Ta*E+2*(F*Va-ba*Sa);return r}function D(){var r=new O(9);O!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0);r[0]=1;r[4]=1;r[8]=1;return r}function A(){var r=new O(4);O!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0);return r}function G(){var r=new O(4);O!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0);r[3]=1;return r}function I(r,x,E){var F=x[0],ba=x[1],qa=x[2];x=x[3];var sa=E[0],La=E[1],Sa=E[2];E=E[3];r[0]=F*E+x*
sa+ba*Sa-qa*La;r[1]=ba*E+x*La+qa*sa-F*Sa;r[2]=qa*E+x*Sa+F*La-ba*sa;r[3]=x*E-F*sa-ba*La-qa*Sa;return r}function H(r,x,E,F){var ba=x[0],qa=x[1],sa=x[2];x=x[3];var La=E[0],Sa=E[1],Va=E[2];E=E[3];var Ta=ba*La+qa*Sa+sa*Va+x*E;0>Ta&&(Ta=-Ta,La=-La,Sa=-Sa,Va=-Va,E=-E);if(1E-6<1-Ta){var fb=Math.acos(Ta);var tb=Math.sin(fb);Ta=Math.sin((1-F)*fb)/tb;F=Math.sin(F*fb)/tb}else Ta=1-F;r[0]=Ta*ba+F*La;r[1]=Ta*qa+F*Sa;r[2]=Ta*sa+F*Va;r[3]=Ta*x+F*E;return r}function P(r,x){var E=x[0],F=x[1],ba=x[2];x=x[3];var qa=
E*E+F*F+ba*ba+x*x;qa=qa?1/qa:0;r[0]=-E*qa;r[1]=-F*qa;r[2]=-ba*qa;r[3]=x*qa;return r}function U(r,x){r=new Event(r,x);r[ta]={frame:x.frame,inputSource:x.inputSource};Object.setPrototypeOf(r,U.prototype);Object.defineProperty(r,"frame",{get:function(){return this[ta].frame}});Object.defineProperty(r,"inputSource",{get:function(){return this[ta].inputSource}});return r}function fa(r,x){r=new Event(r,x);r[Ia]={session:x.session};Object.setPrototypeOf(r,fa.prototype);Object.defineProperty(r,"session",
{get:function(){return this[Ia].session}});return r}function C(r,x){r=new Event(r,x);r[Ea]={session:x.session,added:x.added,removed:x.removed};Object.setPrototypeOf(r,C.prototype);Object.defineProperty(r,"session",{get:function(){return this[Ea].session}});Object.defineProperty(r,"added",{get:function(){return this[Ea].added}});Object.defineProperty(r,"removed",{get:function(){return this[Ea].removed}});return r}function Q(r,x){r=new Event(r,x);r[qb]={referenceSpace:x.referenceSpace,transform:x.transform||
null};Object.setPrototypeOf(r,Q.prototype);Object.defineProperty(r,"referenceSpace",{get:function(){return this[qb].referenceSpace}});Object.defineProperty(r,"transform",{get:function(){return this[qb].transform}});return r}function da(r,x,E){function F(Sa,Va,Ta){return Sa<Va?Va:Sa>Ta?Ta:Sa}var ba=x[0]*x[0],qa=x[1]*x[1],sa=x[2]*x[2],La=x[3]*x[3];"XYZ"===E?(r[0]=Math.atan2(2*(x[0]*x[3]-x[1]*x[2]),La-ba-qa+sa),r[1]=Math.asin(F(2*(x[0]*x[2]+x[1]*x[3]),-1,1)),r[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),La+
ba-qa-sa)):"YXZ"===E?(r[0]=Math.asin(F(2*(x[0]*x[3]-x[1]*x[2]),-1,1)),r[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),La-ba-qa+sa),r[2]=Math.atan2(2*(x[0]*x[1]+x[2]*x[3]),La-ba+qa-sa)):"ZXY"===E?(r[0]=Math.asin(F(2*(x[0]*x[3]+x[1]*x[2]),-1,1)),r[1]=Math.atan2(2*(x[1]*x[3]-x[2]*x[0]),La-ba-qa+sa),r[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),La-ba+qa-sa)):"ZYX"===E?(r[0]=Math.atan2(2*(x[0]*x[3]+x[2]*x[1]),La-ba-qa+sa),r[1]=Math.asin(F(2*(x[1]*x[3]-x[0]*x[2]),-1,1)),r[2]=Math.atan2(2*(x[0]*x[1]+x[2]*x[3]),La+ba-
qa-sa)):"YZX"===E?(r[0]=Math.atan2(2*(x[0]*x[3]-x[2]*x[1]),La-ba+qa-sa),r[1]=Math.atan2(2*(x[1]*x[3]-x[0]*x[2]),La+ba-qa-sa),r[2]=Math.asin(F(2*(x[0]*x[1]+x[2]*x[3]),-1,1))):"XZY"===E?(r[0]=Math.atan2(2*(x[0]*x[3]+x[1]*x[2]),La-ba+qa-sa),r[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),La+ba-qa-sa),r[2]=Math.asin(F(2*(x[2]*x[3]-x[0]*x[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var aa="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{},X=Symbol("@@webxr-polyfill/EventTarget"),S=function(){this[X]={listeners:new Map}};S.prototype.addEventListener=function(r,x){if("string"!==typeof r)throw Error("`type` must be a string");if("function"!==typeof x)throw Error("`listener` must be a function");var E=this[X].listeners.get(r)||[];E.push(x);this[X].listeners.set(r,E)};S.prototype.removeEventListener=function(r,x){if("string"!==typeof r)throw Error("`type` must be a string");if("function"!==typeof x)throw Error("`listener` must be a function");
r=this[X].listeners.get(r)||[];for(var E=r.length;0<=E;E--)r[E]===x&&r.pop()};S.prototype.dispatchEvent=function(r,x){for(var E=this[X].listeners.get(r)||[],F=[],ba=0;ba<E.length;ba++)F[ba]=E[ba];E=$jscomp.makeIterator(F);for(F=E.next();!F.done;F=E.next())F=F.value,F(x);if("function"===typeof this["on"+r])this["on"+r](x)};var O="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var r=k();return function(x,E,F,ba,qa,sa){E||(E=3);F||(F=0);for(ba=ba?Math.min(ba*E+F,x.length):x.length;F<
ba;F+=E)r[0]=x[F],r[1]=x[F+1],r[2]=x[F+2],qa(r,r,sa),x[F]=r[0],x[F+1]=r[1],x[F+2]=r[2];return x}})();(function(){var r=A();return function(x,E,F,ba,qa,sa){E||(E=4);F||(F=0);for(ba=ba?Math.min(ba*E+F,x.length):x.length;F<ba;F+=E)r[0]=x[F],r[1]=x[F+1],r[2]=x[F+2],r[3]=x[F+3],qa(r,r,sa),x[F]=r[0],x[F+1]=r[1],x[F+2]=r[2],x[F+3]=r[3];return x}})();var la=function(r){var x=new O(4);x[0]=r[0];x[1]=r[1];x[2]=r[2];x[3]=r[3];return x},R=function(r,x){r[0]=x[0];r[1]=x[1];r[2]=x[2];r[3]=x[3];return r},ra=function(r,
x){var E=x[0],F=x[1],ba=x[2];x=x[3];var qa=E*E+F*F+ba*ba+x*x;0<qa&&(qa=1/Math.sqrt(qa),r[0]=E*qa,r[1]=F*qa,r[2]=ba*qa,r[3]=x*qa);return r};(function(){var r=k(),x=m(1,0,0),E=m(0,1,0);return function(F,ba,qa){var sa=w(ba,qa);if(-.999999>sa){v(r,x,ba);qa=r[0];sa=r[1];var La=r[2];1E-6>Math.sqrt(qa*qa+sa*sa+La*La)&&v(r,E,ba);p(r,r);ba=Math.PI;ba*=.5;qa=Math.sin(ba);F[0]=qa*r[0];F[1]=qa*r[1];F[2]=qa*r[2];F[3]=Math.cos(ba);return F}if(.999999<sa)return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F;v(r,ba,qa);F[0]=r[0];
F[1]=r[1];F[2]=r[2];F[3]=1+sa;return ra(F,F)}})();(function(){var r=G(),x=G();return function(E,F,ba,qa,sa,La){H(r,F,sa,La);H(x,ba,qa,La);H(E,r,x,2*La*(1-La));return E}})();(function(){var r=D();return function(x,E,F,ba){r[0]=F[0];r[3]=F[1];r[6]=F[2];r[1]=ba[0];r[4]=ba[1];r[7]=ba[2];r[2]=-E[0];r[5]=-E[1];r[8]=-E[2];E=r[0]+r[4]+r[8];if(0<E)E=Math.sqrt(E+1),x[3]=.5*E,E=.5/E,x[0]=(r[5]-r[7])*E,x[1]=(r[6]-r[2])*E,x[2]=(r[1]-r[3])*E;else{F=0;r[4]>r[0]&&(F=1);r[8]>r[3*F+F]&&(F=2);ba=(F+1)%3;var qa=(F+2)%
3;E=Math.sqrt(r[3*F+F]-r[3*ba+ba]-r[3*qa+qa]+1);x[F]=.5*E;E=.5/E;x[3]=(r[3*ba+qa]-r[3*qa+ba])*E;x[ba]=(r[3*ba+F]+r[3*F+ba])*E;x[qa]=(r[3*qa+F]+r[3*F+qa])*E}return ra(x,x)}})();if(!("DOMPointReadOnly"in window)){var ma=Symbol("@@webxr-polyfill/DOMPointReadOnly"),xa=function(r,x,E,F){if(1===arguments.length)this[ma]={x:r.x,y:r.y,z:r.z,w:r.w};else if(4===arguments.length)this[ma]={x:r,y:x,z:E,w:F};else throw new TypeError("Must supply either 1 or 4 arguments");};xa.fromPoint=function(r){return new xa(r.x,
r.y,r.z,r.w)};$jscomp.global.Object.defineProperties(xa.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[ma].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[ma].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[ma].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[ma].w}}});window.DOMPointReadOnly=xa}var T=Symbol("@@webxr-polyfill/XRRigidTransform"),ka=function(){this[T]={matrix:null,position:null,orientation:null,inverse:null};if(0===
arguments.length)this[T].matrix=b(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?this[T].matrix=arguments[0]:(this[T].position=this._getPoint(arguments[0]),this[T].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[T].position=this._getPoint(arguments[0]),this[T].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[T].matrix){var r=k();g(r,this[T].matrix);this[T].position=DOMPointReadOnly.fromPoint({x:r[0],
y:r[1],z:r[2]});r=G();f(r,this[T].matrix);this[T].orientation=DOMPointReadOnly.fromPoint({x:r[0],y:r[1],z:r[2],w:r[3]})}else{this[T].matrix=b(new Float32Array(16));r=this[T].matrix;var x=this[T].orientation.x,E=this[T].orientation.y,F=this[T].orientation.z,ba=this[T].orientation.w,qa=new O(4);qa[0]=x;qa[1]=E;qa[2]=F;qa[3]=ba;e(r,qa,m(this[T].position.x,this[T].position.y,this[T].position.z))}};ka.prototype._getPoint=function(r){return r instanceof DOMPointReadOnly?r:DOMPointReadOnly.fromPoint(r)};
$jscomp.global.Object.defineProperties(ka.prototype,{matrix:{configurable:!0,enumerable:!0,get:function(){return this[T].matrix}},position:{configurable:!0,enumerable:!0,get:function(){return this[T].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[T].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[T].inverse){var r=b(new Float32Array(16));c(r,this[T].matrix);this[T].inverse=new ka(r);this[T].inverse[T].inverse=this}return this[T].inverse}}});
var ua=Symbol("@@webxr-polyfill/XRSpace"),wa=function(r,x){this[ua]={specialType:void 0===r?null:r,inputSource:void 0===x?null:x,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}};wa.prototype._ensurePoseUpdated=function(r,x){x!=this[ua].lastFrameId&&(this[ua].lastFrameId=x,this._onPoseUpdate(r))};wa.prototype._onPoseUpdate=function(r){"viewer"==this[ua].specialType&&(this._baseMatrix=r.getBasePoseMatrix())};wa.prototype._getSpaceRelativeTransform=function(r){if(!this._inverseBaseMatrix||!r._baseMatrix)return null;
var x=new Float32Array(16);d(x,this._inverseBaseMatrix,r._baseMatrix);return new ka(x)};$jscomp.global.Object.defineProperties(wa.prototype,{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[ua].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[ua].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(r){this[ua].baseMatrix=r;this[ua].inverseBaseMatrix=null},get:function(){!this[ua].baseMatrix&&this[ua].inverseBaseMatrix&&(this[ua].baseMatrix=
new Float32Array(16),c(this[ua].baseMatrix,this[ua].inverseBaseMatrix));return this[ua].baseMatrix}},_inverseBaseMatrix:{configurable:!0,enumerable:!0,set:function(r){this[ua].inverseBaseMatrix=r;this[ua].baseMatrix=null},get:function(){!this[ua].inverseBaseMatrix&&this[ua].baseMatrix&&(this[ua].inverseBaseMatrix=new Float32Array(16),c(this[ua].inverseBaseMatrix,this[ua].baseMatrix));return this[ua].inverseBaseMatrix}}});var K=Symbol("@@webxr-polyfill/XRReferenceSpace"),J=["viewer","local","local-floor",
"bounded-floor","unbounded"],ha=function(r,x){x=void 0===x?null:x;if(!J.includes(r))throw Error("XRReferenceSpaceType must be one of "+J);var E=wa.call(this,r)||this;if("bounded-floor"===r&&!x)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==r&&"local-floor"!==r||x||(x=b(new Float32Array(16)),x[13]=1.6);E._inverseBaseMatrix=x||b(new Float32Array(16));E[K]={type:r,transform:x,originOffset:b(new Float32Array(16))};return E};
$jscomp.inherits(ha,wa);ha.prototype._transformBasePoseMatrix=function(r,x){d(r,this._inverseBaseMatrix,x)};ha.prototype._originOffsetMatrix=function(){return this[K].originOffset};ha.prototype._adjustForOriginOffset=function(r){var x=new Float32Array(16);c(x,this[K].originOffset);d(r,x,r)};ha.prototype._getSpaceRelativeTransform=function(r){r=wa.prototype._getSpaceRelativeTransform.call(this,r);this._adjustForOriginOffset(r.matrix);return new XRRigidTransform(r.matrix)};ha.prototype.getOffsetReferenceSpace=
function(r){var x=new ha(this[K].type,this[K].transform,this[K].bounds);d(x[K].originOffset,this[K].originOffset,r.matrix);return x};var W=Symbol("@@webxr-polyfill/XR"),Da=["inline","immersive-vr","immersive-ar"],Ba={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},Ga=function(r){var x=S.call(this)||this;x[W]={device:null,devicePromise:r,immersiveSession:null,
inlineSessions:new Set};r.then(function(E){x[W].device=E});return x};$jscomp.inherits(Ga,S);Ga.prototype.isSessionSupported=function(r){var x=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return 1==E.nextAddress?x[W].device?E.jumpTo(2):E.yield(x[W].devicePromise,2):"inline"!=r?E.return(Promise.resolve(x[W].device.isSessionSupported(r))):E.return(Promise.resolve(!0))})};Ga.prototype.requestSession=function(r,x){var E=this,F,ba,qa,sa,La,Sa,Va,Ta,fb,tb,jb,kb,ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==
ub.nextAddress){if(E[W].device)return ub.jumpTo(2);if("inline"!=r)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");return ub.yield(E[W].devicePromise,2)}if(5!=ub.nextAddress){if(!Da.includes(r))throw new TypeError("The provided value '"+r+"' is not a valid enum value of type XRSessionMode");
F=Ba[r];ba=F.requiredFeatures.concat(x&&x.requiredFeatures?x.requiredFeatures:[]);qa=F.optionalFeatures.concat(x&&x.optionalFeatures?x.optionalFeatures:[]);sa=new Set;La=!1;Sa=$jscomp.makeIterator(ba);for(Va=Sa.next();!Va.done;Va=Sa.next())Ta=Va.value,E[W].device.isFeatureSupported(Ta)?sa.add(Ta):(console.error("The required feature '"+Ta+"' is not supported"),La=!0);if(La)throw new DOMException("Session does not support some required features","NotSupportedError");fb=$jscomp.makeIterator(qa);for(Va=
fb.next();!Va.done;Va=fb.next())tb=Va.value,E[W].device.isFeatureSupported(tb)?sa.add(tb):console.log("The optional feature '"+tb+"' is not supported");return ub.yield(E[W].device.requestSession(r,sa),5)}jb=ub.yieldResult;kb=new XRSession(E[W].device,r,jb);"inline"==r?E[W].inlineSessions.add(kb):E[W].immersiveSession=kb;ib=function(){"inline"==r?E[W].inlineSessions.delete(kb):E[W].immersiveSession=null;kb.removeEventListener("end",ib)};kb.addEventListener("end",ib);return ub.return(kb)})};if(!1===
"performance"in aa){var Ha=Date.now();var pa=function(){return Date.now()-Ha}}else pa=function(){return performance.now()};var ea=pa,Y=Symbol("@@webxr-polyfill/XRPose"),va=function(r,x){this[Y]={transform:r,emulatedPosition:x}};$jscomp.global.Object.defineProperties(va.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[Y].transform}},emulatedPosition:{configurable:!0,enumerable:!0,get:function(){return this[Y].emulatedPosition}}});var L=Symbol("@@webxr-polyfill/XRViewerPose"),
ja=function(r,x,E){r=va.call(this,r,void 0===E?!1:E)||this;r[L]={views:x};return r};$jscomp.inherits(ja,va);$jscomp.global.Object.defineProperties(ja.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[L].views}}});var Ca=Symbol("@@webxr-polyfill/XRViewport"),za=function(r){this[Ca]={target:r}};$jscomp.global.Object.defineProperties(za.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[Ca].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[Ca].target.y}},
width:{configurable:!0,enumerable:!0,get:function(){return this[Ca].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[Ca].target.height}}});var Ka=["left","right","none"],ya=Symbol("@@webxr-polyfill/XRView"),Oa=function(r,x,E,F){if(!Ka.includes(E))throw Error("XREye must be one of: "+Ka);var ba=Object.create(null),qa=new za(ba);this[ya]={device:r,eye:E,viewport:qa,temp:ba,sessionId:F,transform:x}};Oa.prototype._getViewport=function(r){if(this[ya].device.getViewport(this[ya].sessionId,
this.eye,r,this[ya].temp))return this[ya].viewport};$jscomp.global.Object.defineProperties(Oa.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[ya].eye}},projectionMatrix:{configurable:!0,enumerable:!0,get:function(){return this[ya].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[ya].transform}}});var Ja=Symbol("@@webxr-polyfill/XRFrame"),$a=0,Za=function(r,x,E){this[Ja]={id:++$a,active:!1,animationFrame:!1,device:r,
session:x,sessionId:E}};Za.prototype.getViewerPose=function(r){if(!this[Ja].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Ja].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var x=this[Ja].device,E=this[Ja].session;E[na].viewerSpace._ensurePoseUpdated(x,this[Ja].id);r._ensurePoseUpdated(x,this[Ja].id);
var F=r._getSpaceRelativeTransform(E[na].viewerSpace),ba=[];E=$jscomp.makeIterator(E[na].viewSpaces);for(var qa=E.next();!qa.done;qa=E.next()){qa=qa.value;qa._ensurePoseUpdated(x,this[Ja].id);var sa=r._getSpaceRelativeTransform(qa);qa=new Oa(x,sa,qa.eye,this[Ja].sessionId);ba.push(qa)}return new ja(F,ba,!1)};Za.prototype.getPose=function(r,x){if(!this[Ja].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var E=this[Ja].device;if("target-ray"===
r._specialType||"grip"===r._specialType)return E.getInputPose(r._inputSource,x,r._specialType);r._ensurePoseUpdated(E,this[Ja].id);x._ensurePoseUpdated(E,this[Ja].id);return(r=x._getSpaceRelativeTransform(r))?new XRPose(r,!1):null};$jscomp.global.Object.defineProperties(Za.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[Ja].session}}});var xb=Symbol("@@webxr-polyfill/XRRenderState"),Db=Object.freeze({depthNear:.1,depthFar:1E3,inlineVerticalFieldOfView:null,baseLayer:null}),
nb=function(r){r=void 0===r?{}:r;r=Object.assign({},Db,r);this[xb]={config:r}};$jscomp.global.Object.defineProperties(nb.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[xb].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[xb].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[xb].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,enumerable:!0,get:function(){return this[xb].config.baseLayer}}});
var db=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),N=Symbol("@@webxr-polyfill/xr-compatible"),ia=Symbol("@@webxr-polyfill/XRWebGLLayer"),Aa=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),V=function(r,x,E){E=void 0===E?{}:E;E=Object.assign({},Aa,E);if(!(r instanceof Xa))throw Error("session must be a XRSession");if(r.ended)throw Error("InvalidStateError");if(x[db]&&!0!==x[N])throw Error("InvalidStateError");var F=x.getParameter(x.FRAMEBUFFER_BINDING);
this[ia]={context:x,config:E,framebuffer:F,session:r}};V.prototype.getViewport=function(r){return r._getViewport(this)};V.getNativeFramebufferScaleFactor=function(r){if(!r)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return r[na].ended?0:1};$jscomp.global.Object.defineProperties(V.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this[ia].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[ia].config.antialias}},ignoreDepthValues:{configurable:!0,
enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[ia].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[ia].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[ia].context.drawingBufferHeight}},_session:{configurable:!0,enumerable:!0,get:function(){return this[ia].session}}});var ta=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Ia=Symbol("@@webxr-polyfill/XRSessionEvent"),
Ea=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),na=Symbol("@@webxr-polyfill/XRSession"),Ua=function(r){return wa.call(this,r)||this};$jscomp.inherits(Ua,wa);Ua.prototype._onPoseUpdate=function(r){this._inverseBaseMatrix=r.getBaseViewMatrix(this._specialType)};$jscomp.global.Object.defineProperties(Ua.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});var Xa=function(r,x,E){var F=S.call(this)||this;var ba="inline"!=x,qa=new nb({inlineVerticalFieldOfView:ba?
null:.5*Math.PI});F[na]={device:r,mode:x,immersive:ba,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:E,activeRenderState:qa,pendingRenderState:null,viewerSpace:new ha("viewer"),viewSpaces:[],currentInputSources:[]};ba?F[na].viewSpaces.push(new Ua("left"),new Ua("right")):F[na].viewSpaces.push(new Ua("none"));F[na].onDeviceFrame=function(){if(!F[na].ended&&!F[na].suspended){F[na].deviceFrameHandle=null;F[na].startDeviceFrameLoop();if(null!==
F[na].pendingRenderState&&(F[na].activeRenderState=new nb(F[na].pendingRenderState),F[na].pendingRenderState=null,F[na].activeRenderState.baseLayer))F[na].device.onBaseLayerSet(F[na].id,F[na].activeRenderState.baseLayer);if(null!==F[na].activeRenderState.baseLayer){var sa=new Za(r,F,F[na].id),La=F[na].currentFrameCallbacks=F[na].frameCallbacks;F[na].frameCallbacks=[];sa[Ja].active=!0;sa[Ja].animationFrame=!0;F[na].device.onFrameStart(F[na].id,F[na].activeRenderState);F._checkInputSourcesChange();
for(var Sa=ea(),Va=0;Va<La.length;Va++)try{La[Va].cancelled||"function"!==typeof La[Va].callback||La[Va].callback(Sa,sa)}catch(Ta){console.error(Ta)}F[na].currentFrameCallbacks=null;sa[Ja].active=!1;F[na].device.onFrameEnd(F[na].id)}}};F[na].startDeviceFrameLoop=function(){null===F[na].deviceFrameHandle&&(F[na].deviceFrameHandle=F[na].device.requestAnimationFrame(F[na].onDeviceFrame))};F[na].stopDeviceFrameLoop=function(){var sa=F[na].deviceFrameHandle;null!==sa&&(F[na].device.cancelAnimationFrame(sa),
F[na].deviceFrameHandle=null)};F[na].onPresentationEnd=function(sa){sa!==F[na].id?(F[na].suspended=!1,F[na].startDeviceFrameLoop(),F.dispatchEvent("focus",{session:F})):(F[na].ended=!0,F[na].stopDeviceFrameLoop(),r.removeEventListener("@@webxr-polyfill/vr-present-end",F[na].onPresentationEnd),r.removeEventListener("@@webxr-polyfill/vr-present-start",F[na].onPresentationStart),r.removeEventListener("@@webxr-polyfill/input-select-start",F[na].onSelectStart),r.removeEventListener("@@webxr-polyfill/input-select-end",
F[na].onSelectEnd),F.dispatchEvent("end",fa("end",{session:F})))};r.addEventListener("@@webxr-polyfill/vr-present-end",F[na].onPresentationEnd);F[na].onPresentationStart=function(sa){sa!==F[na].id&&(F[na].suspended=!0,F[na].stopDeviceFrameLoop(),F.dispatchEvent("blur",{session:F}))};r.addEventListener("@@webxr-polyfill/vr-present-start",F[na].onPresentationStart);F[na].onSelectStart=function(sa){sa.sessionId===F[na].id&&F[na].dispatchInputSourceEvent("selectstart",sa.inputSource)};r.addEventListener("@@webxr-polyfill/input-select-start",
F[na].onSelectStart);F[na].onSelectEnd=function(sa){sa.sessionId===F[na].id&&(F[na].dispatchInputSourceEvent("selectend",sa.inputSource),F[na].dispatchInputSourceEvent("select",sa.inputSource))};r.addEventListener("@@webxr-polyfill/input-select-end",F[na].onSelectEnd);F[na].onSqueezeStart=function(sa){sa.sessionId===F[na].id&&F[na].dispatchInputSourceEvent("squeezestart",sa.inputSource)};r.addEventListener("@@webxr-polyfill/input-squeeze-start",F[na].onSqueezeStart);F[na].onSqueezeEnd=function(sa){sa.sessionId===
F[na].id&&(F[na].dispatchInputSourceEvent("squeezeend",sa.inputSource),F[na].dispatchInputSourceEvent("squeeze",sa.inputSource))};r.addEventListener("@@webxr-polyfill/input-squeeze-end",F[na].onSqueezeEnd);F[na].dispatchInputSourceEvent=function(sa,La){var Sa=new Za(r,F,F[na].id);La=U(sa,{frame:Sa,inputSource:La});Sa[Ja].active=!0;F.dispatchEvent(sa,La);Sa[Ja].active=!1};F[na].startDeviceFrameLoop();F.onblur=void 0;F.onfocus=void 0;F.onresetpose=void 0;F.onend=void 0;F.onselect=void 0;F.onselectstart=
void 0;F.onselectend=void 0;return F};$jscomp.inherits(Xa,S);Xa.prototype.requestReferenceSpace=function(r){var x=this,E,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){if(1==ba.nextAddress){if(x[na].ended)return ba.return();if(!J.includes(r))throw new TypeError("XRReferenceSpaceType must be one of "+J);if(!x[na].device.doesSessionSupportReferenceSpace(x[na].id,r))throw new DOMException("The "+r+" reference space is not supported by this session.","NotSupportedError");return"viewer"===
r?ba.return(x[na].viewerSpace):ba.yield(x[na].device.requestFrameOfReferenceTransform(r),2)}E=ba.yieldResult;if("bounded-floor"===r){if(!E)throw new DOMException(r+" XRReferenceSpace not supported by this device.","NotSupportedError");F=x[na].device.requestStageBounds();if(!F)throw new DOMException(r+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+r+" reference space yet.","NotSupportedError");}return ba.return(new ha(r,
E))})};Xa.prototype.requestAnimationFrame=function(r){if(!this[na].ended){var x=++this[na].frameHandle;this[na].frameCallbacks.push({handle:x,callback:r,cancelled:!1});return x}};Xa.prototype.cancelAnimationFrame=function(r){var x=this[na].frameCallbacks,E=x.findIndex(function(F){return F&&F.handle===r});-1<E&&(x[E].cancelled=!0,x.splice(E,1));if(x=this[na].currentFrameCallbacks)E=x.findIndex(function(F){return F&&F.handle===r}),-1<E&&(x[E].cancelled=!0)};Xa.prototype.end=function(){var r=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(x){if(r[na].ended)return x.return();
r[na].immersive&&(r[na].ended=!0,r[na].device.removeEventListener("@@webxr-polyfill/vr-present-start",r[na].onPresentationStart),r[na].device.removeEventListener("@@webxr-polyfill/vr-present-end",r[na].onPresentationEnd),r[na].device.removeEventListener("@@webxr-polyfill/input-select-start",r[na].onSelectStart),r[na].device.removeEventListener("@@webxr-polyfill/input-select-end",r[na].onSelectEnd),r.dispatchEvent("end",fa("end",{session:r})));r[na].stopDeviceFrameLoop();return x.return(r[na].device.endSession(r[na].id))})};
Xa.prototype.updateRenderState=function(r){if(this[na].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(r.baseLayer&&r.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==r.inlineVerticalFieldOfView&&void 0!==r.inlineVerticalFieldOfView){if(this[na].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
r.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,r.inlineVerticalFieldOfView))}if(null===this[na].pendingRenderState){var x=this[na].activeRenderState;this[na].pendingRenderState={depthNear:x.depthNear,depthFar:x.depthFar,inlineVerticalFieldOfView:x.inlineVerticalFieldOfView,baseLayer:x.baseLayer}}Object.assign(this[na].pendingRenderState,r)};Xa.prototype._checkInputSourcesChange=function(){for(var r=[],x=[],E=this.inputSources,F=this[na].currentInputSources,ba=$jscomp.makeIterator(E),qa=ba.next();!qa.done;qa=
ba.next())qa=qa.value,F.includes(qa)||r.push(qa);F=$jscomp.makeIterator(F);for(ba=F.next();!ba.done;ba=F.next())ba=ba.value,E.includes(ba)||x.push(ba);(0<r.length||0<x.length)&&this.dispatchEvent("inputsourceschange",C("inputsourceschange",{session:this,added:r,removed:x}));this[na].currentInputSources.length=0;r=$jscomp.makeIterator(E);for(qa=r.next();!qa.done;qa=r.next())this[na].currentInputSources.push(qa.value)};$jscomp.global.Object.defineProperties(Xa.prototype,{renderState:{configurable:!0,
enumerable:!0,get:function(){return this[na].activeRenderState}},environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[na].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[na].device.getInputSources()}}});var Na=Symbol("@@webxr-polyfill/XRInputSource"),eb=function(r){this[Na]={impl:r,gripSpace:new wa("grip",this),targetRaySpace:new wa("target-ray",this)}};$jscomp.global.Object.defineProperties(eb.prototype,{handedness:{configurable:!0,
enumerable:!0,get:function(){return this[Na].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Na].impl.targetRayMode}},gripSpace:{configurable:!0,enumerable:!0,get:function(){var r=this[Na].impl.targetRayMode;return"gaze"===r||"screen"===r?null:this[Na].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Na].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Na].impl.profiles}},gamepad:{configurable:!0,
enumerable:!0,get:function(){return this[Na].impl.gamepad}}});var qb=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Ab={XRSystem:Ga,XRSession:Xa,XRSessionEvent:fa,XRFrame:Za,XRView:Oa,XRViewport:za,XRViewerPose:ja,XRWebGLLayer:V,XRSpace:wa,XRReferenceSpace:ha,XRReferenceSpaceEvent:Q,XRInputSource:eb,XRInputSourceEvent:U,XRInputSourcesChangeEvent:C,XRRenderState:nb,XRRigidTransform:ka,XRPose:va},sc=function(r){if("function"===typeof r.prototype.makeXRCompatible)return!1;r.prototype.makeXRCompatible=
function(){this[N]=!0;return Promise.resolve()};return!0},tc=function(r){var x=r.prototype.getContext;r.prototype.getContext=function(E,F){if(E=x.call(this,E,F))E[db]=!0,F&&"xrCompatible"in F&&(E[N]=F.xrCompatible);return E}},Ic=function(r){var x=!1;r=r.navigator.userAgent||r.navigator.vendor||r.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,
4)))x=!0;return x},kc="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Zc=function(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r["default"]:r}(function(r,x){return x={exports:{}},r(x,x.exports),x.exports}(function(r,x){(function(E,F){r.exports=F()})(kc,function(){function E(t,z,B,M){this.gl=t;this.cardboardUI=z;this.bufferScale=B;this.dirtySubmitFrameBindings=M;this.ctxAttribs=t.getContextAttributes();this.instanceExt=
t.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=t.drawingBufferWidth;this.bufferHeight=t.drawingBufferHeight;this.realBindFramebuffer=t.bindFramebuffer;this.realEnable=t.enable;this.realDisable=t.disable;this.realColorMask=t.colorMask;this.realClearColor=t.clearColor;this.realViewport=t.viewport;Ya()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(t.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(t.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=uc(t,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=vc(t,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.indexCount=0;this.renderTarget=t.createTexture();this.framebuffer=t.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=t.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=t.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=t.createRenderbuffer());this.patch();this.onResize()}function F(t){this.gl=t;this.attribs={position:0};this.program=uc(t,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=vc(t,this.program);this.vertexBuffer=t.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function ba(t){this.coefficients=t}function qa(t){this.width=t.width||Tb();this.height=t.height||Ub();this.widthMeters=t.widthMeters;this.heightMeters=t.heightMeters;this.bevelMeters=t.bevelMeters}function sa(t,z){this.viewer=lc.CardboardV2;this.updateDeviceParams(t);this.distortion=
new ba(this.viewer.distortionCoefficients);for(t=0;t<z.length;t++){var B=z[t];lc[B.id]=new La(B)}}function La(t){this.id=t.id;this.label=t.label;this.fov=t.fov;this.interLensDistance=t.interLensDistance;this.baselineLensDistance=t.baselineLensDistance;this.screenLensDistance=t.screenLensDistance;this.distortionCoefficients=t.distortionCoefficients;this.inverseCoefficients=t.inverseCoefficients}function Sa(t,z){this.dpdb=Jc;this.recalculateDeviceParams_();if(t){this.onDeviceParamsUpdated=z;var B=new XMLHttpRequest,
M=this;B.open("GET",t,!0);B.addEventListener("load",function(){M.loading=!1;200<=B.status&&299>=B.status?(M.dpdb=JSON.parse(B.response),M.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});B.send()}}function Va(t){this.xdpi=t.xdpi;this.ydpi=t.ydpi;this.bevelMm=t.bevelMm}function Ta(t,z){this.set(t,z)}function fb(t,z){this.kFilter=t;this.isDebug=z;this.currentAccelMeasurement=new Ta;this.currentGyroMeasurement=new Ta;this.previousGyroMeasurement=new Ta;Ya()?this.filterQ=new gb(-1,
0,0,1):this.filterQ=new gb(1,0,0,1);this.previousFilterQ=new gb;this.previousFilterQ.copy(this.filterQ);this.accelQ=new gb;this.isOrientationInitialized=!1;this.estimatedGravity=new vb;this.measuredGravity=new vb;this.gyroIntegralQ=new gb}function tb(t,z){this.predictionTimeS=t;this.isDebug=z;this.previousQ=new gb;this.previousTimestampS=null;this.deltaQ=new gb;this.outQ=new gb}function jb(t,z,B,M){this.yawOnly=B;this.accelerometer=new vb;this.gyroscope=new vb;this.filter=new fb(t,M);this.posePredictor=
new tb(z,M);this.isFirefoxAndroid=Nb();this.isIOS=Ya();t=Kb();this.isDeviceMotionInRadians=!this.isIOS&&t&&66>t;this.isWithoutDeviceMotion=Pb()||Ob();this.filterToWorldQ=new gb;Ya()?this.filterToWorldQ.setFromAxisAngle(new vb(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new vb(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new gb;this.worldToScreenQ=new gb;this.originalPoseAdjustQ=new gb;this.originalPoseAdjustQ.setFromAxisAngle(new vb(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();
pb()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new gb;this.orientationOut_=new Float32Array(4);this.start()}function kb(){this.loadIcon_();var t=document.createElement("div"),z=t.style;z.position="fixed";z.top=0;z.right=0;z.bottom=0;z.left=0;z.backgroundColor="gray";z.fontFamily="sans-serif";z.zIndex=1E6;var B=document.createElement("img");B.src=this.icon;z=B.style;z.marginLeft="25%";z.marginTop="25%";z.width="50%";t.appendChild(B);B=document.createElement("div");z=B.style;
z.textAlign="center";z.fontSize="16px";z.lineHeight="24px";z.margin="24px 25%";z.width="50%";B.innerHTML="Place your phone into your Cardboard viewer.";t.appendChild(B);var M=document.createElement("div");z=M.style;z.backgroundColor="#CFD8DC";z.position="fixed";z.bottom=0;z.width="100%";z.height="48px";z.padding="14px 24px";z.boxSizing="border-box";z.color="#656A6B";t.appendChild(M);var oa=document.createElement("div");oa.style.float="left";oa.innerHTML="No Cardboard viewer?";var Z=document.createElement("a");
Z.href="https://www.google.com/get/cardboard/get-cardboard/";Z.innerHTML="get one";Z.target="_blank";z=Z.style;z.float="right";z.fontWeight=600;z.textTransform="uppercase";z.borderLeft="1px solid gray";z.paddingLeft="24px";z.textDecoration="none";z.color="#656A6B";M.appendChild(oa);M.appendChild(Z);this.overlay=t;this.text=B;this.hide()}function ib(t){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(z){console.error("Failed to load viewer profile: %s",z)}this.selectedKey||
(this.selectedKey=t||"CardboardV1");this.dialog=this.createDialog_(sa.Viewers);this.root=null;this.onChangeCallbacks_=[]}function ub(t){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:t.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:t.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:t.canPresent},maxLayers:{writable:!1,enumerable:!0,value:t.maxLayers},hasOrientation:{enumerable:!0,get:function(){Qb("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return t.hasOrientation}}})}function bb(t){t=t||{};t="wakelock"in t?t.wakelock:!0;this.isPolyfilled=!0;this.displayId=Kc++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){Qb("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new ub({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;t&&mc()&&(this.wakelock_=new Lc)}function Wa(t){var z=wc({},Mc);t=wc(z,t||{});bb.call(this,{wakelock:t.MOBILE_WAKE_LOCK});this.config=t;this.displayName="Cardboard VRDisplay";this.capabilities=new ub({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new Nc(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new Sa(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new sa(this.dpdb_.getDeviceParams(),t.ADDITIONAL_VIEWERS);this.viewerSelector_=new ib(t.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new kb);Ya()&&window.addEventListener("resize",this.onResize_.bind(this))}var lb=function(){function t(z,B){for(var M=0;M<B.length;M++){var oa=B[M];oa.enumerable=oa.enumerable||!1;oa.configurable=!0;"value"in oa&&(oa.writable=!0);Object.defineProperty(z,oa.key,oa)}}return function(z,B,M){B&&t(z.prototype,B);M&&t(z,M);return z}}(),mb=function(){return function(t,z){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var B=
[],M=!0,oa=!1,Z=void 0;try{for(var ca=t[Symbol.iterator](),Fa;!(M=(Fa=ca.next()).done)&&(B.push(Fa.value),!z||B.length!==z);M=!0);}catch(Pa){oa=!0,Z=Pa}finally{try{if(!M&&ca["return"])ca["return"]()}finally{if(oa)throw Z;}}return B}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),Ya=function(){var t=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return t}}(),Gb=function(){var t=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return t}}(),Mb=function(){var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return t}}(),Nb=function(){var t=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return t}}(),Kb=function(){var t=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),z=t?parseInt(t[1],10):null;return function(){return z}}(),Ob=function(){var t=!1;t=Ya()&&Mb()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return t}}(),Pb=function(){var t=!1;if(65===Kb()){var z=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(z){z=z[1].split(".");z=mb(z,4);var B=z[3];t=3325===parseInt(z[2],10)&&148>parseInt(B,10)}}return function(){return t}}(),Lb=function(){var t=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return t}}(),pb=function(){var t=90==window.orientation||-90==window.orientation;return Lb()?!t:t},Tb=function(){return Math.max(window.screen.width,window.screen.height)*
window.devicePixelRatio},Ub=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Oc=function(t){if(Gb())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.msRequestFullscreen)t.msRequestFullscreen();else return!1;return!0},xc=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},uc=function(t,z,B,M){var oa=t.createShader(t.VERTEX_SHADER);t.shaderSource(oa,z);t.compileShader(oa);z=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(z,B);t.compileShader(z);B=t.createProgram();t.attachShader(B,oa);t.attachShader(B,z);for(var Z in M)t.bindAttribLocation(B,M[Z],Z);t.linkProgram(B);t.deleteShader(oa);t.deleteShader(z);return B},
vc=function(t,z){for(var B={},M=t.getProgramParameter(z,t.ACTIVE_UNIFORMS),oa,Z=0;Z<M;Z++)oa=t.getActiveUniform(z,Z).name.replace("[0]",""),B[oa]=t.getUniformLocation(z,oa);return B},mc=function(){var t=!1,z=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,
4)))t=!0;return t},wc=function(t,z){for(var B in z)z.hasOwnProperty(B)&&(t[B]=z[B]);return t},nc=function(t){if(Ya()){var z=t.style.width,B=t.style.height;t.style.width=parseInt(z)+1+"px";t.style.height=parseInt(B)+"px";setTimeout(function(){t.style.width=z;t.style.height=B},100)}window.canvas=t},Pc=function(){function t(Z,ca,Fa,Pa,Ma,Qa){var Ra=Pa||null;Pa=Qa.depthNear;Qa=Qa.depthFar;var ab=Math.tan(Ra?Ra.upDegrees*z:B),hb=Math.tan(Ra?Ra.downDegrees*z:B),wb=Math.tan(Ra?Ra.leftDegrees*z:B);Ra=Math.tan(Ra?
Ra.rightDegrees*z:B);var cb=2/(wb+Ra),rb=2/(ab+hb);Z[0]=cb;Z[1]=0;Z[2]=0;Z[3]=0;Z[4]=0;Z[5]=rb;Z[6]=0;Z[7]=0;Z[8]=-((wb-Ra)*cb*.5);Z[9]=(ab-hb)*rb*.5;Z[10]=Qa/(Pa-Qa);Z[11]=-1;Z[12]=0;Z[13]=0;Z[14]=Qa*Pa/(Pa-Qa);Z[15]=0;Z=Fa.orientation||M;Fa=Fa.position||oa;hb=Z[0];cb=Z[1];rb=Z[2];Qa=Z[3];var Cb=hb+hb;Ra=cb+cb;ab=rb+rb;Z=hb*Cb;Pa=hb*Ra;hb*=ab;wb=cb*Ra;cb*=ab;rb*=ab;Cb*=Qa;Ra*=Qa;Qa*=ab;ca[0]=1-(wb+rb);ca[1]=Pa+Qa;ca[2]=hb-Ra;ca[3]=0;ca[4]=Pa-Qa;ca[5]=1-(Z+rb);ca[6]=cb+Cb;ca[7]=0;ca[8]=hb+Ra;ca[9]=
cb-Cb;ca[10]=1-(Z+wb);ca[11]=0;ca[12]=Fa[0];ca[13]=Fa[1];ca[14]=Fa[2];ca[15]=1;if(Ma)if(Fa=Ma[0],Z=Ma[1],Ma=Ma[2],ca===ca)ca[12]=ca[0]*Fa+ca[4]*Z+ca[8]*Ma+ca[12],ca[13]=ca[1]*Fa+ca[5]*Z+ca[9]*Ma+ca[13],ca[14]=ca[2]*Fa+ca[6]*Z+ca[10]*Ma+ca[14],ca[15]=ca[3]*Fa+ca[7]*Z+ca[11]*Ma+ca[15];else{Pa=ca[0];Qa=ca[1];ab=ca[2];hb=ca[3];wb=ca[4];Ra=ca[5];cb=ca[6];rb=ca[7];Cb=ca[8];var Hb=ca[9];var Ib=ca[10];var Jb=ca[11];ca[0]=Pa;ca[1]=Qa;ca[2]=ab;ca[3]=hb;ca[4]=wb;ca[5]=Ra;ca[6]=cb;ca[7]=rb;ca[8]=Cb;ca[9]=Hb;
ca[10]=Ib;ca[11]=Jb;ca[12]=Pa*Fa+wb*Z+Cb*Ma+ca[12];ca[13]=Qa*Fa+Ra*Z+Hb*Ma+ca[13];ca[14]=ab*Fa+cb*Z+Ib*Ma+ca[14];ca[15]=hb*Fa+rb*Z+Jb*Ma+ca[15]}Ma=ca[0];Fa=ca[1];Z=ca[2];Pa=ca[3];Qa=ca[4];ab=ca[5];hb=ca[6];wb=ca[7];Ra=ca[8];cb=ca[9];rb=ca[10];Cb=ca[11];Hb=ca[12];Ib=ca[13];Jb=ca[14];var Sb=ca[15],Vb=Ma*ab-Fa*Qa,Wb=Ma*hb-Z*Qa,Xb=Ma*wb-Pa*Qa,Yb=Fa*hb-Z*ab,Zb=Fa*wb-Pa*ab,$b=Z*wb-Pa*hb,ac=Ra*Ib-cb*Hb,bc=Ra*Jb-rb*Hb,cc=Ra*Sb-Cb*Hb,dc=cb*Jb-rb*Ib,ec=cb*Sb-Cb*Ib,fc=rb*Sb-Cb*Jb,zb=Vb*fc-Wb*ec+Xb*dc+Yb*cc-
Zb*bc+$b*ac;zb&&(zb=1/zb,ca[0]=(ab*fc-hb*ec+wb*dc)*zb,ca[1]=(Z*ec-Fa*fc-Pa*dc)*zb,ca[2]=(Ib*$b-Jb*Zb+Sb*Yb)*zb,ca[3]=(rb*Zb-cb*$b-Cb*Yb)*zb,ca[4]=(hb*cc-Qa*fc-wb*bc)*zb,ca[5]=(Ma*fc-Z*cc+Pa*bc)*zb,ca[6]=(Jb*Xb-Hb*$b-Sb*Wb)*zb,ca[7]=(Ra*$b-rb*Xb+Cb*Wb)*zb,ca[8]=(Qa*ec-ab*cc+wb*ac)*zb,ca[9]=(Fa*cc-Ma*ec-Pa*ac)*zb,ca[10]=(Hb*Zb-Ib*Xb+Sb*Vb)*zb,ca[11]=(cb*Xb-Ra*Zb-Cb*Vb)*zb,ca[12]=(ab*bc-Qa*dc-hb*ac)*zb,ca[13]=(Ma*dc-Fa*bc+Z*ac)*zb,ca[14]=(Ib*Wb-Hb*Yb-Jb*Vb)*zb,ca[15]=(Ra*Yb-cb*Wb+rb*Vb)*zb)}var z=Math.PI/
180,B=.25*Math.PI,M=new Float32Array([0,0,0,1]),oa=new Float32Array([0,0,0]);return function(Z,ca,Fa){if(!Z||!ca)return!1;Z.pose=ca;Z.timestamp=ca.timestamp;t(Z.leftProjectionMatrix,Z.leftViewMatrix,ca,Fa._getFieldOfView("left"),Fa._getEyeOffset("left"),Fa);t(Z.rightProjectionMatrix,Z.rightViewMatrix,ca,Fa._getFieldOfView("right"),Fa._getEyeOffset("right"),Fa);return!0}}(),yc=function(t){var z=t.indexOf("://");z=t.indexOf("/",-1!==z?z+3:0);-1===z&&(z=t.length);return t.substring(0,z)},oc=function(){var t=
{};return function(z,B){void 0===t[z]&&(console.warn("webvr-polyfill: "+B),t[z]=!0)}}(),Qb=function(t,z){oc(t,t+" has been deprecated. This may not work on native WebVR displays. "+(z?"Please use "+z+" instead.":""))},gc=function(t,z,B){if(z){for(var M=[],oa=null,Z=0;Z<z.length;++Z){var ca=z[Z];switch(ca){case t.TEXTURE_BINDING_2D:case t.TEXTURE_BINDING_CUBE_MAP:var Fa=z[++Z];if(Fa<t.TEXTURE0||Fa>t.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
M.push(null,null);break}oa||(oa=t.getParameter(t.ACTIVE_TEXTURE));t.activeTexture(Fa);M.push(t.getParameter(ca),null);break;case t.ACTIVE_TEXTURE:oa=t.getParameter(t.ACTIVE_TEXTURE);M.push(null);break;default:M.push(t.getParameter(ca))}}B(t);for(Z=0;Z<z.length;++Z){ca=z[Z];B=M[Z];switch(ca){case t.ACTIVE_TEXTURE:break;case t.ARRAY_BUFFER_BINDING:t.bindBuffer(t.ARRAY_BUFFER,B);break;case t.COLOR_CLEAR_VALUE:t.clearColor(B[0],B[1],B[2],B[3]);break;case t.COLOR_WRITEMASK:t.colorMask(B[0],B[1],B[2],B[3]);
break;case t.CURRENT_PROGRAM:t.useProgram(B);break;case t.ELEMENT_ARRAY_BUFFER_BINDING:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,B);break;case t.FRAMEBUFFER_BINDING:t.bindFramebuffer(t.FRAMEBUFFER,B);break;case t.RENDERBUFFER_BINDING:t.bindRenderbuffer(t.RENDERBUFFER,B);break;case t.TEXTURE_BINDING_2D:Fa=z[++Z];if(Fa<t.TEXTURE0||Fa>t.TEXTURE31)break;t.activeTexture(Fa);t.bindTexture(t.TEXTURE_2D,B);break;case t.TEXTURE_BINDING_CUBE_MAP:Fa=z[++Z];if(Fa<t.TEXTURE0||Fa>t.TEXTURE31)break;t.activeTexture(Fa);
t.bindTexture(t.TEXTURE_CUBE_MAP,B);break;case t.VIEWPORT:t.viewport(B[0],B[1],B[2],B[3]);break;case t.BLEND:case t.CULL_FACE:case t.DEPTH_TEST:case t.SCISSOR_TEST:case t.STENCIL_TEST:B?t.enable(ca):t.disable(ca);break;default:console.log("No GL restore behavior for 0x"+ca.toString(16))}oa&&t.activeTexture(oa)}}else B(t)};E.prototype.destroy=function(){var t=this.gl;this.unpatch();t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.indexBuffer);t.deleteTexture(this.renderTarget);
t.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&t.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&t.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&t.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};E.prototype.onResize=function(){var t=this.gl,z=this;gc(t,[t.RENDERBUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0],function(B){z.realBindFramebuffer.call(B,B.FRAMEBUFFER,null);z.scissorTest&&z.realDisable.call(B,B.SCISSOR_TEST);
z.realColorMask.call(B,!0,!0,!0,!0);z.realViewport.call(B,0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.realClearColor.call(B,0,0,0,1);B.clear(B.COLOR_BUFFER_BIT);z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.framebuffer);B.bindTexture(B.TEXTURE_2D,z.renderTarget);B.texImage2D(B.TEXTURE_2D,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,z.bufferWidth,z.bufferHeight,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,B.UNSIGNED_BYTE,null);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,
B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,z.renderTarget,0);z.ctxAttribs.depth&&z.ctxAttribs.stencil?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthStencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_STENCIL,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,
z.depthStencilBuffer)):z.ctxAttribs.depth?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,z.depthBuffer)):z.ctxAttribs.stencil&&(B.bindRenderbuffer(B.RENDERBUFFER,z.stencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.STENCIL_INDEX8,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.STENCIL_ATTACHMENT,B.RENDERBUFFER,
z.stencilBuffer));!B.checkFramebufferStatus(B.FRAMEBUFFER)===B.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.lastBoundFramebuffer);z.scissorTest&&z.realEnable.call(B,B.SCISSOR_TEST);z.realColorMask.apply(B,z.colorMask);z.realViewport.apply(B,z.viewport);z.realClearColor.apply(B,z.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};E.prototype.patch=function(){if(!this.isPatched){var t=this,z=this.gl.canvas,B=this.gl;Ya()||(z.width=
Tb()*this.bufferScale,z.height=Ub()*this.bufferScale,Object.defineProperty(z,"width",{configurable:!0,enumerable:!0,get:function(){return t.bufferWidth},set:function(M){t.bufferWidth=M;t.realCanvasWidth.set.call(z,M);t.onResize()}}),Object.defineProperty(z,"height",{configurable:!0,enumerable:!0,get:function(){return t.bufferHeight},set:function(M){t.bufferHeight=M;t.realCanvasHeight.set.call(z,M);t.onResize()}}));this.lastBoundFramebuffer=B.getParameter(B.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&
(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(B.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(M,oa){t.lastBoundFramebuffer=oa?oa:t.framebuffer;t.realBindFramebuffer.call(B,M,t.lastBoundFramebuffer)};this.cullFace=B.getParameter(B.CULL_FACE);this.depthTest=B.getParameter(B.DEPTH_TEST);this.blend=B.getParameter(B.BLEND);this.scissorTest=B.getParameter(B.SCISSOR_TEST);this.stencilTest=B.getParameter(B.STENCIL_TEST);B.enable=function(M){switch(M){case B.CULL_FACE:t.cullFace=
!0;break;case B.DEPTH_TEST:t.depthTest=!0;break;case B.BLEND:t.blend=!0;break;case B.SCISSOR_TEST:t.scissorTest=!0;break;case B.STENCIL_TEST:t.stencilTest=!0}t.realEnable.call(B,M)};B.disable=function(M){switch(M){case B.CULL_FACE:t.cullFace=!1;break;case B.DEPTH_TEST:t.depthTest=!1;break;case B.BLEND:t.blend=!1;break;case B.SCISSOR_TEST:t.scissorTest=!1;break;case B.STENCIL_TEST:t.stencilTest=!1}t.realDisable.call(B,M)};this.colorMask=B.getParameter(B.COLOR_WRITEMASK);B.colorMask=function(M,oa,Z,
ca){t.colorMask[0]=M;t.colorMask[1]=oa;t.colorMask[2]=Z;t.colorMask[3]=ca;t.realColorMask.call(B,M,oa,Z,ca)};this.clearColor=B.getParameter(B.COLOR_CLEAR_VALUE);B.clearColor=function(M,oa,Z,ca){t.clearColor[0]=M;t.clearColor[1]=oa;t.clearColor[2]=Z;t.clearColor[3]=ca;t.realClearColor.call(B,M,oa,Z,ca)};this.viewport=B.getParameter(B.VIEWPORT);B.viewport=function(M,oa,Z,ca){t.viewport[0]=M;t.viewport[1]=oa;t.viewport[2]=Z;t.viewport[3]=ca;t.realViewport.call(B,M,oa,Z,ca)};this.isPatched=!0;nc(z)}};
E.prototype.unpatch=function(){if(this.isPatched){var t=this.gl,z=this.gl.canvas;Ya()||(Object.defineProperty(z,"width",this.realCanvasWidth),Object.defineProperty(z,"height",this.realCanvasHeight));z.width=this.bufferWidth;z.height=this.bufferHeight;t.bindFramebuffer=this.realBindFramebuffer;t.enable=this.realEnable;t.disable=this.realDisable;t.colorMask=this.realColorMask;t.clearColor=this.realClearColor;t.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,
null);this.isPatched=!1;setTimeout(function(){nc(z)},1)}};E.prototype.setTextureBounds=function(t,z){t||(t=[0,0,.5,1]);z||(z=[.5,0,.5,1]);this.viewportOffsetScale[0]=t[0];this.viewportOffsetScale[1]=t[1];this.viewportOffsetScale[2]=t[2];this.viewportOffsetScale[3]=t[3];this.viewportOffsetScale[4]=z[0];this.viewportOffsetScale[5]=z[1];this.viewportOffsetScale[6]=z[2];this.viewportOffsetScale[7]=z[3]};E.prototype.submitFrame=function(){var t=this.gl,z=this,B=[];this.dirtySubmitFrameBindings||B.push(t.CURRENT_PROGRAM,
t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0);gc(t,B,function(M){z.realBindFramebuffer.call(M,M.FRAMEBUFFER,null);var oa=0,Z=0;z.instanceExt&&(oa=M.getVertexAttrib(z.attribs.position,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),Z=M.getVertexAttrib(z.attribs.texCoord,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));z.cullFace&&z.realDisable.call(M,M.CULL_FACE);z.depthTest&&z.realDisable.call(M,M.DEPTH_TEST);z.blend&&z.realDisable.call(M,M.BLEND);z.scissorTest&&
z.realDisable.call(M,M.SCISSOR_TEST);z.stencilTest&&z.realDisable.call(M,M.STENCIL_TEST);z.realColorMask.call(M,!0,!0,!0,!0);z.realViewport.call(M,0,0,M.drawingBufferWidth,M.drawingBufferHeight);if(z.ctxAttribs.alpha||Ya())z.realClearColor.call(M,0,0,0,1),M.clear(M.COLOR_BUFFER_BIT);M.useProgram(z.program);M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,z.indexBuffer);M.bindBuffer(M.ARRAY_BUFFER,z.vertexBuffer);M.enableVertexAttribArray(z.attribs.position);M.enableVertexAttribArray(z.attribs.texCoord);M.vertexAttribPointer(z.attribs.position,
2,M.FLOAT,!1,20,0);M.vertexAttribPointer(z.attribs.texCoord,3,M.FLOAT,!1,20,8);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,0),0!=Z&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,0));M.activeTexture(M.TEXTURE0);M.uniform1i(z.uniforms.diffuse,0);M.bindTexture(M.TEXTURE_2D,z.renderTarget);M.uniform4fv(z.uniforms.viewportOffsetScale,z.viewportOffsetScale);M.drawElements(M.TRIANGLES,z.indexCount,M.UNSIGNED_SHORT,0);z.cardboardUI&&z.cardboardUI.renderNoState();
z.realBindFramebuffer.call(z.gl,M.FRAMEBUFFER,z.framebuffer);z.ctxAttribs.preserveDrawingBuffer||(z.realClearColor.call(M,0,0,0,0),M.clear(M.COLOR_BUFFER_BIT));z.dirtySubmitFrameBindings||z.realBindFramebuffer.call(M,M.FRAMEBUFFER,z.lastBoundFramebuffer);z.cullFace&&z.realEnable.call(M,M.CULL_FACE);z.depthTest&&z.realEnable.call(M,M.DEPTH_TEST);z.blend&&z.realEnable.call(M,M.BLEND);z.scissorTest&&z.realEnable.call(M,M.SCISSOR_TEST);z.stencilTest&&z.realEnable.call(M,M.STENCIL_TEST);z.realColorMask.apply(M,
z.colorMask);z.realViewport.apply(M,z.viewport);!z.ctxAttribs.alpha&&z.ctxAttribs.preserveDrawingBuffer||z.realClearColor.apply(M,z.clearColor);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,oa),0!=Z&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,Z))});Ya()&&(t=t.canvas,t.width!=z.bufferWidth||t.height!=z.bufferHeight)&&(z.bufferWidth=t.width,z.bufferHeight=t.height,z.onResize())};E.prototype.updateDeviceInfo=function(t){var z=this.gl,B=this;gc(z,[z.ARRAY_BUFFER_BINDING,
z.ELEMENT_ARRAY_BUFFER_BINDING],function(M){var oa=B.computeMeshVertices_(B.meshWidth,B.meshHeight,t);M.bindBuffer(M.ARRAY_BUFFER,B.vertexBuffer);M.bufferData(M.ARRAY_BUFFER,oa,M.STATIC_DRAW);B.indexCount||(oa=B.computeMeshIndices_(B.meshWidth,B.meshHeight),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,B.indexBuffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,oa,M.STATIC_DRAW),B.indexCount=oa.length)})};E.prototype.computeMeshVertices_=function(t,z,B){for(var M=new Float32Array(2*t*z*5),oa=B.getLeftEyeVisibleTanAngles(),
Z=B.getLeftEyeNoLensTanAngles(),ca=B.getLeftEyeVisibleScreenRect(Z),Fa=0,Pa=0;2>Pa;Pa++){for(var Ma=0;Ma<z;Ma++)for(var Qa=0;Qa<t;Qa++,Fa++){var Ra=Qa/(t-1),ab=Ma/(z-1),hb=Ra,wb=ab,cb=oa[0];Ra=cb+(oa[2]-cb)*Ra;cb=oa[3];var rb=cb+(oa[1]-cb)*ab;ab=Math.sqrt(Ra*Ra+rb*rb);cb=B.distortion.distortInverse(ab);rb=rb*cb/ab;Ra=(Ra*cb/ab-Z[0])/(Z[2]-Z[0]);ab=(rb-Z[3])/(Z[1]-Z[3]);Ra=2*(ca.x+Ra*ca.width-.5);ab=2*(ca.y+ab*ca.height-.5);M[5*Fa]=Ra;M[5*Fa+1]=ab;M[5*Fa+2]=hb;M[5*Fa+3]=wb;M[5*Fa+4]=Pa}Ma=oa[2]-oa[0];
oa[0]=-(Ma+oa[0]);oa[2]=Ma-oa[2];Ma=Z[2]-Z[0];Z[0]=-(Ma+Z[0]);Z[2]=Ma-Z[2];ca.x=1-(ca.x+ca.width)}return M};E.prototype.computeMeshIndices_=function(t,z){for(var B=new Uint16Array(2*(t-1)*(z-1)*6),M=t/2,oa=z/2,Z=0,ca=0,Fa=0;2>Fa;Fa++)for(var Pa=0;Pa<z;Pa++)for(var Ma=0;Ma<t;Ma++,Z++)0!=Ma&&0!=Pa&&(Ma<=M==Pa<=oa?(B[ca++]=Z,B[ca++]=Z-t-1,B[ca++]=Z-t,B[ca++]=Z-t-1,B[ca++]=Z,B[ca++]=Z-1):(B[ca++]=Z-1,B[ca++]=Z-t,B[ca++]=Z,B[ca++]=Z-t,B[ca++]=Z-1,B[ca++]=Z-t-1));return B};E.prototype.getOwnPropertyDescriptor_=
function(t,z){t=Object.getOwnPropertyDescriptor(t,z);if(void 0===t.get||void 0===t.set)t.configurable=!0,t.enumerable=!0,t.get=function(){return this.getAttribute(z)},t.set=function(B){this.setAttribute(z,B)};return t};var zc=Math.PI/180;F.prototype.destroy=function(){var t=this.gl;this.listener&&t.canvas.removeEventListener("click",this.listener,!1);t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer)};F.prototype.listen=function(t,z){var B=this.gl.canvas;this.listener=function(M){var oa=
B.clientWidth/2,Z=M.touches?M.touches[0].clientX:M.clientX,ca=M.touches?M.touches[0].clientY:M.clientY;Z>oa-42&&Z<oa+42&&ca>B.clientHeight-42?t(M):42>Z&&42>ca&&z(M)};B.addEventListener("click",this.listener,!1);B.addEventListener("touchstart",this.listener,!1)};F.prototype.onResize=function(){var t=this.gl,z=this;gc(t,[t.ARRAY_BUFFER_BINDING],function(B){function M(hb,wb){var cb=(90-hb)*zc;hb=Math.cos(cb);cb=Math.sin(cb);Z.push(.3125*hb*Qa+ca,.3125*cb*Qa+Qa);Z.push(wb*hb*Qa+ca,wb*cb*Qa+Qa)}function oa(hb,
wb){Z.push(Ra+hb,B.drawingBufferHeight-Ra-wb)}var Z=[],ca=B.drawingBufferWidth/2,Fa=B.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*window.devicePixelRatio,Pa=4*Fa/2,Ma=42*Fa,Qa=28*Fa/2,Ra=14*Fa;Z.push(ca-Pa,Ma);Z.push(ca-Pa,B.drawingBufferHeight);Z.push(ca+Pa,Ma);Z.push(ca+Pa,B.drawingBufferHeight);z.gearOffset=Z.length/2;for(Ma=0;6>=Ma;Ma++){var ab=60*Ma;M(ab,1);M(ab+12,1);M(ab+20,.75);M(ab+40,.75);M(ab+48,1)}z.gearVertexCount=Z.length/2-z.gearOffset;z.arrowOffset=
Z.length/2;Ma=Pa/Math.sin(45*zc);oa(0,Qa);oa(Qa,0);oa(Qa+Ma,Ma);oa(Ma,Qa+Ma);oa(Ma,Qa-Ma);oa(0,Qa);oa(Qa,2*Qa);oa(Qa+Ma,2*Qa-Ma);oa(Ma,Qa-Ma);oa(0,Qa);oa(Ma,Qa-Pa);oa(28*Fa,Qa-Pa);oa(Ma,Qa+Pa);oa(28*Fa,Qa+Pa);z.arrowVertexCount=Z.length/2-z.arrowOffset;B.bindBuffer(B.ARRAY_BUFFER,z.vertexBuffer);B.bufferData(B.ARRAY_BUFFER,new Float32Array(Z),B.STATIC_DRAW)})};F.prototype.render=function(){var t=this.gl,z=this;gc(t,[t.CULL_FACE,t.DEPTH_TEST,t.BLEND,t.SCISSOR_TEST,t.STENCIL_TEST,t.COLOR_WRITEMASK,
t.VIEWPORT,t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING],function(B){B.disable(B.CULL_FACE);B.disable(B.DEPTH_TEST);B.disable(B.BLEND);B.disable(B.SCISSOR_TEST);B.disable(B.STENCIL_TEST);B.colorMask(!0,!0,!0,!0);B.viewport(0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.renderNoState()})};F.prototype.renderNoState=function(){var t=this.gl;t.useProgram(this.program);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.enableVertexAttribArray(this.attribs.position);t.vertexAttribPointer(this.attribs.position,
2,t.FLOAT,!1,8,0);t.uniform4f(this.uniforms.color,1,1,1,1);var z=this.projMat,B=t.drawingBufferWidth,M=t.drawingBufferHeight,oa=1/(0-B),Z=1/(0-M),ca=1/-1023.9;z[0]=-2*oa;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=-2*Z;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=2*ca;z[11]=0;z[12]=(0+B)*oa;z[13]=(M+0)*Z;z[14]=1024.1*ca;z[15]=1;t.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);t.drawArrays(t.TRIANGLE_STRIP,0,4);t.drawArrays(t.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);t.drawArrays(t.TRIANGLE_STRIP,
this.arrowOffset,this.arrowVertexCount)};ba.prototype.distortInverse=function(t){for(var z=0,B=1,M=t-this.distort(z);1E-4<Math.abs(B-z);){var oa=t-this.distort(B);M=B-(B-z)/(oa-M)*oa;z=B;B=M;M=oa}return B};ba.prototype.distort=function(t){for(var z=t*t,B=0,M=0;M<this.coefficients.length;M++)B=z*(B+this.coefficients[M]);return(B+1)*t};var Eb=Math.PI/180,Fb=180/Math.PI,vb=function(t,z,B){this.x=t||0;this.y=z||0;this.z=B||0};vb.prototype={constructor:vb,set:function(t,z,B){this.x=t;this.y=z;this.z=B;
return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();0!==t?this.multiplyScalar(1/t):this.z=this.y=this.x=0;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t},applyQuaternion:function(t){var z=this.x,B=this.y,M=this.z,oa=t.x,Z=t.y,ca=t.z;t=t.w;var Fa=t*z+Z*M-ca*B,Pa=t*B+ca*z-oa*M,Ma=t*M+oa*B-Z*z;z=-oa*z-Z*B-ca*M;this.x=Fa*t+z*-oa+Pa*-ca-
Ma*-Z;this.y=Pa*t+z*-Z+Ma*-oa-Fa*-ca;this.z=Ma*t+z*-ca+Fa*-Z-Pa*-oa;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,z){var B=t.x,M=t.y;t=t.z;var oa=z.x,Z=z.y;z=z.z;this.x=M*z-t*Z;this.y=t*oa-B*z;this.z=B*Z-M*oa;return this}};var gb=function(t,z,B,M){this.x=t||0;this.y=z||0;this.z=B||0;this.w=void 0!==M?M:1};gb.prototype={constructor:gb,set:function(t,z,B,M){this.x=t;this.y=z;this.z=B;this.w=M;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=
t.z;this.w=t.w;return this},setFromEulerXYZ:function(t,z,B){var M=Math.cos(t/2),oa=Math.cos(z/2),Z=Math.cos(B/2);t=Math.sin(t/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=t*oa*Z+M*z*B;this.y=M*z*Z-t*oa*B;this.z=M*oa*B+t*z*Z;this.w=M*oa*Z-t*z*B;return this},setFromEulerYXZ:function(t,z,B){var M=Math.cos(t/2),oa=Math.cos(z/2),Z=Math.cos(B/2);t=Math.sin(t/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=t*oa*Z+M*z*B;this.y=M*z*Z-t*oa*B;this.z=M*oa*B-t*z*Z;this.w=M*oa*Z+t*z*B;return this},setFromAxisAngle:function(t,
z){z/=2;var B=Math.sin(z);this.x=t.x*B;this.y=t.y*B;this.z=t.z*B;this.w=Math.cos(z);return this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,z){var B=t.x,M=t.y,oa=t.z;t=t.w;var Z=z.x,ca=z.y,Fa=z.z;z=z.w;this.x=B*z+t*Z+M*Fa-oa*ca;this.y=M*z+t*ca+oa*Z-B*Fa;this.z=oa*z+t*Fa+B*ca-M*Z;this.w=t*z-B*Z-M*ca-oa*Fa;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var t=Math.sqrt(this.x*this.x+
this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.z=this.y=this.x=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t);return this},slerp:function(t,z){if(0===z)return this;if(1===z)return this.copy(t);var B=this.x,M=this.y,oa=this.z,Z=this.w,ca=Z*t.w+B*t.x+M*t.y+oa*t.z;0>ca?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,ca=-ca):this.copy(t);if(1<=ca)return this.w=Z,this.x=B,this.y=M,this.z=oa,this;t=Math.acos(ca);var Fa=Math.sqrt(1-ca*ca);if(.001>Math.abs(Fa))return this.w=.5*(Z+this.w),
this.x=.5*(B+this.x),this.y=.5*(M+this.y),this.z=.5*(oa+this.z),this;ca=Math.sin((1-z)*t)/Fa;z=Math.sin(z*t)/Fa;this.w=Z*ca+this.w*z;this.x=B*ca+this.x*z;this.y=M*ca+this.y*z;this.z=oa*ca+this.z*z;return this},setFromUnitVectors:function(){var t,z;return function(B,M){void 0===t&&(t=new vb);z=B.dot(M)+1;1E-6>z?(z=0,Math.abs(B.x)>Math.abs(B.z)?t.set(-B.y,B.x,0):t.set(0,-B.z,B.y)):t.crossVectors(B,M);this.x=t.x;this.y=t.y;this.z=t.z;this.w=z;this.normalize();return this}}()};var Qc=new qa({widthMeters:.11,
heightMeters:.062,bevelMeters:.004}),Rc=new qa({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),lc={CardboardV1:new La({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new La({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,
interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};sa.prototype.updateDeviceParams=function(t){this.device=this.determineDevice_(t)||this.device};sa.prototype.getDevice=function(){return this.device};sa.prototype.setViewer=function(t){this.viewer=t;this.distortion=new ba(this.viewer.distortionCoefficients)};
sa.prototype.determineDevice_=function(t){if(!t){if(Ya())return console.warn("Using fallback iOS device measurements."),Rc;console.warn("Using fallback Android device measurements.");return Qc}var z=.0254/t.xdpi,B=.0254/t.ydpi,M=Tb(),oa=Ub();return new qa({widthMeters:z*M,heightMeters:B*oa,bevelMeters:.001*t.bevelMm})};sa.prototype.getDistortedFieldOfViewLeftEye=function(){var t=this.viewer,z=this.device,B=this.distortion,M=t.screenLensDistance,oa=t.interLensDistance/2,Z=t.baselineLensDistance-z.bevelMeters,
ca=z.heightMeters-Z;z=Fb*Math.atan(B.distort((z.widthMeters-t.interLensDistance)/2/M));oa=Fb*Math.atan(B.distort(oa/M));Z=Fb*Math.atan(B.distort(Z/M));B=Fb*Math.atan(B.distort(ca/M));return{leftDegrees:Math.min(z,t.fov),rightDegrees:Math.min(oa,t.fov),downDegrees:Math.min(Z,t.fov),upDegrees:Math.min(B,t.fov)}};sa.prototype.getLeftEyeVisibleTanAngles=function(){var t=this.viewer,z=this.device,B=this.distortion,M=Math.tan(-Eb*t.fov),oa=Math.tan(Eb*t.fov),Z=Math.tan(Eb*t.fov),ca=Math.tan(-Eb*t.fov),
Fa=z.widthMeters/4,Pa=z.heightMeters/2,Ma=t.interLensDistance/2-Fa,Qa=-(t.baselineLensDistance-z.bevelMeters-Pa),Ra=t.screenLensDistance;t=B.distort((Ma-Fa)/Ra);z=B.distort((Qa+Pa)/Ra);Fa=B.distort((Ma+Fa)/Ra);B=B.distort((Qa-Pa)/Ra);Pa=new Float32Array(4);Pa[0]=Math.max(M,t);Pa[1]=Math.min(oa,z);Pa[2]=Math.min(Z,Fa);Pa[3]=Math.max(ca,B);return Pa};sa.prototype.getLeftEyeNoLensTanAngles=function(){var t=this.viewer,z=this.device,B=this.distortion,M=new Float32Array(4),oa=B.distortInverse(Math.tan(-Eb*
t.fov)),Z=B.distortInverse(Math.tan(Eb*t.fov)),ca=B.distortInverse(Math.tan(Eb*t.fov));B=B.distortInverse(Math.tan(-Eb*t.fov));var Fa=z.widthMeters/4,Pa=z.heightMeters/2,Ma=t.interLensDistance/2-Fa;z=-(t.baselineLensDistance-z.bevelMeters-Pa);t=t.screenLensDistance;M[0]=Math.max(oa,(Ma-Fa)/t);M[1]=Math.min(Z,(z+Pa)/t);M[2]=Math.min(ca,(Ma+Fa)/t);M[3]=Math.max(B,(z-Pa)/t);return M};sa.prototype.getLeftEyeVisibleScreenRect=function(t){var z=this.viewer,B=this.device,M=z.screenLensDistance,oa=(B.widthMeters-
z.interLensDistance)/2;z=z.baselineLensDistance-B.bevelMeters;var Z=(t[0]*M+oa)/B.widthMeters,ca=(t[3]*M+z)/B.heightMeters;return{x:Z,y:ca,width:(t[2]*M+oa)/B.widthMeters-Z,height:(t[1]*M+z)/B.heightMeters-ca}};sa.prototype.getFieldOfViewLeftEye=function(t){return t?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};sa.prototype.getFieldOfViewRightEye=function(t){t=this.getFieldOfViewLeftEye(t);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,
downDegrees:t.downDegrees}};sa.prototype.getUndistortedFieldOfViewLeftEye=function(){var t=this.getUndistortedParams_();return{leftDegrees:Fb*Math.atan(t.outerDist),rightDegrees:Fb*Math.atan(t.innerDist),downDegrees:Fb*Math.atan(t.bottomDist),upDegrees:Fb*Math.atan(t.topDist)}};sa.prototype.getUndistortedViewportLeftEye=function(){var t=this.getUndistortedParams_(),z=this.device,B=this.viewer.screenLensDistance,M=z.width/(z.widthMeters/B);z=z.height/(z.heightMeters/B);B=Math.round((t.eyePosX-t.outerDist)*
M);var oa=Math.round((t.eyePosY-t.bottomDist)*z);return{x:B,y:oa,width:Math.round((t.eyePosX+t.innerDist)*M)-B,height:Math.round((t.eyePosY+t.topDist)*z)-oa}};sa.prototype.getUndistortedParams_=function(){var t=this.viewer,z=this.device,B=t.screenLensDistance,M=t.interLensDistance/2/B,oa=z.heightMeters/B,Z=z.widthMeters/B/2-M;z=(t.baselineLensDistance-z.bevelMeters)/B;t=this.distortion.distortInverse(Math.tan(Eb*t.fov));return{outerDist:Math.min(Z,t),innerDist:Math.min(M,t),topDist:Math.min(oa-z,
t),bottomDist:Math.min(z,t),eyePosX:Z,eyePosY:z}};sa.Viewers=lc;var Jc={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},
{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],
dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],
bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},
{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},
{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,
316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},
{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},
{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},
{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],
dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,
437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,
431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],
bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,
256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},
{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],
dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],
dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],
dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};Sa.prototype.getDeviceParams=function(){return this.deviceParams};Sa.prototype.recalculateDeviceParams_=function(){var t=this.calcDeviceParams_();
if(t){if(this.deviceParams=t,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};Sa.prototype.calcDeviceParams_=function(){var t=this.dpdb;if(!t)return console.error("DPDB not available."),null;if(1!=t.format)return console.error("DPDB has unexpected format version."),null;if(!t.devices||!t.devices.length)return console.error("DPDB does not have a devices section."),null;var z=navigator.userAgent||navigator.vendor||
window.opera,B=Tb(),M=Ub();if(!t.devices)return console.error("DPDB has no devices section."),null;for(var oa=0;oa<t.devices.length;oa++){var Z=t.devices[oa];if(!Z.rules)console.warn("Device["+oa+"] has no rules section.");else if("ios"!=Z.type&&"android"!=Z.type)console.warn("Device["+oa+"] has invalid type.");else if(Ya()==("ios"==Z.type)){for(var ca=!1,Fa=0;Fa<Z.rules.length;Fa++)if(this.ruleMatches_(Z.rules[Fa],z,B,M)){ca=!0;break}if(ca)return new Va({xdpi:Z.dpi[0]||Z.dpi,ydpi:Z.dpi[1]||Z.dpi,
bevelMm:Z.bw})}}console.warn("No DPDB device match.");return null};Sa.prototype.ruleMatches_=function(t,z,B,M){if(!t.ua&&!t.res)return!1;t.ua&&"SM"===t.ua.substring(0,2)&&(t.ua=t.ua.substring(0,7));if(t.ua&&0>z.indexOf(t.ua))return!1;if(t.res){if(!t.res[0]||!t.res[1])return!1;z=t.res[0];t=t.res[1];if(Math.min(B,M)!=Math.min(z,t)||Math.max(B,M)!=Math.max(z,t))return!1}return!0};Ta.prototype.set=function(t,z){this.sample=t;this.timestampS=z};Ta.prototype.copy=function(t){this.set(t.sample,t.timestampS)};
fb.prototype.addAccelMeasurement=function(t,z){this.currentAccelMeasurement.set(t,z)};fb.prototype.addGyroMeasurement=function(t,z){this.currentGyroMeasurement.set(t,z);t=z-this.previousGyroMeasurement.timestampS;isNaN(t)||.001>=t||1<t||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};fb.prototype.run_=function(){if(this.isOrientationInitialized){var t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(t);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(t);t=new gb;t.copy(this.filterQ);t.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(t);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();t=new gb;t.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);t.inverse();if(this.isDebug){var z=console,B=z.log;if(1<t.w){console.warn("getQuaternionAngle: w > 1");
var M=0}else M=2*Math.acos(t.w);B.call(z,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Fb*M,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}z=new gb;z.copy(this.filterQ);z.multiply(t);this.filterQ.slerp(z,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),
this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};fb.prototype.getOrientation=function(){return this.filterQ};fb.prototype.accelToQuaternion_=function(t){var z=new vb;z.copy(t);z.normalize();t=new gb;t.setFromUnitVectors(new vb(0,0,-1),z);t.inverse();return t};fb.prototype.gyroToQuaternionDelta_=function(t,z){var B=new gb,M=new vb;M.copy(t);M.normalize();B.setFromAxisAngle(M,t.length()*z);return B};tb.prototype.getPrediction=function(t,z,B){if(!this.previousTimestampS)return this.previousQ.copy(t),
this.previousTimestampS=B,t;var M=new vb;M.copy(z);M.normalize();z=z.length();if(z<20*Eb)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Fb*z).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.deltaQ.setFromAxisAngle(M,z*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(t);this.previousTimestampS=B;return this.outQ};jb.prototype.getPosition=function(){return null};jb.prototype.getOrientation=function(){var t=
void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var B=(new gb).setFromAxisAngle(new vb(0,0,-1),0),M=new gb;-90===window.orientation?M.setFromAxisAngle(new vb(0,1,0),Math.PI/-2):M.setFromAxisAngle(new vb(0,1,0),Math.PI/2);return B.multiply(M)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var B=new gb;B.setFromAxisAngle(new vb(1,0,0),-Math.PI/2);return B}();t=this._deviceOrientationQ;
var z=new gb;z.copy(t);z.multiply(this.deviceOrientationFilterToWorldQ);z.multiply(this.resetQ);z.multiply(this.worldToScreenQ);z.multiplyQuaternions(this.deviceOrientationFixQ,z);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_}t=this.filter.getOrientation();t=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);z=new gb;z.copy(this.filterToWorldQ);
z.multiply(this.resetQ);z.multiply(t);z.multiply(this.worldToScreenQ);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_};jb.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();pb()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};
jb.prototype.onDeviceOrientation_=function(t){this._deviceOrientationQ=this._deviceOrientationQ||new gb;var z=t.alpha,B=t.beta;t=t.gamma;z=(z||0)*Math.PI/180;B=(B||0)*Math.PI/180;t=(t||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(B,z,-t)};jb.prototype.onDeviceMotion_=function(t){this.updateDeviceMotion_(t)};jb.prototype.updateDeviceMotion_=function(t){var z=t.accelerationIncludingGravity,B=t.rotationRate;t=t.timeStamp/1E3;var M=t-this.previousTimestampS;0>M?oc("fusion-pose-sensor:invalid:non-monotonic",
"Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=M||1<M?oc("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-z.x,-z.y,-z.z),B&&(Lb()?this.gyroscope.set(-B.beta,B.alpha,B.gamma):this.gyroscope.set(B.alpha,B.beta,B.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,t)),this.filter.addAccelMeasurement(this.accelerometer,
t));this.previousTimestampS=t};jb.prototype.onOrientationChange_=function(t){this.setScreenTransform_()};jb.prototype.onMessage_=function(t){(t=t.data)&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)};jb.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new vb(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new vb(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
this.inverseWorldToScreenQ.inverse()};jb.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var t;if(t=Ya()){t=window.self!==window.top;var z=yc(document.referrer),B=yc(window.location.href);t=t&&z!==B}t&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",
this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};jb.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",
this.onMessageCallback_)};var Sc=new vb(1,0,0),Tc=new vb(0,0,1),pc=new gb;pc.setFromAxisAngle(Sc,-Math.PI/2);pc.multiply((new gb).setFromAxisAngle(Tc,Math.PI/2));var Nc=function(){function t(z){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.config=z;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new gb;this._outQ=new gb;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);
this.init()}lb(t,[{key:"init",value:function(){var z=null;try{z=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),z.addEventListener("error",this._onSensorError)}catch(B){this.errors.push(B),"SecurityError"===B.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===B.name?this.useDeviceMotion():
console.error(B)}z&&(this.api="sensor",this.sensor=z,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new jb(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var z=this.sensor.quaternion;this._sensorQ.set(z[0],z[1],z[2],z[3]);z=this._outQ;z.copy(pc);z.multiply(this._sensorQ);this.config.YAW_ONLY&&(z.x=z.z=0,z.normalize());this._out[0]=z.x;this._out[1]=z.y;this._out[2]=z.z;this._out[3]=z.w;return this._out}},{key:"_onSensorError",value:function(z){this.errors.push(z.error);"NotAllowedError"===z.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===z.error.name?console.error("Sensor could not be read"):console.error(z.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return t}();kb.prototype.show=function(t){t||this.overlay.parentElement?t&&(this.overlay.parentElement&&this.overlay.parentElement!=t&&this.overlay.parentElement.removeChild(this.overlay),t.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";t=this.overlay.querySelector("img").style;
pb()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")};kb.prototype.hide=function(){this.overlay.style.display="none"};kb.prototype.showTemporarily=function(t,z){this.show(z);this.timer=setTimeout(this.hide.bind(this),t)};kb.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};kb.prototype.update=function(){this.disableShowTemporarily();!pb()&&mc()?this.show():this.hide()};kb.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
ib.prototype.show=function(t){this.root=t;t.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};ib.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};ib.prototype.getCurrentViewer=function(){return sa.Viewers[this.selectedKey]};ib.prototype.getSelectedKey_=function(){var t=this.dialog.querySelector("input[name=field]:checked");return t?t.id:null};
ib.prototype.onChange=function(t){this.onChangeCallbacks_.push(t)};ib.prototype.fireOnChange_=function(t){for(var z=0;z<this.onChangeCallbacks_.length;z++)this.onChangeCallbacks_[z](t)};ib.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&sa.Viewers[this.selectedKey]){this.fireOnChange_(sa.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(t){console.error("Failed to save viewer profile: %s",t)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
ib.prototype.createDialog_=function(t){var z=document.createElement("div");z.classList.add("webvr-polyfill-viewer-selector");z.style.display="none";var B=document.createElement("div"),M=B.style;M.position="fixed";M.left=0;M.top=0;M.width="100%";M.height="100%";M.background="rgba(0, 0, 0, 0.3)";B.addEventListener("click",this.hide.bind(this));var oa=document.createElement("div");M=oa.style;M.boxSizing="border-box";M.position="fixed";M.top="24px";M.left="50%";M.marginLeft="-140px";M.width="280px";M.padding=
"24px";M.overflow="hidden";M.background="#fafafa";M.fontFamily="'Roboto', sans-serif";M.boxShadow="0px 5px 20px #666";oa.appendChild(this.createH1_("Select your viewer"));for(var Z in t)oa.appendChild(this.createChoice_(Z,t[Z].label));oa.appendChild(this.createButton_("Save",this.onSave_.bind(this)));z.appendChild(B);z.appendChild(oa);return z};ib.prototype.createH1_=function(t){var z=document.createElement("h1"),B=z.style;B.color="black";B.fontSize="20px";B.fontWeight="bold";B.marginTop=0;B.marginBottom=
"24px";z.innerHTML=t;return z};ib.prototype.createChoice_=function(t,z){var B=document.createElement("div");B.style.marginTop="8px";B.style.color="black";var M=document.createElement("input");M.style.fontSize="30px";M.setAttribute("id",t);M.setAttribute("type","radio");M.setAttribute("value",t);M.setAttribute("name","field");var oa=document.createElement("label");oa.style.marginLeft="4px";oa.setAttribute("for",t);oa.innerHTML=z;B.appendChild(M);B.appendChild(oa);return B};ib.prototype.createButton_=
function(t,z){var B=document.createElement("button");B.innerHTML=t;t=B.style;t.float="right";t.textTransform="uppercase";t.color="#1094f7";t.fontSize="14px";t.letterSpacing=0;t.border=0;t.background="none";t.marginTop="16px";B.addEventListener("click",z);return B};var Uc="undefined"!==typeof window?window:"undefined"!==typeof kc?kc:"undefined"!==typeof self?self:{},Lc=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}(function(t,z){return z={exports:{}},
t(z,z.exports),z.exports}(function(t,z){(function(B,M){t.exports=M()})(Uc,function(){return function(B){function M(Z){if(oa[Z])return oa[Z].exports;var ca=oa[Z]={i:Z,l:!1,exports:{}};B[Z].call(ca.exports,ca,ca.exports,M);ca.l=!0;return ca.exports}var oa={};M.m=B;M.c=oa;M.d=function(Z,ca,Fa){M.o(Z,ca)||Object.defineProperty(Z,ca,{configurable:!1,enumerable:!0,get:Fa})};M.n=function(Z){var ca=Z&&Z.__esModule?function(){return Z["default"]}:function(){return Z};M.d(ca,"a",ca);return ca};M.o=function(Z,
ca){return Object.prototype.hasOwnProperty.call(Z,ca)};M.p="";return M(M.s=0)}([function(B,M,oa){var Z=function(){function Pa(Ma,Qa){for(var Ra=0;Ra<Qa.length;Ra++){var ab=Qa[Ra];ab.enumerable=ab.enumerable||!1;ab.configurable=!0;"value"in ab&&(ab.writable=!0);Object.defineProperty(Ma,ab.key,ab)}}return function(Ma,Qa,Ra){Qa&&Pa(Ma.prototype,Qa);Ra&&Pa(Ma,Ra);return Ma}}(),ca=oa(1),Fa="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;M=function(){function Pa(){if(!(this instanceof Pa))throw new TypeError("Cannot call a class as a function");Fa?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",ca),this.noSleepVideo.addEventListener("timeupdate",function(Ma){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}
Z(Pa,[{key:"enable",value:function(){Fa?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Fa?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Pa}();B.exports=M},function(B,M,oa){B.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
Kc=1E3,Vc=[0,0,.5,1],Wc=[.5,0,.5,1],Xc=window.requestAnimationFrame,Yc=window.cancelAnimationFrame;bb.prototype.getFrameData=function(t){return Pc(t,this._getPose(),this)};bb.prototype.getPose=function(){Qb("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};bb.prototype.resetPose=function(){Qb("VRDisplay.prototype.resetPose");return this._resetPose()};bb.prototype.getImmediatePose=function(){Qb("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};bb.prototype.requestAnimationFrame=function(t){return Xc(t)};bb.prototype.cancelAnimationFrame=function(t){return Yc(t)};bb.prototype.wrapForFullscreen=function(t){if(Ya())return t;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==t)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=t;(this.originalParent_=t.parentElement)||document.body.appendChild(t);this.fullscreenWrapper_.parentElement||(t=this.fullscreenElement_.parentElement,t.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),t.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};bb.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var t=this.fullscreenElement_;this.fullscreenElementCachedStyle_?t.setAttribute("style",this.fullscreenElementCachedStyle_):t.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var z=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(t);this.originalParent_===z?z.insertBefore(t,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(t);
z.removeChild(this.fullscreenWrapper_);return t}};bb.prototype.requestPresent=function(t){var z=this.isPresenting,B=this;t instanceof Array||(Qb("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),t=[t]);return new Promise(function(M,oa){if(B.capabilities.canPresent)if(0==t.length||t.length>B.capabilities.maxLayers)oa(Error("Invalid number of layers."));else{var Z=t[0];if(Z.source){var ca=Z.leftBounds||Vc,Fa=Z.rightBounds||Wc;if(z){var Pa=B.layer_;
Pa.source!==Z.source&&(Pa.source=Z.source);for(Z=0;4>Z;Z++)Pa.leftBounds[Z]=ca[Z],Pa.rightBounds[Z]=Fa[Z];B.wrapForFullscreen(B.layer_.source);B.updatePresent_();M()}else{B.layer_={predistorted:Z.predistorted,source:Z.source,leftBounds:ca.slice(0),rightBounds:Fa.slice(0)};B.waitingForPresent_=!1;if(B.layer_&&B.layer_.source){var Ma=B.wrapForFullscreen(B.layer_.source);B.addFullscreenListeners_(Ma,function(){B.isPresenting=Ma===(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement);B.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Qa){console.error("screen.orientation.lock() failed due to",Qa.message)}),B.waitingForPresent_=!1,B.beginPresent_(),M()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),B.removeFullscreenWrapper(),B.disableWakeLock(),B.endPresent_(),B.removeFullscreenListeners_());B.fireVRDisplayPresentChange_()},function(){B.waitingForPresent_&&
(B.removeFullscreenWrapper(),B.removeFullscreenListeners_(),B.disableWakeLock(),B.waitingForPresent_=!1,B.isPresenting=!1,oa(Error("Unable to present.")))});if(Oc(Ma))B.enableWakeLock(),B.waitingForPresent_=!0;else if(Ya()||Gb())B.enableWakeLock(),B.isPresenting=!0,B.beginPresent_(),B.fireVRDisplayPresentChange_(),M()}B.waitingForPresent_||Ya()||(xc(),oa(Error("Unable to present.")))}}else M()}else oa(Error("VRDisplay is not capable of presenting."))})};bb.prototype.exitPresent=function(){var t=this.isPresenting,
z=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(B,M){t?(!xc()&&Ya()&&(z.endPresent_(),z.fireVRDisplayPresentChange_()),Gb()&&(z.removeFullscreenWrapper(),z.removeFullscreenListeners_(),z.endPresent_(),z.fireVRDisplayPresentChange_()),B()):M(Error("Was not presenting to VRDisplay."))})};bb.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};bb.prototype.fireVRDisplayPresentChange_=function(){var t=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(t)};bb.prototype.fireVRDisplayConnect_=function(){var t=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(t)};bb.prototype.addFullscreenListeners_=function(t,z,B){this.removeFullscreenListeners_();this.fullscreenEventTarget_=t;this.fullscreenChangeHandler_=z;this.fullscreenErrorHandler_=B;z&&(document.fullscreenEnabled?t.addEventListener("fullscreenchange",z,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenchange",
z,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",z,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenchange",z,!1));B&&(document.fullscreenEnabled?t.addEventListener("fullscreenerror",B,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenerror",B,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",B,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenerror",B,!1))};bb.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var t=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var z=this.fullscreenChangeHandler_;t.removeEventListener("fullscreenchange",z,!1);t.removeEventListener("webkitfullscreenchange",z,!1);document.removeEventListener("mozfullscreenchange",z,!1);t.removeEventListener("msfullscreenchange",z,!1)}this.fullscreenErrorHandler_&&(z=this.fullscreenErrorHandler_,t.removeEventListener("fullscreenerror",z,!1),t.removeEventListener("webkitfullscreenerror",
z,!1),document.removeEventListener("mozfullscreenerror",z,!1),t.removeEventListener("msfullscreenerror",z,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};bb.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};bb.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};bb.prototype.beginPresent_=function(){};bb.prototype.endPresent_=function(){};bb.prototype.submitFrame=function(t){};bb.prototype.getEyeParameters=
function(t){return null};var Mc={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};Wa.prototype=Object.create(bb.prototype);Wa.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};Wa.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};Wa.prototype._getFieldOfView=function(t){if("left"==t)t=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==t)t=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",t),null;return t};Wa.prototype._getEyeOffset=function(t){if("left"==t)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==t)t=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",t),null;return t};Wa.prototype.getEyeParameters=function(t){var z=this._getEyeOffset(t),B=this._getFieldOfView(t);t={offset:z,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(t,"fieldOfView",{enumerable:!0,get:function(){Qb("VRFieldOfView","VRFrameData's projection matrices");return B}});return t};Wa.prototype.onDeviceParamsUpdated_=function(t){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};Wa.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};Wa.prototype.beginPresent_=function(){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl"));
t||(t=this.layer_.source.getContext("webgl2"));t&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(t.canvas.width=Tb()*this.bufferScale_,t.canvas.height=Ub()*this.bufferScale_,this.cardboardUI_=new F(t)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new F(t)),this.distorter_=new E(t,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(z){this.viewerSelector_.show(this.layer_.source.parentElement);
z.stopPropagation();z.preventDefault()}.bind(this),function(z){this.exitPresent();z.stopPropagation();z.preventDefault()}.bind(this)),this.rotateInstructions_&&(pb()&&mc()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};Wa.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};Wa.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};Wa.prototype.submitFrame=function(t){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){(t=this.layer_.source.getContext("webgl"))||(t=this.layer_.source.getContext("experimental-webgl"));t||(t=this.layer_.source.getContext("webgl2"));t=t.canvas;if(t.width!=this.lastWidth||t.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=t.width;this.lastHeight=t.height;this.cardboardUI_.render()}};
Wa.prototype.onOrientationChange_=function(t){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};Wa.prototype.onResize_=function(t){this.layer_&&((t=this.layer_.source.getContext("webgl"))||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2")),t.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),
nc(t.canvas))};Wa.prototype.onViewerChanged_=function(t){this.deviceInfo_.setViewer(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};Wa.prototype.fireVRDisplayDeviceParamsChange_=function(){var t=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(t)};Wa.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};Wa.VRDisplay=bb;return Wa})})),sb=function(r){var x=S.call(this)||this;x.global=r;x.onWindowResize=x.onWindowResize.bind(x);x.global.window.addEventListener("resize",x.onWindowResize);x.environmentBlendMode="opaque";return x};$jscomp.inherits(sb,S);sb.prototype.onBaseLayerSet=function(r,x){throw Error("Not implemented");};sb.prototype.isSessionSupported=function(r){throw Error("Not implemented");};sb.prototype.isFeatureSupported=
function(r){throw Error("Not implemented");};sb.prototype.requestSession=function(r,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){throw Error("Not implemented");})};sb.prototype.requestAnimationFrame=function(r){throw Error("Not implemented");};sb.prototype.onFrameStart=function(r){throw Error("Not implemented");};sb.prototype.onFrameEnd=function(r){throw Error("Not implemented");};sb.prototype.doesSessionSupportReferenceSpace=function(r,x){throw Error("Not implemented");};sb.prototype.requestStageBounds=
function(){throw Error("Not implemented");};sb.prototype.requestFrameOfReferenceTransform=function(r,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.return(void 0)})};sb.prototype.cancelAnimationFrame=function(r){throw Error("Not implemented");};sb.prototype.endSession=function(r){throw Error("Not implemented");};sb.prototype.getViewport=function(r,x,E,F){throw Error("Not implemented");};sb.prototype.getProjectionMatrix=function(r){throw Error("Not implemented");};sb.prototype.getBasePoseMatrix=
function(){throw Error("Not implemented");};sb.prototype.getBaseViewMatrix=function(r){throw Error("Not implemented");};sb.prototype.getInputSources=function(){throw Error("Not implemented");};sb.prototype.getInputPose=function(r,x,E){throw Error("Not implemented");};sb.prototype.onWindowResize=function(){this.onWindowResize()};var Ac={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],
axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},qc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},$c={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,
2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,
0,1]}},"Oculus Touch (Right)":Ac,"Oculus Touch (Left)":Ac,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,
3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":qc,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":qc,"Windows Mixed Reality (Left)":qc},Bc=m(.155,-.465,-.15),ad=m(-.155,-.465,-.15),bd=m(0,0,-.25),cd=m(0,0,
.05),Cc=m(-.08,.14,.08),Dc=180/Math.PI,Rb=function(){this.hand="right";this.headElbowOffset=Bc;this.controllerQ=G();this.lastControllerQ=G();this.headQ=G();this.headPos=k();this.elbowPos=k();this.wristPos=k();this.lastTime=this.time=null;this.rootQ=G();this.position=k()};Rb.prototype.setHandedness=function(r){this.hand!=r&&(this.hand=r,this.headElbowOffset="left"==this.hand?ad:Bc)};Rb.prototype.update=function(r,x){this.time=ea();r&&(R(this.lastControllerQ,this.controllerQ),R(this.controllerQ,r));
x&&(g(this.headPos,x),f(this.headQ,x));r=this.getHeadYawOrientation_();x=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<x/((this.time-this.lastTime)/1E3)?H(this.rootQ,this.rootQ,r,Math.min(x/.175,1)):R(this.rootQ,r);r=m(0,0,-1);y(r,r,this.controllerQ);r=w(r,[0,1,0]);r=this.clamp_((r-.12)/.87,0,1);var E=la(this.rootQ);P(E,E);I(E,E,this.controllerQ);x=this.elbowPos;n(x,this.headPos);q(x,x,this.headElbowOffset);var F=l(Cc);u(F,F,r);q(x,x,F);F=this.quatAngle_(E,G())*Dc;var ba=(1-Math.pow(F/
180,4))*(.4+.24*r);F=G();H(F,F,E,ba);ba=P(G(),F);E=la(E);I(E,E,ba);ba=this.wristPos;n(ba,cd);y(ba,ba,F);q(ba,ba,bd);y(ba,ba,E);q(ba,ba,x);x=l(Cc);u(x,x,r);q(this.position,this.wristPos,x);y(this.position,this.position,this.rootQ);this.lastTime=this.time};Rb.prototype.getPosition=function(){return this.position};Rb.prototype.getHeadYawOrientation_=function(){var r=k();da(r,this.headQ,"YXZ");var x=G(),E=r[1]*Dc;r=.5*Math.PI/180;var F=0*r;E*=r;var ba=0*r;r=Math.sin(F);F=Math.cos(F);var qa=Math.sin(E);
E=Math.cos(E);var sa=Math.sin(ba);ba=Math.cos(ba);x[0]=r*E*ba-F*qa*sa;x[1]=F*qa*ba+r*E*sa;x[2]=F*E*sa-r*qa*ba;x[3]=F*E*ba+r*qa*sa;return x};Rb.prototype.clamp_=function(r,x,E){return Math.min(Math.max(r,x),E)};Rb.prototype.quatAngle_=function(r,x){var E=[0,0,-1],F=[0,0,-1];y(E,E,r);y(F,F,x);r=m(E[0],E[1],E[2]);F=m(F[0],F[1],F[2]);p(r,r);p(F,F);F=w(r,F);F=1<F?0:-1>F?Math.PI:Math.acos(F);return F};var Bb=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Ec={pressed:!1,touched:!1,value:0};Object.freeze(Ec);
var rc=function(r,x,E){E||(E={});if(E.userAgentOverrides)for(var F in E.userAgentOverrides)if(navigator.userAgent.includes(F)){F=E.userAgentOverrides[F];for(var ba in F)ba in E?Object.assign(E[ba],F[ba]):E[ba]=F[ba];break}ba=Array(E.axes&&E.axes.length?E.axes.length:r.axes.length);F=Array(E.buttons&&E.buttons.length?E.buttons.length:r.buttons.length);var qa=null;if(E.gripTransform){var sa=E.gripTransform.orientation||[0,0,0,1];qa=a();e(qa,ra(sa,sa),E.gripTransform.position||[0,0,0])}sa=null;if(E.targetRayTransform){var La=
E.targetRayTransform.orientation||[0,0,0,1];sa=a();e(sa,ra(La,La),E.targetRayTransform.position||[0,0,0])}La=E.profiles;E.displayProfiles&&x.displayName in E.displayProfiles&&(La=E.displayProfiles[x.displayName]);this[Bb]={gamepad:r,map:E,profiles:La||[r.id],mapping:E.mapping||r.mapping,axes:ba,buttons:F,gripTransform:qa,targetRayTransform:sa};this._update()};rc.prototype._update=function(){for(var r=this[Bb].gamepad,x=this[Bb].map,E=this[Bb].axes,F=0;F<E.length;++F)E[F]=x.axes&&F in x.axes?null===
x.axes[F]?0:r.axes[x.axes[F]]:r.axes[F];if(x.axes&&x.axes.invert){F=$jscomp.makeIterator(x.axes.invert);for(var ba=F.next();!ba.done;ba=F.next())ba=ba.value,ba<E.length&&(E[ba]*=-1)}E=this[Bb].buttons;for(F=0;F<E.length;++F)E[F]=x.buttons&&F in x.buttons?null===x.buttons[F]?Ec:r.buttons[x.buttons[F]]:r.buttons[F]};$jscomp.global.Object.defineProperties(rc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[Bb].profiles}},
index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[Bb].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[Bb].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[Bb].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[Bb].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[Bb].buttons}},hapticActuators:{configurable:!0,
enumerable:!0,get:function(){return this[Bb].gamepad.hapticActuators}}});var hc=function(r,x,E,F){E=void 0===E?0:E;F=void 0===F?-1:F;this.polyfill=r;this.display=x;this.gamepad=this.nativeGamepad=null;this.inputSource=new eb(this);this.lastPosition=k();this.emulatedPosition=!1;this.basePoseMatrix=a();this.outputMatrix=a();this.primaryButtonIndex=E;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=F;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=
null};hc.prototype.updateFromGamepad=function(r){this.nativeGamepad!==r&&(this.gamepad=(this.nativeGamepad=r)?new rc(r,this.display,$c[r.id]):null);this.handedness=""===r.hand?"none":r.hand;this.gamepad&&this.gamepad._update();r.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!r.pose.hasPosition):""===r.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};hc.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var r=this.nativeGamepad.pose,
x=r.position,E=r.orientation;if(!x&&!E)return;x?(this.lastPosition[0]=x[0],this.lastPosition[1]=x[1],this.lastPosition[2]=x[2]):r.hasPosition?x=this.lastPosition:(this.armModel||(this.armModel=new Rb),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(E,this.polyfill.getBasePoseMatrix()),x=this.armModel.getPosition());e(this.basePoseMatrix,E,x)}else r=this.basePoseMatrix,x=this.polyfill.getBasePoseMatrix(),r[0]=x[0],r[1]=x[1],r[2]=x[2],r[3]=x[3],r[4]=x[4],r[5]=x[5],r[6]=x[6],
r[7]=x[7],r[8]=x[8],r[9]=x[9],r[10]=x[10],r[11]=x[11],r[12]=x[12],r[13]=x[13],r[14]=x[14],r[15]=x[15];return this.basePoseMatrix};hc.prototype.getXRPose=function(r,x){this.updateBasePoseMatrix();switch(x){case "target-ray":r._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Bb].targetRayTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Bb].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;r._transformBasePoseMatrix(this.outputMatrix,
this.basePoseMatrix);this.gamepad&&this.gamepad[Bb].gripTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Bb].gripTransform);break;default:return null}r._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};$jscomp.global.Object.defineProperties(hc.prototype,{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var Fc={highRefreshRate:!0},Gc={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},
dd=0,ed=function(r,x,E){E=void 0===E?{}:E;this.mode=r;this.enabledFeatures=x;this.outputContext=null;this.immersive="immersive-vr"==r||"immersive-ar"==r;this.baseLayer=this.ended=null;this.id=++dd;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(E.renderContextType||"2d"))},ob=function(r,x){var E=x.capabilities.canPresent;var F=sb.call(this,r)||this;F.display=x;F.frame=new r.VRFrameData;F.sessions=new Map;F.immersiveSession=null;F.canPresent=
E;F.baseModelMatrix=a();F.gamepadInputSources={};F.tempVec3=new Float32Array(3);F.onVRDisplayPresentChange=F.onVRDisplayPresentChange.bind(F);r.window.addEventListener("vrdisplaypresentchange",F.onVRDisplayPresentChange);F.CAN_USE_GAMEPAD=r.navigator&&"getGamepads"in r.navigator;F.HAS_BITMAP_SUPPORT=!(!r.ImageBitmapRenderingContext||!r.createImageBitmap);return F};$jscomp.inherits(ob,sb);ob.prototype.onBaseLayerSet=function(r,x){var E=this,F=this.sessions.get(r),ba=x.context.canvas;if(F.immersive){r=
this.display.getEyeParameters("left");var qa=this.display.getEyeParameters("right");ba.width=2*Math.max(r.renderWidth,qa.renderWidth);ba.height=Math.max(r.renderHeight,qa.renderHeight);this.display.requestPresent([{source:ba,attributes:Fc}]).then(function(){E.global.document.body.contains(ba)||(F.modifiedCanvasLayer=!0,E.global.document.body.appendChild(ba),ba.style.display="block",ba.style.position="absolute",ba.style.width=ba.style.height="1px",ba.style.top=ba.style.left="0px");F.baseLayer=x})}else F.baseLayer=
x};ob.prototype.isSessionSupported=function(r){return"immersive-ar"==r||"immersive-vr"==r&&!1===this.canPresent?!1:!0};ob.prototype.isFeatureSupported=function(r){switch(r){case "viewer":return!0;case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};ob.prototype.requestSession=function(r,x){var E=this,F,ba,qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress){if(!E.isSessionSupported(r))return sa.return(Promise.reject());
F="immersive-vr"==r;if(!F)return sa.jumpTo(2);ba=E.global.document.createElement("canvas");ba.getContext("webgl");return sa.yield(E.display.requestPresent([{source:ba,attributes:Fc}]),2)}qa=new ed(r,x,{renderContextType:E.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});E.sessions.set(qa.id,qa);F&&(E.immersiveSession=qa,E.dispatchEvent("@@webxr-polyfill/vr-present-start",qa.id));return sa.return(Promise.resolve(qa.id))})};ob.prototype.requestAnimationFrame=function(r){return this.display.requestAnimationFrame(r)};
ob.prototype.getPrimaryButtonIndex=function(r){var x=0,E=r.id.toLowerCase(),F;for(F in Gc)if(E.includes(F)){x=Gc[F];break}return Math.min(x,r.buttons.length-1)};ob.prototype.onFrameStart=function(r,x){this.display.depthNear=x.depthNear;this.display.depthFar=x.depthFar;this.display.getFrameData(this.frame);r=this.sessions.get(r);if(r.immersive&&this.CAN_USE_GAMEPAD){var E=this.gamepadInputSources;this.gamepadInputSources={};for(var F=this.global.navigator.getGamepads(),ba=0;ba<F.length;++ba){var qa=
F[ba];if(qa&&0<qa.displayId){var sa=E[ba];sa||(sa=new hc(this,this.display,this.getPrimaryButtonIndex(qa)));sa.updateFromGamepad(qa);this.gamepadInputSources[ba]=sa;if(-1!=sa.primaryButtonIndex){var La=qa.buttons[sa.primaryButtonIndex].pressed;La&&!sa.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:r.id,inputSource:sa.inputSource}):!La&&sa.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:r.id,inputSource:sa.inputSource});
sa.primaryActionPressed=La}-1!=sa.primarySqueezeButtonIndex&&((qa=qa.buttons[sa.primarySqueezeButtonIndex].pressed)&&!sa.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:r.id,inputSource:sa.inputSource}):!qa&&sa.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:r.id,inputSource:sa.inputSource}),sa.primarySqueezeActionPressed=qa)}}}!r.immersive&&r.baseLayer&&(r=r.baseLayer.context.canvas,h(this.frame.leftProjectionMatrix,
x.inlineVerticalFieldOfView,r.width/r.height,x.depthNear,x.depthFar))};ob.prototype.onFrameEnd=function(r){r=this.sessions.get(r);if(!r.ended&&r.baseLayer){if(r.outputContext&&(!r.immersive||this.display.capabilities.hasExternalDisplay)){var x=r.baseLayer.context.canvas,E=r.immersive&&this.display.capabilities.hasExternalDisplay?x.width/2:x.width,F=x.height,ba=r.outputContext.canvas,qa=ba.width;ba=ba.height;var sa=r.renderContext;this.HAS_BITMAP_SUPPORT?x.transferToImageBitmap?sa.transferFromImageBitmap(x.transferToImageBitmap()):
this.global.createImageBitmap(x,0,0,E,F,{resizeWidth:qa,resizeHeight:ba}).then(function(La){return sa.transferFromImageBitmap(La)}):sa.drawImage(x,0,0,E,F,0,0,qa,ba)}r.immersive&&r.baseLayer&&this.display.submitFrame()}};ob.prototype.cancelAnimationFrame=function(r){this.display.cancelAnimationFrame(r)};ob.prototype.endSession=function(r){var x=this,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){E=x.sessions.get(r);if(E.ended)return F.return();if(E.immersive)return F.return(x.display.exitPresent());
E.ended=!0;F.jumpToEnd()})};ob.prototype.doesSessionSupportReferenceSpace=function(r,x){r=this.sessions.get(r);return r.ended?!1:r.enabledFeatures.has(x)};ob.prototype.requestStageBounds=function(){if(this.display.stageParameters){var r=this.display.stageParameters.sizeX,x=this.display.stageParameters.sizeZ,E=[];E.push(-r/2);E.push(-x/2);E.push(r/2);E.push(-x/2);E.push(r/2);E.push(x/2);E.push(-r/2);E.push(x/2);return E}return null};ob.prototype.requestFrameOfReferenceTransform=function(r,x){var E=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){return("local-floor"===r||"bounded-floor"===r)&&E.display.stageParameters&&E.display.stageParameters.sittingToStandingTransform?F.return(E.display.stageParameters.sittingToStandingTransform):F.return(null)})};ob.prototype.getProjectionMatrix=function(r){if("left"===r)return this.frame.leftProjectionMatrix;if("right"===r)return this.frame.rightProjectionMatrix;if("none"===r)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");
};ob.prototype.getViewport=function(r,x,E,F){r=this.sessions.get(r);var ba=E.context.canvas;E=ba.width;ba=ba.height;if(!r.immersive)return F.x=F.y=0,F.width=E,F.height=ba,!0;if("left"===x||"none"===x)F.x=0;else if("right"===x)F.x=E/2;else return!1;F.y=0;F.width=E/2;F.height=ba;return!0};ob.prototype.getBasePoseMatrix=function(){var r=this.frame.pose,x=r.position;r=r.orientation;if(!x&&!r)return this.baseModelMatrix;x||(x=this.tempVec3,x[0]=x[1]=x[2]=0);e(this.baseModelMatrix,r,x);return this.baseModelMatrix};
ob.prototype.getBaseViewMatrix=function(r){if("left"===r||"none"===r)return this.frame.leftViewMatrix;if("right"===r)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");};ob.prototype.getInputSources=function(){var r=[],x;for(x in this.gamepadInputSources)r.push(this.gamepadInputSources[x].inputSource);return r};ob.prototype.getInputPose=function(r,x,E){if(!x)return null;for(var F in this.gamepadInputSources){var ba=this.gamepadInputSources[F];if(ba.inputSource===
r)return ba.getXRPose(x,E)}return null};ob.prototype.onWindowResize=function(){};ob.prototype.onVRDisplayPresentChange=function(r){var x=this;this.display.isPresenting||this.sessions.forEach(function(E){if(E.immersive&&!E.ended){if(E.modifiedCanvasLayer){var F=E.baseLayer.context.canvas;document.body.removeChild(F);F.setAttribute("style","")}x.immersiveSession===E&&(x.immersiveSession=null);x.dispatchEvent("@@webxr-polyfill/vr-present-end",E.id)}})};$jscomp.global.Object.defineProperties(ob.prototype,
{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(r){this.display.depthNear=r}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(r){this.display.depthFar=r}}});var Hc=function(r,x){x=new Zc(x||{});r=ob.call(this,r,x)||this;r.display=x;r.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),
pose:null,timestamp:null};return r};$jscomp.inherits(Hc,ob);var fd=0,gd=function(r,x){this.mode=r;this.enabledFeatures=x;this.baseLayer=this.ended=null;this.id=++fd},yb=function(r){r=sb.call(this,r)||this;r.sessions=new Map;r.projectionMatrix=a();r.identityMatrix=a();return r};$jscomp.inherits(yb,sb);yb.prototype.onBaseLayerSet=function(r,x){this.sessions.get(r).baseLayer=x};yb.prototype.isSessionSupported=function(r){return"inline"==r};yb.prototype.isFeatureSupported=function(r){switch(r){case "viewer":return!0;
default:return!1}};yb.prototype.requestSession=function(r,x){var E=this,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){if(!E.isSessionSupported(r))return ba.return(Promise.reject());F=new gd(r,x);E.sessions.set(F.id,F);return ba.return(Promise.resolve(F.id))})};yb.prototype.requestAnimationFrame=function(r){return window.requestAnimationFrame(r)};yb.prototype.cancelAnimationFrame=function(r){window.cancelAnimationFrame(r)};yb.prototype.onFrameStart=function(r,x){r=this.sessions.get(r);
r.baseLayer&&(r=r.baseLayer.context.canvas,h(this.projectionMatrix,x.inlineVerticalFieldOfView,r.width/r.height,x.depthNear,x.depthFar))};yb.prototype.onFrameEnd=function(r){};yb.prototype.endSession=function(r){var x=this,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){E=x.sessions.get(r);E.ended=!0;F.jumpToEnd()})};yb.prototype.doesSessionSupportReferenceSpace=function(r,x){r=this.sessions.get(r);return r.ended?!1:r.enabledFeatures.has(x)};yb.prototype.requestStageBounds=function(){return null};
yb.prototype.requestFrameOfReferenceTransform=function(r,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(E){return E.return(null)})};yb.prototype.getProjectionMatrix=function(r){return this.projectionMatrix};yb.prototype.getViewport=function(r,x,E,F){this.sessions.get(r);x=E.context.canvas;r=x.width;x=x.height;F.x=F.y=0;F.width=r;F.height=x;return!0};yb.prototype.getBasePoseMatrix=function(){return this.identityMatrix};yb.prototype.getBaseViewMatrix=function(r){return this.identityMatrix};
yb.prototype.getInputSources=function(){return[]};yb.prototype.getInputPose=function(r,x,E){return null};yb.prototype.onWindowResize=function(){};var hd=function(r){var x,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){switch(F.nextAddress){case 1:x=null;if(!("getVRDisplays"in r.navigator)){F.jumpTo(2);break}F.setCatchFinallyBlocks(3);return F.yield(r.navigator.getVRDisplays(),5);case 5:(E=F.yieldResult)&&E.length&&(x=new ob(r,E[0]));F.leaveTryBlock(2);break;case 3:F.enterCatchBlock();
case 2:return F.return(x)}})},id=function(r,x){var E,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ba){return 1==ba.nextAddress?x.webvr?ba.yield(hd(r),3):ba.jumpTo(2):2!=ba.nextAddress&&(E=ba.yieldResult)?ba.return(E):(F=Ic(r))&&x.cardboard||!F&&x.allowCardboardOnDesktop?(r.VRFrameData||(r.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);
this.pose=null}),ba.return(new Hc(r,x.cardboardConfig))):ba.return(new yb(r))})},jd={global:aa,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},ic=["navigator","HTMLCanvasElement","WebGLRenderingContext"],jc=function(r){r=void 0===r?{}:r;this.config=Object.freeze(Object.assign({},jd,r));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)};jc.prototype._injectPolyfill=
function(r){if(!ic.every(function(F){return!!r[F]}))throw Error("Global must have the following attributes : "+ic);for(var x=$jscomp.makeIterator(Object.keys(Ab)),E=x.next();!E.done;E=x.next())E=E.value,void 0!==r[E]?console.warn(E+" already defined on global."):r[E]=Ab[E];sc(r.WebGLRenderingContext)&&(tc(r.HTMLCanvasElement),r.OffscreenCanvas&&tc(r.OffscreenCanvas),r.WebGL2RenderingContext&&sc(r.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};jc.prototype._patchNavigatorXR=function(){var r=id(this.global,this.config);this.xr=new Ab.XRSystem(r);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};jc.prototype._injectCompatibilityShims=function(r){if(!ic.every(function(E){return!!r[E]}))throw Error("Global must have the following attributes : "+ic);if(r.navigator.xr&&"supportsSession"in r.navigator.xr&&!("isSessionSupported"in r.navigator.xr)){var x=r.navigator.xr.supportsSession;
r.navigator.xr.isSessionSupported=function(E){return x.call(this,E).then(function(){return!0}).catch(function(){return!1})};r.navigator.xr.supportsSession=function(E){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return x.call(this,E)}}};return jc});(function(){var a=function(b,c,d,e,g,f,h){this.id=b;this.name=c;this.parentTexture=d;this.stdExt=this.rawExt=null;this.uvOffsetScale=new THREE.Vector4(e,g,f,h);this.isCutout=!1;this.importAutoScale=this.importGpuCompress=!0};a.prototype={addLoadedListener:function(b){this.parentTexture.addLoadedListener(b)},get hasAlpha(){return this.parentTexture.hasAlpha},serialize:function(){return{id:this.id,name:this.name,atlasId:this.parentTexture.id,atlasOffset:[this.uvOffsetScale.x,this.uvOffsetScale.y],atlasScale:[this.uvOffsetScale.z,
this.uvOffsetScale.w],rawExt:this.rawExt,stdExt:this.stdExt,webFormats:[],alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale}}};WALK.Texture=function(b,c,d,e,g,f,h,k){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=void 0!==b?b:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==c?c:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==d?d:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==e?e:GLC.LINEAR;
this.minFilter=void 0!==g?g:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==k?k:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==f?f:GLC.RGBA;this.type=void 0!==h?h:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=[];this.__webglSlot=this.__webglTexture=null;this.importAutoScale=this.importGpuCompress=
!0};WALK.Texture.DEFAULT_IMAGE=void 0;WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(b){this._needsUpdate=b},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(){console.assert(!this.isAtlas());this._atlasEntries={}},getAtlasEntry:function(b,c,d,e,g,f){var h=this._atlasEntries[c];if(h)return h;console.assert(!this.loaded);h=
new a(b,c,this,d,e,g,f);return this._atlasEntries[c]=h},forEachAtlasEntry:function(b){for(var c in this._atlasEntries)this._atlasEntries.hasOwnProperty(c)&&b(this._atlasEntries[c])},clone:function(b){void 0===b&&(b=new WALK.Texture);b.isCube=b.isCube;b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.isCutout=this.isCutout;b.isAnimated=this.isAnimated;b.hasAlpha=this.hasAlpha;
b.format=this.format;b.type=this.type;b.generateMipmaps=this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},serialize:function(){var b={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale};this.rawExt&&(b.rawExt=this.rawExt);this.isRgbm&&(b.rgbm=!0);return b},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},
addLoadedListener:function(b){this.loaded?b():this._loadedListeners.push(b)},notifyLoaded:function(){this.loaded=!0;for(var b=this._loadedListeners,c=0;c<b.length;c+=1)b[c]();b.length=0}};THREE.EventDispatcher.prototype.apply(WALK.Texture.prototype)})();(function(){WALK.CompressedTexture=function(a,b,c,d,e,g,f,h,k,l){WALK.Texture.call(this,null,g,f,h,k,d,e,l);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.DataTexture=function(a,b,c,d,e,g,f,h,k,l){WALK.Texture.call(this,null,g,f,h,k,d,e,l);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.VideoTexture=function(a,b,c,d,e,g,f,h,k){var l=this;WALK.Texture.call(this,a,b,c,d,e,g,f,h,k);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._interruptible=!0;this._resizedListeners=[];this._handlePaused=function(){l._pauseRequested?l._pauseRequested=!1:l._isSleeping=!0;!l._isPlaying&&l._interruptible&&(l.video.src="")};this._handleEnded=function(){l._isPlaying=
!1;l._isSleeping=!1};this._notifyResized=function(){l.width=l.video.videoWidth;l.height=l.video.videoHeight;for(var m=0;m<l._resizedListeners.length;m+=1)l._resizedListeners[m]()}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);WALK.VideoTexture.prototype.constructor=WALK.VideoTexture;WALK.VideoTexture.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};WALK.VideoTexture.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;
this.video.pause()};Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){console.assert(void 0===this.image,"Video already attached to texture.");this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);a.addEventListener("resize",this._notifyResized);this._isSleeping&&this._isPlaying&&this._pauseVideo()}});Object.defineProperty(WALK.VideoTexture.prototype,
"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});WALK.VideoTexture.prototype.play=function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;this._interruptible&&(b.src=
this._srcAtPausedPosition());var c=b.play();c?(this._isPlaying=!0,c.catch(function(d){console.log("Can't play video texture: "+d);a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this._pauseVideo(),this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=
function(){this._isSleeping&&(this._isPlaying&&this.video&&(this._interruptible&&(this.video.src=this._srcAtPausedPosition()),this.video.play()),this._isSleeping=!1)};WALK.VideoTexture.prototype.dispose=function(){WALK.Texture.prototype.dispose.call(this);this._isPlaying&&this.pause();var a=this.video;this.image=null;this._videoSrc="";this._isPlaying=!1;a.src="";a.removeEventListener("pause",this._handlePaused);a.removeEventListener("ended",this._handleEnded);a.removeEventListener("resize",this._notifyResized);
this._resizedListeners.length=0};WALK.VideoTexture.prototype.addResizedListener=function(a){this._resizedListeners.push(a)};WALK.VideoTexture.prototype.serialize=function(){var a=WALK.Texture.prototype.serialize.call(this);a.video=!0;return a};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}})})();(function(){WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
GLC.RGBA;this.type=void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype)})();(function(){WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube})();(function(){var a=WALK.DEBUG;WALK.CutoutTextureDetector=function(b){var c={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},d=[b.createRenderTarget(1024,1024,c),b.createRenderTarget(512,512,c)];c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var e=new THREE.ShaderPass(c,
"map");e.material.depthTest=!1;e.material.depthWrite=!1;var g=new THREE.Vector2,f=new THREE.Vector4;e.uniforms.mapUvStep.value=g;e.uniforms.mapUvOffsetScale.value=f;c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var h=new THREE.ShaderPass(c,"map");h.material.depthTest=!1;h.material.depthWrite=!1;var k=new THREE.Vector2;
h.uniforms.mapUvScale.value=k;h.uniforms.mapUvStep.value=g;var l=new Uint8Array(4096),m=null;a&&(m=new WALK.Timer);this.isCutoutTexture=function(n){var q=void 0!==n.parentTexture;if(q){var u=n.parentTexture;var p=n.uvOffsetScale.x;var w=n.uvOffsetScale.y;var v=n.uvOffsetScale.z;var y=n.uvOffsetScale.w}else u=n,p=w=0,v=y=1;if(!u.hasAlpha||u.video)n.isCutout=!1;else{a&&m.reset();b.enableScissorTest(!0);var D=u.width*v,A=u.height*y;g.set(1/D,1/A);f.set(p,w,v,y);D=Math.max(Math.floor(D/2),1);A=Math.max(Math.floor(A/
2),1);b.setRenderTarget(d[0]);b.setViewport(0,0,D,A);b.setScissor(0,0,D,A);e.render(b,d[0],u);for(var G=1,I=d[0];1!==D&&1!==A;){g.set(1/I.width,1/I.height);k.set(D/I.width,A/I.height);D=Math.floor(D/2);A=Math.floor(A/2);var H=d[G];b.setRenderTarget(H);b.setViewport(0,0,D,A);b.setScissor(0,0,D,A);h.render(b,H,I);I=H;G=(G+1)%2}b.readPixels(D,A,l);I=G=0;D=Math.max(D,A);for(A=0;A<D;++A)G+=l[4*A],I+=l[4*A+1];G=100*G/(255*D);I=100*I/(255*D);n.isCutout=20>G||50<I;a&&(D="",q&&(D+="From atlas: "+u.name+" ["+
p+", "+w+", "+v+", "+y+"]\n"),console.log(n.name+" "+u.width+"x"+u.height+"\n "+D+"Is cutout: "+n.isCutout+"\n Partialy transparent regions: "+G+"%\n Fully transparent pixels: "+I+"%\n Time: "+m.elapsedSec()));b.enableScissorTest(!1)}};this.dispose=function(){d[0].dispose();d[1].dispose();e.dispose();h.dispose()}}})();WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarOut vec3 vNormalV;\nvarOut vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\nfragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor.xyz = min(linearToGamma(lightColor), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\nfragColor.xyz = colormap(colorMap, colorGamma);\n#else\nfragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["object_id_distance_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";WALK.SHADERS["object_id_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 0);\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarIn vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\nfragColor.xyz = colormap(colorMap, colorGamma);\n#else\nfragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vPositionV;\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 baseColorUv = vUv;\n#endif\nbaseColorUv = baseColorUv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 + .5 * baseColorUv.y));\nfloat textureAlpha = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 * baseColorUv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, baseColorUv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\nstruct Roughness {\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\nfragColor.rgb = colormap(colorMap, min(gammaColor, 1.0));\n#else\nfragColor.rgb = gammaColor;\n#endif\nfragColor.a = alpha;\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vPositionV;\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\nvarOut vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor.rgb = linearToGammaUnreal(colorLinear);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor.rgb = lineColor;\nfragColor.w = (1.0 - edge) * lineMaxAlpha;\n} else {\nfragColor.rgb = highlight;\nfragColor.w = highlightMix;\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";(function(){WALK.Shader=function(b,c){this.id=b;this.code=c};var a=0;WALK.InlineShader=function(b){WALK.Shader.call(this,"inline:"+a,b);a+=1};WALK.getShader=function(b){return new WALK.Shader(b,WALK.SHADERS[b])}})();(function(){var a=0,b=[0,0],c=Object.freeze({uv:b,uv2:b,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),d=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),e=new WALK.InlineShader("");WALK.BaseMaterial=function(g,f,h){h=void 0===h?e:h;a+=1;Object.defineProperty(this,"id",{value:a});this.name="";this.side=THREE.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=THREE.NoBlending;this.blendSrc=
GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=d;this._vertexShaderBody=g;this._fragmentShaderBody=f;this._fragmentShaderHooks=h;this.defaultAttributeValues=c;this.index0AttributeName=
void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(g){},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(g){this._hideFromLightProbes=g},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(g){this._definesString=null;this._programNeedsUpdate=
g},hasDefine:function(g){return this._defines.has(g)},addDefine:function(g){this.hasDefine(g)||(this._defines.add(g),this.programNeedsUpdate=!0)},removeDefine:function(g){this.hasDefine(g)&&(this._defines.delete(g),this.programNeedsUpdate=!0)},condDefine:function(g,f){g?this.addDefine(f):this.removeDefine(f);return g},_getDefinesString:function(){if(null===this._definesString){for(var g=[],f=$jscomp.makeIterator(this._defines),h=f.next();!h.done;h=f.next())g.push("#define "+h.value);g.sort();this._definesString=
g.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){WALK.DETECTOR.gl.webgl2||this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){WALK.DETECTOR.gl.webgl2||
this._textureLodExtension||(this.programNeedsUpdate=this._textureLodExtension=!0)},_getShaderHeader:function(){return WALK.DETECTOR.gl.webgl2?"#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n":"\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"},generateVertexShader:function(){return[this._getShaderHeader(),
"precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;",this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._getShaderHeader(),this._standardDerivativesExtension?
"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.gl.fragmentPrecision+" float;","precision "+WALK.DETECTOR.gl.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",WALK.DETECTOR.gl.webgl2?"out vec4 fragColor;":"#define fragColor gl_FragColor",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},dispose:function(){this.dispatchEvent({type:"dispose"})},
setUniform:function(g,f,h){this.uniforms[g]={type:f,value:h}},propertyFromUniform:function(g){Object.defineProperty(this,g,{get:function(){return this.uniforms[g].value},set:function(f){this.uniforms[g].value=f}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(g){console.assert(!1,"canMerge not implemented")}};THREE.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype)})();(function(){WALK.CompressedTextureLoader=function(){this._parser=null};WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var e=this,g=[],f=new WALK.CompressedTexture;f.image=g;WALK.queueAjaxGet(a,b,!0,function(h){h=e._parser(h,!0);if(h.isCubemap)for(var k=h.mipmaps.length/h.mipmapCount,l=0;l<k;l+=1){g[l]={mipmaps:[]};for(var m=0;m<h.mipmapCount;m+=1)g[l].mipmaps.push(h.mipmaps[l*h.mipmapCount+m]),g[l].format=h.format,g[l].width=h.width,g[l].height=
h.height}else f.image.width=h.width,f.image.height=h.height,f.mipmaps=h.mipmaps;1===h.mipmapCount&&(f.minFilter=GLC.LINEAR);f.format=h.format;f.width=h.width;f.height=h.height;c&&c(f)},d);return f}}})();THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}")};THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:new WALK.InlineShader("varOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform float opacity;\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nfragColor = opacity * texel;\n}")};THREE.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[];void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader")};
THREE.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,e=this.passes.length;for(d=0;d<e;d++){var g=this.passes[d];g.enabled&&(g.render(this.renderer,a,b,c),g.needsSwap&&d!=e-1&&(g=b,b=a,a=g))}}}()};THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
THREE.ShaderPass.prototype={render:function(a,b,c,d){if(d=this.material.uniforms[this.textureID])d.value=c;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};THREE.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};THREE.RenderPass.prototype={render:function(a,b,c,d){c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};(function(a){function b(g){return!isNaN(g)&&isFinite(g)}function c(g,f){for(var h=0,k=g.length;h<k;h++)if(g[h]===f)return h;return-1}a.Octree=function(g){g=g||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=b(g.INDEX_OUTSIDE_POS_X)?g.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=b(g.INDEX_OUTSIDE_NEG_X)?g.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=b(g.INDEX_OUTSIDE_POS_Y)?g.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=b(g.INDEX_OUTSIDE_NEG_Y)?
g.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=b(g.INDEX_OUTSIDE_POS_Z)?g.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=b(g.INDEX_OUTSIDE_NEG_Z)?g.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new a.Vector3;this.utilVec32Search=new a.Vector3;if(this.scene=g.scene)this.visualGeometry=new a.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new a.Color(65280));this.depthMax=b(g.depthMax)?g.depthMax:Infinity;this.objectsThreshold=b(g.objectsThreshold)?g.objectsThreshold:8;this.overlapPct=b(g.overlapPct)?g.overlapPct:.15;this.root=
new a.OctreeNode({tree:this,parent:null,position:new a.Vector3})};a.Octree.prototype={add:function(g,f,h){this.root.addObject(new a.OctreeObjectData(g,f,h))},search:function(g,f,h){var k,l=[];this.root.appendObjectsFromNode(l);0<f||(f=Number.MAX_VALUE);if(h instanceof a.Vector3){h=this.utilVec31Search.copy(h).normalize();var m=this.utilVec32Search.set(1,1,1).divide(h)}var n=0;for(k=this.root.nodesIndices.length;n<k;n++){var q=this.root.nodesByIndex[this.root.nodesIndices[n]];q.search(g,f,h,m,l)}return l},
setRoot:function(g){g instanceof a.OctreeNode&&(this.root=g,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};a.OctreeObjectData=function(g,f,h){this.object=g;f?(this.radius=h,this.position=f):(this.radius=this.object.geometry.boundingSphere.radius,this.position=this.object.geometry.boundingSphere.center)};
var d=new a.Vector3,e=new a.Vector3;new a.Vector3;a.OctreeNode=function(g){this.tree=g.tree;this.id=this.tree.nodeCount++;this.position=g.position;this.radius=0<g.radius?g.radius:1;this.indexOctant=g.indexOctant;this.depth=0;this.reset();this.setParent(g.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+
this.radiusOverlap;this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new a.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};a.OctreeNode.prototype={setParent:function(g){g!==this&&this.parent!==g&&(this.parent=g,this.updateProperties())},
updateProperties:function(){var g;this.parent instanceof a.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var f=0;for(g=this.nodesIndices.length;f<g;f++)this.nodesByIndex[this.nodesIndices[f]].updateProperties()},reset:function(g,f){var h,k=this.nodesIndices||[],l=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var m=0;for(h=k.length;m<h;m++){var n=l[k[m]];n.setParent(void 0);!0===g&&n.reset(g,f)}!0===f&&this.visual&&this.visual.parent&&
this.visual.parent.remove(this.visual)},addNode:function(g,f){g.indexOctant=f;-1===c(this.nodesIndices,f)&&this.nodesIndices.push(f);this.nodesByIndex[f]=g;g.parent!==this&&g.setParent(this)},removeNode:function(g){var f=c(this.nodesIndices,g);this.nodesIndices.splice(f,1);var h=h||this.nodesByIndex[g];delete this.nodesByIndex[g];h.parent===this&&h.setParent(void 0)},addObject:function(g){var f=this.getOctantIndex(g);-1<f&&0<this.nodesIndices.length?(f=this.branch(f),f.addObject(g)):-1>f&&this.parent instanceof
a.OctreeNode?this.parent.addObject(g):(f=c(this.objects,g),-1===f&&this.objects.push(g),g.node=this,this.checkGrow())},addObjectWithoutCheck:function(g){var f;var h=0;for(f=g.length;h<f;h++){var k=g[h];this.objects.push(k);k.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var g=[],f=[],h=[],k=[],l=[],m;var n=0;for(m=this.objects.length;n<m;n++){var q=this.objects[n];var u=this.getOctantIndex(q);-1<u?(h.push(q),
k.push(u)):-1>u?(g.push(q),f.push(u)):l.push(q)}0<h.length&&(l=l.concat(this.split(h,k)));0<g.length&&(l=l.concat(this.expand(g,f)));this.objects=l;this.checkMerge()},split:function(g,f){var h;if(this.depth<this.tree.depthMax){g=g||this.objects;f=f||[];var k=[];var l=0;for(h=g.length;l<h;l++){var m=g[l];var n=f[l];-1<n?(n=this.branch(n),n.addObject(m)):k.push(m)}g===this.objects&&(this.objects=k)}else k=this.objects;return k},branch:function(g){if(this.nodesByIndex[g]instanceof a.OctreeNode)var f=
this.nodesByIndex[g];else{f=.5*this.radiusOverlap;var h=f*this.tree.overlapPct;h=f-h;h=d.set(g&1?h:-h,g&2?h:-h,g&4?h:-h);h=(new a.Vector3).addVectors(this.position,h);f=new a.OctreeNode({tree:this.tree,parent:this,position:h,radius:f,indexOctant:g});this.addNode(f,g)}return f},expand:function(g,f){var h,k=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){g=g||this.objects;f=f||[];var l=[];var m=[];var n=0;for(h=k.length;n<h;n++)k[n].count=0;n=0;for(h=g.length;n<h;n++){var q=
g[n];var u=f[n];-1>u?(u=-u-this.tree.INDEX_OUTSIDE_OFFSET,u&this.tree.FLAG_POS_X?k[this.tree.INDEX_OUTSIDE_POS_X].count++:u&this.tree.FLAG_NEG_X&&k[this.tree.INDEX_OUTSIDE_NEG_X].count++,u&this.tree.FLAG_POS_Y?k[this.tree.INDEX_OUTSIDE_POS_Y].count++:u&this.tree.FLAG_NEG_Y&&k[this.tree.INDEX_OUTSIDE_NEG_Y].count++,u&this.tree.FLAG_POS_Z?k[this.tree.INDEX_OUTSIDE_POS_Z].count++:u&this.tree.FLAG_NEG_Z&&k[this.tree.INDEX_OUTSIDE_NEG_Z].count++,m.push(q)):l.push(q)}if(0<m.length){var p=k.slice(0);p.sort(function(y,
D){return D.count-y.count});u=p[0];n=u.index|1;q=p[1];k=p[2];f=(q.index|1)!==n?q:k;h=f.index|1;q=p[2];k=p[3];p=p[4];var w=q.index|1;var v=k.index|1;q=w!==n&&w!==h?q:v!==n&&v!==h?k:p;n=u.x+f.x+q.x;h=u.y+f.y+q.y;f=u.z+f.z+q.z;u=this.getOctantIndexFromPosition(n,h,f);f=this.getOctantIndexFromPosition(-n,-h,-f);h=this.overlap;q=this.radius;n=0<this.tree.overlapPct?h/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*q;k=n*this.tree.overlapPct;h=n+k-(q+h);e.set(u&1?h:-h,u&2?h:-h,u&4?h:-h);u=(new a.Vector3).addVectors(this.position,
e);u=new a.OctreeNode({tree:this.tree,position:u,radius:n});u.addNode(this,f);this.tree.setRoot(u);n=0;for(h=m.length;n<h;n++)this.tree.root.addObject(m[n])}g===this.objects&&(this.objects=l)}else l=g;return l},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var g=this,f;g.parent instanceof a.OctreeNode&&g.getObjectCountEnd()<this.tree.objectsThreshold;)f=g,g=g.parent;g!==this&&g.merge(f)},merge:function(g){var f;g=g?"[object Array]"===Object.prototype.toString.call(g)!==
!0?[g]:g:[];var h=0;for(f=g.length;h<f;h++){var k=g[h];this.addObjectWithoutCheck(k.getObjectsEnd());k.reset(!0,!0);this.removeNode(k.indexOctant,k)}this.checkMerge()},checkContract:function(){var g;if(0<this.nodesIndices.length){var f=0;var h=this.objects.length;var k=0;for(g=this.nodesIndices.length;k<g;k++){var l=this.nodesByIndex[this.nodesIndices[k]];var m=l.getObjectCountEnd();h+=m;if(!1===n instanceof a.OctreeNode||m>f){var n=l;f=m}}h-f<this.tree.objectsThreshold&&n instanceof a.OctreeNode&&
this.contract(n)}},contract:function(g){var f;var h=0;for(f=this.nodesIndices.length;h<f;h++){var k=this.nodesByIndex[this.nodesIndices[h]];k!==g&&(g.addObjectWithoutCheck(k.getObjectsEnd()),k.reset(!0,!0))}g.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(g);g.checkContract()},getOctantIndex:function(g){var f=this.position,h=this.radiusOverlap,k=this.overlap,l=0;if(g instanceof a.OctreeObjectData){var m=g.radius;var n=g.position}else g instanceof a.OctreeNode&&(n=g.position,
m=0);var q=n.x-f.x;var u=n.y-f.y;n=n.z-f.z;f=Math.abs(q);var p=Math.abs(u);var w=Math.abs(n);if(Math.max(f,p,w)+m>h)return f+m>h&&(l^=0<q?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),p+m>h&&(l^=0<u?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),w+m>h&&(l^=0<n?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),g.indexOctant=-l-this.tree.INDEX_OUTSIDE_OFFSET,g.indexOctant;if(q-m>-k)l|=1;else if(!(q+m<k))return g.indexOctant=this.tree.INDEX_INSIDE_CROSS,g.indexOctant;if(u-m>-k)l|=2;else if(!(u+m<k))return g.indexOctant=
this.tree.INDEX_INSIDE_CROSS,g.indexOctant;if(n-m>-k)l|=4;else if(!(n+m<k))return g.indexOctant=this.tree.INDEX_INSIDE_CROSS,g.indexOctant;g.indexOctant=l;return g.indexOctant},getOctantIndexFromPosition:function(g,f,h){var k=0;0<g&&(k|=1);0<f&&(k|=2);0<h&&(k|=4);return k},appendObjectsFromNode:function(g){var f,h=this.objects;var k=0;for(f=h.length;k<f;k+=1)g.push(h[k].object)},search:function(g,f,h,k,l){var m;if(!0===this.intersectRay(g,h,f,k)){this.appendObjectsFromNode(l);var n=0;for(m=this.nodesIndices.length;n<
m;n++){var q=this.nodesByIndex[this.nodesIndices[n]];q.search(g,f,h,k,l)}}},intersectRay:function(g,f,h,k){f=(this.left-g.x)*k.x;var l=(this.right-g.x)*k.x,m=(this.bottom-g.y)*k.y,n=(this.top-g.y)*k.y,q=(this.back-g.z)*k.z;k=(this.front-g.z)*k.z;g=Math.min(Math.min(Math.max(f,l),Math.max(m,n)),Math.max(q,k));if(0>g)return!1;f=Math.max(Math.max(Math.min(f,l),Math.min(m,n)),Math.min(q,k));return f>g||f>h?!1:!0},getDepthEnd:function(g){var f;if(0<this.nodesIndices.length){var h=0;for(f=this.nodesIndices.length;h<
f;h++){var k=this.nodesByIndex[this.nodesIndices[h]];g=k.getDepthEnd(g)}}else g=!g||this.depth>g?this.depth:g;return g},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var g,f=this.nodesIndices.length;var h=0;for(g=this.nodesIndices.length;h<g;h++)f+=this.nodesByIndex[this.nodesIndices[h]].getNodeCountRecursive();return f},getObjectsEnd:function(g){var f;g=(g||[]).concat(this.objects);var h=0;for(f=this.nodesIndices.length;h<f;h++){var k=
this.nodesByIndex[this.nodesIndices[h]];g=k.getObjectsEnd(g)}return g},getObjectCountEnd:function(){var g,f=this.objects.length;var h=0;for(g=this.nodesIndices.length;h<g;h++)f+=this.nodesByIndex[this.nodesIndices[h]].getObjectCountEnd();return f},getObjectCountStart:function(){for(var g=this.objects.length,f=this.parent;f instanceof a.OctreeNode;)g+=f.objects.length,f=f.parent;return g},toConsole:function(g){var f;g="string"===typeof g?g:"   ";console.log(this.parent?g+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?g+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?g+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var h=0;for(f=this.nodesIndices.length;h<f;h++){var k=this.nodesByIndex[this.nodesIndices[h]];k.toConsole(g+"   ")}}}})(THREE);THREE.PolyhedronBufferGeometry=function(a,b,c,d){function e(l){h.push(l.x,l.y,l.z)}function g(l,m){l*=3;m.x=a[l+0];m.y=a[l+1];m.z=a[l+2]}function f(l,m,n,q){0>q&&1===l.x&&(k[m]=l.x-1);0===n.x&&0===n.z&&(k[m]=q/2/Math.PI+.5)}THREE.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],k=[];(function(l){for(var m=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector3,u=0;u<b.length;u+=3){g(b[u+0],m);g(b[u+1],
n);g(b[u+2],q);var p,w,v=m,y=n,D=q,A=Math.pow(2,l),G=[];for(w=0;w<=A;w++){G[w]=[];var I=v.clone().lerp(D,w/A),H=y.clone().lerp(D,w/A),P=A-w;for(p=0;p<=P;p++)G[w][p]=0===p&&w===A?I:I.clone().lerp(H,p/P)}for(w=0;w<A;w++)for(p=0;p<2*(A-w)-1;p++)v=Math.floor(p/2),0===p%2?(e(G[w][v+1]),e(G[w+1][v]),e(G[w][v])):(e(G[w][v+1]),e(G[w+1][v+1]),e(G[w+1][v]))}})(d);(function(l){for(var m=new THREE.Vector3,n=0;n<h.length;n+=3)m.x=h[n+0],m.y=h[n+1],m.z=h[n+2],m.normalize().multiplyScalar(l),h[n+0]=m.x,h[n+1]=m.y,
h[n+2]=m.z})(c);(function(){for(var l=new THREE.Vector3,m=0;m<h.length;m+=3)l.x=h[m+0],l.y=h[m+1],l.z=h[m+2],k.push(Math.atan2(l.z,-l.x)/2/Math.PI+.5,1-(Math.atan2(-l.y,Math.sqrt(l.x*l.x+l.z*l.z))/Math.PI+.5));l=new THREE.Vector3;m=new THREE.Vector3;for(var n=new THREE.Vector3,q=new THREE.Vector3,u=new THREE.Vector2,p=new THREE.Vector2,w=new THREE.Vector2,v=0,y=0;v<h.length;v+=9,y+=6){l.set(h[v+0],h[v+1],h[v+2]);m.set(h[v+3],h[v+4],h[v+5]);n.set(h[v+6],h[v+7],h[v+8]);u.set(k[y+0],k[y+1]);p.set(k[y+
2],k[y+3]);w.set(k[y+4],k[y+5]);q.copy(l).add(m).add(n).divideScalar(3);var D=Math.atan2(q.z,-q.x);f(u,y+0,l,D);f(p,y+2,m,D);f(w,y+4,n,D)}for(l=0;l<k.length;l+=6)m=k[l+0],n=k[l+2],q=k[l+4],u=Math.min(m,n,q),.9<Math.max(m,n,q)&&.1>u&&(.2>m&&(k[l+0]+=1),.2>n&&(k[l+2]+=1),.2>q&&(k[l+4]+=1))})();this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h.slice()),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2));0===d?this.computeVertexNormals():this.normalizeNormals()};THREE.PolyhedronBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PolyhedronBufferGeometry.prototype.constructor=THREE.PolyhedronBufferGeometry;THREE.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronBufferGeometry.prototype=Object.create(THREE.PolyhedronBufferGeometry.prototype);
THREE.IcosahedronBufferGeometry.prototype.constructor=THREE.IcosahedronBufferGeometry;(function(){WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=THREE.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.setRGB(c/e,d/e,a/e);return 1-e}};THREE.Color.prototype.copyGammaToLinear=void 0;THREE.Color.prototype.copyLinearToGamma=
void 0;THREE.Color.prototype.convertLinearToGamma=void 0;THREE.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};THREE.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this}})();/*
 Copyright (C) 2017-present Shapespark
*/
(function(){var a=new THREE.Vector3;WALK.Math={toSnorm8:function(b){return Math.round(127*THREE.Math.clamp(b,-1,1))},minBytesToHold:function(b){return 127>=b?1:32767>=b?2:4},anyPositiveRootOfQuadraticEquation:function(b,c,d){d=c*c-4*b*d;if(0>d)return null;d=Math.sqrt(d);var e=(-c-d)/(2*b);if(0<e)return e;b=(-c+d)/(2*b);return 0<b?b:null},spheresUnion:function(b,c){if(c.empty())c.copy(b);else{var d=c.center.distanceTo(b.center);if(b.radius>c.radius){var e=b;b=c}else e=c;var g=(e.radius+b.radius+d)/
2;g<=e.radius?c.copy(e):(d=(g-e.radius)/d,console.assert(0<d),a.copy(b.center).sub(e.center).multiplyScalar(d),c.center.copy(e.center).add(a),c.radius=g)}}}})();(function(){WALK.Euler=function(a,b,c){THREE.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(THREE.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return THREE.Math.radToDeg(this.yaw)},set:function(a){this.yaw=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return THREE.Math.radToDeg(this.pitch)},set:function(a){this.pitch=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return THREE.Math.radToDeg(this.roll)},set:function(a){this.roll=THREE.Math.degToRad(a)}});WALK.Euler.prototype.setFromDegTriple=
function(a){var b=THREE.Math.degToRad(a[0]),c=THREE.Math.degToRad(a[1]);a=THREE.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new THREE.Quaternion;a.setFromEuler(this);return a};WALK.Euler.prototype.toRotationMatrix=function(){var a=new THREE.Matrix4;
a.makeRotationFromEuler(this);return a}})();(function(){var a=new THREE.Sphere;WALK.Frustum=function(){this.planes=[new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane]};WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(b){var c=this.planes,d=b.elements;b=d[0];var e=d[1],g=d[2],f=d[3],h=d[4],k=d[5],l=d[6],m=d[7],n=d[8],q=d[9],u=d[10],p=d[11],w=d[12],v=d[13],y=d[14];d=d[15];c[0].setComponents(f-b,m-h,p-n,d-w).normalize();c[1].setComponents(f+b,m+h,p+n,d+w).normalize();c[2].setComponents(f+
e,m+k,p+q,d+v).normalize();c[3].setComponents(f-e,m-k,p-q,d-v).normalize();c[4].setComponents(f-g,m-l,p-u,d-y).normalize();c[5].setComponents(f+g,m+l,p+u,d+y).normalize();return this},intersectsObject:function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.matrixWorld?(a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return this.intersectsSphere(b)},nearPlaneDistanceToCenter:function(b){var c=b.geometry,d=this.planes[5];b.matrixWorld?(a.copy(c.boundingSphere),
a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return d.distanceToPoint(b.center)},intersectsSphere:function(b){var c=this.planes,d=b.center;b=-b.radius;for(var e=0;6>e;e+=1)if(c[e].distanceToPoint(d)<b)return!1;return!0},intersectsBox:function(){var b=new THREE.Vector3,c=new THREE.Vector3;return function(d){for(var e=this.planes,g=0;6>g;g+=1){var f=e[g];b.x=0<f.normal.x?d.min.x:d.max.x;c.x=0<f.normal.x?d.max.x:d.min.x;b.y=0<f.normal.y?d.min.y:d.max.y;c.y=0<f.normal.y?d.max.y:d.min.y;b.z=0<
f.normal.z?d.min.z:d.max.z;c.z=0<f.normal.z?d.max.z:d.min.z;var h=f.distanceToPoint(b);f=f.distanceToPoint(c);if(0>h&&0>f)return!1}return!0}}(),containsPoint:function(b){for(var c=this.planes,d=0;6>d;d+=1)if(0>c[d].distanceToPoint(b))return!1;return!0}}})();(function(){WALK.DETECTOR=new function(){function a(k){var l=document.createElement("a");l.href=k;return l.protocol+"//"+l.host}function b(k,l){k=k.toLowerCase();l=l.toLowerCase();return-1!==k.indexOf(l)}function c(k){return navigator&&navigator.userAgent?b(navigator.userAgent,k):!1}function d(k,l){console.assert(void 0===e[k]);e[k]=l;void 0!==e.webp&&(h.forEach(function(m){return m()}),h.length=0)}var e=this;this.https="https:"===window.location.protocol;this.localhost="localhost"===window.location.hostname||
"127.0.0.1"===window.location.hostname;this.brotliJsDecode=!1;this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);this.inCrossOriginIframe=function(){var k=window.self!==window.top,l=a(document.referrer),m=
a(window.location.href);return k&&l!==m}();this.firefox=c("firefox");this.opera=c("opera")||c("OPR/");var g;(g=c("msie"))||(g=navigator&&navigator.appVersion?b(navigator.appVersion,"trident/"):!1);this.ie=g;this.edge=c("edge/");this.safari=c("safari/")&&!(c("chrome/")||c("chromium/"));this.mac=c("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||4);this.gl=null;var f=function(k){function l(u){var p=n[u];if(void 0!==p)return p;switch(u){case "EXT_texture_filter_anisotropic":p=
k.getExtension("EXT_texture_filter_anisotropic")||k.getExtension("MOZ_EXT_texture_filter_anisotropic")||k.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":p=k.getExtension("WEBGL_compressed_texture_s3tc")||k.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||k.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":p=k.getExtension("WEBGL_compressed_texture_pvrtc")||k.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");
break;case "WEBGL_compressed_texture_etc1":p=k.getExtension("WEBGL_compressed_texture_etc1");break;default:p=k.getExtension(u)}return n[u]=p}function m(){var u=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return u?parseInt(u[2],10):!1}var n={};this.extension=l;this.webgl2="undefined"!==typeof WebGL2RenderingContext&&k instanceof WebGL2RenderingContext;this.antialiasNative=k.getContextAttributes().antialias&&1<k.getParameter(k.SAMPLES);this.antialiasSamples=k.getParameter(k.SAMPLES);this.antialiasPostprocess=
!e.mobile;this.floatTextures=this.webgl2||l("OES_texture_float");this.standardDerivatives=this.webgl2||l("OES_standard_derivatives");this.maxAnisotropy=function(){var u=l("EXT_texture_filter_anisotropic");return null!==u?k.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=this.webgl2||l("OES_element_index_uint");this.instances=this.webgl2||l("ANGLE_instanced_arrays");this.fragmentPrecision=void 0===k.getShaderPrecisionFormat||0<k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.HIGH_FLOAT).precision?
"highp":0<k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.MEDIUM_FLOAT).precision?"mediump":"lowp";var q=4096>k.getParameter(k.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=q;this.maxRenderBufferSize=k.getParameter(k.MAX_RENDERBUFFER_SIZE);this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;for(var u=l("WEBGL_compressed_texture_s3tc"),p=k.getParameter(k.COMPRESSED_TEXTURE_FORMATS),
w=!1,v=!1,y=0;y<p.length;y+=1)w=w||p[y]===u.COMPRESSED_RGB_S3TC_DXT1_EXT,v=v||p[y]===u.COMPRESSED_RGBA_S3TC_DXT5_EXT;return w&&v}catch(D){}return!1}();q=WALK.urlHashContains("nopvr")?!1:l("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=q;q=WALK.urlHashContains("noetc1")?!1:l("WEBGL_compressed_texture_etc1")&&e.mobile;this.etc1Textures=q;this.astcTextures=!1;this.textureLod=this.webgl2||l("EXT_shader_texture_lod")&&(!e.firefox||!e.android);this.mirrorCubeMaps=!e.mobile||WALK.urlHashContains("mobilehi");
this.disableTextureSlotReuse=e.mac||83===m();this.reportToConsole=function(){WALK.log("WebGL"+(this.webgl2?"2":"")+"; "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures||WALK.log("Float textures not supported.");this.antialiasNative?WALK.log("Native anti-aliasing supported with "+this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");
this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||WALK.log("Instanced geometry not supported")}};this.resetGlDetector=function(k){this.gl=new f(k)};this.webp=void 0;var h=[];(function(){var k=new Image;k.onload=function(){d("webp",0<k.width&&0<k.height)};k.onerror=function(){d("webp",!1)};k.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="})();
this.onAsyncPropertiesDetected=function(k){void 0!==e.webp?k():this._asyncPropertiesDetectionListeners.push(k)}}})();(function(){WALK.Viewer=function(a,b,c){function d(){return null}function e(L){c.isMaterialEditable(L)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+L+"') before the scene is loaded.")}function g(){for(var L=[],ja=$jscomp.makeIterator(X.materials),Ca=ja.next();!Ca.done;Ca=ja.next())Ca=Ca.value,c.isMaterialEditable(Ca.name)&&L.push(Ca);return L}function f(){for(var L=[],ja=$jscomp.makeIterator(X.nodeConfigs),Ca=ja.next();!Ca.done;Ca=ja.next())Ca=Ca.value,c.isNodeTypeEditable(Ca.name)&&
L.push(Ca.name);return L}function h(L){e(L);for(var ja=$jscomp.makeIterator(X.materials),Ca=ja.next();!Ca.done;Ca=ja.next())if(Ca=Ca.value,Ca.name===L)return Ca;return null}function k(){Ga.copy(S.cameraWorldPosition());return Ga}function l(){Ha.yaw=S.getYawAngle();Ha.pitch=S.getPitchAngle();Ha.roll=0;return Ha}function m(){return X.boundingBox}function n(L){var ja=[];e(L);for(var Ca=$jscomp.makeIterator(X.gpuMeshes),za=Ca.next();!za.done;za=Ca.next())za=za.value,za.material.name===L&&ja.push(za);
return ja}function q(L){return(L=X.findNodeConfig(L))?L.nodes.slice(0):[]}function u(L,ja){ja.material=L;xa.requestFrame()}function p(L,ja){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");u(L,ja)}function w(L,ja,Ca){var za;(za="string"===typeof L?X.findViewByName(L):L)?(!0===ja?ja=0:!1===ja&&(ja=void 0),la.isRunning()&&(ja=0,la.stop()),Ca?(O.activateSky(za),O.updateHiddenMeshes(za)):O.switchToView(za,ja)):console.error("Unknown view: "+L)}function v(L){L=void 0===
L?{}:L;var ja=L.isPanorama||!1,Ca=L.width||(ja?4E3:window.innerWidth),za=L.height||(ja?2E3:window.innerHeight);if(L.toDataUrl)return ra.screenToDataUrl(ja,Ca,za);ra.screenToLocalImage(ja,Ca,za)}function y(L){X.addAuxiliaryObject(L);L!==L.colliderMesh&&aa.uploadNewBuffers(L.colliderMesh);R.addDynamicObstacle(L.colliderMesh)}function D(L,ja){for(var Ca=[],za=1;za<arguments.length;++za)Ca[za-1]=arguments[za];try{return L.apply(null,$jscomp.arrayFromIterable(Ca))}catch(Ka){console.error(Ka)}return!1}
function A(L,ja){for(var Ca=[],za=1;za<arguments.length;++za)Ca[za-1]=arguments[za];if(L){za=$jscomp.makeIterator(L);for(var Ka=za.next();!Ka.done;Ka=za.next())D.apply(null,[Ka.value].concat($jscomp.arrayFromIterable(Ca)))}}function G(){A(W.nextPageInteraction);W.nextPageInteraction.length=0}function I(L,ja){L=new WALK.Anchor(X,L);Da.push(L);pa&&y(L);W.anchorClicked[L.colliderMesh.id]=ja;wa=!0;xa.requestFrame();return L}function H(L){delete W.anchorClicked[L.colliderMesh.id];pa&&(X.removeAuxiliaryObject(L),
R.removeDynamicObstacle(L.colliderMesh));WALK.removeFromArray(L,Da);L.dispose();xa.requestFrame()}function P(L,ja){L=new WALK.Avatar(X,L,ja);Ba.push(L);X.addAuxiliaryObject(L,!0);ja=$jscomp.makeIterator(L.colliders);for(var Ca=ja.next();!Ca.done;Ca=ja.next())R.addDynamicObstacle(Ca.value);A(W.avatarListChanged);xa.requestFrame();return L}function U(L){for(var ja=$jscomp.makeIterator(L.colliders),Ca=ja.next();!Ca.done;Ca=ja.next())R.removeDynamicObstacle(Ca.value);X.removeAuxiliaryObject(L);WALK.removeFromArray(L,
Ba);L.dispose();A(W.avatarListChanged);xa.requestFrame()}function fa(L){return WALK.find(Ba,function(ja){return ja.uuid===L})}function C(){for(var L=$jscomp.makeIterator(X.getAnimatedMaterials()),ja=L.next();!ja.done;ja=L.next())ja.value.sleepAnimation()}function Q(){for(var L=$jscomp.makeIterator(X.getAnimatedMaterials()),ja=L.next();!ja.done;ja=L.next())ja.value.wakeAnimation();xa.requestFrame()}function da(L,ja){var Ca=L[ja];if(Ca)return Ca;Ca=[];return L[ja]=Ca}var aa,X=null,S,O,la,R,ra,ma,xa,
T,ka,ua,wa=!1,K=!1,J=null,ha=null,W={nextPageInteraction:[],viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},Da=[],Ba=[],Ga=new THREE.Vector3,Ha=new WALK.Euler;document.addEventListener("keydown",
G);document.addEventListener("mousedown",G);WALK.DETECTOR.ios?document.addEventListener("touchstart",G):document.addEventListener("touchend",G);var pa=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return pa},set:function(L){L!==pa&&((pa=L)?Da.forEach(function(ja){return y(ja)}):Da.forEach(function(ja){X.removeAuxiliaryObject(ja);R.removeDynamicObstacle(ja.colliderMesh)}),this.requestFrame(),A(W.anchorsVisibilityChanged,pa))}});var ea=function(){function L(Ja,$a,Za){Ca.set(Ja.x,Ja.y,
Oa.z).sub(Oa);Ja=Ca.length();Ja>$a&&(Ca.normalize().multiplyScalar(Ja-$a),Za.add(Ca))}var ja=new THREE.Vector3,Ca=new THREE.Vector3,za=new THREE.Vector3,Ka=new WALK.View,ya=new THREE.Sphere,Oa;return function(Ja){Oa=S.cameraWorldPosition();var $a=Ka.position;$a.copy(Oa);Ja instanceof WALK.LightInstance&&"sun"===Ja.light.type?(WALK.sunRotationToPosition(X,Ja.rotation,ja),Ja=ja):Ja instanceof WALK.Node?(WALK.computeNodeBoundingSphere(Ja,ya),Ja=ya.center,L(Ja,1+ya.radius,$a)):(Ja=Ja.position,L(Ja,1,
$a));za.copy(Ja).sub($a).normalize();Ka.rotation.setFromDirection(za);O.switchToView(Ka)}}();this.openMaterialPicker=function(L,ja,Ca,za){J=new WALK.MaterialPicker(L,Ca,za,X,S,ma,ka);J.meshes.forEach(function(Ka){X.addAuxiliaryObject(Ka);R.addDynamicObstacle(Ka);W.materialPickerClicked[Ka.id]=ja});xa.requestFrame()};this._vrChange=function(L){A(W.vrChange,L)};this._update=function(L){A(W.beforeRender,L)};this._clickListener=function(L,ja,Ca){if(!wa)return!1;if(J){var za=W.materialPickerClicked[L.id];
if(za)return D(za,L.material,J.meshes.indexOf(L)),!0;J.meshes.forEach(function(ya){X.removeAuxiliaryObject(ya);R.removeDynamicObstacle(ya);delete W.materialPickerClicked[ya.id]});xa.requestFrame();J.dispose();J=null;return!0}if(za=W.anchorClicked[L.id])return D(za,L.anchor,ja,Ca),!0;za=function(ya,Oa){if(ya){ya=$jscomp.makeIterator(ya);for(var Ja=ya.next();!Ja.done;Ja=ya.next())if(D(Ja.value,Oa,ja,Ca))return!0}return!1};for(var Ka=L.node;Ka;){if(za(W.nodeTypeClicked[Ka.config.name],L.node))return!0;
Ka=Ka.parent}return L.node&&za(W.anyNodeTypeClicked,L.node)?!0:L.material?za(W.materialClicked[L.material.name],L.material):!1};this._createHoverListener=function(){var L=W.materialHoverChanged,ja=[];return 0===Object.keys(L).length?null:function(Ca,za){if(Ca.material)for(var Ka=$jscomp.makeIterator(L[Ca.material.name]||ja),ya=Ka.next();!ya.done;ya=Ka.next())if(D(ya.value,Ca.material,za))return!0;return!1}};this._teleportStarted=function(L){L=L.view;null!==L&&A(W.viewSwitchStarted,L.name,L)};this._teleportDone=
function(L){L=L.view;null!==L&&A(W.viewSwitchDone,L.name,L)};this._viewerConfigLoaded=function(L){T=L;A(W.viewerConfigLoaded,T);W.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(L,ja,Ca,za,Ka,ya,Oa,Ja,$a,Za,xb){aa=L;X=ja;S=Ca;O=za;la=Ka;R=ya;ra=Oa;ma=Ja;ka=$a;ua=Za;xa=xb;this.getEditableMaterials=g;this.getEditableNodeTypes=f;this.findMaterial=h;this.findMeshesWithMaterial=n;this.findNodesOfType=q;this.getCameraPosition=k;this.getCameraRotation=l;this.getSceneBoundingBox=m;this.setMaterialForNode=
p;this.setMaterialForMesh=u;this.switchToView=w;this.captureImage=v;this.addAnchor=I;this.removeAnchor=H;this.addAvatar=P;this.removeAvatar=U;this.findAvatar=fa;this.seeItem=ea;this.sleepAnimatedMaterials=C;this.wakeAnimatedMaterials=Q;A(W.sceneReadyToDisplay,X);W.sceneReadyToDisplay=[];O.addEventListener("teleportStarted",this._teleportStarted.bind(this));O.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){K=!1;T=X=O=la=R=ra=ua=xa=null;this.wakeAnimatedMaterials=
this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d};this._sceneLoadComplete=function(){A(W.sceneLoadComplete);W.sceneLoadComplete=[];K=!0;for(var L=$jscomp.makeIterator(Da),ja=L.next();!ja.done;ja=L.next())ja.value.enableLightProbe()};this.openUrl=function(L,
ja){ja||a?window.open(L):window.location.href=L};this.onNextPageInteraction=function(L){W.nextPageInteraction.push(L)};this.onViewerConfigLoaded=function(L){T?L(T):W.viewerConfigLoaded.push(L)};this.isSceneReadyToDisplay=function(){return null!==X};this.onSceneReadyToDisplay=function(L){X?L(X):W.sceneReadyToDisplay.push(L)};this.onSceneLoadComplete=function(L){K?L(X):W.sceneLoadComplete.push(L)};this.requestFrame=function(){xa&&xa.requestFrame()};this.setNodeTypeEditable=function(L){console.assert(null===
X,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(L)};this.setMaterialEditable=function(L){console.assert(null===X,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(L)};this.setAllMaterialsEditable=function(){console.assert(null===X,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onNodeTypeClicked=function(L,ja){"function"===typeof L?W.anyNodeTypeClicked.push(L):da(W.nodeTypeClicked,
L).push(ja);wa=!0};this.removeOnNodeTypeClicked=function(L,ja){"function"===typeof L?WALK.removeFromArray(L,W.anyNodeTypeClicked):WALK.removeFromArray(ja,W.nodeTypeClicked[L])};this.onMaterialClicked=function(L,ja){this.setMaterialEditable(L);da(W.materialClicked,L).push(ja);wa=!0};this.onMaterialHoverChanged=function(L,ja){this.setMaterialEditable(L);da(W.materialHoverChanged,L).push(ja)};this.onViewSwitchStarted=function(L){W.viewSwitchStarted.push(L)};this.onViewSwitchDone=function(L){W.viewSwitchDone.push(L)};
this.onVrChange=function(L){W.vrChange.push(L)};this.onBeforeRender=function(L){W.beforeRender.push(L)};this.createTextureFromHtmlImage=function(L,ja){function Ca(){Ka.needsUpdate=!0;Ka.width=L.naturalWidth;Ka.height=L.naturalHeight;THREE.Math.isPowerOfTwo(Ka.width)&&THREE.Math.isPowerOfTwo(Ka.height)||(Ka.minFilter=GLC.LINEAR);Ka.notifyLoaded()}function za(){Ca();ya&&ya();L.onload=ya}ja=void 0===ja?!1:ja;var Ka=new WALK.Texture;Ka.image=L;Ka.wrapS=Ka.wrapT=GLC.REPEAT;Ka.minFilter=GLC.LINEAR_MIPMAP_LINEAR;
Ka.anisotropy=WALK.DEFAULT_ANISOTROPY;Ka.format=ja?GLC.RGBA:GLC.RGB;Ka.hasAlpha=ja;var ya=null;L.complete&&0!==L.naturalHeight?Ca():(ya=L.onload,L.onload=za);return Ka};this.createTextureFromHtmlVideo=function(L){var ja=new WALK.VideoTexture;ja.video=L;ja.minFilter=GLC.LINEAR;ja.anisotropy=WALK.DEFAULT_ANISOTROPY;ja.format=GLC.RGB;ja.generateMipmaps=!1;L.setAttribute("playsinline","");L.setAttribute("webkit-playsinline","");L.crossOrigin="anonymous";WALK.onVideoDataReady(L,function(Ca){ja.width=Ca.videoWidth;
ja.height=Ca.videoHeight;THREE.Math.isPowerOfTwo(ja.width)&&THREE.Math.isPowerOfTwo(ja.height)?(ja.wrapS=GLC.REPEAT,ja.wrapT=GLC.REPEAT):(ja.wrapS=GLC.CLAMP_TO_EDGE,ja.wrapT=GLC.CLAMP_TO_EDGE);ja.notifyLoaded()});return ja};this.createStreamTextureFromHtmlVideo=function(L){L=this.createTextureFromHtmlVideo(L);L._interruptible=!1;return L};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};
this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,"Can't remove avatars until the scene is ready to display")};this.findAvatar=function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};
this.onAnchorsVisibilityChanged=function(L){W.anchorsVisibilityChanged.push(L)};this.removeAnchorsVisibilityChangedListener=function(L){W.anchorsVisibilityChanged=W.anchorsVisibilityChanged.filter(function(ja){return ja!==L})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=
function(L){return WALK.getViewerAssetUrl(L)};this.addMenuButton=function(L){return b.addExtraButton(L)};this.removeMenuButton=function(L){b.removeExtraButton(L)};this.getMenuButtonIcon=function(L){return b.getExtraButonIcon(L)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(L){b.visible=L}});this.onMenuVisibilityChanged=function(L){b.addEventListener("visibilityChanged",function(){L()})};Object.defineProperty(this,"helpVisible",{get:function(){return b.helpVisible},
set:function(L){b.helpVisible=L}});this.play=function(){WALK.play()};var Y={};this.apiUserChangeState=function(L,ja){WALK.deepEqual(Y[L],ja)||(Y[L]=WALK.readOnlyCopy(ja),ja=WALK.cloneObject(ja),A(W.apiUserStateChanged[L],L,ja),A(W.anyApiUserStateChanged,L,ja))};this.onApiUserStateChanged=function(L,ja){"function"===typeof L?W.anyApiUserStateChanged.push(L):da(W.apiUserStateChanged,L).push(ja)};this.removeOnApiUserStateChanged=function(L,ja){"function"===typeof L?WALK.removeFromArray(L,W.anyApiUserStateChanged):
WALK.removeFromArray(ja,W.apiUserStateChanged[L])};this.getApiUserState=function(L){if(void 0===L)return WALK.cloneObject(Y);L=Y[L];return void 0===L?void 0:WALK.cloneObject(L)};this._meetingJoined=function(L){console.assert(null===ha);ha=L;A(W.meetingJoined,ha)};this._onMeetingJoined=function(L){W.meetingJoined.push(L);null!==ha&&L(ha)};this._removeOnMeetingJoined=function(L){WALK.removeFromArray(L,W.meetingJoined)};this._onAvatarListChanged=function(L){W.avatarListChanged.push(L)};this._removeOnAvatarListChanged=
function(L){WALK.removeFromArray(L,W.avatarListChanged)};this._createPointerEventHelper=function(L){return new WALK.PointerEventHelper(ua,L)};this._disableControls=function(){S.disable()};this._enableControls=function(){S.enable()};var va=new WALK.RayIntersection;this._findIntersectionAtPosition=function(L,ja){R.findIntersectionAtPosition(L,ja,!0,va);return va}}})();(function(){function a(d){for(var e=0,g=0;g<d.length;g+=1)d[g].id>=e&&(e=d[g].id+1);return e}function b(d,e){for(var g=0;g<d.length;g+=1)if(d[g].name===e)return!1;return!0}function c(d,e){for(var g=d,f=2;!b(e,g);f+=1)g=d+f.toString();return g}WALK.EditorHooks=function(d,e,g,f,h,k,l,m){function n(){WALK.USER_MSG.info("Failed to load texture")}var q={geometryFacesCnt:d.nodes.reduce(function(v,y){return v+y.facesInSubtree()},0)},u=new WALK.TextureLoader("./",WALK.DETECTOR,function(v){m.requestFrame()},
n,n,!0,!1),p=new WALK.SkyLoader(u),w=h.transformControls;this.getExtensionManager=function(){return k};this.getCameraPosition=function(){var v=g.cameraWorldPosition();return[v.x,v.y,v.z]};this.getCameraRotation=function(){return[THREE.Math.radToDeg(g.getYawAngle()),THREE.Math.radToDeg(g.getPitchAngle())]};this.getCamera=function(){return d.camera};this.getSceneStats=function(){return q};this.getMaterials=function(){return d.sortedMaterials()};this.getLights=function(){return d.lights};this.getLightProbes=
function(){return d.lightProbes};this.getCameraVolumes=function(){return d.cameraVolumes};this.getNodes=function(){return d.nodes};this.addLight=function(v,y,D){v=new WALK.Light({name:c(v,d.lights),type:y,doNotImport:!0});v.addInstance(D);d.addLight(v)};this.removeLight=function(v){d.removeLight(v)};this.renameLight=function(v,y){y=y.trim()||"light";v.name="";v.name=c(y,d.lights)};this.addLightInstance=function(v,y){v.addInstance(y)};this.removeLightInstance=function(v,y){v.removeInstance(y)};this.addLightProbe=
function(v){var y=a(d.lightProbes);v=new WALK.LightProbe({id:y,position:v});v.enableBoundingBox();d.addLightProbe(v);1===d.lightProbes.length&&d.enableLightProbesForMaterials()};this.removeLightProbe=function(v){d.removeLightProbe(v);0===d.lightProbes.length&&d.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(v,y){var D=(new THREE.Vector3).fromArray(this.getCameraPosition()),A=this.getCameraRotation();
A=(new THREE.Vector3(0,3,0)).applyEuler(new WALK.Euler(A[0]/180*Math.PI,A[1]/180*Math.PI,0));var G=a(d.cameraVolumes),I=d.addCameraVolume,H=WALK.CameraVolume;y||(y=v[0].toUpperCase()+v.slice(1)+G);I.call(d,new H({id:G,name:y,type:v,position:D.add(A).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:d.camera.defaultExposure,gamma:d.camera.defaultGamma}))};this.removeCameraVolume=function(v){d.removeCameraVolume(v)};this.shiftCameraVolume=function(v,y){d.shiftCameraVolume(v,y)};this.getViews=function(){return d.views.filter(function(v){return!v.internal})};
this.markScreenshotArea=function(v){l.markArea(v)};this.unmarkScreenshotArea=function(){l.unmarkArea()};this.screenToBuffer=function(v,y,D){return l.screenToBuffer(v,y,D)};this.addViewFromCamera=function(v,y){var D=[];console.assert("fps"===y||"top"===y||"orbit"===y);var A=g.cameraWorldPosition(),G=g.orbit;D[0]=THREE.Math.radToDeg(g.getYawAngle());D[1]=THREE.Math.radToDeg(g.getPitchAngle());v={id:a(d.views),name:c(v.trim()||"view",d.views),rotation:D};"fps"===y?(v.mode="fps",v.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,
v.position=A.toArray()):"top"===y?(v.mode="orbit",v.sky=WALK.DEFAULT_SKY_NAME,v.panPrimary=!0,v.noPitchRotate=!0,v.rotation[1]=-90,v.minUpAngle=0,v.maxUpAngle=Math.PI/2,G.isEnabled()?(v.target=G.target.toArray(),v.distance=G.getCameraDistance()):(v.target=[A.x,A.y,d.boundingBox.min.z],v.distance=Math.max(A.z-d.boundingBox.min.z,1))):(v.mode="orbit",v.sky=WALK.DEFAULT_SKY_NAME,v.panPrimary=!1,v.noPitchRotate=!1,G.isEnabled()?(v.target=G.target.toArray(),v.distance=G.getCameraDistance(),v.minUpAngle=
-G.getMaxPitchAngle(),v.maxUpAngle=-G.getMinPitchAngle()):(y=d.boundingBox.center(),v.target=y.toArray(),y.sub(A),v.distance=y.length(),y.normalize(),v.rotation=[THREE.Math.radToDeg(Math.atan2(-y.x,y.y)),THREE.Math.radToDeg(Math.asin(y.z))],v.minUpAngle=0,v.maxUpAngle=Math.PI/2));A=new WALK.View(v);d.addView(A);return A};this.resetViewFromCamera=function(v){var y=g.cameraWorldPosition();"fps"===v.mode?v.position.copy(y):(v.target.copy(g.orbit.target),v.distance=y.distanceTo(v.target));"fps"!==v.mode&&
v.isTop()||(v.rotation.pitch=g.getPitchAngle());v.setYaw(g.getYawAngle())};this.removeView=function(v){d.removeView(v)};this.shiftView=function(v,y){d.shiftView(v,y)};this.activateSkyForView=function(v){f.activateSky(v)};this.switchToView=function(v){f.switchToView(v);document.getElementById("walk-canvas").focus()};this.renameView=function(v,y){y=y.trim()||"view";v.name="";v.setName(c(y,d.views))};this.updateHiddenMeshes=function(v){f.updateHiddenMeshes(v)};this.getSky=function(){return d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};
this.loadTexture=function(v){return u.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,v,!0,!0,WALK.DEFAULT_ANISOTROPY)};this.materialTextureUpdated=function(v,y){var D=new Set,A="";v.textureNeedsUv0(y)&&d.visitMeshesWithMaterial(v,function(G){0===G.geometry.vertexCnt||G.uv0InBuffers()||D.has(G.node.type)||(D.add(G.node.type),5<D.size||(""!==A&&(A+=", "),A+="'"+G.node.type+"'"))});return 0<D.size&&"Texture "+y+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+
A+(5<D.size?" (plus "+(D.size-5)+" more).":".")};this.changeSkyTexture=function(v){var y=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);y.isEquirect?p.loadSkyTexture(y,v):(d.removeSkyMesh(y),p.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:v},d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=function(){var v=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);v.isEquirect&&(d.removeSkyMesh(v),p.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},
d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return d.camera.colorMap?d.camera.colorMap.name:null};this.loadColorMap=function(v){v=u.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,v,!1,!1,WALK.NO_ANISOTROPY);v.flipY=!1;return v};this.getSceneJson=function(){return d.serialize()};this.getCoverJson=function(){var v=e.cover;v.extensions=k.getConfig();return v};this.disableSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=
function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};this.enablePositionSelection=function(v){h.setDistanceToObject(v);h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};
this.enableNodeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){h.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(v){h.selectMaterial(v,!1)};this.replaceMaterial=function(v,y){v=d.replaceMaterial(v,y);v.isAnimated&&v.play();h.selectMaterial(v,!0);return v};this.selectLight=function(v){h.selectLight(v)};this.selectLightInstance=function(v){h.selectLightInstance(v,!1)};this.selectLightProbe=
function(v){h.selectLightProbe(v,!1)};this.selectCameraVolume=function(v){h.selectEditorCameraVolume(v)};this.selectExtension=function(v){h.selectExtension(v,!1)};this.selectNodes=function(v,y){h.selectNodes(v,y)};this.setMaterialSelectedCallback=function(v){h.setMaterialSelectedCallback(v)};this.setLightInstanceSelectedCallback=function(v){h.setLightInstanceSelectedCallback(v)};this.setLightProbeSelectedCallback=function(v){h.setLightProbeSelectedCallback(v)};this.setNodeSelectedCallback=function(v){h.setNodeSelectedCallback(v)};
this.setExtensionSelectedCallback=function(v){h.setExtensionSelectedCallback(v)};this.setPositionSelectedCallback=function(v){h.setPositionSelectedCallback(v)};this.setItemModifiedCallback=function(v){w.setItemModifiedCallback(v)};this.setViewSelectedCallback=function(v){f.addEventListener("teleportStarted",function(y){null!==y.view&&v(y.view)})};this.coverModified=function(v){e.updateCover(v)};this.autoTourModified=function(){e.refresh()};this.hasLightMap=function(){return d.hasLightMap()};this.getAutoTour=
function(){return d.autoTour};this.getDisableProgressiveLoader=function(){return d.disableProgressiveLoader};this.setDisableProgressiveLoader=function(v){d.disableProgressiveLoader=v};this.getSceneScaleHtmlWarning=function(){var v=d.boundingBox;return!v.empty()&&(v=v.size(),200<v.x||200<v.y||200<v.z)?"The scene has unusually large dimensions: <strong>"+Math.round(v.x)+"m x "+Math.round(v.y)+"m x "+Math.round(v.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return w.mode};this.setTransformMode=function(v){w.setTransformMode(v)};this.getSupportedTransformModes=function(){return w.supportedModes};this.seeItem=function(v){WALK.getViewer().seeItem(v)}};WALK.SceneLoadConfig=function(){this.assetsUrl="./";this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null}})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(288);c.addAttribute("position",new THREE.BufferAttribute(d,3));var e=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],
[[1,-1,-1],[1,-1,-.6],[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,
-1]],[[1,1,-1],[.6,1,-1],[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(g){for(var f=0;3>f;f+=1)for(var h=0;3>h;h+=1)d[e]=g[f][h],e+=1});c.computeVertexNormals();c.convertNormalsToSpherical();return c}function b(){var c=new WALK.StandardMaterial;c.disableLightProbe=!0;c.headLight=!0;c.baseColor=WALK.EDITOR_SELECTION_COLOR;c.setUniforms();return c}WALK.LightControls=
function(c,d){function e(H){if("spot"===H.type){var P=THREE.Math.degToRad(H.angle);H=1*Math.cos(P/2);P=new THREE.CylinderBufferGeometry(0,1*Math.sin(P/2),H,32,1);v.makeTranslation(0,-H/2,0);w.makeRotationZ(Math.PI);y.multiplyMatrices(w,v);P.applyMatrix(y);P.convertNormalsToSpherical()}else P="area"===H.type?A:D;return P}function g(H,P,U){var fa=new WALK.LightMaterial(H);U=new THREE.Mesh(U,fa);U.visibilityId=null;var C=new THREE.Mesh(G,I);U.add(C);if("sun"!==H.type){var Q=P.rotation.toQuaternion().multiply(U.quaternion);
U.setRotationFromQuaternion(Q);U.position.copy(P.position);"area"===H.type?(fa.side=THREE.DoubleSide,U.scale.set(H.width,1,H.height),fa=Math.max(H.width,H.height)/2,C.scale.set(fa/H.width,fa,fa/H.height)):U.scale.set(H.size,H.size,H.size)}else H=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,H=1*Math.PI*H*1.5/360,WALK.sunRotationToPosition(c,P.rotation,U.position),U.scale.set(H,H,H);U.userData.lightInstance=P;U.updateMatrixWorld();u.lightInstanceMeshes.push(U);p&&c.addAuxiliaryObject(U)}function f(H){var P=
e(H);H.forEachLightInstance(function(U){g(H,U,P)})}function h(H){for(var P=0;P<u.lightInstanceMeshes.length;P+=1){var U=u.lightInstanceMeshes[P];if(U.userData.lightInstance===H)return U}return null}function k(H){for(var P=[],U=0;U<u.lightInstanceMeshes.length;U+=1){var fa=u.lightInstanceMeshes[U];fa.userData.lightInstance.light===H?(p&&c.removeAuxiliaryObject(fa),fa.geometry!==D&&fa.geometry!==A&&fa.geometry.dispose(),fa.material.dispose()):P.push(fa)}u.lightInstanceMeshes=P}function l(H){H=H.target;
k(H);f(H)}function m(H){H=H.instance;var P=H.light;var U=P.instances[0]!==H?h(P.instances[0]).geometry:e(P);g(P,H,U);d.requestFrame()}function n(H){H=H.instance.light;k(H);f(H);d.requestFrame()}function q(H){f(H);H.addEventListener("updated",l);H.addEventListener("instanceAdded",m);H.addEventListener("instanceRemoved",n)}var u=this,p=!1,w=new THREE.Matrix4,v=new THREE.Matrix4,y=new THREE.Matrix4,D=new THREE.SphereBufferGeometry(1,32,16);D.convertNormalsToSpherical();var A=new THREE.PlaneBufferGeometry(1,
1);w.makeRotationX(-Math.PI/2);A.applyMatrix(w);A.convertNormalsToSpherical();var G=a(),I=b();this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(H){return h(H).material};this.showLights=function(){if(!p){p=!0;for(var H=0;H<this.lightInstanceMeshes.length;H+=1)c.addAuxiliaryObject(this.lightInstanceMeshes[H]);d.requestFrame()}};this.showSelectionMesh=function(H){this.lightInstanceMeshes.forEach(function(P){P.children[0].visible=P.userData.lightInstance.light===H?!0:!1})};this.hideLights=
function(){if(p){p=!1;for(var H=0;H<this.lightInstanceMeshes.length;H+=1)c.removeAuxiliaryObject(this.lightInstanceMeshes[H]);d.requestFrame()}};c.lights.forEach(q);c.addEventListener("lightAdded",function(H){q(H.light);d.requestFrame()});c.addEventListener("lightRemoved",function(H){k(H.light);d.requestFrame()})}})();(function(){WALK.LightProbeControls=function(a,b){function c(w,v){v.position.addVectors(w.boxMin,w.boxMax).multiplyScalar(.5).sub(w.position);v.scale.subVectors(w.boxMax,w.boxMin);v.scale.subScalar(.005)}function d(w){var v=new WALK.StandardMaterial;v.hideFromLightProbes=!0;v.disableLightProbe=!1;v.highlight=WALK.EDITOR_SELECTION_COLOR;v.metallic=1;v.roughness=0;v.setUniforms();v=new THREE.Mesh(q,v);v.visibilityId=null;v.lightProbe=w;v.position.copy(w.position);var y=new THREE.Mesh(p,u);y.visible=
!1;v.add(y);w.isBoundingBoxEnabled()&&c(w,y);v.updateMatrixWorld(!0);v.visible=m;l.lightProbeMeshes.push(v);a.addAuxiliaryObject(v)}function e(w){for(var v=0;v<l.lightProbeMeshes.length;v+=1)if(l.lightProbeMeshes[v].lightProbe===w)return v;console.assert(!1);return null}function g(w){w=w.target;var v=l.lightProbeMeshes[e(w)];v.position.copy(w.position);var y=v.children[0];w.isBoundingBoxEnabled()?(c(w,y),y.visible=!0):y.visible=!1;v.updateMatrixWorld()}function f(w){w=w.lightProbe;d(w);b.requestFrame();
w.addEventListener("positionUpdated",g);w.addEventListener("boundsUpdated",g)}function h(w){w=e(w.lightProbe);var v=l.lightProbeMeshes[w];a.removeAuxiliaryObject(v);v.material.dispose();l.lightProbeMeshes.splice(w,1);b.requestFrame()}function k(w){for(var v=0;v<l.lightProbeMeshes.length;v+=1){var y=l.lightProbeMeshes[v];if(y.lightProbe===w)return y}return null}var l=this,m=!1,n=null;this.lightProbeMeshes=[];var q=new THREE.SphereBufferGeometry(.2,32,16);q.convertNormalsToSpherical();var u=WALK.createBoundingBoxMaterial(),
p=new THREE.BoxBufferGeometry(1,1,1);p.addTriangleOrderAttribute();p.convertNormalsToSpherical();this.getLightProbeMaterial=function(w){return(w=k(w))?w.material:null};this.showLightProbeBoundingBox=function(w){n&&(n.visible=!1,n=null);w.isBoundingBoxEnabled()&&(n=k(w).children[0],n.visible=!0)};this.showLightProbes=function(){if(!m){m=!0;for(var w=0;w<this.lightProbeMeshes.length;w+=1)this.lightProbeMeshes[w].visible=!0}b.requestFrame()};this.hideLightProbes=function(){if(m){m=!1;for(var w=0;w<this.lightProbeMeshes.length;w+=
1)this.lightProbeMeshes[w].visible=!1}b.requestFrame()};(function(){for(var w=0;w<a.lightProbes.length;w+=1){var v=a.lightProbes[w];d(v);v.addEventListener("positionUpdated",g);v.addEventListener("boundsUpdated",g)}a.addEventListener("lightProbeAdded",f);a.addEventListener("lightProbeRemoved",h)})()}})();(function(){WALK.CameraVolumeControls=function(a,b){function c(h){function k(){m.position.copy(h.position);m.rotation.copy(h.rotation);m.scale.copy(h.scale);m.updateMatrixWorld()}var l=WALK.createBoundingBoxMaterial(),m=new THREE.Mesh(h.getVolumeGeometry(),l);m.visible=!1;m.visibilityId=null;g.add(m);e.set(h,m);k(h);h.addEventListener("updated",k)}var d=function(){},e=new Map,g=new THREE.Object3D;g.visible=!1;a.addAuxiliaryObject(g);this.setHighlightedCameraVolume=function(h){d();var k=e.get(h);k.visible=
!0;d=function(){return k.visible=!1};return k.material};this.setControlsVisible=function(h){g.visible=h;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(h){c(h.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(h){h=h.cameraVolume;var k=e.get(h);g.remove(k);k.material.dispose();e.delete(h);b.requestFrame()});for(var f=0;f<a.cameraVolumes.length;f+=1)c(a.cameraVolumes[f])}})();/*
 Copyright (C) 2019-present Shapespark
*/
(function(){WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&WALK.Math.spheresUnion(c.mesh.geometry.boundingSphere,b)})}})();(function(){WALK.PointerEventDispatcher=function(a,b){function c(w){if(void 0===w.button)return 0;switch(w.button){case 0:return 0;case 1:return 1;case 2:return 2}return-1}function d(w,v){if(0!==w.length){var y=void 0!==v.touches;if(!y&&(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement))u.clipX=0,u.clipY=0;else{if(y){b:{for(y=0;y<v.changedTouches.length;y++){var D=v.changedTouches[y];if(D.identifier===q){v=D;break b}}for(y=0;y<v.touches.length;y++)if(D=
v.touches[y],D.identifier===q){v=D;break b}v=null}console.assert(null!==v);y=v.clientX;v=v.clientY}else y=v.clientX,v=v.clientY;u.clipX=y/window.innerWidth*2-1;u.clipY=2*-(v/window.innerHeight)+1}v=u;for(y=0;y<w.length&&(D=w[y].callback,!D(v.clipX,v.clipY));y++);}}function e(w){0!==c(w)||n||(n=!0,void 0!==w.touches&&(console.assert(0<w.changedTouches.length),q=w.changedTouches[0].identifier),d(k,w))}function g(w){0===c(w)&&n&&(n=!1,d(l,w))}function f(w){d(m,w)}function h(w,v,y){var D=w.filter(function(G){return G.callback===
v});console.assert(0===D.length,"Do not add the same callback twice!");y={callback:v,priority:y};for(D=D=0;D<w.length;D+=1){var A=w[D];if(y.priority<=A.priority){if(y.priority===A.priority){console.error("Adding two listeners with the same priority is not allowed!");return}break}}w.splice(D,0,y)}var k=[],l=[],m=[],n=!1,q=-1,u={clipX:0,clipY:0};this.addPointerDownListener=function(w,v){h(k,w,v)};this.removePointerDownListener=function(w){k=k.filter(function(v){return v.callback!==w})};this.addPointerUpListener=
function(w,v){h(l,w,v)};this.removePointerUpListener=function(w){l=l.filter(function(v){return v.callback!==w})};this.addPointerMoveListener=function(w,v){h(m,w,v)};this.removePointerMoveListener=function(w){m=m.filter(function(v){return v.callback!==w})};var p=!1;this.isEnabled=function(){return p};this.enable=function(){p||(a.addEventListener("mousedown",e,!1),a.addEventListener("touchstart",e,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",
f,!1),a.addEventListener("touchmove",f,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),p=!0)};this.disable=function(){p&&(a.removeEventListener("mousedown",e,!1),a.removeEventListener("touchstart",e,!1),a.removeEventListener("mouseup",g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",f,!1),a.removeEventListener("touchmove",f,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),p=!1)};
this.enable()}})();(function(){WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(p,w){var v=f.callbacks.onPointerDown(p,w);h=!0;k=p;l=w;return v}function e(p,w){var v=f.callbacks.onPointerUp(p,w);if(h){var y=Date.now();v=null!==q&&.03>=Math.abs(m-k)&&.03>=Math.abs(n-l)&&500>=Math.abs(q-y)&&f.callbacks.onDoubleClick!==c?f.callbacks.onDoubleClick(p,w)||v:f.callbacks.onClick(p,w)||v;q=y;m=p;n=w}return v}function g(p,w){var v=f.callbacks.onPointerMove(p,w);!h||.03>=Math.abs(p-k)&&.03>=Math.abs(w-l)||
(h=!1,q=null);return v}var f=this,h=!1,k=null,l=null,m=null,n=null,q=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var u=!1;this.isEnabled=function(){return u};this.enable=function(){u||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(g,b),u=!0)};this.disable=function(){u&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(g),u=!1)};this.enable()}})();(function(){function a(A){var G=new THREE.Box3;A instanceof THREE.Object3D&&A.traverse(function(I){I instanceof THREE.Mesh&&(I.geometry.boundingBox||I.geometry.computeBoundingBox(),G.union(I.geometry.boundingBox))});return G}function b(A,G){var I=a(A);A=I.size();A=new THREE.BoxBufferGeometry(A.x,A.y,A.z);I=I.center();var H=new THREE.Matrix4;H.makeTranslation(I.x,I.y,I.z);A.applyMatrix(H);A.computeBoundingBox();G=new THREE.Mesh(A,G);G.visible=!1;G.visibilityId=null;return G}function c(A,G){var I=new WALK.StandardMaterial;
I.hideFromLightProbes=!0;I.baseColor.copy(A);I.opacity=G;I.specularOff=1;I.depthTest=!1;I.depthWrite=!1;return I}function d(A){for(var G=[],I=0;I<arguments.length;++I)G[I-0]=arguments[I];console.assert(0<G.length,"Part must have at least one element!");var H=new THREE.Object3D;G.forEach(function(P){return H.add(P)});G=b(H,c(g,.6));return new q(H,G,H.children[0].material)}function e(A,G,I){var H=A.material;H.opacity=G===A.collider?A.hoveredOpacity:I&&null!==G?A.notUsedOpacity:A.defaultOpacity;H.setUniforms()}
WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var g=new THREE.Color(16777215),f=new THREE.Color(16711680),h=new THREE.Color(65280),k=new THREE.Color(255),l=new THREE.Vector3(0,0,1),m=new THREE.Vector3(1,0,0),n=new THREE.Vector3(0,1,0),q=function(A,G,I){THREE.Object3D.call(this);this.add(A);this.add(G);this.material=I;this.collider=G;this.defaultOpacity=I.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=0};q.prototype=Object.create(THREE.Object3D.prototype);q.prototype.constructor=
q;var u=function(){function A(C){C=c(C,.6);C.depthTest=!0;return new THREE.Mesh(G,C)}THREE.Object3D.call(this);var G=new THREE.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),I=A(f);I.rotation.set(0,0,Math.PI/2);var H=A(h),P=A(k);P.rotation.set(Math.PI/2,0,0);this.add(I);this.add(H);this.add(P);var U=[!1,!1,!1];this.show=function(C){U[0]=1===(1&C);U[1]=2===(2&C);U[2]=4===(4&C);I.visible=U[0];H.visible=U[1];P.visible=U[2]};var fa=new THREE.Vector3;this.update=function(C){fa.copy(C);fa.sub(this.position);
fa.normalize();I.visible=U[0]&&.998>Math.abs(m.dot(fa));H.visible=U[1]&&.998>Math.abs(n.dot(fa));P.visible=U[2]&&.998>Math.abs(l.dot(fa))}};u.prototype=Object.create(THREE.Object3D.prototype);u.prototype.constructor=u;var p=function(){function A(){var U=c(g,.99);return new THREE.Mesh(G,U)}THREE.Object3D.call(this);var G=new THREE.SphereBufferGeometry(.012,10,10),I=A(),H=A(),P=A();this.add(I);this.add(H);this.add(P);this.show=function(U){I.visible=1===(1&U);H.visible=2===(2&U);P.visible=4===(4&U)};
this.update=function(U){I.position.set(U.x,0,0);I.updateMatrixWorld();H.position.set(0,U.y,0);H.updateMatrixWorld();P.position.set(0,0,U.z);P.updateMatrixWorld()}};p.prototype=Object.create(THREE.Object3D.prototype);p.prototype.constructor=p;var w=function(){function A(C){C=c(C,.2);C.depthTest=!0;C.side=THREE.DoubleSide;return d(new THREE.Mesh(G,C))}THREE.Object3D.call(this);var G=new THREE.PlaneBufferGeometry(1E3,1E3,1,1),I=A(g);this.add(I);var H=new THREE.Object3D;this.add(H);var P=A(k);P.rotation.set(0,
0,0);var U=A(h);U.rotation.set(Math.PI/2,0,0);var fa=A(f);fa.rotation.set(0,Math.PI/2,0);H.add(P);H.add(U);H.add(fa);this.setLocalRotation=function(C){C?H.rotation.copy(C):H.rotation.set(0,0,0)};this.update=function(C){I.rotation.setFromRotationMatrix(C.matrixWorld);I.updateMatrixWorld()};this.cameraPlane=I;this.findPlaneIntersectionPoint=function(){function C(aa){switch(aa){case 1:return fa;case 2:return U;case 4:return P;case 3:return P;case 5:return U;case 6:return fa;case 7:return I;default:throw"Impossible";
}}var Q=new THREE.Vector3,da=new THREE.Vector3;return function(aa,X,S,O){var la=C(aa);la.getWorldPosition(Q).sub(X);la.getWorldDirection(da);if(1===aa||2===aa||4===aa){aa=da.dot(da);la=da.dot(S);var R=S.dot(S),ra=da.dot(Q),ma=S.dot(Q);R=aa*R-la*la;aa=1E-5>Math.abs(R)?Infinity:(aa*ma-la*ra)/R}else aa=da.dot(S),aa=1E-5>Math.abs(aa)?Infinity:da.dot(Q)/aa;if(Infinity===aa)return!1;O.copy(S).multiplyScalar(aa).add(X);return!0}}();this.show=function(C){I.visible=7===C?!0:!1;P.visible=3===C;U.visible=5===
C;fa.visible=6===C}};w.prototype=Object.create(THREE.Object3D.prototype);w.prototype.constructor=w;var v=function(){function A(O){for(var la=new Uint8Array(4096),R=Math.floor(255*O.r),ra=Math.floor(255*O.g),ma=Math.floor(255*O.b),xa=0,T=0;32>T;T++)for(var ka=0;32>ka;ka++)la[xa]=R,la[xa+1]=ra,la[xa+2]=ma,la[xa+3]=0===T||0===ka||31===T||31===ka?220:150,xa+=4;la=new WALK.DataTexture(la,32,32,THREE.RGBAFormat);la.hasAlpha=!0;la.needsUpdate=!0;la.loaded=!0;R=new WALK.StandardMaterial;R.hideFromLightProbes=
!0;R.specularOff=1;R.disableLightProbe=!0;R.depthTest=!1;R.depthWrite=!1;R.transparent=!0;R.baseColor=O;R.side=THREE.DoubleSide;R.baseColorTexture=la;R.opacity=.6;R.configureTransparency();R.setUniforms();return d(new THREE.Mesh(H.squareGeometry,R))}function G(O){O=c(O,.6);return d(new THREE.Mesh(H.lineGeometry,O),new THREE.Mesh(H.arrowHeadGeometry,O))}var I=this;THREE.Object3D.call(this);var H=function(){var O=new THREE.Matrix4,la=new THREE.SphereBufferGeometry(.1,16,16),R=new THREE.PlaneBufferGeometry(.23,
.23,1,1);O.makeTranslation(.45,.45,0);R.applyMatrix(O);R.addTriangleOrderAttribute();var ra=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);O.makeTranslation(0,.65,0);ra.applyMatrix(O);var ma=new THREE.CylinderBufferGeometry(0,.05,.2,10,1,!1);O.makeTranslation(0,1.25,0);ma.applyMatrix(O);return{pickerGeometry:la,squareGeometry:R,lineGeometry:ra,arrowHeadGeometry:ma}}(),P=function(){var O=c(g,.6);return d(new THREE.Mesh(H.pickerGeometry,O))}(),U=G(f);U.rotation.set(0,0,-Math.PI/2);var fa=G(h),
C=G(k);C.rotation.set(Math.PI/2,0,0);var Q=A(k),da=A(h);da.rotation.set(Math.PI/2,0,0);var aa=A(f);aa.rotation.set(0,-Math.PI/2,0);P.usedAxes=7;U.usedAxes=1;fa.usedAxes=2;C.usedAxes=4;Q.usedAxes=3;da.usedAxes=5;aa.usedAxes=6;var X=[P,U,fa,C,Q,da,aa];X.forEach(function(O){return I.add(O)});var S=new Map(X.map(function(O){return[O.collider,O]}));this.colliders=[].concat($jscomp.arrayFromIterable(S.keys()));this.highlight=function(O,la){X.forEach(function(R){return e(R,O,la)})};this.usedAxes=function(O){return S.get(O).usedAxes}};
v.prototype=Object.create(THREE.Object3D.prototype);v.prototype.constructor=v;var y=function(){function A(X){var S=new THREE.TorusBufferGeometry(X,.012,6,64);X=new THREE.TorusBufferGeometry(X,.038,6,64);return{torusGeometry:S,colliderGeometry:X}}function G(X,S){X=new WALK.RotateGizmoMaterial(X,.6);var O=new THREE.Object3D;O.add(new THREE.Mesh(S.torusGeometry,X));S=new THREE.Mesh(S.colliderGeometry,X);S.visible=!1;S.visibilityId=null;return new q(O,S,X)}var I=this;THREE.Object3D.call(this);var H=A(.9),
P=G(f,H);P.rotation.set(0,Math.PI/2,0);var U=G(h,H);U.rotation.set(Math.PI/2,0,0);H=G(k,H);var fa=A(1.12),C=G(g,fa),Q=function(X,S){X=c(X,0);var O=new THREE.SphereBufferGeometry(S,32,32);S=new THREE.Object3D;S.add(new THREE.Mesh(O,X));O=new THREE.Mesh(O,X);O.visible=!1;O.visibilityId=null;X=new q(S,O,X);X.defaultOpacity=0;X.hoveredOpacity=.2;X.notUsedOpacity=0;return X}(g,.848),da=[P,U,H,C,Q];da.forEach(function(X){return I.add(X)});var aa=new Map(da.map(function(X){return[X.collider,X]}));this.colliders=
[].concat($jscomp.arrayFromIterable(aa.keys()));this.update=function(X){var S=this;da.filter(function(O){return O!==Q}).forEach(function(O){O=O.material;O.gizmoPosition.copy(S.position);O.sphereRadius=.86*S.scale.x});C.rotation.setFromRotationMatrix(X.matrixWorld);C.updateMatrixWorld()};P.usedAxes=1;U.usedAxes=2;H.usedAxes=4;C.usedAxes=7;Q.usedAxes=0;this.highlight=function(X,S){da.forEach(function(O){return e(O,X,S)})};this.usedAxes=function(X){return aa.get(X).usedAxes}};y.prototype=Object.create(THREE.Object3D.prototype);
y.prototype.constructor=y;var D=function(){function A(O){for(var la=new Uint8Array(4096),R=Math.floor(255*O.r),ra=Math.floor(255*O.g),ma=Math.floor(255*O.b),xa=0,T=0;32>T;T++)for(var ka=0;32>ka;ka++)la[xa]=R,la[xa+1]=ra,la[xa+2]=ma,la[xa+3]=0===T||0===ka||31===T||31===ka?220:150,xa+=4;la=new WALK.DataTexture(la,32,32,THREE.RGBAFormat);la.hasAlpha=!0;la.needsUpdate=!0;la.loaded=!0;R=new WALK.StandardMaterial;R.hideFromLightProbes=!0;R.specularOff=1;R.disableLightProbe=!0;R.depthTest=!1;R.depthWrite=
!1;R.transparent=!0;R.baseColor=O;R.side=THREE.DoubleSide;R.baseColorTexture=la;R.opacity=.6;R.configureTransparency();R.setUniforms();return d(new THREE.Mesh(H.squareGeometry,R))}function G(O){O=c(O,.6);return d(new THREE.Mesh(H.lineGeometry,O),new THREE.Mesh(H.cubeGeometry,O))}var I=this;THREE.Object3D.call(this);var H=function(){var O=new THREE.Matrix4,la=new THREE.BoxBufferGeometry(.3,.3,.3),R=new THREE.PlaneBufferGeometry(.23,.23,1,1);O.makeTranslation(.45,.45,0);R.applyMatrix(O);R.addTriangleOrderAttribute();
var ra=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);O.makeTranslation(0,.65,0);ra.applyMatrix(O);var ma=new THREE.BoxBufferGeometry(.1,.1,.1);O.makeTranslation(0,1.1,0);ma.applyMatrix(O);return{pickerGeometry:la,squareGeometry:R,lineGeometry:ra,cubeGeometry:ma}}(),P=function(){var O=c(g,.6);return d(new THREE.Mesh(H.pickerGeometry,O))}(),U=G(f);U.rotation.set(0,0,-Math.PI/2);var fa=G(h),C=G(k);C.rotation.set(Math.PI/2,0,0);var Q=A(k),da=A(h);da.rotation.set(Math.PI/2,0,0);var aa=A(f);aa.rotation.set(0,
-Math.PI/2,0);P.usedAxes=7;U.usedAxes=1;fa.usedAxes=2;C.usedAxes=4;Q.usedAxes=3;da.usedAxes=5;aa.usedAxes=6;var X=[P,U,fa,C,Q,da,aa];X.forEach(function(O){return I.add(O)});var S=new Map(X.map(function(O){return[O.collider,O]}));this.colliders=[].concat($jscomp.arrayFromIterable(S.keys()));this.highlight=function(O,la){X.forEach(function(R){return e(R,O,la)})};this.usedAxes=function(O){return S.get(O).usedAxes}};D.prototype=Object.create(THREE.Object3D.prototype);D.prototype.constructor=D;WALK.TransformGizmo=
function(A,G,I,H){function P(pa){C.oldPosition.copy(pa);C.newPosition.copy(pa);Q.position.copy(pa);da.position.copy(pa);aa.position.copy(pa);X.position.copy(pa);S.position.copy(pa);O.position.copy(pa)}function U(pa){C.oldRotation.copy(pa);C.newRotation.copy(pa);xa===WALK.TRANSFORM_MODE.SCALE?(Q.rotation.copy(pa),da.setLocalRotation(pa),O.rotation.copy(C.oldRotation)):(Q.rotation.set(0,0,0),da.setLocalRotation(null))}function fa(){T?xa===WALK.TRANSFORM_MODE.TRANSLATE?(A.addAuxiliaryObject(Q),A.addAuxiliaryObject(da),
A.addAuxiliaryObject(aa),A.addAuxiliaryObject(X),A.removeAuxiliaryObject(S),A.removeAuxiliaryObject(O)):xa===WALK.TRANSFORM_MODE.ROTATE?(A.addAuxiliaryObject(Q),A.removeAuxiliaryObject(X),A.addAuxiliaryObject(S),A.removeAuxiliaryObject(O)):(A.addAuxiliaryObject(Q),A.addAuxiliaryObject(da),A.removeAuxiliaryObject(X),A.removeAuxiliaryObject(S),A.addAuxiliaryObject(O)):(A.removeAuxiliaryObject(Q),A.removeAuxiliaryObject(da),A.removeAuxiliaryObject(aa),A.removeAuxiliaryObject(X),A.removeAuxiliaryObject(S),
A.removeAuxiliaryObject(O))}var C=this;this.target=null;var Q=new u;Q.show(7);var da=new w;da.show(0);var aa=new p;aa.show(0);var X=new v,S=new y,O=new D,la=!1;Object.defineProperty(this,"transforming",{get:function(){return la}});var R=new THREE.Vector3(0,0,0),ra=0,ma=new THREE.Vector3;this.oldPosition=new THREE.Vector3(0,0,0);this.newPosition=new THREE.Vector3(0,0,0);this.oldRotation=new THREE.Euler(0,0,0);this.newRotation=new THREE.Euler(0,0,0);this.oldScale=new THREE.Vector3(1,1,1);this.newScale=
new THREE.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return Q.position}});Object.defineProperty(this,"rotation",{get:function(){return C.oldRotation}});var xa=!1;Object.defineProperty(this,"scale",{get:function(){return C.oldScale}});var T=!1;Object.defineProperty(this,"mode",{get:function(){return xa},set:function(pa){xa!==pa&&(xa=pa,fa(),H.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return T},set:function(pa){T!==pa&&(T=pa,fa())}});this.mode=
WALK.TRANSFORM_MODE.TRANSLATE;var ka=Infinity,ua=Infinity,wa=new THREE.Vector3(0,0,0),K=null,J=!1,ha=7,W=function(){var pa=new THREE.Vector3,ea=new THREE.Vector3,Y=new THREE.Quaternion;return function(va,L,ja){pa.set(L,ja,1).unproject(A.camera);pa.sub(I).normalize();if(!da.findPlaneIntersectionPoint(va,I,pa,ea))return null;ea.sub(Q.position);ea.applyQuaternion(Y.setFromEuler(Q.rotation).inverse());va&1||(ea.x=0);va&2||(ea.y=0);va&4||(ea.z=0);return ea}}(),Da=function(){var pa=new THREE.Vector3,ea=
new THREE.Vector3,Y=new THREE.Vector3;return function(va,L){var ja=da.cameraPlane;pa.set(0,0,-1);pa.transformDirection(ja.matrixWorld);ea.set(-1,0,0);ea.transformDirection(ja.matrixWorld);va=W(7,va,L).normalize();Y.copy(ea).cross(va);return Math.sign(pa.dot(Y))*Math.acos(ea.dot(va))}}(),Ba=new THREE.Vector3;this.rotationSpeed=5;var Ga=function(){var pa=new THREE.Vector2(0,0),ea=new THREE.Quaternion,Y=new THREE.Euler,va=new THREE.Quaternion,L=new THREE.Quaternion,ja=new THREE.Vector3,Ca=new THREE.Vector3,
za=new THREE.Vector3;return function(Ka,ya){ea.setFromEuler(C.oldRotation);ea.normalize();pa.set(ka-Ka,ua-ya);pa.multiplyScalar(C.rotationSpeed);if(0===ha)return Ka=da.cameraPlane,ja.copy(m),ja.transformDirection(Ka.matrixWorld),Ca.set(0,1,0),Ca.transformDirection(Ka.matrixWorld),L.setFromAxisAngle(ja,pa.y),va.setFromAxisAngle(Ca,-pa.x),va.multiply(L),va.multiply(ea),va.normalize(),Y.setFromQuaternion(va,"ZXY"),Y;if(7===ha){var Oa=da.cameraPlane;za.set(0,0,-1);za.transformDirection(Oa.matrixWorld);
Oa=za;Ka=Da(Ka,ya);Ka-=ra}else{4!==ha&&pa.multiplyScalar((1===ha?-1:1)*Math.sign((1===ha?n:m).dot(Ba)));a:{switch(ha){case 1:Oa=m;break a;case 2:Oa=n;break a;case 4:Oa=l;break a}console.error("Unable to get direction for this value!");Oa=void 0}Ka=4===ha?-pa.x:pa.y}va.setFromAxisAngle(Oa,Ka);va.multiply(ea);va.normalize();Y.setFromQuaternion(va,"ZXY");return Y}}(),Ha=function(){var pa={hoveredCollider:null,hasAnythingChanged:!1};return function(ea,Y,va){var L=xa===WALK.TRANSFORM_MODE.TRANSLATE?X:
xa===WALK.TRANSFORM_MODE.ROTATE?S:O;ea=G.findMeshFromListAtPosition(L.colliders,ea,Y,!0);Y=!1;if(ea!==K||J!==va)K=ea,L.highlight(ea,va),Y=!0;pa.hoveredCollider=ea;pa.hasAnythingChanged=Y;return pa}}();this.onCanvasPointerMove=function(pa,ea){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var Y=W(ha,pa,ea);Y&&this.newPosition.copy(Y.sub(R).add(Q.position));wa.copy(this.newPosition);wa.sub(Q.position);wa.divide(Q.scale);aa.update(wa);if(pa!==ka||ea!==ua)X.visible=!1,aa.show(ha),
Q.show(ha)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(Q.show(ha),this.newRotation.copy(Ga(pa,ea)),pa!==ka||ea!==ua)S.visible=!1}else{Q.show(ha);if(Y=W(ha,pa,ea))Y.addScalar(1).divide(ma),this.newScale.copy(Y);if(pa!==ka||ea!==ua)O.visible=!1}H.requestFrame();return!0}Ha(pa,ea,J).hasAnythingChanged&&H.requestFrame();return!1};this.onCanvasPointerDown=function(pa,ea){var Y=Ha(pa,ea,!0);J=!0;if(null!==Y.hoveredCollider)return la=!0,ha=(xa===WALK.TRANSFORM_MODE.TRANSLATE?X:xa===WALK.TRANSFORM_MODE.ROTATE?
S:O).usedAxes(Y.hoveredCollider),ka=pa,ua=ea,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?(da.show(ha),this.newPosition.copy(this.oldPosition),R.copy(W(ha,pa,ea))):this.mode===WALK.TRANSFORM_MODE.ROTATE?7===ha&&(this.newRotation.copy(this.oldRotation),ra=Da(pa,ea)):(da.show(7===ha?0:ha),this.newScale.copy(this.oldScale),pa=W(ha,pa,ea),ma.copy(pa).addScalar(1).divide(this.oldScale)),!0;ha=7;la=!1;Y.hasAnythingChanged&&H.requestFrame();return!1};this.onCanvasPointerUp=function(pa,ea){if(this.transforming){P(this.newPosition);
U(this.newRotation);var Y=this.newScale;C.oldScale.copy(Y);C.newScale.copy(Y);da.show(0);aa.show(0);ha=7;Q.show(ha);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?X.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?S.visible=!0:O.visible=!0}Y=this.transforming;la=!1;this.update();Ha(pa,ea,!1).hasAnythingChanged&&H.requestFrame();J=!1;return Y};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&P(this.target.position),void 0!==this.target.rotation&&U(this.target.rotation),void 0!==
this.target.scale)){var pa=this.target.scale;C.oldScale.copy(pa);C.newScale.copy(pa)}Ba.copy(I);Ba.sub(Q.position);Ba.normalize();pa=.18*Q.position.distanceTo(I)*A.camera.fov/90;Q.scale.set(pa,pa,pa);da.scale.set(pa,pa,pa);aa.scale.set(pa,pa,pa);X.scale.set(pa,pa,pa);S.scale.set(pa,pa,pa);O.scale.set(pa,pa,pa);S.update(A.camera);da.update(A.camera);Q.update(I);Q.updateMatrixWorld();da.updateMatrixWorld();aa.updateMatrixWorld();X.updateMatrixWorld();S.updateMatrixWorld();O.updateMatrixWorld()}}})();(function(){WALK.TransformControls=function(a,b,c,d,e){function g(){}function f(u){e.isEnabled()!==u&&(u?e.enable():e.disable())}var h=this,k=!1,l=new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);l.mode=WALK.TRANSFORM_MODE.TRANSLATE;var m={itemModified:g},n=[];Object.defineProperty(this,"supportedModes",{get:function(){return n}});Object.defineProperty(this,"mode",{get:function(){return l.mode}});this.setItemModifiedCallback=function(u){console.assert(m.itemModified===g);m.itemModified=u};var q=
new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);q.callbacks.onPointerDown=function(u,p){u=l.onCanvasPointerDown(u,p);f(!l.transforming);return u};q.callbacks.onPointerUp=function(u,p){u=l.onCanvasPointerUp(u,p);f(!l.transforming);return u};q.callbacks.onPointerMove=function(u,p){u=l.onCanvasPointerMove(u,p);l.transforming&&(l.mode===WALK.TRANSFORM_MODE.TRANSLATE?(p=l.newPosition,h.target.setPosition(p.x,p.y,p.z)):l.mode===WALK.TRANSFORM_MODE.ROTATE?(p=l.newRotation,h.target.setRotation(p.z,
p.x,p.y)):(p=l.newScale,h.target.setScale(p.x,p.y,p.z)),m.itemModified(h.target));return u};q.disable();Object.defineProperty(this,"target",{get:function(){return l.target}});this.setTransformMode=function(u){l.mode=u};this.update=function(){k&&l.update()};this.enable=function(u,p){k=!0;l.target=u;null!==u&&(l.update(),l.visible=!0);n=p;-1===p.indexOf(l.mode)&&(l.mode=p[0]);q.enable()};this.disable=function(){k=!1;n=[];l.visible=!1;q.disable()}}})();(function(){var a=function(b,c){this._nodesPrimary=b;this._nodesSecondary=c};a.prototype.constructor=a;Object.defineProperty(a.prototype,"highlightMix",{set:function(b){this._nodesPrimary.forEach(function(c){c.highlightMix=b});this._nodesSecondary.forEach(function(c){c.highlightMix=b})}});Object.defineProperty(a.prototype,"selected",{set:function(b){this._nodesPrimary.forEach(function(c){c.selected=b});this._nodesSecondary.forEach(function(c){c.selectedSecondary=b})}});WALK.EditorSelector=function(b,
c,d,e,g,f,h,k,l){function m(){}function n(){D.highlightMix=.8*Math.pow(A/y.selectionTimeSec,2)}function q(S){null!==D&&(D.highlightMix=0);null!==S&&(D=S,A=y.selectionTimeSec,n());k.requestFrame()}function u(S){var O=S.geometry;O&&void 0===O.getAttribute("order")&&S.visible&&(S.visible=!1,X.push(S))}function p(){for(var S=$jscomp.makeIterator(X),O=S.next();!O.done;O=S.next())O.value.visible=!0}function w(){fa.set(!0,!1,!1);C.set(Q);c.gpuMeshes.forEach(function(S){S.geometry.addTriangleOrderAttribute();
S.highlightMix=0;S.selected=!1;d.uploadNewBuffers(S)});X.length=0;c.threeScene.traverse(u);c.threeScene.overrideMaterial=da;c.skyMeshes.forEach(function(S){S.visible=!1})}function v(){fa.restore();C.restore();p();c.threeScene.overrideMaterial=null;c.gpuMeshes.forEach(function(S){S.highlightMix=null;S.selected=null;S.selectedSecondary=!1});G=null;c.skyMeshes.forEach(function(S){S.visible=!0})}var y=this,D=null,A=0,G=null,I=0,H=new WALK.RayIntersection,P=new WALK.TransformControls(b,k,c,e,l),U={materialSelected:m,
lightInstanceSelected:m,lightProbeSelected:m,nodeSelected:m,extensionSelected:m,positionSelected:m},fa=new WALK.AutoClearAlter(d),C=new WALK.ClearColorAlter(d),Q=new THREE.Color(16777215),da=new WALK.WireframeMaterial(new THREE.Color(0));da.highlight=da.meshSelectedLineColor;var aa;this.selectionTimeSec=1;this.selectMaterial=function(S,O){console.assert(aa===WALK.EditorSelector.SELECTION_MODE.MATERIAL);q(S);null!==S&&O&&U.materialSelected(S)};this.selectLight=function(S){console.assert(aa===WALK.EditorSelector.SELECTION_MODE.LIGHT);
g.showSelectionMesh(S);k.requestFrame()};this.selectLightInstance=function(S,O){var la=null;console.assert(aa===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(S){la=g.getLightInstanceMaterial(S);var R=S.light.type;P.enable(S,"point"===R?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===R?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE])}else P.disable();q(la);S&&O&&U.lightInstanceSelected(S)};this.selectLightProbe=function(S,O){var la=null;console.assert(aa===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);
S?(f.showLightProbeBoundingBox(S),la=f.getLightProbeMaterial(S),P.enable(S,[WALK.TRANSFORM_MODE.TRANSLATE])):P.disable();q(la);S&&O&&U.lightProbeSelected(S)};this.selectEditorCameraVolume=function(S){console.assert(aa===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);S?(q(h.setHighlightedCameraVolume(S)),P.enable(S,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(q(null),P.disable())};this.selectExtension=function(S,O){var la=null;console.assert(aa===WALK.EditorSelector.SELECTION_MODE.EXTENSION);
if(S&&0<S.triggers.length){var R=S.triggers[0].mesh;R&&(la=R.material)}q(la);S&&O&&U.extensionSelected(S)};this.selectNodes=function(S,O){console.assert(aa===WALK.EditorSelector.SELECTION_MODE.NODE);G&&(G.selected=!1);S.length||O.length?(G=new a(S,O),G.selected=!0):G=null;q(G)};this._selectNode=function(S){null!==S?this.selectNodes([S],[]):this.selectNodes([],[]);S&&U.nodeSelected(S)};this.update=function(S){P.update();null!==D&&(A-=S,0<A?n():(D.highlightMix=0,D=null),k.requestFrame())};var X=[];
this.setDistanceToObject=function(S){I=S};this.setSelectionMode=function(S){if(S!==aa){aa===WALK.EditorSelector.SELECTION_MODE.NODE&&v();aa===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!1);switch(S){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:g.hideLights();f.hideLightProbes();
break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:g.showLights();f.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:g.hideLights();f.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:g.hideLights(),f.hideLightProbes(),w()}S===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!0);P.disable();if(S===WALK.EditorSelector.SELECTION_MODE.MATERIAL||S===WALK.EditorSelector.SELECTION_MODE.EXTENSION)for(var O=$jscomp.makeIterator(c.getAnimatedMaterials()),
la=O.next();!la.done;la=O.next())la.value.play();else for(O=$jscomp.makeIterator(c.getAnimatedMaterials()),la=O.next();!la.done;la=O.next())la.value.pause();aa=S}};this.setMaterialSelectedCallback=function(S){console.assert(U.materialSelected===m);U.materialSelected=S};this.setLightInstanceSelectedCallback=function(S){console.assert(U.lightInstanceSelected===m);U.lightInstanceSelected=S};this.setLightProbeSelectedCallback=function(S){console.assert(U.lightProbeSelected===m);U.lightProbeSelected=S};
this.setNodeSelectedCallback=function(S){console.assert(U.nodeSelected===m);U.nodeSelected=S};this.setExtensionSelectedCallback=function(S){console.assert(U.extensionSelected===m);U.extensionSelected=S};this.setPositionSelectedCallback=function(S){console.assert(U.positionSelected===m);U.positionSelected=S};(function(){var S=new WALK.PointerEventHelper(b,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);S.callbacks.onClick=function(O,la){if(aa===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var R=!1;aa===
WALK.EditorSelector.SELECTION_MODE.MATERIAL?(O=e.findObstacleMeshAtPosition(O,la,!1),O=null!==O?O.material:null,y.selectMaterial(O,!0)):aa===WALK.EditorSelector.SELECTION_MODE.LIGHT?(O=e.findMeshFromListAtPosition(g.lightInstanceMeshes,O,la),O=null!==O?O.userData.lightInstance:null,null!==O&&y.selectLightInstance(O,!0)):aa===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE?(O=e.findMeshFromListAtPosition(f.lightProbeMeshes,O,la),O=null!==O?O.lightProbe:null,null!==O&&y.selectLightProbe(O,!0)):aa===
WALK.EditorSelector.SELECTION_MODE.NODE?(O=e.findObstacleMeshAtPosition(O,la,!1),O=null!==O?O.node:null,y._selectNode(O)):aa===WALK.EditorSelector.SELECTION_MODE.EXTENSION?(O=e.findIntersectionAtPosition(O,la,!1,H)?H.object.anchor||null:null,y.selectExtension(O?O.extension:null,!0)):aa===WALK.EditorSelector.SELECTION_MODE.POSITION&&(O=e.findIntersectionAtPosition(O,la,!1,H)&&!H.object.anchor?e.movePointTowardsTheCamera(H.point,I):null,O&&(U.positionSelected(O),R=!0));return R};S.callbacks.onDoubleClick=
function(O,la){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return P}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE={OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8}})();(function(){function a(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new THREE.Vector2}}}function b(c){c=WALK.createRenderer(c,{antialias:!1});c.autoClear=!1;c.autoUpdateObjects=!1;c.sortObjects=!1;return c}a.prototype=Object.create(WALK.BaseMaterial.prototype);a.prototype.constructor=a;WALK.StaticRenderViewer=function(c){var d=b(c),e=new a,g=new THREE.OrthographicCamera(-1,
1,1,-1,0,1),f=new THREE.Scene;c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),e);d.uploadNewBuffers(c);f.add(c);this.update=function(h){var k=new Float32Array(h,0,h.byteLength/4);h=k[0];var l=k[1];k=k.subarray(2);console.assert(h*l===k.length/3);k=new WALK.DataTexture(k,h,l,GLC.RGB,GLC.FLOAT);k.minFilter=GLC.NEAREST;k.magFilter=GLC.NEAREST;k.generateMipmaps=!1;k.flipY=!1;k.needsUpdate=!0;e.uniforms.staticRender.value=k;e.uniforms.sizeInv.value.set(1/h,1/l);d.setCanvasSize(h,l);d.render(f,g);k.dispose()}}})();(function(){WALK.VRManager=function(a,b,c,d,e,g,f){function h(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(P,U){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(fa){"granted"===fa[0]&&"granted"===fa[1]?P():U()},function(){U()})}):Promise.resolve()}function k(){q=
null;G.dispose();p=u=v=G=null;b.removeAllXrGamepads();f(!1);if(A){var P=A;A=null;P()}}function l(P){for(var U=$jscomp.makeIterator(P.removed),fa=U.next();!fa.done;fa=U.next())fa=fa.value,fa.gamepad&&b.removeXrGamepad(fa.gamepad);P=$jscomp.makeIterator(P.added);for(fa=P.next();!fa.done;fa=P.next())U=fa.value,U.gamepad&&b.addXrGamepad(U.gamepad,U.handedness)}var m=navigator.xr,n=c?!c.nativeWebXR:!1,q,u,p,w=!1,v,y,D,A=null,G,I=new THREE.Matrix4,H=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(P){H=P;
q&&(v.depthFar=H,q.updateRenderState(v))};this.render=function(P,U,fa){D.set(!1,!0,!1);y.matrixWorld=U;U=y.projectionMatrix;for(var C=p.views,Q=0;Q<C.length;++Q){var da=C[Q];I.fromArray(da.transform.inverse.matrix);U.fromArray(p.transform.matrix);I.multiply(U);U.fromArray(da.projectionMatrix);U.multiply(I);fa(y);a.enableScissorTest(!0);da=v.baseLayer.getViewport(da);a.setScissor(da.x,da.y,da.width,da.height);G.x=da.x;G.y=da.y;G.width=da.width;G.height=da.height;a.render(P,y,G);a.enableScissorTest(!1)}D.restore()};
this.enableVr=function(P){m?w?(g(!0),h().then(function(){return P.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(U){q=U;return q.requestReferenceSpace("local-floor")}).then(function(U){u=U;U=new XRWebGLLayer(q,P);G=a.createFrameBufferRenderTarget(U.framebuffer);v={baseLayer:U};y||(y=new THREE.PerspectiveCamera,D=new WALK.AutoClearAlter(a));v.depthNear=WALK.CAMERA_WALK_NEAR;v.depthFar=H;q.updateRenderState(v);
q.addEventListener("end",k);n||q.addEventListener("inputsourceschange",l);g(!1);f(!0)}).catch(function(){g(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){g(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){q.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!u};this.requestAnimationFrame=function(){function P(U,fa){p=fa.getViewerPose(u);A&&(fa=A,A=null,fa(U))}return function(U){A=U;q.requestAnimationFrame(P)}}();this.update=function(){var P=new WALK.Euler,U=new THREE.Vector3;return function(){if(p){var fa=p.transform;if(null!==fa.orientation){P.setFromQuaternion(fa.orientation,"YXZ");var C=P.y;P.y=-P.z;P.z=C;fa=fa.position;e(P,fa&&U.set(fa.x,-fa.z,fa.y,fa.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&m?(c=
function(){navigator.xr.isSessionSupported("immersive-vr").then(function(P){w=P;d(P)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)}})();(function(){WALK.RaycasterConfig=function(a,b,c){this.ray=new THREE.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new THREE.Vector3;this.object=null};WALK.GpuRaycaster=function(a,b){function c(n,q){if(!q.ignoreVisibility&&!n.visible)return!1;var u=n.node||m;if(u.disableCollisions&&q.respectColliderSettings||!u.ground&&q.onlyGroundCollisions)return!1;u=q.ray;if(n.matrixWorld)return!0;
var p=n.geometry.boundingSphere;if(p.distanceToPoint(u.origin)>q.far||!1===u.isIntersectionSphere(p))return!1;n=n.geometry.boundingBox;return n.distanceToPoint(u.origin)>q.far||!u.isIntersectionBox(n)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),g=new WALK.AutoClearAlter(a),f=new WALK.ClearColorAlter(a),h=new THREE.Color(16777215),k=new WALK.ObjectDistanceMaterial(!1),l=new THREE.PerspectiveCamera(1,
1,b.near,b.far),m={disableCollisions:!1,ground:!1};this.closestIntersection=function(n,q,u){for(var p=[],w=0;w<n.length;w+=1){var v=n[w];console.assert(null===v.visibilityId);c(v,q)&&(v.visibilityId=p.length,p.push(v))}if(0===p.length)return!1;l.position.set(0,0,0);l.lookAt(q.ray.direction);l.position.copy(q.ray.origin);l.updateMatrixWorld();g.set(!0,!0,!1);f.set(h);n=a.sortObjects;a.sortObjects=!1;a.renderMeshes(p,k,l,d,!1,q.ignoreVisibility);a.sortObjects=n;f.restore();g.restore();a.readPixels(1,
1,e);a.setRenderTarget(null);n=256*e[0]+e[1];w=e[2]+e[3]/255;for(v=0;v<p.length;v+=1)p[v].visibilityId=null;if(65535===n||w>q.far)return!1;console.assert(n<p.length);u.object=p[n];u.distance=w;u.point.copy(q.ray.direction).multiplyScalar(w).add(q.ray.origin);return!0}}})();(function(){WALK.movePointTowards=function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();WALK.Collider=function(a,b,c){var d=this,e=new THREE.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),g=c.cameraWorldPosition(),f=b.camera,h=[];this.addStaticObstacle=function(n,q,u){e.add(n,q,u)};this.addDynamicObstacle=function(n){h.push(n)};this.removeDynamicObstacle=function(n){WALK.removeFromArray(n,h)};var k=
function(){var n=new WALK.GpuRaycaster(a,f);return function(q,u){for(var p=e.search(q.ray.origin,q.far,q.ray.direction),w=0;w<h.length;w+=1)p.push(h[w]);return n.closestIntersection(p,q,u)?!0:!1}}(),l=function(){var n=new WALK.RayIntersection;return function(q){return k(q,n)?n.distance:Infinity}}(),m=function(){var n=new WALK.RaycasterConfig;n.ray.direction.set(0,0,-1);n.respectColliderSettings=!0;n.onlyGroundCollisions=f.autoClimb;return function(q,u){n.ray.origin.copy(q);n.far=u;q=l(n);return f.autoClimb||
1<=q?q:Infinity}}();this.distanceToGround=function(n){return m(g,n)};this.objectBelowCamera=function(){var n=new WALK.RayIntersection,q=new WALK.RaycasterConfig(g);q.ray.direction.set(0,0,-1);q.respectColliderSettings=!0;return function(u){q.far=u;return k(q,n)?n.object:null}}();this.distanceToCeiling=function(){var n=new WALK.RaycasterConfig(g);n.ray.direction.set(0,0,1);n.respectColliderSettings=!0;return function(q){n.far=q;return l(n)}}();this.distanceToCeilingFrom=function(){var n=new WALK.RaycasterConfig;
n.ray.direction.set(0,0,1);n.respectColliderSettings=!0;return function(q,u){n.ray.origin.copy(q);n.far=u;return l(n)}}();this.cameraHeightFromPoint=function(n){n=m(n,WALK.MAX_GROUND_SEARCH_DEPTH);return Infinity===n?null:n};this.adjustPointToMatchCameraHeight=function(n){var q=c.cameraHeight;if(null===q)return!1;var u=m(n,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===u)return!1;q-=u;if(.01>Math.abs(q)||0<q&&Infinity!==this.distanceToCeilingFrom(n,q+WALK.MIN_DISTANCE_TO_CEILING))return!1;n.z+=q;return!0};
this.findIntersectionAtPosition=function(){var n=new WALK.RaycasterConfig(g),q=n.ray.direction;return function(u,p,w,v){q.set(u,p,1).unproject(c.camera());q.sub(g).normalize();n.respectColliderSettings=w;return k(n,v)}}();this.findObstacleMeshAtPosition=function(){var n=new WALK.RayIntersection;return function(q,u,p){return this.findIntersectionAtPosition(q,u,p,n)?n.object:null}}();this.findMeshFromListAtPosition=function(){var n=new WALK.RaycasterConfig(g),q=new WALK.RayIntersection,u=new WALK.GpuRaycaster(a,
f),p=n.ray.direction;return function(w,v,y,D,A){n.ignoreVisibility=void 0===D?!1:D;D=void 0===A?q:A;p.set(v,y,1).unproject(f);p.sub(g).normalize();return u.closestIntersection(w,n,D)?D.object:null}}();this.clickedPointToMoveTarget=function(){function n(y){var D=u.x-v.x;var A=u.y-v.y;D=Math.sqrt(D*D+A*A);q.far=D+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;p.x=v.x-u.x;p.y=v.y-u.y;if(!(.01>Math.abs(p.x)&&.01>Math.abs(p.y)))if(p.z=0,p.normalize(),k(q,w)){if(A=w.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
0<A&&(y.x=u.x+p.x*A,y.y=u.y+p.y*A,y.z=u.z),A=Math.min(w.distance-.01,D),u.x+=p.x*A,u.y+=p.y*A,d.adjustPointToMatchCameraHeight(u))return n(y)}else y.x=v.x,y.y=v.y,y.z=u.z}var q=new WALK.RaycasterConfig;q.respectColliderSettings=!0;var u=q.ray.origin,p=q.ray.direction,w=new WALK.RayIntersection,v=new THREE.Vector3;return function(y){u.copy(g);v.copy(y);y.copy(g);n(y);d.adjustPointToMatchCameraHeight(y)}}();this.movePointTowardsTheCamera=function(n,q){return WALK.movePointTowards(n,g,q)};this.handleCollisions=
function(){function n(y){c.applyCameraYaw(u);u.normalize();var D=p.start.distanceTo(g),A=p.end.distanceTo(g);if(v-.02<D+A&&D+A<v+.02&&A>=y&&w.equals(u))return!1;D=l(q);Infinity===D&&(D=q.far);w.copy(u);p.start.copy(g);p.end.copy(u).multiplyScalar(D).add(g);v=p.distance();return D<y}var q=new WALK.RaycasterConfig(g),u=q.ray.direction,p=new THREE.Line3,w=new THREE.Vector3,v=0;q.respectColliderSettings=!0;q.far=5;console.assert(q.far>WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(y){y=c.maxFrameMoveLinearDistance(y)+
WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(u.set(0,1,0),n(y)&&c.stopForward());c.movesBackward()&&(u.set(0,-1,0),n(y)&&c.stopBackward());c.movesLeft()&&(u.set(-1,0,0),n(y)&&c.stopLeft());c.movesRight()&&(u.set(1,0,0),n(y)&&c.stopRight());c.movesDown()&&(u.set(0,0,-1),n(y)&&c.stopDown());c.movesUp()&&(u.set(0,0,1),n(y)&&c.stopUp())}}()}})();(function(){WALK.OrbitControls=function(a,b,c,d){function e(){var T=b.getYawAngle(),ka=b.getPitchAngle(),ua=b.cameraWorldPosition();I.copy(ua).sub(q.target);q.autoRotate&&ma===ra.NONE&&q.rotateLeft(2*Math.PI/60/60*q.autoRotateSpeed);var wa=q.getMinYawAngle(),K=q.getMaxYawAngle();Math.abs(K-wa)>=2*Math.PI-1E-6?T+=fa:wa===K?T=wa:(wa>K&&(K+=2*Math.PI,T<wa&&(T+=2*Math.PI)),T=0>fa?Math.min(Math.max(T+fa,wa),K):Math.max(Math.min(T+fa,K),wa));ka=THREE.Math.clamp(ka+C,q.getMinPitchAngle(),q.getMaxPitchAngle());
wa=I.length()*Q;wa=THREE.Math.clamp(wa,q.minDistance,q.maxDistance);q.target.add(da);WALK.OrbitControls.computeCameraPosition(ua,q.target,T,ka,wa);b.cameraPositionUpdated();b.setYawAngle(T);b.setPitchAngle(ka);C=fa=0;Q=1;da.set(0,0,0);d.requestFrame()}function g(){la=R=S=O=X=0;xa&&(xa(),xa=!1)}function f(T){if(!1!==u){T.preventDefault();var ka=c===document?c.body:c;if(ma===ra.ROTATE){if(!0===q.noRotate)return;w.set(T.clientX,T.clientY);v.subVectors(w,p);q.rotateLeft(v.x/ka.clientWidth*q.mouseRotateSpeed);
!1===q.noPitchRotate&&q.rotateUp(v.y/ka.clientHeight*q.mouseRotateSpeed);p.copy(w)}else if(ma===ra.DOLLY){if(!0===q.noZoom)return;P.set(T.clientX,T.clientY);U.subVectors(P,H);0<U.y?q.dollyIn():0>U.y&&q.dollyOut();H.copy(P)}else if(ma===ra.PAN){if(!0===q.noPan)return;D.set(T.clientX,T.clientY);A.subVectors(D,y);q.pan(A.x/ka.clientHeight,A.y/ka.clientWidth);y.copy(D)}ma!==ra.NONE&&e()}}function h(){!1!==u&&xa&&(xa(),xa=!1)}function k(T){if(!1!==u&&!0!==q.noZoom&&ma===ra.NONE){T.preventDefault();var ka=
0;void 0!==T.wheelDelta?ka=T.wheelDelta:void 0!==T.detail&&(ka=-T.detail);0<ka?q.dollyOut():0>ka&&q.dollyIn();e()}}function l(T,ka,ua){return!0===ua?ka:T===ka?0:T}function m(T,ka){var ua=!1,wa=T.keyCode;if(!1!==u){if(!0===aa&&!1===q.noPan)if(38===wa||87===wa)R=l(R,1,ka),ua=!0;else if(40===wa||83===wa)R=l(R,-1,ka),ua=!0;else if(37===wa||65===wa)la=l(la,1,ka),ua=!0;else{if(39===wa||68===wa)la=l(la,-1,ka),ua=!0}else if(!1===aa&&!1===q.noRotate)if((38===wa||87===wa)&&!1===q.noPitchRotate)O=l(O,1,ka),
ua=!0;else if((40===wa||83===wa)&&!1===q.noPitchRotate)O=l(O,-1,ka),ua=!0;else if(37===wa||65===wa)S=l(S,1,ka),ua=!0;else if(39===wa||68===wa)S=l(S,-1,ka),ua=!0;switch(wa){case q.dollyKeys.IN1:case q.dollyKeys.IN2:case q.dollyKeys.IN3:!1===q.noZoom&&(X=l(X,1,ka),ua=!0);break;case q.dollyKeys.OUT1:case q.dollyKeys.OUT2:case q.dollyKeys.OUT3:!1===q.noZoom&&(X=l(X,-1,ka),ua=!0)}ua&&(T.preventDefault(),d.requestFrame())}}function n(T){return q.noPan?!1:aa&&1===T.length?!0:aa||2!==T.length?!1:Math.abs(T[0].clientY-
T[1].clientY)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}this.target=new THREE.Vector3;this.noZoom=!1;this.mouseZoomSpeed=.98;this.keyZoomSpeed=.7;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=Math.PI/4;this.keyPitchRotateSpeed=this.keyYawRotateSpeed/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/
2};this.getMinYawAngle=function(){return-Math.PI};this.getMaxYawAngle=function(){return Math.PI};this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=THREE.MOUSE.LEFT;this.secondaryMouseButton=THREE.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:THREE.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var q=this,u=!1,p=new THREE.Vector2,w=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,D=new THREE.Vector2,
A=new THREE.Vector2,G=new THREE.Vector3,I=new THREE.Vector3,H=new THREE.Vector2,P=new THREE.Vector2,U=new THREE.Vector2,fa=0,C=0,Q=1,da=new THREE.Vector3,aa=!1,X=0,S=0,O=0,la=0,R=0,ra={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},ma=ra.NONE,xa=!1;this.enable=function(){u=!0;e()};this.disable=function(){u=!1;g()};this.isEnabled=function(){return u};this.setPanPrimary=function(T){aa=T;!0===aa?(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):
(this.mouseButtons.ROTATE=this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var T=new THREE.Vector3;return function(){T.copy(b.cameraWorldPosition()).sub(this.target);return T.length()}}();this.rotateLeft=function(T){void 0===T&&(T=2*Math.PI/60/60*q.autoRotateSpeed);fa-=T};this.rotateUp=function(T){void 0===T&&(T=2*Math.PI/60/60*q.autoRotateSpeed);C-=T};this.panLeft=function(T){var ka=a.matrixWorld.elements;G.set(ka[0],ka[1],ka[2]);G.multiplyScalar(-T);
da.add(G)};this.panUp=function(T){var ka=a.matrixWorld.elements;G.set(ka[4],ka[5],ka[6]);G.multiplyScalar(T);da.add(G)};this.pan=function(T,ka){if(a instanceof THREE.PerspectiveCamera){var ua=b.cameraWorldPosition().clone().sub(q.target).length();ua*=Math.tan(a.fov/2*Math.PI/180);q.panLeft(2*T*ua);q.panUp(2*ka*ua)}else a instanceof THREE.OrthographicCamera&&(q.panLeft(T*(a.right-a.left)),q.panUp(ka*(a.top-a.bottom)))};this.dollyIn=function(T){void 0===T&&(T=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?
Q/=T:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*T)),a.updateProjectionMatrix())};this.dollyOut=function(T){void 0===T&&(T=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?Q*=T:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/T)),a.updateProjectionMatrix())};this.update=function(T){if(u&&T){var ka=!1;0!==S&&(q.rotateLeft(S*q.keyYawRotateSpeed*T),ka=!0);0!==O&&(q.rotateUp(O*q.keyPitchRotateSpeed*
T),ka=!0);if(0!==la||0!==R)q.pan(la*q.keyPanSpeed*T,R*q.keyPanSpeed*T),ka=!0;0!==X&&(T=Math.pow(q.keyZoomSpeed,T),-1===X?q.dollyIn(T):q.dollyOut(T),ka=!0);ka&&e()}};c.addEventListener("mousedown",function(T){if(!1!==u){c.focus();T.preventDefault();if(T.button===q.mouseButtons.ROTATE){if(!0===q.noRotate)return;ma=ra.ROTATE;p.set(T.clientX,T.clientY)}else if(T.button===q.mouseButtons.ZOOM){if(!0===q.noZoom)return;ma=ra.DOLLY;H.set(T.clientX,T.clientY)}else if(T.button===q.mouseButtons.PAN){if(!0===
q.noPan)return;ma=ra.PAN;y.set(T.clientX,T.clientY)}ma!==ra.NONE&&(document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",h,!1),xa=function(){document.removeEventListener("mousemove",f,!1);document.removeEventListener("mouseup",h,!1);ma=ra.NONE})}},!1);c.addEventListener("mousewheel",k,!1);c.addEventListener("DOMMouseScroll",k,!1);c.addEventListener("touchstart",function(T){if(!1!==u){var ka=T.touches.length;T.preventDefault();n(T.touches)?(ma=ra.TOUCH_PAN,y.set(T.touches[0].clientX,
T.touches[0].clientY)):q.noRotate||aa||1!==ka?q.noZoom||2!==ka?ma=ra.NONE:(ma=ra.TOUCH_DOLLY,ka=T.touches[0].clientX-T.touches[1].clientX,T=T.touches[0].clientY-T.touches[1].clientY,H.set(0,Math.sqrt(ka*ka+T*T))):(ma=ra.TOUCH_ROTATE,p.set(T.touches[0].clientX,T.touches[0].clientY))}},!1);c.addEventListener("touchend",function(){!1!==u&&(ma=ra.NONE)},!1);c.addEventListener("touchmove",function(T){if(!1!==u){var ka=T.touches.length;T.preventDefault();var ua=c===document?c.body:c;n(T.touches)&&ma===
ra.TOUCH_PAN?(D.set(T.touches[0].clientX,T.touches[0].clientY),A.subVectors(D,y),q.pan(A.x/ua.clientHeight,A.y/ua.clientWidth),y.copy(D),e()):q.noRotate||aa||1!==ka||ma!==ra.TOUCH_ROTATE?q.noZoom||2!==ka||ma!==ra.TOUCH_DOLLY?ma=ra.NONE:(ka=T.touches[0].clientX-T.touches[1].clientX,T=T.touches[0].clientY-T.touches[1].clientY,P.set(0,Math.sqrt(ka*ka+T*T)),U.subVectors(P,H),0<U.y?q.dollyOut():0>U.y&&q.dollyIn(),H.copy(P),e()):(w.set(T.touches[0].clientX,T.touches[0].clientY),v.subVectors(w,p),q.rotateLeft(v.x/
ua.clientWidth*q.mouseRotateSpeed),q.rotateUp(v.y/ua.clientHeight*q.mouseRotateSpeed),p.copy(w),e())}},!1);c.addEventListener("blur",function(T){g()},!1);c.addEventListener("keydown",function(T){WALK.isModifierPressed(T)||m(T,!0)},!1);c.addEventListener("keyup",function(T){m(T,!1)},!1);a instanceof THREE.PerspectiveCamera||a instanceof THREE.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;
WALK.OrbitControls.computeCameraPosition=function(){var a=new THREE.Vector3;return function(b,c,d,e,g){d-=Math.PI/2;e+=Math.PI/2;a.x=g*Math.sin(e)*Math.cos(d);a.y=g*Math.sin(e)*Math.sin(d);a.z=g*Math.cos(e);b.copy(c).add(a)}}()})();(function(){WALK.Controls=function(a,b,c,d){function e(){ka.rotation.z=WALK.normalizeRotation(K.z+wa.z)}function g(){e();T.rotation.x=WALK.normalizeRotation(K.x+wa.x);xa.rotation.y=K.y;ka.updateMatrixWorld(!0)}function f(J){return Math.abs(J[0].y-J[1].y)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}function h(J){C[0].copy(fa[0]);C[1].copy(fa[1]);J.touches?(fa[0].set(J.touches[0].clientX,J.touches[0].clientY),2===J.touches.length?fa[1].set(J.touches[1].clientX,J.touches[1].clientY):fa[1].set(0,0)):(fa[0].set(J.clientX,
J.clientY),fa[1].set(0,0))}function k(J){if(p)if(J.preventDefault(),h(J),O){if(O!==S){if(O===da){var ha=la[0].distanceTo(la[1]);J=fa[0].distanceTo(fa[1]);10<=Math.abs(J-ha)?(O=aa,ha=!0):f(fa)&&f(la)&&10<=Math.abs(fa[0].y-la[0].y)?(O=X,ha=!0):ha=!1;if(!ha)return}O===aa?(ha=C[1].distanceTo(C[0]),ha=fa[1].distanceTo(fa[0])-ha,0<Math.abs(ha)&&(R=Date.now(),H.activateDirectionFromSource(Math.sign(ha),D)),d.requestFrame()):O===X&&f(fa)&&(ha=fa[0].y-C[0].y,0<Math.abs(ha)&&(ra=Date.now(),P.activateDirectionFromSource(Math.sign(ha),
D)),d.requestFrame())}}else if(!u.mousePressLook||ma||!O&&J.touches){ha=J.movementX||J.mozMovementX||J.webkitMovementX;void 0===ha&&(ha=fa[0].x-C[0].x);var W=J.movementY||J.mozMovementY||J.webkitMovementY;void 0===W&&(W=fa[0].y-C[0].y);J=u.flipMouseLook||!O&&J.touches?1:-1;wa.z+=J*ha*WALK.CAMERA_LOOK_SPEED;u.mouseControlsPitch&&(wa.x+=J*W*WALK.CAMERA_LOOK_SPEED);u.restrictVerticalAngle&&(wa.x>u.verticalAngleMax?wa.x=u.verticalAngleMax:wa.x<u.verticalAngleMin&&(wa.x=u.verticalAngleMin));g();d.requestFrame()}}
function l(J){p&&(b.focus(),J.preventDefault(),h(J),ma=!0,d.requestFrame())}function m(J){p&&(J.preventDefault(),ma=!1)}function n(J){var ha=0,W;(W=!p)||(W=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,W=!W);W||(J||(J=window.event),J.preventDefault(),J.wheelDelta?ha=J.wheelDelta/120:J.detail&&(ha=-J.detail/3),Q+=ha*WALK.CAMERA_SCROLL_SPEED,Q=0<=Q?Math.min(Q,.5):Math.max(Q,-.5),d.requestFrame())}function q(){u.stopForward();u.stopBackward();u.stopLeft();u.stopRight();u.stopUp();
u.stopDown();U.stopInDirection(1);U.stopInDirection(-1)}var u=this,p=!0,w=Math.PI/12,v=Symbol("MOVE_SOURCE_NONE"),y=Symbol("MOVE_SOURCE_KEY"),D=Symbol("MOVE_SOURCE_GESTURE"),A=Symbol("MOVE_SOURCE_GAMEPAD"),G=function(J){this.activeDirection=0;this.activeSource=v;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(ha){return this.activeDirection===ha||Math.sign(this.speed)===ha};this.activateDirectionFromSource=function(ha,W){this.activeDirection=
ha;this.activeSource=W};this.deactivateDirectionFromSource=function(ha,W){this.activeDirection===ha&&this.activeSource===W&&(this.activeDirection=0,this.activeSource=W)};this.deactivateSource=function(ha){this.activeSource===ha&&(this.activeDirection=0,this.activeSource=v)};this.stopInDirection=function(ha){this.activeDirection===ha&&(this.activeDirection=0,this.activeSource=v);Math.sign(this.speed)===ha&&(this.speed=0)};this.update=function(ha,W){if(!this.moves())return 0;var Da=Math.sign(this.speed),
Ba=this.activeDirection||-Da;Ba=W*Ba*(Da===Ba?ha/WALK.CAMERA_FULL_ACCELERATION_TIME:ha/WALK.CAMERA_FULL_DECELERATION_TIME);W*=this.speed+Ba/2;this.speed=THREE.Math.clamp(this.speed+Ba,-ha,ha);this.activeDirection||Math.sign(this.speed)===Da||(this.speed=0);return THREE.Math.clamp(W,-J,J)}},I=new G(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),H=new G(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),P=new G(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),U=new G(w),fa=[new THREE.Vector2(0,0),new THREE.Vector2(0,
0)],C=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],Q=0,da=Symbol("GESTURE_RECOGNITION"),aa=Symbol("GESTURE_PINCH"),X=Symbol("GESTURE_TWO_POINTER_DRAG"),S=Symbol("GESTURE_IGNORE"),O=null,la=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],R=0,ra=0,ma=!1,xa=new THREE.Object3D,T=new THREE.Object3D,ka=new THREE.Object3D,ua=!1,wa=new THREE.Vector3(0,0,0),K=new THREE.Euler(0,0,0);xa.add(a);T.add(xa);ka.add(T);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=
!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);this.orbit.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.orbit.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.cameraHeight=null;this.isFpsEnabled=function(){return p};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=function(){p=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(J){J.applyEuler(ka.rotation)};
this.cameraWorldPosition=function(){return ka.position};this.cameraPositionUpdated=function(){var J={type:"positionChanged",target:null},ha=null,W=null,Da=null;return function(){ka.updateMatrixWorld(!0);var Ba=ka.position;if(ha!==Ba.x||W!==Ba.y||Da!==Ba.z)ha=Ba.x,W=Ba.y,Da=Ba.z,a.dispatchEvent(J)}}();this.resetRollAngle=function(){0!==xa.rotation.y&&(K.y=0,g())};this.getPitchAngle=function(){return T.rotation.x};this.setPitchAngle=function(J){J!==T.rotation.x&&(wa.x=J,K.x=0,g())};this.resetPitchAngle=
function(){this.setPitchAngle(0)};this.getYawAngle=function(){return ka.rotation.z};this.setYawAngle=function(J){J!==ka.rotation.z&&(wa.z=J,K.z=0,g())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==O};this.hmdReset=function(){ua=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var J=new THREE.Vector3,ha=new THREE.Vector3,W=new THREE.Vector3,Da=new THREE.Vector3,Ba=new THREE.Vector3;return function(Ga,Ha){p&&(K.copy(Ga),ua?wa.z-=K.z:Ha&&(Da.subVectors(Ha,
W),J.set(Math.cos(wa.z),Math.sin(wa.z),0),ha.set(-Math.sin(wa.z),Math.cos(wa.z),0),Ba.copy(J.multiplyScalar(Da.x)),Ba.add(ha.multiplyScalar(Da.y)),Ba.z=Da.z,ka.position.add(Ba)),Ha&&W.copy(Ha),ua=!1,g())}}();this.maxFrameMoveLinearDistance=function(J){return Math.min(J*a.moveMaxSpeed,WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return H.movesInDirection(1)||0<Q};this.stopForward=function(){0<Q&&(Q=0);H.stopInDirection(1)};this.movesBackward=function(){return H.movesInDirection(-1)||
0>Q};this.stopBackward=function(){0>Q&&(Q=0);H.stopInDirection(-1)};this.movesLeft=function(){return I.movesInDirection(-1)};this.stopLeft=function(){I.stopInDirection(-1)};this.movesRight=function(){return I.movesInDirection(1)};this.stopRight=function(){I.stopInDirection(1)};this.movesUp=function(){return P.movesInDirection(1)};this.stopUp=function(){P.stopInDirection(1)};this.movesDown=function(){return P.movesInDirection(-1)};this.stopDown=function(){P.stopInDirection(-1)};this.enable=function(){this.orbit.disable();
p=!0;ma=0};this.disable=function(){this.orbit.disable();p=!1;q()};this.update=function(J){if(p){H.activeSource===D&&100<Date.now()-R&&H.deactivateSource(D);P.activeSource===D&&100<Date.now()-ra&&P.deactivateSource(D);var ha=I.update(a.moveMaxSpeed,J),W=H.update(a.moveMaxSpeed,J),Da=P.update(a.moveMaxSpeed,J);var Ba=0;W?Q=0:(Q&&(W=u.maxFrameMoveLinearDistance(J),Ba=THREE.Math.clamp(Q,-W,W),Q-=Ba),W=Ba);ka.translateX(ha);ka.translateY(W);ka.translateZ(Da);J=U.update(WALK.CAMERA_ARROWS_TURN_SPEED,J);
wa.z+=J;e();(I.moves()||H.moves()||P.moves()||U.moves()||Q)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(J)};a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(J){J.preventDefault()},!1);b.addEventListener("mousedown",l,!1);b.addEventListener("touchstart",function(J){p&&(J.preventDefault(),h(J),2===J.touches.length?(O=da,la[0].copy(fa[0]),la[1].copy(fa[1])):2<J.touches.length&&(O=
S))},!1);b.addEventListener("mousemove",k,!1);b.addEventListener("touchmove",k,!1);b.addEventListener("mouseup",m,!1);b.addEventListener("touchend",function(J){p&&(J.preventDefault(),O=0===J.touches.length?null:S)},!1);b.addEventListener("keydown",function(J){var ha=!0;if(p&&!WALK.isModifierPressed(J)){switch(J.keyCode){case 38:case 32:case 87:H.activateDirectionFromSource(1,y);break;case 37:u.arrowsTurn?U.activateDirectionFromSource(1,y):I.activateDirectionFromSource(-1,y);break;case 65:I.activateDirectionFromSource(-1,
y);break;case 40:case 83:H.activateDirectionFromSource(-1,y);break;case 39:u.arrowsTurn?U.activateDirectionFromSource(-1,y):I.activateDirectionFromSource(1,y);break;case 68:I.activateDirectionFromSource(1,y);break;case 33:case 69:P.activateDirectionFromSource(1,y);break;case 34:case 81:P.activateDirectionFromSource(-1,y);break;default:ha=!1}ha&&(J.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",function(J){var ha=!0;if(p){switch(J.keyCode){case 38:case 32:case 87:H.deactivateDirectionFromSource(1,
y);break;case 37:case 65:U.deactivateDirectionFromSource(1,y);I.deactivateDirectionFromSource(-1,y);break;case 40:case 83:H.deactivateDirectionFromSource(-1,y);break;case 39:case 68:U.deactivateDirectionFromSource(-1,y);I.deactivateDirectionFromSource(1,y);break;case 33:case 69:P.deactivateDirectionFromSource(1,y);break;case 34:case 81:P.deactivateDirectionFromSource(-1,y);break;default:ha=!1}ha&&J.preventDefault()}},!1);b.addEventListener("mouseout",function(J){m(J)},!1);b.addEventListener("mouseenter",
function(J){0<J.buttons&&l(J)},!1);b.addEventListener("DOMMouseScroll",n,!1);b.addEventListener("mousewheel",n,!1);b.addEventListener("blur",function(J){q()},!1);c.addEventListener("actionActivated",function(J){if(p)switch(J.action){case WALK.GAMEPAD_ACTION.BACKWARD:H.activateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.FORWARD:H.activateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.LEFT:u.arrowsTurn?U.activateDirectionFromSource(1,A):I.activateDirectionFromSource(-1,A);break;
case WALK.GAMEPAD_ACTION.RIGHT:u.arrowsTurn?U.activateDirectionFromSource(-1,A):I.activateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.DOWN:P.activateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.UP:P.activateDirectionFromSource(1,A)}});c.addEventListener("actionDeactivated",function(J){if(p)switch(J.action){case WALK.GAMEPAD_ACTION.BACKWARD:H.deactivateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.FORWARD:H.deactivateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.LEFT:I.deactivateDirectionFromSource(-1,
A);U.deactivateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.RIGHT:I.deactivateDirectionFromSource(1,A);U.deactivateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.DOWN:P.deactivateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.UP:P.deactivateDirectionFromSource(1,A)}});this.isEnabled=function(){return p}}})();(function(){WALK.ClickNavigator=function(a,b,c){function d(){c.teleportingToPoint&&c.cancelSwitchToPoint()}function e(){!b.mousePressLook&&c.teleportingToPoint&&c.cancelSwitchToPoint()}this.onMeshClicked=function(g,f){b.isOrbitEnabled()||b.isHandlingGesture()||(a.clickedPointToMoveTarget(f),c.switchToPoint(f))};this.dispose=function(){document.removeEventListener("keydown",d,!1);document.removeEventListener("mousedown",d,!1);document.removeEventListener("mousemove",e,!1);document.removeEventListener("touchstart",
d,!1);document.removeEventListener("DOMMouseScroll",d,!1);document.removeEventListener("mousewheel",d,!1)};document.addEventListener("keydown",d,!1);document.addEventListener("mousedown",d,!1);document.addEventListener("mousemove",e,!1);document.addEventListener("touchstart",d,!1);document.addEventListener("DOMMouseScroll",d,!1);document.addEventListener("mousewheel",d,!1)}})();(function(){WALK.StepsClimber=function(a,b,c){var d,e,g=b.cameraWorldPosition(),f=new THREE.Vector3;this.updateCameraHeight=function(h){if(d){var k=g.z-f.z;null!==b.cameraHeight&&(b.cameraHeight+=k);g.x!==f.x||g.y!==f.y?e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==e&&(e+=k);if(Infinity!==e&&(null===b.cameraHeight&&(b.cameraHeight=e),k=b.cameraHeight,e<k-.005||e>k+.005)){var l=1.5*b.camera().moveMaxSpeed;k=b.cameraHeight;h=Math.min(l*h,Math.abs(e-k));e>k&&(h=-h);if(0>h||Infinity===
a.distanceToCeiling(h+WALK.MIN_DISTANCE_TO_CEILING))g.z+=h,e+=h,c.requestFrame()}f.copy(g)}};this.enable=function(){d=!0;e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==e?e:null;f.copy(g)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()}})();(function(){WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,e,g;this.onHmdPositionUpdate=function(f){d&&!g&&1<f.z&&(a.cameraHeight=f.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,g=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.VR_FALLBACK_CAMERA_HEIGHT);e=c.z;g=!1};this.disable=
function(){d=!1;a.cameraHeight=null}}})();(function(){function a(d){var e=null;this.activateSky=function(g){if(e){if(e.name===g)return;d.removeAuxiliaryObject(e)}var f=d.findSkyMesh(g);(g=f.material.map)&&!g.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),e=f,g.addLoadedListener(function(){e===f&&(d.addAuxiliaryObject(f),f.updateMatrixWorld(!0))})):(d.addAuxiliaryObject(f),f.updateMatrixWorld(!0),e=f)};this.activeSkyName=function(){return e.name}}function b(d,e,g){this.position=d||new THREE.Vector3;this.rotation=e||new THREE.Vector2;this.fov=
g||0}var c=1/180;b.prototype={length:function(){return Math.sqrt(this.position.lengthSq()+this.rotation.lengthSq()+this.fov*this.fov)},multiplyScalar:function(d){this.position.multiplyScalar(d);this.rotation.multiplyScalar(d);this.fov*=d;return this},divideScalar:function(d){this.position.divideScalar(d);this.rotation.divideScalar(d);this.fov/=d;return this},normalize:function(){return this.divideScalar(this.length())},normalizeRotation:function(){this.rotation.x=WALK.normalizeRotation(this.rotation.x);
this.rotation.y=WALK.normalizeRotation(this.rotation.y);return this},distanceTo:function(d){var e=this.position.x-d.position.x,g=this.position.y-d.position.y,f=this.position.z-d.position.z,h=WALK.normalizeRotation(this.rotation.x-d.rotation.x),k=WALK.normalizeRotation(this.rotation.y-d.rotation.y);d=this.fov-d.fov;return Math.sqrt(e*e+g*g+f*f+h*h+k*k+d*d)},subVectors:function(d,e){this.position.subVectors(d.position,e.position);this.rotation.subVectors(d.rotation,e.rotation);this.fov=d.fov-e.fov;
return this.normalizeRotation()},copy:function(d){this.position.copy(d.position);this.rotation.copy(d.rotation);this.fov=d.fov;return this}};WALK.Teleport=function(d,e,g,f){function h(){v=[];for(var R=0;R<d.views.length;R+=1)v[d.views[R].id]=[];for(R=0;R<d.gpuMeshes.length;R+=1){var ra=d.gpuMeshes[R],ma=ra.hideInViews;if(ma)for(var xa=0;xa<ma.length;xa+=1)v[ma[xa]]?v[ma[xa]].push(ra):console.warn("Invalid view id in hideInViews list: '"+ma[R]+"'")}}function k(R){for(var ra=0;ra<R.length;ra+=1){var ma=
R[ra];ma.visible=!1;y.push(ma)}}function l(){for(var R=0;R<y.length;R+=1)y[R].visible=!0;y.length=0}function m(R){l();k(R)}function n(){w.fov=D.fov;p.copy(D.position);e.setYawAngle(D.rotation.x);e.setPitchAngle(D.rotation.y);e.cameraPositionUpdated()}var q=this,u=new a(d),p=e.cameraWorldPosition(),w=d.camera,v,y=[],D=new b,A=new b,G=new THREE.Vector3,I=0,H=0,P=0,U,fa,C,Q=!1,da={type:"teleportStarted",target:this,view:null},aa={type:"teleportDone",target:this,view:null},X=null;this.lastDestinationView=
null;var S=this.teleportingToPoint=this.teleportingToView=!1,O=!1,la=function(){var R=new b(e.cameraWorldPosition());return function(){R.rotation.set(e.getYawAngle(),e.getPitchAngle());R.normalizeRotation();R.fov=w.fov;return R}}();this.update=function(){function R(ma,xa){var T=0;H*H/(2*P)>=xa?(T=H/P,T=2*(H*T-xa)/(T*T)*-ma):H<I&&(T=ma*P);ra.copy(A);H=THREE.Math.clamp(H+.5*T,0,I);ra.multiplyScalar(H*ma);H=THREE.Math.clamp(H+.5*T,0,I);ra.fov&&(w.fov+=ra.fov,w.updateProjectionMatrix());p.add(ra.position);
e.setYawAngle(e.getYawAngle()+ra.rotation.x);e.setPitchAngle(e.getPitchAngle()+ra.rotation.y)}var ra=new b;return function(ma){if(q.teleportingToView||q.teleportingToPoint){ma=Math.min(ma,.067);ma=Math.max(ma,c);var xa=la().distanceTo(D);this.teleportingToPoint&&(D.position.z=p.z);var T=!0;0!==xa&&(R(ma,xa),la().distanceTo(D)>xa||0===H?n():T=!1,e.cameraPositionUpdated());T&&(this.teleportingToView&&("orbit"!==C.mode||Q?(ma=e.camera(),ma.near=WALK.CAMERA_WALK_NEAR,ma.updateProjectionMatrix(),e.enable()):
(e.orbit.minDistance=U,e.orbit.maxDistance=fa,e.orbit.setPanPrimary(C.panPrimary||!1),e.orbit.noPan=C.noPan||!1,e.orbit.noRotate=C.noRotate||!1,e.orbit.noPitchRotate=C.noPitchRotate||!1,e.orbit.getMinPitchAngle=function(){return-C.maxUpAngle},e.orbit.getMaxPitchAngle=function(){return-C.minUpAngle},e.orbit.getMinYawAngle=function(){return C.minSideAngle},e.orbit.getMaxYawAngle=function(){return C.maxSideAngle},e.orbit.target.copy(G),e.orbitModeEnable()),u.activateSky(C.sky),m(v[C.id]||[])),this.teleportingToView=
this.teleportingToPoint=!1,aa.view=C,this.dispatchEvent(aa));f.requestFrame()}}}();this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;aa.view=null;this.dispatchEvent(aa)};this.switchToPoint=function(R){if(R.x!==p.x||R.y!==p.y)if(C=null,this.teleportingToPoint=!0,this.teleportingToView=!1,da.view=null,this.dispatchEvent(da),S?D.position.set(R.x,R.y,R.z):D.position.set(R.x,R.y,p.z),R=Math.atan2(-(R.x-p.x),R.y-p.y),R=WALK.normalizeRotation(R),D.rotation.set(R,
0),D.fov=w.defaultFov,S)n(),this.update(c);else{A.subVectors(D,la());R=A.length();I=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;P=I/WALK.CAMERA_FULL_ACCELERATION_TIME;var ra=WALK.TELEPORT_TO_POINT_MAX_TIME;R>(ra-WALK.CAMERA_FULL_ACCELERATION_TIME)*I&&(I=WALK.Math.anyPositiveRootOfQuadraticEquation(1,-P*ra,P*R),null===I&&(ra/=2,P=R/(ra*ra),I=P*ra));A.normalize();H=0;f.requestFrame()}};this.switchToView=function(R,ra){void 0===ra&&(ra=WALK.TELEPORT_TO_VIEW_MAX_TIME);R.hideFromMenu||(X=R);this.lastDestinationView=
C=R;this.teleportingToView=!0;this.teleportingToPoint=!1;da.view=C;this.dispatchEvent(da);e.disable();e.resetRollAngle();k(v[C.id]||[]);void 0!==C.rotation?D.rotation.set(C.rotation.yaw,C.rotation.pitch):D.rotation.set(0,0);D.fov=C.fov||w.defaultFov;"orbit"===C.mode?(void 0!==C.target?G.set(C.target.x,C.target.y,C.target.z):G.set(0,0,0),U=C.minDistance||0,fa=C.maxDistance||100,R=THREE.Math.clamp(C.distance||10,U,fa),WALK.OrbitControls.computeCameraPosition(D.position,G,D.rotation.x,D.rotation.y,R),
R=e.camera(),R.near=WALK.CAMERA_ORBIT_NEAR,R.updateProjectionMatrix()):void 0!==C.position?(D.position.set(C.position.x,C.position.y,C.position.z),O&&g.adjustPointToMatchCameraHeight(D.position)):D.position.set(0,0,0);if(0===ra||S)n(),this.update(c);else{C.sky!==u.activeSkyName()&&u.activateSky(WALK.DEFAULT_SKY_NAME);A.subVectors(D,la());R=A.length();P=WALK.TELEPORT_TO_VIEW_ACCELERATION;var ma=Math.sqrt(R/P);ma>ra/2&&(ma=ra/2,P=R/(ma*ma));I=P*ma;A.normalize();H=0}f.requestFrame()};this._switchToAdjacentVisibleView=
function(R,ra){var ma=d.visibleViews();if(0!==ma.length)if(null===X)this.switchToView(ma[0],ra);else{var xa=ma.indexOf(X);-1===xa&&this.switchToView(ma[0],ra);this.switchToView(ma[(xa+ma.length+R)%ma.length],ra)}};this.switchToPreviousVisibleView=function(R){this._switchToAdjacentVisibleView(-1,R)};this.switchToNextVisibleView=function(R){this._switchToAdjacentVisibleView(1,R)};this.updateHiddenMeshes=function(R){h();R?m(v[R.id]||[]):l();f.requestFrame()};this.activateSky=function(R){u.activateSky(R.sky);
f.requestFrame()};this.executeWithViewVisibilitySettings=function(R,ra){var ma=y.slice();m(v[R.id]||[]);u.activateSky(R.sky);ra();u.activateSky(this.lastDestinationView.sky);m(ma)};this.onVrChange=function(R){O=S=Q=R;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};h();d.addEventListener("viewAdded",h);d.addEventListener("viewRemoved",h);d.addEventListener("skyMeshAdded",function(R){u.activateSky(R.skyMesh.name);f.requestFrame()});d.addEventListener("skyMeshRemoved",
function(R){u.activeSkyName()===R.skyMesh.name&&(u.activateSky(WALK.DEFAULT_SKY_NAME),f.requestFrame())})};THREE.EventDispatcher.prototype.apply(WALK.Teleport.prototype)})();(function(){WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,e={type:"tourStarted"},g={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(e);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(g)}};THREE.EventDispatcher.prototype.apply(WALK.AutoTour.prototype)})();(function(){function a(f){return-.7>=f?0:.7<=f?1:-1}function b(f,h){if("xr-standard"===f.mapping)return"left"===(f.hand?f.hand:h)?d:e;h=$jscomp.makeIterator(c);for(var k=h.next();!k.done;k=h.next()){k=k.value;var l=f;var m=k;l=m.gamepadIdPattern.test(l.id)?void 0!==m.gamepadLayoutMappingId?l.mapping===m.gamepadLayoutMappingId:!0:!1;if(l)return k}console.error("No matching action mapping for gamepad found",f.id);return null}WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,
UP:6,PREVIOUS:7,NEXT:8};var c=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,
WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},
{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,
[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],
[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],d={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},e={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],
[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])},g=function(f,h){h=b(f,h);this.axisMapping=h.axisMapping;this.buttonMapping=h.buttonMapping;this.axisPosition=f.axes.map(a);this.buttonPressed=f.buttons.map(function(k){return k.pressed})};WALK.GamepadManager=function(){function f(p){var w=p.gamepad;p=new g(p.gamepad);k.set(w.index,p)}function h(p){k.delete(p.gamepad.index)}var k=new Map,l=new Map,m=new Set,n=new Set,q={type:"actionActivated",action:null},u={type:"actionDeactivated",
action:null};this.hasGamepads=function(){return 0<k.size||0<l.size};this.update=function(){function p(D,A){for(var G=0;G<A.axes.length;++G){var I=a(A.axes[G]),H=D.axisPosition[G];if(I!==H){var P=D.axisMapping.get(G);void 0!==P&&(-1!==H&&n.add(P[H]),-1!==I&&m.add(P[I]))}D.axisPosition[G]=I}for(G=0;G<A.buttons.length;++G)I=A.buttons[G].pressed,H=D.buttonPressed[G],I!==H&&(P=D.buttonMapping.get(G),void 0!==P&&(H?n.add(P):m.add(P))),D.buttonPressed[G]=I}if(this.hasGamepads()){m.clear();n.clear();var w=
navigator.getGamepads?navigator.getGamepads():[];w=$jscomp.makeIterator(w);for(var v=w.next();!v.done;v=w.next())if(v=v.value){var y=k.get(v.index);p(y,v)}w=$jscomp.makeIterator(l);for(v=w.next();!v.done;v=w.next())y=$jscomp.makeIterator(v.value),v=y.next().value,y=y.next().value,p(y,v);v=$jscomp.makeIterator(n);for(w=v.next();!w.done;w=v.next())u.action=w.value,this.dispatchEvent(u);v=$jscomp.makeIterator(m);for(w=v.next();!w.done;w=v.next())q.action=w.value,this.dispatchEvent(q)}};this.addXrGamepad=
function(p,w){w=new g(p,w);l.set(p,w)};this.removeXrGamepad=function(p){l.delete(p)};this.removeAllXrGamepads=function(){l.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",f);window.addEventListener("gamepaddisconnected",h);for(var p=$jscomp.makeIterator(navigator.getGamepads()),w=p.next();!w.done;w=p.next())if(w=w.value){var v=new g(w);k.set(w.index,v)}}})()};THREE.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype)})();/*
 Copyright (C) 2020-present Shapespark
*/
(function(){WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};THREE.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype)})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(18);c.addAttribute("position",new THREE.BufferAttribute(d,3));d[0]=.05;d[1]=-.05;d[2]=-2;d[3]=.05;d[4]=.05;d[5]=-2;d[6]=-.05;d[7]=-.05;d[8]=-2;d[9]=.05;d[10]=.05;d[11]=-2;d[12]=-.05;d[13]=.05;d[14]=-2;d[15]=-.05;d[16]=-.05;d[17]=-2;c.computeBoundingSphere();return c}console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var b=Math.PI/60;WALK.GazePointer=function(c,d,e,g){function f(){k=l=
null;m=0;n=!1;q&&q.setCircleSpan(0)}var h=g.modeIsEnabled(),k,l,m,n,q=null,u=null,p=null;this.setGazeHandlers=function(v,y){u=v;p=y};var w=function(){if(!h)f();else if(!q){var v=new WALK.GazePointerMaterial,y=new THREE.Mesh(a(),v);c.addAuxiliaryObject(y);y.frustumCulled=!1;y.matrixWorld=d.camera().matrixWorld;q={setVisible:function(D){y.visible=D;e()},setCircleSpan:function(D){v.circleSpan=D;e()}};f()}q&&q.setVisible(h)};g.addEventListener("modeDisabled",function(){h=!1;w()});g.addEventListener("modeEnabled",
function(){h=!0;w()});this.reset=function(){null!==k&&f()};this.update=function(v){if(h){var y=d.getPitchAngle(),D=d.getYawAngle();null===k?(k=y,l=D):Math.abs(k-y)>b||Math.abs(l-D)>b?f():(m+=v,m>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(n?(q.setCircleSpan(Math.min((m-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),m>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(p&&p(),f())):u&&u()?n=!0:f()))}};w()}})();/*
 Copyright (C) 2018-present Shapespark
*/
(function(){WALK.HashChangeTeleport=function(a,b){function c(){var d=WALK.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}}})();(function(){WALK.AutoClearAlter=function(a){var b,c,d,e;this.set=function(g,f,h){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=g||f||h;a.autoClearColor=g;a.autoClearDepth=f;a.autoClearStencil=h};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}}})();(function(){WALK.ClearColorAlter=function(a){var b=new THREE.Color,c=!1;this.set=function(d){console.assert(!c);c=!0;b.copy(a.getClearColor());a.setClearColor(d)};this.restore=function(){console.assert(c);c=!1;a.setClearColor(b)}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("standard_material_fragment.glsl"),c=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),d=new THREE.Color,e=new THREE.Vector3(0,0,0),g=new THREE.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var f=this;WALK.BaseMaterial.call(this,a,b,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(k){this._opacity=.99<k?1:k;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new THREE.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new THREE.Vector4;this._emissive=this.lightMapped=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.gl.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=
10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var h={type:"updated",target:this};this._updated=function(){return f.dispatchEvent(h)};this._alphaInLowerHalf=!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new THREE.Color).setRGB(0,.94,0);this._chromaKeyDelta=new THREE.Vector3(.1,
.1,.1);this._chromaKeyDeltaCoeff=new THREE.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(f){var h="_"+f;Object.defineProperty(this,f,{get:function(){return this[h]||null},set:function(k){var l=this;(this[h]=k)?k.addLoadedListener(function(){l.setUniforms();l._updated();l=k=null}):(l.setUniforms(),l._updated())}})};WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");
WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return c};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var f=
this._baseColorTexture;return 1===this.opacity&&(f&&f.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};WALK.StandardMaterial.prototype.configureTransparency=function(){var f=this._baseColorTexture;f=f&&(f.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||f;f=this._useBaseColorTextureAsCutout();this.transparent?(this.blending=THREE.NormalBlending,this.transparentRenderOrder=f?0:1):this.blending=THREE.NoBlending;this.depthWrite=!this.transparent||
f};Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(f){this._alphaInLowerHalf=f;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(f){this._chromaKeyEnabled=!!f;this.configureTransparency();this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setChromaKeyColorRGB=
function(f,h,k){this.chromaKeyColor.setRGB(f,h,k);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(f){return this._chromaKeyDelta.getComponent(f)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(f,h){this._chromaKeyDelta.setComponent(f,h);this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"isAnimated",{get:function(){var f=this.baseColorTexture;return f&&f.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,
"isPlaying",{get:function(){var f=this.baseColorTexture;return f&&f.isAnimated&&f.isPlaying}});WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var f=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==f&&this._updated()};WALK.StandardMaterial.prototype.pause=function(){console.assert(this.isAnimated);var f=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==f&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=
function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===THREE.DoubleSide},set:function(f){this.side=f?THREE.DoubleSide:THREE.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===
this.roughness&&!this.roughnessTexture}});Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(f){f!==this._hdrOutput&&(this._hdrOutput=f,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",{get:function(){return this._specularOff},set:function(f){f!==this._specularOff&&(this._specularOff=f,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},
set:function(f){f!==this._highlightMix&&(this._highlightMix=f,this.uniforms.highlightMix.value=f)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(f){this._cameraExposure=f;this.setUniform("exposure","f",Math.pow(2,f))}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(f){this.setUniform("cameraGamma","f",f)}});Object.defineProperty(WALK.StandardMaterial.prototype,
"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(f){var h=this;(this._baseColorTexture=f)?f.addLoadedListener(function(){h.configureTransparency();h.setUniforms();h._updated();h=f=null}):(h.setUniforms(),h._updated())}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",{get:function(){return this._baseColorTextureCorrection},set:function(f){this._baseColorTextureCorrection=f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(f){this._baseColorTextureContrast=f;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(f,h,k){this.baseColorTextureHslOffset.h=f;this.baseColorTextureHslOffset.s=h;this.baseColorTextureHslOffset.l=k;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(f){this._emissive=
f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(f){this._emissionStrength=f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"roughness",{get:function(){return this._roughness},set:function(f){this._roughness=f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},
set:function(f){this._metallic=f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(f){this._envMapProject=f;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(f){this._bumpScale=f;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setDoNotImport=function(f,h){this.doNotImport[f]=
h;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};WALK.StandardMaterial.prototype._setLightProbeUniforms=function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD")){var f=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*f);
this._mipLevel1=Math.min(this._mipLevel0+1,f);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW","v3",e),this.setUniform("envBoxMin","v3",e),this.setUniform("envBoxMax","v3",e));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.setUvOffsetAndScale=function(f,h,k,l){this._uvOffsetScale||(this._uvOffsetScale=new THREE.Vector4);
console.assert(!this.baseColorTexture||!this.baseColorTexture.parentTexture,"Can't set uv offset and scale if baseColor texture is in atlas");this._uvOffsetScale.set(f,h,k,l)};WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var f=!this.isLightProbeDisabled(),h=!1,k=this.roughnessTexture;this.condDefine(k&&k.loaded&&f,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture","t",k),h=!0):this.setUniform("roughness","f",this.roughness);k=this.metallicTexture;
this.condDefine(k&&k.loaded&&f,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",k),h=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(d.set(this.baseColor),d.offsetHSL(this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),k=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(k*
(d.r-this.baseColor.r-.5)+.5,k*(d.g-this.baseColor.g-.5)+.5,k*(d.b-this.baseColor.b-.5)+.5,k)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);k=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture){k=this._baseColorTexture.parentTexture;var l=this._baseColorTexture.uvOffsetScale}else k=this._baseColorTexture,l=g;this.condDefine(k&&k.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",
k),h=!0,this.setUniform("baseColorAtlasUvMod","v4",l),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor","c",this.chromaKeyColor),l=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*l.x),this._chromaKeyDeltaCoeff.y=
1/(1.22*l.y),this._chromaKeyDeltaCoeff.z=1/(1.22*l.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));k=this.bumpTexture;this.condDefine(k&&k.loaded&&f,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",k),h=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,"USE_PARALLAX_CORRECTION")&&(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),
this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));h&&this.setUniform("uvMod","v4",this._uvOffsetScale||g);this.condDefine(this.lightMapped,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(f,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix",
"f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(f){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?
"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};WALK.StandardMaterial.prototype.canMerge=function(f){if(this.type!==f.type||this.opacity!==f.opacity)return!1;if(this._baseColorTexture||f._baseColorTexture){if(this._baseColorTexture!==f._baseColorTexture||this.baseColorTextureCorrection!==f.baseColorTextureCorrection||this.baseColorTextureContrast!==f.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==f.baseColorTextureHslOffset.h||
this.baseColorTextureHslOffset.s!==f.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==f.baseColorTextureHslOffset.l||this._useAlphaInLowerHalf()!==f._useAlphaInLowerHalf()||(this._useChromaKey()?!(f._useChromaKey()&&this.chromaKeyColor.equals(f.chromaKeyColor)&&this._chromaKeyDelta.equals(f._chromaKeyDelta)):f._useChromaKey()))return!1}else if(!this.baseColor.equals(f.baseColor))return!1;if(this.emissive||f.emissive)if(this.emissive!==f.emissive||this.emissionStrength!==f.emissionStrength)return!1;
if(this.roughnessTexture||f.roughnessTexture){if(this.roughnessTexture!==f.roughnessTexture)return!1}else if(this.roughness!==f.roughness)return!1;if(this.metallicTexture||f.metallicTexture){if(this.metallicTexture!==f.metallicTexture)return!1}else if(this.metallic!==f.metallic)return!1;return(this.bumpTexture||f.bumpTexture)&&(this.bumpTexture!==f.bumpTexture||this.bumpScale!==f.bumpScale)||this.envMapProject!==f.envMapProject||this.doubleSided!==f.doubleSided||this.parallaxCorrection||f.parallaxCorrection?
!1:!0};WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(f,h){var k=!1;if(!this.isLightProbeDisabled()){var l=f.lightProbe;if(this._lastUsedLightProbeId!==l.id){k=!0;this._lastUsedLightProbeId=l.id;var m=this.envMapMirror?l.getMirrorTexture():this._haveTextureLod?l.getFilteredTexture():l.getFilteredTextureNoLod(this._mipLevel0);h.envMap.value=m;this._haveTextureLod||(h.envMap2.value=l.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(h.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);
this.envMapProject&&(l.isBoundingBoxEnabled()?(h.envMapPosW.value=l.position,h.envBoxMin.value=l.boxMin,h.envBoxMax.value=l.boxMax):(h.envBoxMin.value=e,h.envBoxMax.value=e))}}f=f.lightMap;this.lightMapped&&h.lightMap.value!==f&&(k=!0,h.lightMap.value=f);return k};WALK.StandardMaterial.prototype.setBaseColorRGB=function(f,h,k){this.baseColor.setRGB(f,h,k);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.setTexture=function(f,h){if(h){var k=this.baseColorTexture;k&&(h.wrapS=k.wrapS,
h.wrapT=k.wrapT,h.anisotropy=k.anisotropy)}this[f]=h||null;"baseColorTexture"===f?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===f&&(this._bumpScale=.001)};WALK.StandardMaterial.prototype.serialize=function(){var f=this,h=null;console.assert(!this.merged);this.baseColorTextureCorrection&&(h={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,
this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var k={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:h,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&
(k.chromaKeyEnabled=this.chromaKeyEnabled,k.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),k.chromaKeyDelta=this._chromaKeyDelta.toArray());h=function(l){var m=f[l];k[l]=m?m.serialize():null};h("baseColorTexture");h("roughnessTexture");h("metallicTexture");h("bumpTexture");return k}})();(function(){WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new THREE.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(a){return!1};WALK.StandardMaterialWater.prototype.hash=function(a){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},
set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=
function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),
baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("luma_fragment.glsl"),c=new THREE.Color(16777215);WALK.LumaMaterial=function(d){WALK.BaseMaterial.call(this,a,b);this.computeIncidentLuma=d;this.setUniform("lightMap","t",null);this.color=new THREE.Color(c);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;WALK.LumaMaterial.prototype.refreshPerObjectUniforms=
function(d,e){var g=d.lightMap,f=!1;e.lightMap.value!==g&&(e.lightMap.value=g,f=!0);d=this.computeIncidentLuma?c:d.material.baseColor;d.equals(this.color)||(this.color.copy(d),f=!0);return f}})();(function(){WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new THREE.Color(16777215);this.sharedBuffersMaster=new THREE.Color(255);this.sharedBuffersCopy=new THREE.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.DebugMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0}})();(function(){var a=WALK.getShader("equirect_sky_vertex.glsl"),b=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.depthWrite=!1;this.side=THREE.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(c){this.uniforms.map.value=c;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(c){this.condDefine(c,"HDR_OUTPUT")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(c){this.uniforms.colorMap.value=
c;this.condDefine(c,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(c){this.uniforms.exposure.value=Math.pow(2,c)}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(c){this.uniforms.cameraGamma.value=c}})})();(function(){WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=THREE.BackSide;this.uniforms={topColor:{type:"c",value:new THREE.Color(15135487)},bottomColor:{type:"c",value:new THREE.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(THREE.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=
Object.create(WALK.BaseMaterial.prototype);WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}})})();(function(){var a=WALK.getShader("object_distance_vertex.glsl"),b=WALK.getShader("object_id_fragment.glsl"),c=WALK.getShader("object_id_distance_fragment.glsl");WALK.ObjectDistanceMaterial=function(d){WALK.BaseMaterial.call(this,a,d?b:c);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=
function(d,e){e.objectId.value=d.visibilityId;return!0}})();(function(){var a=WALK.getShader("wireframe_vertex.glsl"),b=WALK.getShader("wireframe_fragment.glsl");WALK.WireframeMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.lineColor=c;this.setUniform("lineColor","c",c);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new THREE.Color(170);this.autoLightmapResolutionLineColor=new THREE.Color(43690);this.meshSelectedLineColor=
new THREE.Color(47872);this.meshSelectedSecondaryLineColor=new THREE.Color(13404160);this.transparent=!0;this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(c,d){var e=!1;null!==c.highlightMix&&void 0!==c.highlightMix&&c.highlightMix!==d.highlightMix.value&&(d.highlightMix.value=c.highlightMix,e=!0);return null!==c.selected&&void 0!==c.selected&&(c=!0===c.selected?this.meshSelectedLineColor:!0===c.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==c.node.lightmapResolution?this.customLightmapResolutionLineColor:
0<=c.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,d.lineColor.value!==c)?(d.lineColor.value=c,!0):e}})();(function(){var a=new WALK.InlineShader("attr vec3 envLookup;\nvarOut vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),b=new WALK.InlineShader("uniform samplerCube envMap;\nvarIn vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(c,d){var e=[],g=[],f=3*d,h=2*d;this.readCubeMapToBuffer=function(p){u.uniforms.envMap.value=p;q.set(!0,!1,!1);c.render(l,k,m);c.readPixels(f,h,n);q.restore();return n};this.dispose=function(){for(var p=0;6>p;p+=1)e[p].geometry.dispose();u.dispose();m.dispose();n=null};var k=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var l=new THREE.Scene;var m=c.createRenderTarget(f,h,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var n=new Uint8Array(4*f*h);var q=new WALK.AutoClearAlter(c);var u=new WALK.BaseMaterial(a,b);u.uniforms={envMap:{type:"t",value:null}};u.attributes={envLookup:{type:"v3",value:null}};(function(){for(var p=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],w=0;6>w;w+=1){var v=new THREE.PlaneBufferGeometry(d,d),
y=new Float32Array(12);v.addAttribute("envLookup",new THREE.BufferAttribute(y,3));for(var D=0;4>D;D+=1){var A=D,G=p[w][D];y[3*A]=G[0];y[3*A+1]=G[1];y[3*A+2]=G[2]}e[w]=new THREE.Mesh(v,u);l.add(e[w])}g[0]=[0,0];g[1]=[d,0];g[2]=[2*d,0];g[3]=[0,d];g[4]=[d,d];g[5]=[2*d,d]})();(function(p,w){p/=2;var v=w/2;k.left=-p;k.right=p;k.top=v;k.bottom=-v;k.updateProjectionMatrix();w=-p+d/2;p=v-d/2;for(v=0;v<e.length;v+=1)e[v].position.set(w+g[v][0],p-g[v][1],0)})(f,h)}})();(function(){WALK.ObjectVisibilityQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),e=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c),g=WALK.OBJECT_VISIBILITY_TARGET_SIZE,f=a.createRenderTarget(g,g,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1}),h=new Uint8Array(4*g*g),k=new WALK.AutoClearAlter(a),l=new WALK.ClearColorAlter(a),m=new THREE.Color(16777215);this.findVisibleObjects=function(n){var q=new Set,u=[];e.position.copy(n);
e.updateMatrixWorld();for(n=0;n<b.length;n+=1){var p=b[n];console.assert(!p.visibilityId);p.visibilityId=n;u.push(p)}k.set(!0,!0,!1);l.set(m);for(n=0;6>n;n+=1){a.renderMeshes(u,d,e.sideCameras[n],f);a.readPixels(g,g,h);p=h;for(var w=p.length,v=0;v<w;v+=4){var y=Math.round(65536*p[v]+256*p[v+1]+p[v+2]);16777215!==y&&q.add(y)}}l.restore();k.restore();u=[];q=$jscomp.makeIterator(q);for(n=q.next();!n.done;n=q.next())u.push(b[n.value]);for(q=0;q<b.length;q+=1)b[q].visibilityId=null;return u};this.dispose=
function(){d.dispose();f.dispose();h=f=null}};WALK.ObjectVisibilityQuery.prototype.constructor=WALK.ObjectDistanceQuery})();(function(){var a=WALK.getShader("aabb_query_vertex.glsl"),b=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(c){console.assert(0===
c||1===c||2===c);this.uniforms.axis.value=c}})})();(function(){var a=WALK.getShader("gaze_pointer_vertex.glsl"),b=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;Object.defineProperty(WALK.GazePointerMaterial.prototype,
"circleSpan",{set:function(c){console.assert(1>=c);this.uniforms.circleSpan.value=2*Math.PI*c-Math.PI}})})();(function(){var a=WALK.getShader("editor_light_vertex.glsl"),b=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.setUniform("color","c",c.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix")})();(function(){WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},
set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}})})();(function(){WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=THREE.DoubleSide;a.hideFromLightProbes=!0;return a}})();(function(){var a=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=a;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var b=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=b;this.hideFromLightProbes=!0};WALK.AnchorSpriteMaterial.prototype=
Object.create(WALK.StandardMaterial.prototype)})();(function(){var a=WALK.getShader("rotate_gizmo_material_vertex.glsl"),b=WALK.getShader("rotate_gizmo_material_fragment.glsl");WALK.RotateGizmoMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:c},gizmoPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};
Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(e){this.uniforms.sphereRadius.value=e}});this.opacity=d;this.setUniforms=
function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial})();(function(){WALK.Camera=function(){var a=this;THREE.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=!1;this._colorMap=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",
target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"colorMap",{get:function(){return this._colorMap},
set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,
"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=
a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});WALK.Camera.prototype.setFar=
function(a){this.far=a;this.updateProjectionMatrix();this._updated()};Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=
a;this._updated()}});WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed}};THREE.EventDispatcher.prototype.apply(WALK.Camera.prototype)})();(function(){WALK.LightInstance=function(b,c,d){this.light=b;this.position=c;this.rotation=d;this._directionW=new THREE.Vector3};WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var b=this.light.instances.indexOf(this);console.assert(-1!==b,"Light instance not found");return b},setPosition:function(b,c,d){this.position.set(b,c,d);this.light._updated()},setRotation:function(b,
c,d){this.rotation.yaw=WALK.normalizeRotation(b);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this.light._updated()},setRotationDeg:function(b,c,d){b=THREE.Math.degToRad(b);c=THREE.Math.degToRad(c);d=void 0===d?this.rotation.roll:THREE.Math.degToRad(d);this.setRotation(b,c,d)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var a="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(b){this._name=b.name;this._type=b.type||"spot";if(void 0!==b.strength)var c=b.strength;else a:{switch(this._type){case "point":case "spot":case "area":c=25;break a;case "sun":c=8;break a;default:console.assert(!1)}c=void 0}this._strength=c;if(void 0!==b.color)c=(new THREE.Color).fromArray(b.color);else a:{switch(this._type){case "point":case "spot":case "area":c=new THREE.Color(1,.88,.799);break a;case "sun":c=new THREE.Color(1,.8,.638);break a;default:console.assert(!1)}c=void 0}this._color=
c;if(void 0!==b.size)c=b.size;else a:{switch(this._type){case "point":case "spot":case "area":c=.1;break a;case "sun":c=.02;break a;default:console.assert(!1)}c=void 0}this._size=c;this._width=void 0!==b.width?b.width:.2;this._height=void 0!==b.height?b.height:.2;this._angle=void 0!==b.angle?b.angle:140;this._photometricProfile=void 0!==b.photometricProfile?b.photometricProfile:null;!0===b.doNotImport?this.doNotImport=!0:(this.doNotImport={},b.doNotImport&&WALK.copyProperties(b.doNotImport,a,this.doNotImport));
this.instances=[]};WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(b){for(var c=0;c<this.instances.length;c+=1)b(this.instances[c])},get name(){return this._name},set name(b){this._name=b;this._updated()},get type(){return this._type},set type(b){this._type=b;this._updated()},get size(){return this._size},set size(b){this._size=b;this._updated()},get width(){return this._width},set width(b){this._width=b;this._updated()},get height(){return this._height},set height(b){this._height=
b;this._updated()},get angle(){return this._angle},set angle(b){this._angle=b;this._updated()},get color(){return this._color},setColorRGB:function(b,c,d){this._color.setRGB(b,c,d);this._updated()},get strength(){return this._strength},set strength(b){this._strength=b;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(b){this._photometricProfile=b;this._updated()},setDoNotImport:function(b,c){this.doNotImport[b]=c;this._updated()},addInstance:function(b,
c){c=void 0===c?[0,-90,0]:c;b=(new THREE.Vector3).fromArray(b);c=(new WALK.Euler).setFromDegTriple(c);c=new WALK.LightInstance(this,b,c);this.instances.push(c);this.dispatchEvent({type:"instanceAdded",instance:c,target:this})},removeInstance:function(b){WALK.removeFromArray(b,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:b,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,
size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(b){return b.serialize()})}},_updated:function(){this.dispatchEvent({type:"updated",target:this})}};THREE.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(b,c){for(var d=1,e=0;e<b.length;e+=1)for(var g=b[e],f=0;f<g.instances.length;f+=1,d+=1)c(g,g.instances[f],d)}})();(function(){WALK.LightProbe=function(a){this.id=a.id;this.position=new THREE.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new THREE.Vector3;this.boxMax=new THREE.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};WALK.LightProbe.prototype={constructor:WALK.LightProbe,
setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},disableBoundingBox:function(){this._boxEnabled=
!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();this._mirrorCubeTexture=
a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-.1&&(c=this.boxMax.z-
.1);this.boxMin.set(a,b,c)},isBoxMinValid:function(a,b,c){return a>this.boxMax.x-.1||b>this.boxMax.y-.1||c>this.boxMax.z-.1?!1:!0},isBoxMaxValid:function(a,b,c){return a<this.boxMin.x+.1||b<this.boxMin.y+.1||c<this.boxMin.z+.1?!1:!0},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);
this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&
this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=null)}};THREE.EventDispatcher.prototype.apply(WALK.LightProbe.prototype)})();(function(){function a(e){return null!==e&&void 0!==e}function b(e){e.configure()}function c(e){e.visitSubtree(b)}function d(e){var g=new THREE.Vector3(Infinity,Infinity,Infinity),f=new THREE.Matrix4,h=new THREE.Matrix4,k=new THREE.Matrix4,l,m=new THREE.Vector3,n=new WALK.Euler;return function(q){if(g.equals(q))return f;g.copy(q);if(!l){l=new THREE.Vector3;var u=new THREE.Box3;e.visitSubtree(function(p){(p=p.mesh)&&u.union(p.geometry.boundingBox)});u.center(l);k.elements[12]=-l.x;k.elements[13]=-l.y;
k.elements[14]=-l.z}m.copy(q).sub(l).normalize();n.setFromDirection(m);"yaw"===e.faceCamera&&(n.pitch=0);h.makeRotationFromEuler(n);f.identity().setPosition(l).multiply(h).multiply(k);return f}}WALK.NodeConfig=function(e){var g=this;this.name=e.name;this._editable=e.editable||!1;this._setsDisableCollisions=a(e.disableCollisions);this._disableCollisions=e.disableCollisions||!1;this._setsHideInViews=a(e.hideInViews);this.hideInViews=null;e.hideInViews&&(this.hideInViews=e.hideInViews,this.hideInViews.sort());
this._lightmapResolution=(this._setsLightmapResolution=a(e.lightmapResolution))?e.lightmapResolution:null;this._ground=a(e.ground)?e.ground:!1;this._faceCamera=e.faceCamera||null;this._isolateShadows=a(e.isolateShadows)?e.isolateShadows:!1;this.nodes=[];var f={type:"updated",target:this};this._updated=function(){return g.dispatchEvent(f)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;THREE.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);WALK.NodeConfig.prototype._configUpdated=
function(){this.nodes.forEach(c);this._updated()};WALK.NodeConfig.prototype.addNode=function(e){this.nodes.push(e)};WALK.NodeConfig.prototype.isOnHideInViews=function(e){return-1!==this.hideInViews.indexOf(e)};WALK.NodeConfig.prototype.addToHideInViews=function(e){console.assert(this.setsHideInViews);console.assert(!this.isOnHideInViews(e));this.hideInViews.push(e);this._updated()};WALK.NodeConfig.prototype.removeFromHideInViews=function(e){if(this.hideInViews)for(var g=0;g<this.hideInViews.length;)this.hideInViews[g]===
e?this.hideInViews.splice(g,1):g+=1;this._updated()};WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,isolateShadows:this.isolateShadows?!0:null}};Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},
set:function(e){this._setsDisableCollisions=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(e){console.assert(this._setsDisableCollisions);this._disableCollisions=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||null!==this.faceCamera},set:function(e){this._editable=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"ground",{get:function(){return this._ground},set:function(e){this._ground=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(e){this._faceCamera=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(e){this._setsLightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(e){console.assert(this._setsLightmapResolution);this._lightmapResolution=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"isolateShadows",{get:function(){return this._isolateShadows},set:function(e){this._isolateShadows=e;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(e){this._setsHideInViews=
e;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});WALK.Node=function(e,g,f){this.id=f.id;this.initialLightProbeId=void 0===f.lightProbeId?null:f.lightProbeId;this.parent=e;this.config=g;this.children=[];this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.getFaceCameraMatrix=this.faceCamera=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;g.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;WALK.Node.prototype.configure=
function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.config.faceCamera?(this.faceCamera=this.config.faceCamera,this.getFaceCameraMatrix=d(this)):(this.parent?(this.faceCamera=this.parent.faceCamera,this.getFaceCameraMatrix=this.parent.getFaceCameraMatrix):this.getFaceCameraMatrix=this.faceCamera=null,this.mesh&&(this.mesh.matrixWorld=null));this.hideInViews=this.config.setsHideInViews?
this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editable=this.config.editable;this.parent&&(this.editable=this.editable||this.parent.editable)};WALK.Node.prototype.visitSubtree=function(e){e(this);
var g=this.children;if(g)for(var f=0;f<g.length;f+=1)g[f].visitSubtree(e)};WALK.Node.prototype.facesInSubtree=function(){var e=this;null===e._facesCnt&&(e._facesCnt=0,e.visitSubtree(function(g){g.mesh&&(e._facesCnt+=g.mesh.geometry.vertexCnt/3)}));return e._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!1)})};WALK.Node.prototype.show=function(){this.visitSubtree(function(e){e.mesh&&(e.mesh.visible=!0)})};WALK.Node.prototype.serialize=function(){var e=
{id:this.id,children:this.children.map(function(f){return f.serialize()})},g=this.mesh;g&&(e.lightProbeId=g.lightProbe?g.lightProbe.id:null,e.mesh=!0);return e};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(e){this.visitSubtree(function(g){g.mesh&&(g.mesh.highlightMix=e)})}});Object.defineProperty(WALK.Node.prototype,"selected",{set:function(e){this.visitSubtree(function(g){g.mesh&&
(g.mesh.selected=e)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(e){this.visitSubtree(function(g){g.mesh&&(g.mesh.selectedSecondary=e)})}})})();(function(){WALK.Mesh=function(a,b,c){this._visible=!0;THREE.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=
null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(THREE.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;WALK.Mesh.prototype.updateMatrixWorld=function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};
WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};WALK.Mesh.prototype.update=function(a,b){this.node.faceCamera&&(this.matrixWorld=this.node.getFaceCameraMatrix(b))};Object.defineProperty(WALK.Mesh.prototype,"hideInViews",
{get:function(){return this.node.hideInViews},set:function(a){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});Object.defineProperty(WALK.Mesh.prototype,"isAnimated",{get:function(){return null!==this.node.faceCamera}});WALK.MergedMesh=function(a,b){this._visible=!0;THREE.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=
!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.center=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=
function(a){this.logicalMeshes.push(a);a._mergedMesh=this};Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}});Object.defineProperty(WALK.MergedMesh.prototype,"isAnimated",{get:function(){return!1}})})();(function(){WALK.SkyMesh=function(a,b,c,d){var e=this;THREE.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var g={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(g)}};WALK.SkyMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?
(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation.y)},set:function(a){a=THREE.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});
Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}})})();(function(){var a=1E3,b={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};WALK.View=function(c){var d=this;void 0===c&&(c=b);this.id=void 0!==c.id?c.id:a++;this.name=c.name||"view"+this.id;this.internal=c.internal||!1;c.position&&(this.position=new THREE.Vector3(c.position[0],c.position[1],c.position[2]));this.rotation=new WALK.Euler(WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[0])),WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[1])),
0);this.hideFromMenu=c.hideFromMenu||!1;this.sky=c.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=c.mode||"fps";this.distance=c.distance;this.minDistance=c.minDistance;this.maxDistance=c.maxDistance;this.panPrimary=c.panPrimary;this.noPan=c.noPan;this.noRotate=c.noRotate;this.noPitchRotate=c.noPitchRotate;this.minUpAngle=void 0===c.minUpAngle?-Math.PI/2:c.minUpAngle;this.maxUpAngle=void 0===c.maxUpAngle?Math.PI/2:c.maxUpAngle;this.minSideAngle=void 0===c.minSideAngle?-Math.PI:c.minSideAngle;this.maxSideAngle=
void 0===c.maxSideAngle?Math.PI:c.maxSideAngle;c.target&&(this.target=new THREE.Vector3(c.target[0],c.target[1],c.target[2]));this.fov=c.fov;var e={type:"updated",target:this};this._updated=function(){return d.dispatchEvent(e)}};WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?
this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(c){this.name=c;this._updated()},setYaw:function(c){this.rotation.yaw=c;this._updated()},setMinUpAngle:function(c){c!==this.minUpAngle&&(this.minUpAngle=c,this._updated())},setMaxUpAngle:function(c){c!==this.maxUpAngle&&(this.maxUpAngle=c,this._updated())},setMinSideAngle:function(c){c!==this.minSideAngle&&(this.minSideAngle=c,this._updated())},setMaxSideAngle:function(c){c!==this.maxSideAngle&&
(this.maxSideAngle=c,this._updated())},setHideFromMenu:function(c){c!==this.hideFromMenu&&(this.hideFromMenu=c,this._updated())},serialize:function(){var c=this,d={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(d.position=this.position.toArray());this.target&&(d.target=this.target.toArray());-Infinity!==this.minSideAngle&&(d.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(d.maxSideAngle=
this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(e){void 0!==c[e]&&(d[e]=c[e])});return d}};THREE.EventDispatcher.prototype.apply(WALK.View.prototype)})();(function(){WALK.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.textureMatrix=new THREE.Matrix4;this.mirrorWorldPosition=new THREE.Vector3;
this.mirrorRotationMatrix=new THREE.Matrix4;this.mirrorNormal=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.cameraRotationMatrix=new THREE.Matrix4;this.mirrorToCamera=new THREE.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(THREE.Object3D.prototype);WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();
a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};WALK.Mirror.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};WALK.Mirror.prototype.updateTextureMatrix=
function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector4,e=new THREE.Plane,g=new THREE.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);
this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);e.setFromNormalAndCoplanarPoint(this.mirrorNormal,
this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var f=this.mirrorCamera.projectionMatrix;g.x=(Math.sign(d.x)+f.elements[8])/f.elements[0];g.y=(Math.sign(d.y)+f.elements[9])/f.elements[5];g.z=-1;g.w=(1+f.elements[10])/f.elements[14];d.multiplyScalar(2/d.dot(g));f.elements[2]=d.x;f.elements[6]=d.y;f.elements[10]=d.z+1-this.clipBias;f.elements[14]=d.w}}();WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=
c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();
a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)}})();(function(){function a(g,f,h){h=h||"id";for(var k=0;k<g.length;k+=1)if(g[k].hasOwnProperty(h)&&g[k][h]===f)return!1;return!0}function b(g,f,h){h=h||"id";for(var k=0;k<g.length;k+=1)if(g[k][h]===f)return g[k];return null}function c(g,f){g=g.name.toUpperCase();f=f.name.toUpperCase();return g<f?-1:g>f?1:0}function d(g,f,h){for(var k=g[f],l=h>f?1:-1;f!==h;f+=l)g[f]=g[f+l];g[h]=k}var e=0;WALK.Scene=function(g){function f(){n.dispatchEvent(q)}function h(){n.dispatchEvent(u);f()}function k(p){p=p.target;
var w=n._mainAnimatedMaterials.has(p);p.isAnimated&&!w?n._mainAnimatedMaterials.add(p):!p.isAnimated&&w&&n._mainAnimatedMaterials.delete(p);f()}function l(){n._animatedMeshes.length=0;for(var p=$jscomp.makeIterator(n.gpuMeshes),w=p.next();!w.done;w=p.next())w=w.value,w.isAnimated&&n._animatedMeshes.push(w);f()}function m(p){n._nodeLookup[p.id]=p}var n=this,q={type:"updated",target:this},u={type:"anyViewUpdated",target:this};this.id=e++;this._headLight=!1;this.threeScene=new THREE.Scene;this.autoAddLightProbes=
!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=g;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._animatedMeshes=[];this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._nodeLookup=
{};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new THREE.Box3;this._sumLogicalMeshCenter=new THREE.Vector3;this._logicalNonemptyMeshCount=0;this._center=new THREE.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(p){return p.serialize()}),
nodeConfigs:this.nodeConfigs.map(function(p){return p.serialize()}),nodes:this.nodes.map(function(p){return p.serialize()}),lights:this.lights.map(function(p){return p.serialize()}),lightProbes:this.lightProbes.map(function(p){return p.serialize()}),cameraVolumes:this.cameraVolumes.map(function(p){return p.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(p){return!p.internal}).map(function(p){return p.serialize()}),skies:this.skyMeshes.filter(function(p){return p.name!==WALK.DEFAULT_SKY_NAME}).map(function(p){return p.serialize()})}};
this.addMaterial=function(p){this.materials.push(p);p.addEventListener("updated",k);p.isAnimated&&this._mainAnimatedMaterials.add(p);this.camera.colorMapReady()&&void 0!==p.colorMap&&(p.colorMap=this.camera.colorMap);void 0!==p.cameraExposure&&(p.cameraExposure=this.camera.exposure);void 0!==p.cameraGamma&&(p.cameraGamma=this.camera.gamma);void 0!==p.headLight&&(p.headLight=this.headLight)};this.replaceMaterial=function(p,w){var v=this.materials.indexOf(p);void 0===this._disabledMaterials[v]&&(this._disabledMaterials[v]=
new Map);this._disabledMaterials[v].set(p.type,p);var y=this._disabledMaterials[v].get(w);y||(y=WALK.createMaterialOfType(w),y.addEventListener("updated",k),y.name=p.name,0===this.lightProbes.length&&(y.disableLightProbeTmp=!0));this.materials[v]=y;f();for(w=0;w<this.gpuMeshes.length;w+=1)this.gpuMeshes[w].material===p&&(this.gpuMeshes[w].material=y);p.isAnimated&&this._mainAnimatedMaterials.delete(p);y.isAnimated&&this._mainAnimatedMaterials.add(y);this._sortedMaterials=null;y.setUniforms();return y};
this.addNodeConfig=function(p){this.nodeConfigs.push(p);this._nodeConfigsLookup[p.name]=p;p.addEventListener("updated",l)};this.findNodeConfig=function(p){return this._nodeConfigsLookup.hasOwnProperty(p)?this._nodeConfigsLookup[p]:null};this.addNode=function(p){this.nodes.push(p);p.visitSubtree(m)};this.findNode=function(p){return this._nodeLookup[p]};this.visitAllNodes=function(p){for(var w=0;w<this.nodes.length;w+=1)this.nodes[w].visitSubtree(p)};this.visitMeshesWithMaterial=function(p,w){this.visitAllNodes(function(v){(v=
v.mesh)&&v.material===p&&w(v)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(c));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var p=new THREE.Vector3;return function(w){if(w.logicalMeshes)for(var v=0;v<w.logicalMeshes.length;v+=1){var y=w.logicalMeshes[v].geometry.boundingBox;y.empty()||(y.center(p),this._sumLogicalMeshCenter.add(p),++this._logicalNonemptyMeshCount)}else w=w.geometry.boundingBox,w.empty()||
(w.center(p),this._sumLogicalMeshCenter.add(p),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(p){p.isAnimated&&this._animatedMeshes.push(p);if(p.material.planarReflector){var w=new WALK.Mirror(this.threeScene,this.camera,{clipBias:0,color:8355711,debugMode:!1});w.material.name=p.material.name;var v=p.geometry;console.assert(v.boundingBox);var y=v.boundingBox,D=
Math.sqrt(Math.pow(y.max.x-y.min.x,2)+Math.pow(y.max.z-y.min.z,2)),A=y.max.y-y.min.y;D&&A?(D=new THREE.Mesh(new THREE.PlaneBufferGeometry(D,A),w.material),D.rotation.y=Math.atan2(v.normals[0],v.normals[2]),y.center(D.position),D.geometry.boundingBox=y,D.add(w),w=D):(WALK.log("mirror with 0 dimension"),w=null);this.mirrors.push(w.children[0]);this.addAuxiliaryObject(w)}else this.addAuxiliaryObject(p);this.gpuMeshes.push(p);this.boundingBox.union(p.geometry.boundingBox);this._updateSceneCenterWithGpuMesh(p)};
this.addAuxiliaryObject=function(p,w){w=void 0===w?!1:w;this.threeScene.add(p);w&&this._animatableAuxiliaryObjects.add(p)};this.removeAuxiliaryObject=function(p){this.threeScene.remove(p);this._animatableAuxiliaryObjects.delete(p)};this.addSkyMesh=function(p){var w=p.material;this.skyMeshes.push(p);this.camera.colorMapReady()&&(w.colorMap=this.camera.colorMap);void 0!==w.cameraExposure&&(w.cameraExposure=this.camera.exposure);void 0!==w.cameraGamma&&(w.cameraGamma=this.camera.gamma);p.addEventListener("updated",
f);this.dispatchEvent({type:"skyMeshAdded",skyMesh:p,target:this})};this.removeSkyMesh=function(p){WALK.removeFromArray(p,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:p,target:this});p.geometry.dispose();p.material.map&&p.material.map.dispose();p.material.dispose()};this.findSkyMesh=function(p){return b(this.skyMeshes,p,"name")};this.addLight=function(p){console.assert(a(this.lights,p.name,"name"));this.lights.push(p);p.addEventListener("updated",f);p.addEventListener("instanceAdded",
f);p.addEventListener("instanceRemoved",f);f();this.dispatchEvent({type:"lightAdded",light:p,target:this})};this.removeLight=function(p){WALK.removeFromArray(p,this.lights);f();this.dispatchEvent({type:"lightRemoved",light:p,target:this})};this.addLightProbe=function(p){console.assert(a(this.lightProbes,p.id));this.lightProbes.push(p);p.addEventListener("positionUpdated",f);p.addEventListener("boundsUpdated",f);f();this.dispatchEvent({type:"lightProbeAdded",lightProbe:p,target:this})};this.removeLightProbe=
function(p){WALK.removeFromArray(p,this.lightProbes);for(var w=0;w<this.gpuMeshes.length;w+=1)this.gpuMeshes[w].lightProbe===p&&(this.gpuMeshes[w].lightProbe=null);f();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:p,target:this});p.dispose()};this.findLightProbe=function(p){return b(this.lightProbes,p)};this.closestLightProbe=function(p){for(var w=null,v=Infinity,y=$jscomp.makeIterator(this.lightProbes),D=y.next();!D.done;D=y.next()){D=D.value;var A=p.distanceTo(D.position);A<v&&(v=A,w=
D)}return w};this.addCameraVolume=function(p){console.assert(a(this.cameraVolumes,p.id));this.cameraVolumes.push(p);p.addEventListener("updated",f);f();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:p,target:this})};this.removeCameraVolume=function(p){WALK.removeFromArray(p,this.cameraVolumes);f();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:p,target:this});p.dispose()};this.findCameraVolume=function(p){return b(this.cameraVolumes,p)};this.shiftCameraVolume=function(p,w){d(this.cameraVolumes,
this.cameraVolumes.indexOf(p),w);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:p,target:this})};this.findView=function(p){return b(this.views,p)};this.findViewByName=function(p){return b(this.views,p,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(p){return!p.hideFromMenu})};this.addView=function(p){console.assert(a(this.views,p.id));this.views.push(p);p.addEventListener("updated",h);f();this.dispatchEvent({type:"viewAdded",view:p,target:this})};this.removeView=
function(p){WALK.removeFromArray(p,this.views);this.nodeConfigs.forEach(function(w){w.removeFromHideInViews(p.id)});f();this.dispatchEvent({type:"viewRemoved",view:p,target:this})};this.shiftView=function(p,w){d(this.views,this.views.indexOf(p),w);this.dispatchEvent({type:"viewShifted",view:p,target:this})};this.hasLightMap=function(){return void 0!==WALK.find(this.materials,function(p){return p.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){for(var p=0,w=0;w<this.skyMeshes.length;w+=
1){var v=this.skyMeshes[w];v.autoPosition&&v.position.copy(this.center);if(this.boundingBox.empty())var y=0;else{var D=this.boundingBox,A=v.position;y=Math.max(Math.abs(D.min.x-A.x),Math.abs(D.max.x-A.x));var G=Math.max(Math.abs(D.min.y-A.y),Math.abs(D.max.y-A.y));D=Math.max(Math.abs(D.min.z-A.z),Math.abs(D.max.z-A.z));y=Math.sqrt(y*y+G*G+D*D)}y+=WALK.SKY_DISTANCE_TO_SCENE;v.radius=y;p=Math.max(p,y)}this.camera.setFar(Math.max(this.camera.far,2*p));WALK.log("Camera far set to "+this.camera.far)};
g.addEventListener("colorMapUpdated",function(){var p=g.colorMap;n.materials.forEach(function(w){void 0!==w.colorMap&&(w.colorMap=p);w.setUniforms()});n.skyMeshes.forEach(function(w){w.material.colorMap=p});f()});g.addEventListener("updated",f);this.disableLightProbesForMaterials=function(){for(var p=0;p<this.materials.length;p+=1)this.materials[p].disableLightProbeTmp=!0,this.materials[p].setUniforms()};this.enableLightProbesForMaterials=function(){for(var p=0;p<this.materials.length;p+=1)this.materials[p].disableLightProbeTmp=
!1,this.materials[p].setUniforms()};this.getAnimatedMaterials=function(){var p=!1,w=new Map;return function(){function v(I){I instanceof THREE.Mesh&&I.material.isAnimated&&w.set(I.material,y)}for(var y=!p,D=$jscomp.makeIterator(n._mainAnimatedMaterials),A=D.next();!A.done;A=D.next())w.set(A.value,y);D=$jscomp.makeIterator(n._animatableAuxiliaryObjects);for(A=D.next();!A.done;A=D.next())A.value.traverse(v);D=$jscomp.makeIterator(w);for(A=D.next();!A.done;A=D.next()){A=$jscomp.makeIterator(A.value);
var G=A.next().value;A.next().value===p&&w.delete(G)}p=y;return w.keys()}}();this.getAnimatedMeshes=function(){return this._animatedMeshes};g.addEventListener("exposureUpdated",function(p){var w=g.exposure;n.materials.forEach(function(v){void 0!==v.cameraExposure&&(v.cameraExposure=w)});n.skyMeshes.forEach(function(v){v=v.material;void 0!==v.cameraExposure&&(v.cameraExposure=w)})});g.addEventListener("gammaUpdated",function(p){var w=g.gamma;n.materials.forEach(function(v){void 0!==v.cameraGamma&&
(v.cameraGamma=w)});n.skyMeshes.forEach(function(v){v=v.material;void 0!==v.cameraGamma&&(v.cameraGamma=w)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(g){g!==this._headLight&&(this._headLight=g,this.materials.forEach(function(f){f.headLight=g;f.setUniforms()}))}};THREE.EventDispatcher.prototype.apply(WALK.Scene.prototype);WALK.createMaterialOfType=function(g){return"water"===g?new WALK.StandardMaterialWater:
new WALK.StandardMaterial}})();(function(){WALK.BufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}}})();(function(){function a(b,c,d,e,g){d=new WALK.BufferAttribute(d,e,g||0);b.addAttribute(c,d)}THREE.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var b=this.getAttribute("position").length/3,c=new Float32Array(b),d=0;d<b;d+=1)c[d]=d%3;this.addAttribute("order",new WALK.BufferAttribute(c,1))}};THREE.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var b=this.getAttribute("normal");
console.assert(!b.buffer);b=b.array;for(var c=b.length/3,d=WALK.DETECTOR.ios?new Int16Array(2*c):new Int8Array(2*c),e=0;e<c;e+=1){var g=3*e,f=2*e,h=Math.atan2(b[g+1],b[g])/Math.PI;d[f]=WALK.Math.toSnorm8(2*(Math.acos(b[g+2])/Math.PI-.5));d[f+1]=WALK.Math.toSnorm8(h)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(d,2))};THREE.BufferGeometry.prototype.changePosition=function(b){var c=this.getAttribute("position"),d=c.length/3;c=c.array;for(var e=0;e<3*d;e+=
3)c[e]+=b.x,c[e+1]+=b.y,c[e+2]+=b.z};THREE.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};WALK.Geometry=function(){THREE.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs1=this.uvs0=this.normals=this.vertices=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this.gpuSize=0};WALK.Geometry.prototype=
Object.create(THREE.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;WALK.Geometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.vertices);b&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;this.normals=WALK.DETECTOR.ios?
new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(a(this,"index",this.index,1),this.index=null);a(this,"position",this.vertices,3);this.vertices=null;a(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};WALK.Geometry.prototype.addUv0Attribute=
function(){a(this,"uv",this.uvs0,2);this.uvs0=null};WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){a(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;WALK.InstancedGeometry=function(b,c){THREE.BufferGeometry.call(this);this.parent=b;this.ownsGpuBuffers=
c;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.transforms0);this.parent.vertices||
this.parent.allocateCoreBuffers(b);b=4*this.instanceCount;this.transforms0=new Float32Array(b);this.transforms1=new Float32Array(b);this.transforms2=new Float32Array(b);this._gpuSize+=12*b};WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var b=$jscomp.makeIterator(Object.keys(this.parent.attributes)),c=b.next();!c.done;c=b.next())c=c.value,this.addAttribute(c,this.parent.attributes[c]);a(this,"t0",this.transforms0,
4,1);a(this,"t1",this.transforms1,4,1);a(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);this.parent.uvs1||
this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);a(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,
"index",{get:function(){return this.parent.index}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(WALK.InstancedGeometry.prototype,
"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(b){this.parent.vertexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(b){this.parent.indexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:
this._gpuSize}});WALK.SubGeometry=function(b,c,d,e,g,f,h){THREE.BufferGeometry.call(this);this.indexCnt=b;this.vertexCnt=c;this.parent=d;this.vertexOffset=g;this.indexOffset=e;this.boundingBox=f;this.boundingSphere=h;this.isInstanced=d.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});
Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()}})();(function(){function a(g){g.dispatchEvent({type:"updated",target:g})}var b=null,c=null,d=new THREE.Vector3,e=new THREE.Quaternion;WALK.CameraVolume=function(g){this.id=g.id;this.name=g.name;this._type=g.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new THREE.Vector3).fromArray(g.position);this.rotation=(new WALK.Euler).setFromDegTriple(g.rotation);this.scale=(new THREE.Vector3).fromArray(g.scale);this.exposure=g.exposure;this.gamma=g.gamma;this._inverse=
new THREE.Matrix4;this._inverseDirty=!0};WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){b||(b=new THREE.BoxBufferGeometry(2,2,2),b.addTriangleOrderAttribute(),b.convertNormalsToSpherical(),c=new THREE.IcosahedronBufferGeometry(1,2),c.addTriangleOrderAttribute(),c.convertNormalsToSpherical());return"sphere"===this._type?c:b},setName:function(g){this.name=g;a(this)},setPosition:function(g,f,h){this.position.set(g,
f,h);this._inverseDirty=!0;a(this)},setRotation:function(g,f,h){this.rotation.yaw=WALK.normalizeRotation(g);this.rotation.pitch=WALK.normalizeRotation(f);this.rotation.roll=WALK.normalizeRotation(h);this._inverseDirty=!0;a(this)},setRotationDeg:function(g,f,h){g=THREE.Math.degToRad(g);f=THREE.Math.degToRad(f);h=THREE.Math.degToRad(h);this.setRotation(g,f,h)},setScale:function(g,f,h){this.scale.set(g,f,h);this._inverseDirty=!0;a(this)},setExposure:function(g){this.exposure=g;a(this)},setGamma:function(g){this.gamma=
g;a(this)},worldCoordinatesInside:function(g){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,e.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));d.copy(g).applyMatrix4(this._inverse);return"sphere"===this._type?1>=d.lengthSq():1>=Math.abs(d.x)&&1>=Math.abs(d.y)&&1>=Math.abs(d.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),scale:this.scale.toArray(),
exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};THREE.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype)})();(function(){var a=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),b=null,c,d,e=null,g,f=new THREE.Color,h=new Map;WALK.Anchor=function(k,l){b&&e===k.id||(b=new THREE.SphereBufferGeometry(1,32,16),b.convertNormalsToSpherical(),c=new THREE.PlaneBufferGeometry(1,1),c.convertNormalsToSpherical(),d=new THREE.CylinderBufferGeometry(.5,.5,1,16,1),g||(g=new THREE.Matrix4,g.makeRotationX(Math.PI/2)),d.applyMatrix(g),d.convertNormalsToSpherical(),e=k.id);var m=new THREE.Vector3;m.fromArray(l.position);
var n=$jscomp,q=n.makeIterator;var u=l.icon&&WALK.ICONS[l.icon],p=u?u.value:l.text,w=u?u.fontFamily:"Noto Sans";var v=l.color||"#4c9ed9";var y=l.opacity;void 0===y||1<=y||(f.setStyle(v),v="rgba("+(255*f.r|0)+","+(255*f.g|0)+","+(255*f.b|0)+","+y+")");var D=v;y=l.textColor||"#ffffff";v=void 0!==l.opacity&&1>l.opacity;var A="sphere"===l.type,G=A||void 0===l.textMargin?20:l.textMargin;u=[u||"",p,w,D,y,A,G,l.borderRadius||0,v].join("_");var I=h.get(u);if(I)I.usedTimes++,v=[u,I.texture];else{I=document.getElementById("anchor-canvas");
I||(I=document.createElement("canvas"),I.id="anchor-canvas");if(A)G=I,A=p,G.width=512,G.height=512,G=G.getContext("2d"),G.font="700 128px "+w,A=G.measureText(A).width,A=Math.floor(a/A*128),A=Math.min(A,a),G.font="700 "+A+"px "+w,w=G;else{A=$jscomp;var H=A.makeIterator,P=I,U=WALK.SPRITE_ANCHOR_FONT_SIZE,fa=P.getContext("2d");fa.font="700 "+U+"px "+w;for(var C=p,Q=p.length-1,da;;){da=fa.measureText(C).width;da+=2*G;if(1024>=da)break;C=p.substring(0,Q)+"...";--Q}P.width=da;P.height=1.5*U;fa=P.getContext("2d");
fa.font="700 "+U+"px "+w;p=H.call(A,[fa,C]);w=p.next().value;p=p.next().value}w.fillStyle=D;l.borderRadius?(D=w,G=I.width,A=I.height,H=.5*l.borderRadius*Math.min(G,A),D.beginPath(),D.moveTo(0+H,0),D.lineTo(0+G-H,0),D.quadraticCurveTo(0+G,0,0+G,0+H),D.lineTo(0+G,0+A-H),D.quadraticCurveTo(0+G,0+A,0+G-H,0+A),D.lineTo(0+H,0+A),D.quadraticCurveTo(0,0+A,0,0+A-H),D.lineTo(0,0+H),D.quadraticCurveTo(0,0,0+H,0),D.closePath(),D.fill()):w.fillRect(0,0,I.width,I.height);w.fillStyle=y;w.textAlign="center";w.textBaseline=
"middle";w.shadowColor="black";w.shadowBlur=16;w.fillText(p,I.width/2,I.height/2);y=new WALK.Texture(I);y.width=I.width;y.height=I.height;y.hasAlpha=v;y.minFilter=GLC.LINEAR;y.loaded=!0;y.needsUpdate=!0;h.set(u,{usedTimes:1,texture:y});v=[u,y]}n=q.call(n,v);q=n.next().value;n=n.next().value;this._textureSignature=q;if("sphere"===l.type)q=b,v=new WALK.AnchorMaterial,y=k.closestLightProbe(m),v.bumpTexture=n,v.disableLightProbe=null===y||!y.texturesReady(),v.headLight=!0,k=[l.radius,l.radius,l.radius];
else{q=c;v=new WALK.AnchorSpriteMaterial;y=null;v.disableLightProbe=!0;v.headLight=!1;v.specularOff=1;k=[n.width/n.height*l.height,l.height,1];var aa=new THREE.Mesh(d,null)}v.baseColorTexture=n;v.configureTransparency();v.setUniforms();THREE.Mesh.call(this,q,v);this.position.copy(m);this.scale.fromArray(k);this.updateMatrixWorld(!0);this.lightProbe=y;aa?(aa.position.copy(m),m=Math.max(k[0],k[1]),aa.scale.fromArray([m,m,l.height]),aa.updateMatrixWorld(!0),this.colliderMesh=aa):this.colliderMesh=this;
this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(THREE.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var k=this.material;k.dispose();var l=this._textureSignature,m=h.get(l),n=m.texture;console.assert(k.baseColorTexture===n);m.usedTimes--;0===m.usedTimes&&(n.dispose(),h.delete(l))};WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var k=this.material;
k.disableLightProbe=!1;k.setUniforms()}}})();(function(){function a(d){return(d.boundingBox.max.z-d.boundingBox.min.z)/2}var b=null,c={sphere:null,head:null,torso:null,displayPortrait:null,displayLandscape:null,cylinder:null};WALK.setAvatarGeometries=function(d){for(var e=$jscomp.makeIterator(["head","torso","displayPortrait","displayLandscape"]),g=e.next();!g.done;g=e.next())g=g.value,d.has(g)||console.assert(!1,'Avatar "'+g+'" geometry is missing'),c[g]=d.get(g)};WALK.Avatar=function(d,e,g){THREE.Object3D.call(this);this.uuid=e;this.displayName=
g.displayName;this._scene=d;this._lastLightProbeCheckPosition=new THREE.Vector3(0,0,0);this.colliders=[];c.plane&&b===d.id||(c.sphere=new THREE.SphereBufferGeometry(.08,32,16),c.sphere.convertNormalsToSpherical(),c.cylinder=new THREE.CylinderBufferGeometry(.005,.005,1,3),c.cylinder.convertNormalsToSpherical(),b=d.id);this._haveLightProbe=0<this._scene.lightProbes.length;var f=g.color,h=this._haveLightProbe;e=new WALK.StandardMaterial;e.baseColor.setStyle(f).convertGammaToLinear();e.roughness=.7;e.metallic=
1;e.highlight=new THREE.Color(16777215);e.highlightMix=0;h||(e.disableLightProbe=!0,e.headLight=!0);e.setUniforms();this._body=new THREE.Object3D;this._head=new THREE.Mesh(c.head,e);this._head.rotation.order="ZXY";this._torso=new THREE.Mesh(c.torso,e);this._torso.position.z=-(c.torso.boundingBox.max.z+a(c.head)+.05);f=g.displayName;h=g.color;this._displayNameAnchor=new WALK.Anchor(d,{type:"sprite",position:[0,0,.1+a(c.head)],height:.1,text:f,textColor:h,opacity:0});d=this._haveLightProbe;f=new WALK.StandardMaterial;
f.headLight=!1;f.baseColor.setRGB(0,0,0);f.roughness=.001;f.metallic=0;d||(f.disableLightProbe=!0);f.setUniforms();this._displayMaterial=f;this._displayLandscape=new THREE.Mesh(c.displayLandscape,this._displayMaterial);this._displayPortrait=new THREE.Mesh(c.displayPortrait,this._displayMaterial);e=new THREE.Mesh(c.sphere,e);e.scale.set(.4,.4,.4);e.visible=!1;this._pointer=e;this._pointerLeaderStartOffset=new THREE.Vector3(0,.3,-.35);e=g.color;d=new WALK.StandardMaterial;d.headLight=!1;d.baseColor.setStyle(e).convertGammaToLinear();
d.transparent=!0;d.opacity=.5;d.emissive=!0;d.disableLightProbe=!0;d.setUniforms();e=new THREE.Mesh(c.cylinder,d);e.visible=!1;this._pointerLeader=e;this._body.add(this._torso);this._head.add(this._displayLandscape);this._head.add(this._displayPortrait);this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointerLeader);this.add(this._pointer);e=$jscomp.makeIterator([this._torso,this._displayLandscape,this._displayPortrait,this._head]);for(d=e.next();!d.done;d=
e.next())d=d.value,d.visibilityId=null,this.colliders.push(d);g.position&&this.position.fromArray(g.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();this._videoTexture1=this._videoTexture0=null;this._landscape=!0;this._displayLandscape.visible=!0;this._displayPortrait.visible=!1;this._soundThreshold=140;this._maxHighlight=.5;this._highlightStepDown=.05};WALK.Avatar.prototype=Object.create(THREE.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.switchToPortrait=
function(){this._landscape&&(this._landscape=!1,this._displayLandscape.visible=!1,this._displayPortrait.visible=!0,this._head.rotation.y=Math.PI/2,this._torso.position.z-=.05)};WALK.Avatar.prototype.switchToLandscape=function(){this._landscape||(this._landscape=!0,this._displayLandscape.visible=!0,this._displayPortrait.visible=!1,this._head.rotation.y=0,this._torso.position.z+=.05)};WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._torso.visible=!1;this._displayNameAnchor.visible=
!1};WALK.Avatar.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};WALK.Avatar.prototype.rotate=function(d,e){this._body.rotation.z=d;this._head.rotation.x=e};WALK.Avatar.prototype.setOrientation=function(){this._videoTexture0.width<this._videoTexture0.height?this.switchToPortrait():this.switchToLandscape()};WALK.Avatar.prototype.setVideoTexture0=function(d){var e=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null);this._haveLightProbe&&
(this._displayMaterial.disableLightProbe=!1);this._displayMaterial.baseColorTexture=null;this._updated();d?d.addLoadedListener(function(){e._videoTexture0=d;e.setOrientation();e._displayMaterial.disableLightProbe=!0;e._displayMaterial.baseColorTexture=d;d.addResizedListener(function(){e.setOrientation();e._updated()});e._updated()}):(this.switchToLandscape(),this._updated())};WALK.Avatar.prototype.getVideoTexture0=function(){return this._videoTexture0};WALK.Avatar.prototype.setVideoTexture1=function(d){var e=
this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());d&&d.addLoadedListener(function(){e._videoTexture1=d;e._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this._head.material};WALK.Avatar.prototype._setClosestLightProbe=function(){var d=this._scene.closestLightProbe(this.position);d!==this._head.lightProbe&&(this._head.lightProbe=d,this._torso.lightProbe=
d,this._displayLandscape.lightProbe=d,this._displayPortrait.lightProbe=d,this._pointer.lightProbe=d,this._pointerLeader.lightProbe=d)};WALK.Avatar.prototype.setPositionFromArray=function(d){this.position.fromArray(d);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};WALK.Avatar.prototype.placePointer=function(d,e,g){var f=new THREE.Matrix4,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,
m=new THREE.Vector3,n=new THREE.Matrix4,q=new THREE.Matrix4;q.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var u=new THREE.Matrix4;return function(p,w,v){this._pointer.position.set(p-this.position.x,w-this.position.y,v-this.position.z);this._pointer.visible=!0;f.makeRotationZ(this._body.rotation.z);h.set(this._pointerLeaderStartOffset.x,this._pointerLeaderStartOffset.y,this._pointerLeaderStartOffset.z);h.applyMatrix4(f);k.set(this.position.x,this.position.y,this.position.z).add(h);l.set(p,w,v);m.set(p,w,
v).sub(k);u.makeScale(1,m.length(),1);n.lookAt(k,l,THREE.Object3D.DefaultUp);n.multiply(q);u.multiplyMatrices(n,u);m.divideScalar(2).add(h);u.setPosition(m);this._pointerLeader.matrix.identity();this._pointerLeader.applyMatrix(u);this._pointerLeader.visible=!0}}();WALK.Avatar.prototype.hidePointer=function(){this._pointerLeader.visible=!1;this._pointer.visible=!1};WALK.Avatar.prototype.onSoundVolumeUpdated=function(d){null!==d&&(d=this._computeHighlighMix(d),this.getMainMaterial().highlightMix!==
d&&(this.getMainMaterial().highlightMix=d,WALK.getViewer().requestFrame()))};WALK.Avatar.prototype.onSoundSwitchedOff=function(){0<this.getMainMaterial().highlightMix&&(this.getMainMaterial().highlightMix=0,WALK.getViewer().requestFrame())};WALK.Avatar.prototype._computeHighlighMix=function(d){var e=this.getMainMaterial().highlightMix;if(d<this._soundThreshold)return 0<e?Math.max(0,e-this._highlightStepDown):0;d=(d-this._soundThreshold)/(255-this._soundThreshold)*this._maxHighlight;return d>e?d:Math.max(d,
e-this._highlightStepDown)};WALK.Avatar.prototype.dispose=function(){this._head.material.dispose();this._displayMaterial.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})}})();(function(){function a(k,l,m,n,q){m=new THREE.SphereBufferGeometry(m,32,16);m.changePosition(n);m.computeBoundingSphere();m.convertNormalsToSpherical();n=new WALK.Mesh(null,m,l);l.lightMapped&&(n.lightMap=q);k.camera.getWorldPosition(g);n.lightProbe=k.closestLightProbe(g);n.frustumCulled=!1;n.userData.hideFromLightProbes=!0;return n}function b(k){c.setRGB(k,k,k);k=WALK.ColorUtils.hdrEncode(c,d);var l=new Uint8Array(4);l[0]=Math.round(255*d.r);l[1]=Math.round(255*d.g);l[2]=Math.round(255*d.b);l[3]=
Math.round(255*k);k=new WALK.DataTexture(l,1,1);k.magFilter=GLC.NEAREST;k.minFilter=GLC.NEAREST;k.anisotropy=WALK.NO_ANISOTROPY;k.hasAlpha=!0;k.isRgbm=!0;k.loaded=!0;k.needsUpdate=!0;return k}var c,d,e,g,f=new THREE.Matrix4,h=new THREE.Vector2;WALK.MaterialPicker=function(k,l,m,n,q,u,p){function w(Q){y.forEach(function(da){return da(Q)})}var v=this;this.lightMap=null;this.meshes=[];var y=[];c||(c=new THREE.Color,d=new THREE.Color,g=new THREE.Vector3,e=new THREE.Vector3,g=new THREE.Vector3);var D=
n.camera.aspect,A=.1*Math.tan(THREE.Math.degToRad(n.camera.fov/2)),G=-A;D=Math.abs(D*A-D*G);A=Math.abs(A-G);var I=.01*D,H=(D-k.length*I-I)/(2*k.length);H=Math.min(H,WALK.MATERIAL_PICKER_BALL_MAX_SIZE/2*D);var P=k.length/2*-(2*H+I)+H+I;G=document.getElementById("menu-bar").getBoundingClientRect().top;var U=-A/2+(window.innerHeight-G)/window.innerHeight*A+H+I;k.some(function(Q){return Q.lightMapped})&&(u=u.measureIncidentLuma(),0>u&&(u=1),this.lightMap=b(u));k.forEach(function(Q,da){if(Q){e.set(P,U,
-.1);var aa=a(n,Q,H,e,v.lightMap);P+=2*H+I;var X=new THREE.Matrix4;X.multiply(f.makeTranslation(l.x,l.y,l.z));Q=q.cameraWorldPosition();h.x=Q.x-l.x;h.y=Q.y-l.y;X.multiply(f.makeRotationZ(Math.abs(h.y)>Math.abs(h.x)?0<h.x?0:-Math.PI:0<h.y?Math.PI/2:-Math.PI/2));X.multiply(f.makeRotationX(-Math.PI/2));X.multiply(f.makeScale(m,m,m));X.multiply(f.makeTranslation(2.1*(da+1),0,0));X.multiply(f.makeScale(1/H,1/H,1/H));X.multiply(f.makeTranslation(-e.x,-e.y,-e.z));v.meshes.push(aa);y.push(function(S){S?(aa.matrix=
X,aa.matrixWorld=X):(aa.matrix=n.camera.matrix,aa.matrixWorld=n.camera.matrixWorld)})}});var fa=function(){return w(!0)},C=function(){return w(!1)};p.addEventListener("modeEnabled",fa);p.addEventListener("modeDisabled",C);this.dispose=function(){y.length=0;p.removeEventListener("modeEnabled",fa);p.removeEventListener("modeDisabled",C);this.meshes.forEach(function(Q){return Q.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),this.lightMap=null)};w(p.modeIsEnabled())}})();(function(){function a(){var b=new Set,c=[];this.add=function(d){d instanceof RegExp?c.push(d):b.add(d)};this.matchesAny=function(d){return b.has(d)?!0:c.some(function(e){return e.test(d)})}}WALK.MergeConfig=function(){this._editableNodeTypes=new a;this._editableMaterialNames=new a;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(b){this._editableNodeTypes.add(b)};this.setMaterialEditable=function(b){this._editableMaterialNames.add(b)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=
!0};this.isMaterialEditable=function(b){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(b)};this.isNodeTypeEditable=function(b){return this._editableNodeTypes.matchesAny(b)}}})();(function(){function a(){function c(m,n,q){return(0<=m?m-1:m+n/q)*q}var d=this,e=new THREE.Vector3,g=new THREE.Vector3,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3;this.objects=[];var l=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(m){l={name:m||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(l)};this.addFace=function(m,n,q,u,p,w,v,y,D){var A=this.vertices.length;m=c(m,A,3);n=c(n,A,3);q=c(q,A,3);A=d.vertices;var G=l.vertices;G.push(A[m+0],
A[m+1],A[m+2]);G.push(A[n+0],A[n+1],A[n+2]);G.push(A[q+0],A[q+1],A[q+2]);void 0!==v?(m=this.normals.length,v=c(v,m,3),y=c(y,m,3),D=c(D,m,3),m=d.normals,n=l.normals,n.push(m[v+0],m[v+1],m[v+2]),n.push(m[y+0],m[y+1],m[y+2]),n.push(m[D+0],m[D+1],m[D+2])):(D=d.vertices,y=l.normals,e.fromArray(D,m),g.fromArray(D,n),f.fromArray(D,q),k.subVectors(f,g),h.subVectors(e,g),k.cross(h),k.normalize(),y.push(k.x,k.y,k.z),y.push(k.x,k.y,k.z),y.push(k.x,k.y,k.z));void 0!==u?(D=this.uvs.length,u=c(u,D,2),p=c(p,D,2),
w=c(w,D,2),D=d.uvs,y=l.uvs,y.push(D[u+0],D[u+1]),y.push(D[p+0],D[p+1]),y.push(D[w+0],D[w+1]),l.hasUvs=!0):(w=l.uvs,w.push(0,0),w.push(0,0),w.push(0,0))}}function b(c){if(void 0!==c&&""!==c)return parseInt(c,10)}WALK.loadGeometriesFromObj=function(c,d,e){WALK.ajaxGet(c,!1,function(g){var f=g,h=/^[og]\s*(.+)?/,k=/^mtllib /,l=/^usemtl /,m=/^usemap /;g=new a;-1!==f.indexOf("\r\n")&&(f=f.replace(/\r\n/g,"\n"));-1!==f.indexOf("\\\n")&&(f=f.replace(/\\\n/g,""));f=f.split("\n");var n;f=$jscomp.makeIterator(f);
for(n=f.next();!n.done;n=f.next()){var q=n.value;if(0!==q.length&&"\x00"!==q){var u=q.charAt(0);if("#"!==u)if("v"===u)switch(n=q.split(/\s+/),n[0]){case "v":g.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));7<=n.length&&console.assert(!1,"obj with vertex colors is not supported");break;case "vn":g.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case "vt":g.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}else if("f"===u){q=q.substr(1).trim().split(/\s+/);n=[];q=
$jscomp.makeIterator(q);for(u=q.next();!u.done;u=q.next())u=u.value,0<u.length&&(u=u.split("/"),n.push(u));q=n[0];u=1;for(var p=n.length-1;u<p;u++){var w=n[u],v=n[u+1];g.addFace(b(q[0]),b(w[0]),b(v[0]),b(q[1]),b(w[1]),b(v[1]),b(q[2]),b(w[2]),b(v[2]))}}else"l"===u?console.assert(!1,"line geometry is not supported"):"p"===u?console.assert(!1,"obj point geometry not supported"):null!==(n=h.exec(q))?(n=(" "+n[0].substr(1).trim()).substr(1),g.startObject(n)):l.test(q)||k.test(q)||m.test(q)||"s"!==u&&console.warn('OBJLoader: Unexpected line: "'+
q+'"')}}h=new Map;g=$jscomp.makeIterator(g.objects);for(k=g.next();!k.done;k=g.next())k=k.value,0!==k.vertices.length&&(l=new THREE.BufferGeometry,l.addAttribute("position",new WALK.BufferAttribute(new Float32Array(k.vertices),3)),0<k.normals.length&&l.addAttribute("normal",new WALK.BufferAttribute(new Float32Array(k.normals),3)),!0===k.hasUvs&&l.addAttribute("uv",new WALK.BufferAttribute(new Float32Array(k.uvs),2)),l.convertNormalsToSpherical(),l.computeBoundingBox(),l.computeBoundingSphere(),h.set(k.name,
l));return d(h)},e)}})();(function(){WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):
33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var e=c[9],g=c[10];console.assert(0===(e&e-1));console.assert(0===(g&g-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var f=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var h=new DataView(a,0),k=e,l=g,m=0;m<f;++m){var n=h.getUint32(c,!0);c+=4;var q=new Uint8Array(a,
c,n);b.push({data:q,width:k,height:l});c+=n+(3-(n+3)%4);k=Math.max(k/2,1);l=Math.max(l/2,1)}console.assert(c===a.byteLength);return{format:d,width:e,height:g,mipmapCount:f,mipmaps:b}}})();(function(){function a(g,f,h,k,l){g({wasmBinary:f}).then(function(m){function n(q,u,p){var w=0===Math.log2(u)%1&&0===Math.log2(p)%1;return k.dxtTextures?q?h.BC3:h.BC1:k.pvrtcTextures&&u===p&&w?q?h.PVRTC1_4_RGBA:h.PVRTC1_4_RGB:k.etc1Textures&&!q?h.ETC1:k.astcTextures?h.ASTC_4x4:h.RGBA32}m.initializeBasis();l(function(q){var u=new m.BasisFile(new self.Uint8Array(q));q=function(P){u.close();u.delete();throw P;};var p=u.getHasAlpha(),w=u.getNumImages(),v=u.getNumLevels(0),y=u.getImageWidth(0,0),D=u.getImageHeight(0,
0);0!==y&&0!==D&&0!==w&&0!==v||q("Invalid .basis file");1<w&&q("Missing multiple images handling");w=n(p,y,D);y=w.formatIdx;u.startTranscoding()||q("startTranscoding failed");D=[];for(var A=0;A<v;++A){var G=u.getImageWidth(0,A),I=u.getImageHeight(0,A),H=u.getImageTranscodedSizeInBytes(0,A,y);H=new self.Uint8Array(new self.ArrayBuffer(H));u.transcodeImage(H,0,A,y,0,p)||q(".transcodeImage failed");D.push({data:H,width:G,height:I})}u.close();u.delete();return{gpuFormat:w.gpuFormat,mipmaps:D}})})}function b(g,
f,h,k){var l=new window.Worker(g),m=null,n={processItem:function(p){console.assert(!m);m=p;l.postMessage(p.texBuffer,[p.texBuffer])},terminate:function(){console.assert(!m);l.terminate()}},q=function(p){throw"Worker error @L"+p.lineno+": "+p.message;};l.addEventListener("error",q);var u=function(){l.removeEventListener("error",q);l.removeEventListener("message",u);l.addEventListener("error",function(p){p="Worker error @L"+p.lineno+": "+p.message;m&&(m.onError(p),m=null)});l.addEventListener("message",
function(p){console.assert(m);m.onSuccess(p.data);m=null;k(n)});h();k(n)};l.addEventListener("message",u);l.postMessage(f)}function c(g,f,h,k){function l(){w.deferRun();0!==p.length&&(0<u.length?(u.pop().processItem(p.pop()),l()):q<k&&!n&&(q++,n=!0,b(m,h,function(){n=!1},function(v){u.push(v);l()})))}g="\nself.importScripts("+JSON.stringify(g)+");\nconst initBasis = "+a.toString()+";\nconst basisFormats = "+JSON.stringify(e)+";\nconst glDetector = "+JSON.stringify({astcTextures:f.gl.astcTextures,
dxtTextures:f.gl.dxtTextures,etc1Textures:f.gl.etc1Textures,pvrtcTextures:f.gl.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var m=window.URL.createObjectURL(new window.Blob([g])),n=!1,q=0,u=[],p=[],w=new WALK.DeferringExecutorOnce(function(){for(var v=$jscomp.makeIterator(u),y=v.next();!y.done;y=v.next())y.value.terminate();q-=u.length;u.length=0},5E3);return function(v,y,D){p.push({texBuffer:v,onSuccess:y,onError:D});l()}}function d(g,f){WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(h){var k=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),l=g.BASIS_DECODE_WORKERS;if(0>=l){var m=
window.document.createElement("script");m.addEventListener("load",function q(){m.removeEventListener("load",q);a(window.BASIS,h,e,g.gl,function(u){f(function(p,w,v){try{w(u(p))}catch(y){v(y)}})})});m.src=k;window.document.head.appendChild(m)}else f(c(k,g,h,l))},function(h){throw h;})}var e=function(){function g(f,h){return{formatIdx:f,gpuFormat:h}}return{ETC1:g(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:g(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:g(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:g(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),
PVRTC1_4_RGBA:g(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:g(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),RGBA32:g(13,GLC.RGBA)}}();WALK.createBasisLoader=function(g){function f(m){k=m;h.forEach(function(n){return k.apply(null,$jscomp.arrayFromIterable(n))});h.length=0}if(!window.WebAssembly||!(g.gl.pvrtcTextures||g.gl.etc1Textures||g.gl.dxtTextures||g.gl.astcTextures))return null;var h=[],k=function(m){for(var n=[],q=0;q<arguments.length;++q)n[q-0]=arguments[q];h.push(n)},l=!1;return{load:function(m,
n,q,u){var p=new WALK.CompressedTexture;l||(l=!0,d(g,f));WALK.queueAjaxGet(m,n,!0,function(w){k(w,function(v){p.format=v.gpuFormat;v=v.mipmaps;p.mipmaps=v;p.width=v[0].width;p.height=v[0].height;p.generateMipmaps=!1;p.minFilter=1===v.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;p.flipY=!1;p.needsUpdate=!0;q(p)},u)},u);return p}}}})();(function(){function a(){var g={};this.cacheKey=function(f,h,k,l,m){return f+"@"+h+"@"+k+"@"+l+"@"+m};this.get=function(f){return g[f]};this.insert=function(f,h){g[f]=h}}function b(g,f,h,k,l){function m(q){n.image=q;n.width=q.width;n.height=q.height;k(n)}var n=new WALK.Texture;n.format=h;WALK.queueImageGet(g,f,e?function(q){createImageBitmap(q,{premultiplyAlpha:"none",imageOrientation:n.flipY?"flipY":"none"}).then(m).catch(l)}:m,l);return n}function c(g,f,h,k,l,m){var n=new WALK.VideoTexture;n.format=
h;WALK.queueVideoGet(g,f,function(q){n.video=q;n.width=q.videoWidth;n.height=q.videoHeight;THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height)||(n.wrapS=GLC.CLAMP_TO_EDGE,n.wrapT=GLC.CLAMP_TO_EDGE);l(n);k&&n.pause()},m);return n}function d(g,f){!1===g.importGpuCompress&&(f.importGpuCompress=!1);!1===g.importAutoScale&&(f.importAutoScale=!1)}var e=!1;WALK.TextureLoader=function(g,f,h,k,l,m,n){function q(I){var H=I.id,P=I.webFormats;console.assert(P&&0<P.length,"No web format for texture: "+
I.id+"."+I.rawExt);if(I.video)return g+"video/"+P[0]+"/"+H+"."+I.stdExt;var U=g+"img/",fa=f.ios&&I.rgbm;if(G&&!fa){if(!f.mobile&&-1<P.indexOf("large/basis"))return U+"large/basis/"+H+".basis";if(-1<P.indexOf("small/basis"))return U+"small/basis/"+H+".basis"}if(f.gl.pvrtcTextures&&!fa&&-1<P.indexOf("small/pvr"))return U+"small/pvr/"+H+".ktx";if(f.gl.etc1Textures&&-1<P.indexOf("small/etc1"))return U+"small/etc1/"+H+".ktx";if(f.gl.dxtTextures&&-1<P.indexOf("large/dxt"))return U+"large/dxt/"+H+".ktx";
fa=-1<P.indexOf("small/std");return!(-1<P.indexOf("large/std"))||f.mobile&&fa?U+"small/std/"+H+"."+I.stdExt:U+"large/std/"+H+"."+I.stdExt}function u(I){--y.texturesToLoad;I.needsUpdate=!0;h(I);I.notifyLoaded()}function p(){--y.texturesToLoad;k()}function w(){--y.texturesToLoad;l()}function v(I,H,P,U,fa){var C=new WALK.DataTexture;WALK.queueAjaxGet(I,H,!0,function(Q){Q=new Uint8Array(Q,0,Q.byteLength);var da=Q[1];C.image.width=Math.pow(2,Q[0]);C.image.height=Math.pow(2,da);C.format=P;C.type=GLC.UNSIGNED_BYTE;
C.image.data=Q.subarray(2);U&&U(C);C=null},fa);return C}var y=this,D=new a,A=new WALK.KTXLoader,G=!WALK.urlHashContains("nobasis")&&WALK.createBasisLoader(f);m&&(D.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){D=null};this.load=function(I,H,P,U,fa){var C=H.alpha?GLC.RGBA:GLC.RGB,Q=q(H),da=/\.basis$/.test(Q),aa=/\.ktx$/.test(Q),X=/\.buf$/.test(Q),S=H.video,O=!(aa||X||S),la=D.cacheKey(Q,P,U,fa,C),R=D.get(la);if(R)return d(H,R),R;y.texturesToLoad+=1;X?R=v(I,Q,C,u,p):da?R=G.load(I,
Q,u,p):aa?R=A.load(I,Q,u,p):O?R=b(I,Q,C,u,p):(console.assert(S),R=c(WALK.LOAD_PRIORITY.VIDEO,Q,C,n,u,w));R.hasAlpha=!!H.alpha;R.isRgbm=!!H.rgbm;P&&(R.wrapS=GLC.REPEAT,R.wrapT=GLC.REPEAT);U&&!S?(R.minFilter=GLC.LINEAR_MIPMAP_LINEAR,R.generateMipmaps=!aa):(R.minFilter=GLC.LINEAR,R.generateMipmaps=!1);fa&&(R.anisotropy=fa);D.insert(la,R);R.id=H.id;R.name=H.name;R.webFormats=H.webFormats;d(H,R);H.rawExt&&(R.rawExt=H.rawExt);R.stdExt=H.stdExt;return R}}})();(function(){function a(e,g,f){for(var h=0;h<g.length;h+=1){var k=g[h],l=e[k];void 0!==l&&(f["_"+k]=l)}}var b="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),c="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),d="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");WALK.MaterialLoader=function(e,g,f){var h=WALK.DETECTOR;
this.load=function(k,l){for(var m=new Map,n=0,q=0;q<k.length;q+=1){var u;var p=k[q];var w=WALK.createMaterialOfType(p.type);if("water"===w.type)w.name=p.name,p.normalTexture&&(w.normalTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,p.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),p.baseColor&&w.baseColor.fromArray(p.baseColor),void 0!==p.opacity&&(w.opacity=p.opacity),a(p,["wavesSpeed","wavesScale","refractionFactor"],w),w.setUniforms();else{WALK.copyProperties(p,b,w);a(p,c,w);p.baseColor&&(w.baseColor.fromArray(p.baseColor),
w.baseColor.roundChannels());if(u=p.baseColorTextureCorrection)w._baseColorTextureCorrection=!0,void 0!==u.contrast&&(w._baseColorTextureContrast=u.contrast),w.baseColorTextureHslOffset.h=u.hslOffset[0],w.baseColorTextureHslOffset.s=u.hslOffset[1],w.baseColorTextureHslOffset.l=u.hslOffset[2];if(u=p.baseColorTexture){if(u.atlasId){var v=g[u.atlasId].getAtlasEntry(u.id,u.name,u.atlasOffset[0],u.atlasOffset[1],u.atlasScale[0],u.atlasScale[1]);null!==v.rawExt&&v.rawExt!==u.rawExt&&console.warn("Atlas entries with not matching rawExt "+
u.name);v.rawExt=u.rawExt;null!==v.stdExt&&v.stdExt!==u.stdExt&&console.warn("Atlas entries with not matching stdExt "+u.name);v.stdExt=u.stdExt;u=v}else u=e.load(WALK.LOAD_PRIORITY.DIFFUSE,u,!0,!0,WALK.DEFAULT_ANISOTROPY);u.isCutout=null;w.baseColorTexture=u}p.roughnessTexture&&(w.roughnessTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,p.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));p.metallicTexture&&(w.metallicTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,p.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));
p.bumpTexture&&h.gl.standardDerivatives&&(w.bumpTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,p.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));p.doNotImport&&WALK.copyProperties(p.doNotImport,d,w.doNotImport);p.chromaKeyColor&&(w.chromaKeyColor.fromArray(p.chromaKeyColor),w.chromaKeyColor.roundChannels());p.chromaKeyDelta&&w._chromaKeyDelta.fromArray(p.chromaKeyDelta)}p=w;if(!f.isMaterialEditable(p.name)){w=p.hash();u=m.get(w)||[];v=$jscomp.makeIterator(u);for(var y=v.next();!y.done;y=v.next())if(y=
y.value,y.canMerge(p)){n+=1;y.merged=!0;p=y;break}p.merged||(u.push(p),m.set(w,u))}l.addMaterial(p);p.merged||p.setUniforms()}WALK.log("Have "+k.length+" materials and "+(k.length-n)+" merged materials.")}}})();(function(){WALK.SkyLoader=function(a){function b(d,e,g){var f=new THREE.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(d,f,e,g)}function c(d){var e=new WALK.ProceduralSkyMaterial;return b(d.name,e,d.center)}this.loadSkyTexture=function(d,e){d.material.map&&d.material.map.dispose();d.material.map=a.load(WALK.LOAD_PRIORITY.SKY,e,!1,!1,WALK.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,e){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var g=new WALK.EquirectSkyMaterial;
g.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);g=b(d.name,g,d.center);g.geometry.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1));g.rotation.x=Math.PI/2;g.yawRotationDeg=d.yawRotation||0;d=g}else console.warn("Unknown sky type: ",d.type),d=c(d);e.addSkyMesh(d)};this.load=function(d,e){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},e);for(var g=0;g<d.length;g+=1)this.loadSingleSky(d[g],e)}}})();(function(){WALK.LightmapLoader=function(a,b,c){function d(){--g;if(0===g)e.onComplete()}var e=this,g=b;this.lightmaps=[];this.onComplete=null;this.load=function(){var f;if(f=WALK.DETECTOR.webp)f=void 0!==c&&void 0!==c.formats?0<=c.formats.indexOf("webp"):!1;f={id:null,name:null,stdExt:f?"webp":"png",webFormats:["large/std"],alpha:!0,rgbm:!0};for(var h=0;h<b;h+=1){f.id=f.name="lightmap-rgbm"+h;var k=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,f,!1,!1,WALK.NO_ANISOTROPY);k.addLoadedListener(d);this.lightmaps.push(k)}}}})();(function(){WALK.TextureAtlasLoader=function(a){this.atlases={};this.load=function(b){for(var c=0;c<b.length;++c){var d=a.load(WALK.LOAD_PRIORITY.DIFFUSE,b[c],!1,!0,WALK.DEFAULT_ANISOTROPY);d.flipY=!1;d.enableAtlas();this.atlases[b[c].id]=d}}}})();(function(){WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};
this.releaseCoreBuffers=function(){var d=this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(k){return function(l){g.buffers[k]=l;g.onHaveBuffer()}}function e(k){return function(l){c[k]=l.loaded;g.onProgress()}}var g=this,f=WALK.LOAD_PRIORITY.CORE_RESOURCE,h={meshes:f,transforms:f,bounds:f,faces16:f,faces:f,vertices:f,normals:f,uvs0:b?f:WALK.LOAD_PRIORITY.UV0,uvs1:b?f:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var k in g.buffers)if(g.buffers.hasOwnProperty(k)){var l=
h[k];console.assert(void 0!==l);WALK.queueAjaxGet(l,a+k+".buf",!0,d(k),g.onFailure,e(k))}})()};this.totalDone=function(){var d=0,e;for(e in c)c.hasOwnProperty(e)&&(d+=c[e]);return d}}})();(function(){function a(c,d,e){var g=new Int32Array(c);c=new Float32Array(c);var f=new Float32Array(d),h={},k=g[0],l=g[1],m=2;for(d=0;m<g.length;){var n={nodeId:g[m],materialIdx:g[m+1],useFaces16:1===g[m+2],faceByteOffset:g[m+3],faceCnt:g[m+4],vertexByteOffset:g[m+5],vertexCnt:g[m+6],normalByteOffset:g[m+7],uv0ByteOffset:g[m+8],uv1ByteOffset:g[m+9],lightMapIdx:g[m+10],uv1CoordUScale:c[m+11],uv1CoordVScale:c[m+12],uv1CoordUOffset:g[m+13],uv1CoordVOffset:g[m+14],transformByteOffset:g[m+15],boundsByteOffset:g[m+
16],quantVertexRange:c[m+17],quantVertexMax:g[m+18],quantUv0Range:c[m+19],quantUv0Max:g[m+20],autoLightmapResolution:2<=k?g[m+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};n.boundingBox=new THREE.Box3;n.boundingSphere=new THREE.Sphere;a:{for(var q=n.boundingBox,u=n.boundingSphere,p=n.boundsByteOffset/4,w=0;6>w;++w)if(!isFinite(f[p+w]))break a;q.max.x=f[p];q.max.y=f[p+1];q.max.z=f[p+2];q.min.x=f[p+3];q.min.y=f[p+4];q.min.z=f[p+5];q.center(u.center);u.radius=f[p+6]}d=Math.max(d,n.lightMapIdx+
1);WALK.DETECTOR.gl.instances&&(q=n.vertexByteOffset,h.hasOwnProperty(q)?(q=h[q],u=q[0],u.isMasterCopy=!0,u.hasCopies=!0,n.hasCopies=!0,q.push(n)):h[q]=[n]);e.push(n);m+=l}e=$jscomp.makeIterator(Object.values(h));for(g=e.next();!g.done;g=e.next())if(g=g.value,c=g.length,1<c&&500<c*g[0].faceCnt)for(g=$jscomp.makeIterator(g),c=g.next();!c.done;c=g.next())c.value.useInstances=!0;return d}var b=function(c,d,e,g,f){this.meshPropsSet=new Set;this.meshPropsSet.add(c);this.material=d;this.lightMap=e;this.lightProbe=
g;this.hideInViews=f;this.anyLogicalMeshHasUvs=-1!==c.uv0ByteOffset;this.sharedGeometryId=c.useInstances?c.vertexByteOffset:null};b.prototype.canUseLightMap=function(c){return null===this.lightMap||null===c||this.lightMap===c};WALK.MeshMaker=function(c,d,e,g){function f(n){var q=[],u=new Map;k.forEach(function(p){var w=c.findNode(p.nodeId),v=c.materials[p.materialIdx],y=null;null!==w.initialLightProbeId&&(y=c.findLightProbe(w.initialLightProbeId));var D=null;-1!==p.lightMapIdx&&(D=n[p.lightMapIdx]);
var A=w.hideInViews||[];if(w.editable||1!==v.opacity)q.push(new b(p,v,D,y,A));else{var G=p.useInstances?p.vertexByteOffset:null;w=u.get(v)||[];for(var I=$jscomp.makeIterator(w),H=I.next();!H.done;H=I.next()){H=H.value;var P;if(P=H.lightProbe===y&&H.canUseLightMap(D)&&H.sharedGeometryId===G)a:if(P=H.hideInViews,P.length!==A.length)P=!1;else{for(var U=0;U<P.length;U+=1)if(P[U]!==A[U]){P=!1;break a}P=!0}if(P){null!==D&&(H.lightMap=D);H.anyLogicalMeshHasUvs=H.anyLogicalMeshHasUvs||-1!==p.uv0ByteOffset;
H.meshPropsSet.add(p);return}}p=new b(p,v,D,y,A);w.push(p);u.set(v,w);q.push(p)}});return q}var h=this,k=[],l=d.byteLength,m=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(n){var q=n?n[0]:null,u=f(n);n={};u=$jscomp.makeIterator(u);for(var p=u.next();!p.done;p=u.next()){var w=p.value;p=w.sharedGeometryId;if(null!==p){var v=n[p],y=!1;v||(v=new WALK.Geometry,y=!0,n[p]=v);p=new WALK.InstancedGeometry(v,y)}else p=new WALK.Geometry;
v=new WALK.MergedMesh(p,w.material);v.lightProbe=w.lightProbe;v.lightMap=w.lightMap||q;v.hideInViews=w.hideInViews;v.anyLogicalMeshHasUvs=w.anyLogicalMeshHasUvs;this.mergedMeshes.push(v);w=$jscomp.makeIterator(w.meshPropsSet);for(y=w.next();!y.done;y=w.next()){y=y.value;var D,A=p;if(g){var G=3*y.faceCnt;var I=y.vertexCnt}else G=0,I=3*y.faceCnt;if(A.isInstanced)var H=D=0;else D=A.indexCnt,H=A.vertexCnt;H=new WALK.SubGeometry(G,I,A,D,H,y.boundingBox,y.boundingSphere);A.boundingBox.union(y.boundingBox);
WALK.Math.spheresUnion(y.boundingSphere,A.boundingSphere);A.isInstanced?(H.instanceId=A.instanceCount,A.instanceCount+=1,A.indexCnt=G,A.vertexCnt=I):(A.indexCnt+=G,A.vertexCnt+=I);G=H;I=c.findNode(y.nodeId);G=new WALK.Mesh(I,G,v.material);G.lightMap=v.lightMap;G.lightProbe=v.lightProbe;G.autoLightmapResolution=y.autoLightmapResolution;G.useFaces16=y.useFaces16;G.faceByteOffset=y.faceByteOffset;G.faceCnt=y.faceCnt;G.vertexByteOffset=y.vertexByteOffset;G.vertexCnt=y.vertexCnt;G.normalByteOffset=y.normalByteOffset;
G.uv0ByteOffset=y.uv0ByteOffset;G.uv1ByteOffset=y.uv1ByteOffset;G.lightMapIdx=y.lightMapIdx;G.uv1CoordUScale=y.uv1CoordUScale;G.uv1CoordVScale=y.uv1CoordVScale;G.uv1CoordUOffset=y.uv1CoordUOffset;G.uv1CoordVOffset=y.uv1CoordVOffset;G.transformByteOffset=y.transformByteOffset;G.quantVertexRange=y.quantVertexRange;G.quantVertexMax=y.quantVertexMax;G.quantUv0Range=y.quantUv0Range;G.quantUv0Max=y.quantUv0Max;y.hasCopies&&(G.sharedBuffersDebug=y.isMasterCopy?1:2);m+=1;v.addLogicalMesh(G);I.mesh=G}}WALK.log("Have "+
m+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=a(d,e,k);d=e=null;(function(){for(var n=0,q=0,u=0,p=0,w=0,v=0,y=0,D=$jscomp.makeIterator(k),A=D.next();!A.done;A=D.next()){A=A.value;var G=A.vertexCnt;n=Math.max(n,A.faceByteOffset+3*A.faceCnt*(A.useFaces16?2:4));q=Math.max(q,A.vertexByteOffset+3*G*WALK.Math.minBytesToHold(A.quantVertexMax)+3&-4);u=Math.max(u,A.normalByteOffset+2*G);p=Math.max(p,A.transformByteOffset+64);w=Math.max(w,A.boundsByteOffset+28);-1!==A.uv0ByteOffset&&
(v=Math.max(v,A.uv0ByteOffset+2*G*WALK.Math.minBytesToHold(A.quantVertexMax)+3&-4));-1!==A.uv1ByteOffset&&(y=Math.max(y,A.uv1ByteOffset+4*G))}h.coreGeometryDownloadSize=l+n+q+u+p+w;h.geometryDownloadSize+=h.coreGeometryDownloadSize+v+y})()}})();(function(){function a(q,u,p,w,v,y,D){var A=0;for(p*=3;A<p;A+=3){var G=q[A+u]*v,I=q[A+u+1]*v,H=q[A+u+2]*v;y[D+A]=w[0]*G+w[1]*I+w[2]*H+w[3];y[D+A+1]=w[4]*G+w[5]*I+w[6]*H+w[7];y[D+A+2]=w[8]*G+w[9]*I+w[10]*H+w[11]}}function b(q,u,p,w,v,y){var D=0;for(p*=2;D<p;D+=2){var A=(q[D+u]/254+.5)*Math.PI,G=Math.PI/127*q[D+u+1],I=Math.sin(A),H=I*Math.cos(G);G=I*Math.sin(G);A=Math.cos(A);I=w[0]*H+w[1]*G+w[2]*A;var P=w[4]*H+w[5]*G+w[6]*A;A=2*(Math.acos(w[8]*H+w[9]*G+w[10]*A)/Math.PI-.5);G=Math.atan2(P,I)/Math.PI;
v[y+D]=WALK.Math.toSnorm8(A);v[y+D+1]=WALK.Math.toSnorm8(G)}}function c(q){return 0!==q.instanceId||!1===q.parent.ownsGpuBuffers}function d(q,u,p,w,v,y,D,A,G){var I=0;for(p*=2;I<p;I+=2){var H=q[I+u],P=q[I+u+1];0!==H||0!==P?(A[G+I]=Math.round(H*w)+y,A[G+I+1]=Math.round(P*v)+D):(A[G+I]=0,A[G+I+1]=0)}}function e(q,u,p,w,v){function y(){for(;A<q.length;){var I=q[A];if(0!==G||u(I)){for(;G<I.logicalMeshes.length;){var H=I.logicalMeshes[G];p(H);G+=1;if(D.shouldInterrupt(H.vertexCnt)){setTimeout(y,0);return}}w(I);
A+=1;G=0}else A+=1}v()}var D=new n(5E4),A=0,G=0;y()}function g(q,u){u.geometry.allocateCoreBuffers(q);return!0}function f(q,u){q?q=u.anyLogicalMeshHasUvs:(q=u.material,q=u.anyLogicalMeshHasUvs&&(q.baseColorTexture||q.bumpTexture||q.roughnessTexture||q.metallicTexture));return q?(u.geometry.allocateUv0(),!0):!1}function h(q){return q.lightMap?(q.geometry.allocateUv1(),!0):!1}function k(q,u,p,w,v){var y=4*v.instanceId;v=v.parent.uvs1Mod;v[y]=p/65535;v[y+1]=w/65535;v[y+2]=q/65535;v[y+3]=u/65535}function l(q,
u){var p=u.parent;u=4*u.instanceId;var w=p.transforms0;w[u]=q[0];w[u+1]=q[1];w[u+2]=q[2];w[u+3]=q[3];w=p.transforms1;w[u]=q[4];w[u+1]=q[5];w[u+2]=q[6];w[u+3]=q[7];p=p.transforms2;p[u]=q[8];p[u+1]=q[9];p[u+2]=q[10];p[u+3]=q[11]}var m=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]),n=function(q){this.minVerticesUntilTimeCall=q;this.verticesCount=0;this.timer=new WALK.Timer};n.prototype.shouldInterrupt=function(q){this.verticesCount+=q;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?
(this.verticesCount=0,this.timer.reset(),!0):!1};WALK.asyncFillIndexedUv0=function(q,u,p,w,v){var y=new Uint16Array(q),D=new Float32Array(q);e(u,f.bind(null,p),function(A){if(A.uv0InBuffers()){var G=A.geometry;if(!c(G)){var I=G.vertexOffset,H=G.parent;if(A.quantUv0Disabled()){G=A.uv0ByteOffset/4;var P=H.uvs0;H=0;for(A=2*A.vertexCnt;H<A;H+=1)P[2*I+H]=D[H+G]}else{G=A.uv0ByteOffset/2;P=A.quantUv0Factor();H=H.uvs0;var U=0;for(A=2*A.vertexCnt;U<A;U+=1)H[2*I+U]=y[U+G]*P}}}},w,v)};WALK.asyncFillIndexedUv1=
function(q,u,p,w){var v=new Uint16Array(q);e(u,h,function(y){if(y.uv1InBuffers()){var D=y.uv1CoordUScale,A=y.uv1CoordVScale,G=y.uv1CoordUOffset,I=y.uv1CoordVOffset,H=y.geometry;if(H.isInstanced){k(D,A,G,I,H);if(c(H))return;D=A=1;G=I=0}d(v,y.uv1ByteOffset/2,y.vertexCnt,D,A,G,I,H.parent.uvs1,2*H.vertexOffset)}},p,w)};WALK.asyncFillIndexedCoreGeometry=function(q,u,p,w){var v=q.faces16?new Uint16Array(q.faces16):null,y=q.faces?new Uint32Array(q.faces):null,D=new Int8Array(q.vertices),A=new Int16Array(q.vertices),
G=new Int32Array(q.vertices),I=new Int8Array(q.normals);e(u,g.bind(null,!0),function(H){var P=H.geometry,U=P.parent,fa=new Float32Array(q.transforms,H.transformByteOffset,16);if(P.isInstanced){l(fa,P);if(c(P))return;fa=m}switch(WALK.Math.minBytesToHold(H.quantVertexMax)){case 1:var C=D;var Q=H.vertexByteOffset;break;case 2:C=A;Q=H.vertexByteOffset/2;break;case 4:C=G,Q=H.vertexByteOffset/4}var da=P.vertexOffset;a(C,Q,H.vertexCnt,fa,H.quantVertexFactor(),U.vertices,3*da);b(I,H.normalByteOffset,H.vertexCnt,
fa,U.normals,2*da);U=U.index;P=P.indexOffset;H.useFaces16?(Q=H.faceByteOffset/2,fa=v):(Q=H.faceByteOffset/4,fa=y);C=Q;for(H=Q+3*H.faceCnt;C<H;C+=1,P+=1)U[P]=fa[C]+da},p,w)};WALK.asyncFillNotIndexedGeometry=function(q,u,p,w,v){var y=q.faces16?new Uint16Array(q.faces16):null,D=q.faces?new Uint32Array(q.faces):null,A=new Int8Array(q.vertices),G=new Int16Array(q.vertices),I=new Int32Array(q.vertices),H=new Int8Array(q.normals),P=new Uint16Array(q.uvs0),U=new Float32Array(q.uvs0),fa=q.uvs1?new Uint16Array(q.uvs1):
null;e(u,function(C){g(!1,C);f(p,C);h(C);return!0},function(C){var Q=C.geometry,da=C.geometry.parent,aa=new Float32Array(q.transforms,C.transformByteOffset,16);if(C.uv0InBuffers()&&da.uvs0)var X=da.uvs0;if(C.uv1InBuffers()&&da.uvs1){var S=da.uvs1;var O=C.uv1CoordUScale;var la=C.uv1CoordVScale;var R=C.uv1CoordUOffset;var ra=C.uv1CoordVOffset}if(Q.isInstanced){l(aa,Q);S&&k(O,la,R,ra,Q);if(c(Q))return;aa=m;O=la=1;R=ra=0}if(C.useFaces16){Q=y;var ma=C.faceByteOffset/2}else Q=D,ma=C.faceByteOffset/4;switch(WALK.Math.minBytesToHold(C.quantVertexMax)){case 1:var xa=
A;var T=C.vertexByteOffset;break;case 2:xa=G;T=C.vertexByteOffset/2;break;case 4:xa=I,T=C.vertexByteOffset/4}var ka=C.quantUv0Disabled();if(ka)var ua=C.uv0ByteOffset/4;else{var wa=C.quantUv0Factor();ua=C.uv0ByteOffset/2}var K=3*C.geometry.vertexOffset,J=2*C.geometry.vertexOffset,ha=C.quantVertexFactor(),W=da.vertices;da=da.normals;var Da=C.normalByteOffset,Ba=C.uv1ByteOffset/2,Ga=ma;for(C=ma+3*C.faceCnt;Ga<C;Ga+=1,K+=3,J+=2){ma=Q[Ga];a(xa,T+3*ma,1,aa,ha,W,K);b(H,Da+2*ma,1,aa,da,J);if(X){var Ha=ua+
2*ma;if(ka)for(var pa=X,ea=J,Y=0;2>Y;Y+=1)pa[ea+Y]=U[Y+Ha];else{pa=wa;ea=X;Y=J;for(var va=0;2>va;va+=1)ea[Y+va]=P[va+Ha]*pa}}S&&d(fa,Ba+2*ma,1,O,la,R,ra,S,J)}},w,v)}})();(function(){function a(h,k){h.forEach(function(l){k.addView(new WALK.View(l))})}function b(h,k,l){h.forEach(function(m){l.isNodeTypeEditable(m.name)&&(m.editable=!0);k.addNodeConfig(new WALK.NodeConfig(m))})}function c(h,k){h.forEach(function(l){var m=new WALK.Light(l);l=l.instances;for(var n=0;n<l.length;n+=1){var q=l[n];m.addInstance(q.position,q.rotation)}k.addLight(m)})}function d(h,k){h.forEach(function(l){k.addLightProbe(new WALK.LightProbe(l))})}function e(h,k,l){l=l.camera;h&&(l.defaultFov=
h.fov,h.exposure&&(l.defaultExposure=h.exposure),h.gamma&&(l.defaultGamma=h.gamma),h.lutTexture&&(k=k.load(WALK.LOAD_PRIORITY.COLORMAP,h.lutTexture,!1,!1,WALK.NO_ANISOTROPY),k.flipY=!1,l.colorMap=k),l.autoClimb=!!h.autoClimb,l.autoExposure=!!h.autoExposure,void 0!==h.autoExposureDarkness&&(l.autoExposureDarkness=h.autoExposureDarkness),h.moveMaxSpeed&&(l.moveMaxSpeed=h.moveMaxSpeed),l.updateProjectionMatrix())}function g(h,k){function l(m,n){var q=k.findNodeConfig(n.config),u=new WALK.Node(m,q,n);
void 0!==n.children&&(u.children=n.children.map(function(p){return l(u,p)}));return u}h.forEach(function(m){k.addNode(l(null,m))})}function f(){WALK.USER_MSG.error("Scene failed to load. Reload the page to retry.")}WALK.SceneLoader=function(h,k,l,m){var n=!l&&WALK.DETECTOR.gl.indexUint,q=!l&&!WALK.DEBUG_SHARED_BUFFERS,u=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function p(){if(void 0!==
ua.total)aa.onProgress(ua)}function w(){R||(R=!0,aa.onReadyToDisplay(h))}function v(K){0===K.name.indexOf("lightmap-rgbm")?ua.texturesDone+=12582912:ua.texturesDone+=524288;p();aa.onTextureLoaded(K);wa()}function y(){console.warn("Failed to load video texture");wa()}function D(){if(0===X.texturesToLoad&&ma){X.clearCache();for(var K=0,J=$jscomp.makeIterator(O.mergedMeshes),ha=J.next();!ha.done;ha=J.next())K+=ha.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+K+" bytes");X=S=O=null;
WALK.defer(function(){w();aa.onComplete(h)})}}function A(){xa&&ra&&la&&(wa=D,ka&&h.materials.forEach(function(K){K.lightMapped||(K.lightMapped=!0,K.setUniforms())}),wa())}function G(K){K.geometry.addUv1Attribute();aa.onMeshBuffersLoaded(K)}function I(){S.buffers.uvs1&&(wa=A,WALK.asyncFillIndexedUv1(S.buffers.uvs1,O.mergedMeshes,G,function(){S.buffers.uvs1=null;xa=!0;wa()}))}function H(K){K.geometry.addUv0Attribute();aa.onMeshBuffersLoaded(K)}function P(){S.buffers.uvs0&&(wa=I,WALK.asyncFillIndexedUv0(S.buffers.uvs0,
O.mergedMeshes,l,H,function(){S.buffers.uvs0=null;ma=!0;wa()}))}function U(){la=!0;0===h.views.length&&h.addView(new WALK.View({id:0,name:"Start place",hideFromMenu:!0,position:h.center.toArray(),rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!l&&!h.disableProgressiveLoader){var K=1E3*WALK.PROGRESSIVE_LOADER_AFTER_SEC-u.elapsedMSec();0>=K?w():setTimeout(w,K)}wa()}function fa(K){h.addGpuMesh(K)}function C(K){K.geometry.addCoreAttributes();var J=K.logicalMeshes;console.assert(!J[0].node.editable||
1===J.length);J[0].node.editable||!q?J.forEach(fa):fa(K);aa.onMeshBuffersLoaded(K)}function Q(K){K.geometry.uvs0&&K.geometry.addUv0Attribute();K.geometry.uvs1&&K.geometry.addUv1Attribute();C(K)}function da(){if(n){if(!S.haveCoreBuffers())return;WALK.log("Using indexed geometry");wa=P;WALK.asyncFillIndexedCoreGeometry(S.buffers,O.mergedMeshes,C,U)}else{if(!S.haveAllBuffers())return;wa=A;WALK.asyncFillNotIndexedGeometry(S.buffers,O.mergedMeshes,l,Q,function(){xa=ma=!0;U()})}S&&S.releaseCoreBuffers()}
var aa=this,X=null,S=null,O=null,la=!1,R=!1,ra=!1,ma=!1,xa=!1,T=null,ka=!1,ua={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+S.totalDone()}};u.reset();var wa=function(){if(T&&S.buffers.meshes&&S.buffers.bounds){wa=da;void 0!==T.autoAddLightProbes&&(h.autoAddLightProbes=T.autoAddLightProbes);h.disableProgressiveLoader=T.disableProgressiveLoader||!1;void 0!==T.autoTour&&(h.autoTour.disabled=T.autoTour.disabled||!1,h.autoTour.startOnLoad=T.autoTour.startOnLoad||!1);c(T.lights,
h);d(T.lightProbes||[],h);T.cameraVolumes&&T.cameraVolumes.forEach(function(ha){return h.addCameraVolume(new WALK.CameraVolume(ha))});X=new WALK.TextureLoader(k,WALK.DETECTOR,v,f,y,!1,!0);e(T.camera,X,h);var K=new WALK.TextureAtlasLoader(X);K.load(T.atlases||[]);(new WALK.MaterialLoader(X,K.atlases,m)).load(T.materials||[],h);(new WALK.SkyLoader(X)).load(T.skies||[],h);null===h.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");
a(T.views||[],h);T.hideViewsMenu&&(h.hideViewsMenu=!0);b(T.nodeConfigs,h,m);g(T.nodes,h);O=new WALK.MeshMaker(h,S.buffers.meshes,S.buffers.bounds,n);K=null;if(0!==O.lightmapCount){ka=!0;var J=new WALK.LightmapLoader(X,O.lightmapCount,T.lightmap);J.onComplete=function(){ra=!0;wa()};J.load();K=J.lightmaps;J=null}else ra=!0;O.createMeshes(K);ua.total=O.geometryDownloadSize+524288*(X.texturesToLoad-O.lightmapCount)+12582912*O.lightmapCount;T.panoramas&&(aa.panoramas=T.panoramas);T=null;wa()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,
k+"scene.json",!1,function(K){T=K;wa()},f);S=new WALK.BufferLoader(k,!n);S.onProgress=p;S.onFailure=f;S.onHaveBuffer=function(){wa()};S.load()};this.elapsedLoadTimeSec=function(){return u.elapsedSec()}}})();(function(){function a(c,d,e,g){for(var f=[],h=0;6>h;h+=1){var k=g?new THREE.OrthographicCamera(-1,1,1,-1,c,d):new THREE.PerspectiveCamera(90,1,c,d);e.add(k);f.push(k)}f[0].up.set(0,-1,0);b.set(1,0,0);f[0].lookAt(b);f[1].up.set(0,-1,0);b.set(-1,0,0);f[1].lookAt(b);f[2].up.set(0,0,1);b.set(0,1,0);f[2].lookAt(b);f[3].up.set(0,0,-1);b.set(0,-1,0);f[3].lookAt(b);f[4].up.set(0,-1,0);b.set(0,0,1);f[4].lookAt(b);f[5].up.set(0,-1,0);b.set(0,0,-1);f[5].lookAt(b);return f}var b=new THREE.Vector3;WALK.CubeCamera=
function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!1)};WALK.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera})();(function(){WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")}})();(function(){function a(m,n){n=n.target;m.deleteTexture(n.__webglTexture);n.__webglTexture=null;n.image=null}function b(m,n,q){for(var u=!0;u;){m.readPixels(n,n,q);for(var p=0;p<n*n*4;p+=4)if(0!==q[p]||0!==q[p+1]||0!==q[p+2]){u=!1;break}if(u){console.warn("Cube face has all pixels black.");break}}}function c(m,n){var q=new Set;m.traverse(function(u){if(u instanceof THREE.Mesh&&u.visible){var p=u.material;u.userData.hideFromLightProbes||p.hideFromLightProbes?(n.add(u),u.visible=!1):q.has(p)||(q.add(p),
p.configureTransparency&&(p.transparent=!1,p.blending=THREE.NoBlending,p.depthWrite=!0),void 0!==p.hdrOutput&&(p.hdrOutput=!0),void 0!==p.specularOff&&(p.specularOff+=1))}});q=null}function d(m,n){var q=new Set;m.traverse(function(u){if(u instanceof THREE.Mesh){var p=u.material;p.forceObjectUniformsRefresh&&p.forceObjectUniformsRefresh();u.visible?q.has(p)||(q.add(p),void 0!==p.hdrOutput&&(p.hdrOutput=!1),p.configureTransparency&&p.configureTransparency(),void 0!==p.specularOff&&--p.specularOff):
n.has(u)&&(u.visible=!0)}});q=null}function e(m,n){var q={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1};this.renderer=m;this.scene=n;this.threeScene=n.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new THREE.ShaderPass(WALK.CubeMapFilterShader,"envMap");n=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(n*n*4);this.targetCubeRaw=m.createRenderTargetCube(n,n,q);q.depthBuffer=!1;this.targetFiltered=m.createRenderTarget(n,
n,q);this.autoClearAlter=new WALK.AutoClearAlter(m);this.dispose=function(){this.targetCubeRaw.dispose();this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}function g(m,n){var q=n.geometry.boundingSphere.center;if(null===n.lightProbe||q.distanceTo(m.position)<q.distanceTo(n.lightProbe.position))n.lightProbe=m}function f(m,n){for(var q=0;q<n.length;q+=1)g(m,n[q])}function h(m,n){WALK.log("No visible light probe found for "+n.length+
" objects. Assigning the closest ones.");for(var q=0;q<n.length;q+=1)for(var u=0;u<m.length;u+=1)g(m[u],n[q])}var k=function(){var m=null;return function(n,q){var u=null,p=0;q*=q;console.assert(q<Math.pow(2,16));null===m&&(m=new Uint16Array(65536));for(var w=0;w<4*q;w+=4)m[256*n[w]+n[w+1]]+=1;m[0]>.7*q&&(p=m[0]);m[0]=0;for(n=1;n<m.length;n+=1)m[n]>p&&(p=m[n],u=Math.floor(n/256)+n%256/255),m[n]=0;return u}}(),l=function(){var m=null;return function(n,q,u){var p=n.renderer,w=n.aabbQueryMaterial,v=n.pixelBuf,
y=n.targetCubeRaw;null===m&&(m=new WALK.OrthoCubeCamera(.01,255));m.position.copy(q.position);m.updateMatrixWorld();var D;for(D=0;6>D;D+=1){y.activeCubeFace=D;w.axis=Math.floor(D/2);p.renderMeshes(n.scene.gpuMeshes,w,m.sideCameras[D],y);b(p,y.width,v);var A=k(v,y.width);if(null===A){WALK.log("failed to find light probe bound");break}switch(D){case 0:u.boxMax.x=q.position.x+A;break;case 1:u.boxMin.x=q.position.x-A;break;case 2:u.boxMax.y=q.position.y+A;break;case 3:u.boxMin.y=q.position.y-A;break;
case 4:u.boxMax.z=q.position.z+A;break;case 5:u.boxMin.z=q.position.z-A}}6!==D&&(WALK.log("Light probe bounds: X["+u.boxMin.x.toFixed(2)+":"+u.boxMax.x.toFixed(2)+"] Y["+u.boxMin.y.toFixed(2)+":"+u.boxMax.y.toFixed(2)+"] Z["+u.boxMin.z.toFixed(2)+":"+u.boxMax.z.toFixed(2)+"]"),u.resetBoundingBox())}}();e.prototype.constructor=e;WALK.LightProbeMaker=function(m,n,q,u,p){function w(I,H){G.position.copy(I.position);G.updateMatrixWorld();var P;if((P=u)&&!(P=p))a:{P=m.gpuMeshes;for(var U=0;U<P.length;U+=
1){var fa=P[U];if(fa.lightProbe===I&&fa.material.envMapMirror){P=!0;break a}}P=!1}(U=P)&&WALK.log("Mirror texture needed for the light probe.");A.reset();P=D.renderer;D.autoClearAlter.set(!0,!0,!1);if(U){U=D.renderer;var C=WALK.LIGHT_PROBE_MIRROR_SIZE;C=U.createRenderTargetCube(C,C,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(fa=0;6>fa;fa+=1)C.activeCubeFace=fa,U.render(D.threeScene,G.sideCameras[fa],C);U=U.context;fa=new WALK.Texture;fa.minFilter=
GLC.LINEAR;fa.generateMipmaps=!1;fa.needsUpdate=!1;fa.isCube=!0;fa.addEventListener("dispose",a.bind(void 0,U));fa.__webglTexture=C.__webglTexture;C.__webglTexture=null;C.dispose();C=fa;I.setMirrorTexture(C)}H&&l(D,G,I);H=D.renderer;U=D.targetCubeRaw;for(fa=0;6>fa;fa+=1)U.activeCubeFace=fa,H.render(D.threeScene,G.sideCameras[fa],U);D.autoClearAlter.restore();P.enableScissorTest(!0);D.autoClearAlter.set(!1,!1,!1);q&&(C=P.createCubeTexture(D.targetFiltered.width,!0),I.setFilteredTexture(C));for(H=0;H<
WALK.LIGHT_PROBE_MIPS_COUNT;H+=1){U=H;U=Math.pow(2,WALK.log2(D.targetFiltered.width)-U);P.setScissor(0,0,U,U);D.filterPass.uniforms.mipSize.value=U;D.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[H];q||(C=P.createCubeTexture(U,!1),I.setFilteredTextureNoLod(C,H));fa=D.filterPass;var Q=D.targetCubeRaw,da=D.targetFiltered,aa=D.pixelBuf,X=q?H:0,S=C;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var O=aa,la=255*X/WALK.LIGHT_PROBE_MIPS_COUNT,R=0;R<4*U*U;R+=4)O[R]=la,O[R+1]=la,O[R+2]=la,O[R+3]=31.875;
for(O=0;6>O;O+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||(fa.uniforms.face.value=O,fa.render(P,da,Q),b(P,U,aa)),P.copyBufferToCubeFaceMip(X,U,O,aa,S)}P.enableScissorTest(!1);D.autoClearAlter.restore();WALK.log("Cube generation time "+A.elapsedSec())}var v,y=m.threeScene,D=new e(n,m),A=new WALK.Timer,G=new WALK.CubeCamera(.15,m.camera.far);this.assignLightProbesToObjects=function(){A.reset();void 0===v&&(v=new WALK.ObjectVisibilityQuery(n,m.gpuMeshes,m.camera.far));for(var I=0;I<m.gpuMeshes.length;I+=1)m.gpuMeshes[I].lightProbe=
null;for(I=0;I<m.lightProbes.length;I+=1){var H=m.lightProbes[I],P=v.findVisibleObjects(H.position);WALK.log("Have visible objects "+P.length);f(H,P)}WALK.log("Light probe assigment time "+A.elapsedSec());h(m.lightProbes,WALK.filter(m.gpuMeshes,function(U){return null===U.lightProbe}))};this.findBounds=function(I){G.position.copy(I.position);G.updateMatrixWorld();D.autoClearAlter.set(!0,!0,!1);l(D,G,I);D.autoClearAlter.restore()};this.createLightProbeTexture=function(I,H){var P=new Set;c(y,P);w(I,
H);d(y,P)};this.createAllLightProbeTextures=function(){var I=new Set;c(y,I);for(var H=0;H<m.lightProbes.length;H+=1)w(m.lightProbes[H],!1);d(y,I)};this.dispose=function(){D.dispose();v&&v.dispose()}}})();(function(){function a(e){if(e.empty())return 0;e.size(d);return d.x*d.y*d.z}function b(e){if(e.empty())return 0;e.size(d);e=d.x*d.y;return 1>d.x||1>d.y||1.9>d.z||1.5>e?0:e*d.z}function c(e){var g=[],f=[];g.push(e);this.addFilledBox=function(k){f.push(k)};this.findBestFilledBoxes=function(){function k(p){return p[1]}function l(p){p=p[0];p=p.max.x<u.min.x+.2||p.min.x>u.max.x-.2||p.max.y<u.min.y+.2||p.min.y>u.max.y-.2||p.max.z<u.min.z+.2||p.min.z>u.max.z-.2?!1:!0;return!p}var m=[],n=[];for(f.forEach(function(p){n.push([p,
a(p)])});0<n.length&&10>m.length;){var q=WALK.indexOfMax(n,k);var u=n[q][0];m.push(u);n=n.filter(l)}return m};this.isEnclosedInFilledBox=function(k){return WALK.any(f,function(l){l=l.min.x-.1<=k.min.x&&k.max.x<=l.max.x+.1&&l.min.y-.1<=k.min.y&&k.max.y<=l.max.y+.1&&l.min.z-.1<=k.min.z&&k.max.z<=l.max.z+.1?!0:!1;return l})};this.findLargestEmptyBox=function(){var k=WALK.indexOfMax(g,a);return null!==k?g[k]:null};var h=function(){var k=[];k[0]=new THREE.Box3;k[1]=new THREE.Box3;k[2]=new THREE.Box3;k[3]=
new THREE.Box3;k[4]=new THREE.Box3;k[5]=new THREE.Box3;return function(l,m,n){k[0].max.copy(l.max);k[0].min.copy(l.min);k[0].min.z=m.max.z;k[1].max.copy(l.max);k[1].max.z=m.min.z;k[1].min.copy(l.min);k[2].max.copy(l.max);k[2].min.copy(l.min);k[2].min.x=m.max.x;k[3].max.copy(l.max);k[3].max.x=m.min.x;k[3].min.copy(l.min);k[4].max.copy(l.max);k[4].min.copy(l.min);k[4].min.y=m.max.y;k[5].max.copy(l.max);k[5].max.y=m.min.y;k[5].min.copy(l.min);var q=WALK.indexOfMax(k,b);0!==b(k[q])&&(n.push(k[q].clone()),
0===q?l.max.z=m.max.z:1===q?l.min.z=m.min.z:2===q?l.max.x=m.max.x:3===q?l.min.x=m.min.x:4===q?l.max.y=m.max.y:5===q&&(l.min.y=m.min.y),h(l,m,n))}}();this.split=function(k){for(var l=[],m=0;m<g.length;m+=1){var n=g[m];n.isIntersectionBox(k)?h(n,k,l):l.push(n)}g=l}}var d;WALK.arrangeLightProbes=function(e,g,f){function h(A){var G=new WALK.LightProbe({id:e.lightProbes.length});A.center(G.position);G.position.z=A.min.z+1.3;G.enableBoundingBox();G.boxMin.copy(A.min);G.boxMax.copy(A.max);e.lightProbes.push(G)}
var k=new c(e.boundingBox.clone()),l=new THREE.Box3,m=new THREE.Box3,n=new THREE.Vector3,q=new WALK.Timer;d=new THREE.Vector3;for(var u=new WALK.LightProbe({id:0}),p=0;200>p;p+=1){var w=k.findLargestEmptyBox();if(null===w)break;w.center(u.position);u.position.z=w.min.z+1.3;u.enableBoundingBox();m.makeEmpty();for(var v=0;5>v;v+=1){g.findBounds(u);if(!u.isBoundingBoxInitialized())break;l.set(u.boxMin,u.boxMax);var y=b(l);if(0===y)break;if(k.isEnclosedInFilledBox(l))break;l.center(n);n.z=l.min.z+1.3;
var D=u.position.distanceToSquared(n);a(m)<y&&.25>D&&m.set(l.min,l.max);if(.04>D)break;u.position.copy(n)}m.empty()?(w.center(l.min),w.center(l.max),k.split(l)):(k.addFilledBox(m.clone()),k.split(m))}WALK.log("Light probes arrangement time "+q.elapsedSec());g=k.findBestFilledBoxes();(g.reduce(function(A,G){return A+a(G)},0)>.2*a(e.boundingBox)||f)&&g.forEach(h);0===e.lightProbes.length&&f&&h(e.boundingBox)}})();/*
 Copyright (C) 2015-present Shapespark
*/
(function(){function a(l){return document.getElementById(l)}function b(l,m){l=document.getElementsByClassName(l);for(var n=0;n<l.length;n+=1)m(l[n])}function c(l){var m=[];b(l,function(q){m.push(q)});for(var n=0;n<m.length;n+=1)m[n].classList.remove(l)}function d(l,m){l.style.display=m?"":"none"}function e(l,m){d(a(l),m)}function g(l,m){b(l,function(n){d(n,m)})}function f(l){d(l,!0);l.style.opacity=0;WALK.defer(function(){l.style.opacity=1})}function h(){var l=document.getElementById("qr-code-canvas");
l?l.remove():(l=document.createElement("canvas"),l.setAttribute("id","qr-code-canvas"),document.body.appendChild(l),QRCode.toCanvas(l,window.location.toString()))}function k(l){l.style.opacity=0;var m=window.getComputedStyle(l).transitionDuration;if(m){var n=parseFloat(m);-1===m.indexOf("ms")&&(n*=1E3);setTimeout(function(){d(l,!1);l.style.opacity=1},n)}else d(l,!1),l.style.opacity=1}WALK.Menu=function(l,m,n,q,u){function p(ea){return function(Y){Y.stopPropagation();ea();WALK.DETECTOR.ios||a("walk-canvas").focus()}}
function w(ea,Y){ea.addEventListener("click",p(Y))}function v(ea,Y){w(a(ea),Y)}function y(ea){if(ea){var Y=null===T?[]:T.visibleViews(),va;for(va=0;va<Y.length&&Y[va]!==ea;va+=1);ea=a("view-list-items").children;if(va<ea.length)return ea[va]}return null}function D(ea){return function(){ea.classList.remove("active-view");ea.classList.remove("next-active-view")}}function A(){for(var ea=a("view-list-items").children,Y=0;Y<ea.length;Y+=1)ea[Y].classList.remove("active-view"),ea[Y].classList.remove("next-active-view")}
function G(){a("tour-button").classList.add("tour-on")}function I(){a("tour-button").classList.remove("tour-on");A()}function H(){ua.isRunning()?ua.stop():ua.start()}function P(){return ua.isRunning()?(ua.stop(),!0):!1}function U(ea){A();(ea=y(ea.view))&&ea.classList.add("next-active-view")}function fa(ea){if(ea=y(ea.view))ea.classList.remove("next-active-view"),ea.classList.add("active-view"),setTimeout(D(ea),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function C(ea){return p(function(){var Y=P();ka.switchToView(ea,
Y?0:void 0)})}function Q(){var ea=a("info-bar"),Y=a("info-bar-slide"),va=a("view-list"),L=a("view-list-slide"),ja=a("menu-bar"),Ca=a("menu-bar-slide"),za=a("menu-bar-folder");d(za,T&&!W);if(ma.visible){ea.style.pointerEvents=null;Y.style.left=0;va.style.pointerEvents=null;L.style.top=0;ja.style.pointerEvents=null;Ca.style.right=0;za.style.pointerEvents=null;za.children[0].style.transform="";if(null!==ma.cover){ja=ma.cover.title;L=ma.cover.author;Ca=ma.cover.authorHref;va=ma.cover.engineLogoOn;ea=
ma.cover.engineLogoText;Y=ma.cover.engineLogoUrl;za=ma.cover.authorLogoUrl;ma.cover.authorLogo&&(za=WALK.getExtraAssetUrl(ma.cover.authorLogo.path));var Ka=a("author-logo"),ya=Ka.firstElementChild;za?(Ca&&(Ka.href=Ca),ya.src=za):(d(Ka,!1),ya.removeAttribute("src"));za=null===T||null!==pa;e("info-text",za&&(ja||L));za&&(WALK.setTextContent(a("info-title"),ja),WALK.setTextContent(a("info-author"),L),Ca&&(a("info-author").href=Ca));ja=ja?ja:"3D scene";L&&(ja+=" by "+L);document.title=ja;L=a("engine-logo");
d(L,va);va&&(ea&&(va=a("engine-logo-text"),d(va,!0),WALK.setTextContent(va,ea)),Y&&(L.href=Y))}ea=null===T?[]:T.visibleViews();Y=a("view-list-items");e("view-list",0<ea.length&&!W);if(0<ea.length){va=Y.children[0];for(D(va)();1!==Y.children.length;)Y.removeChild(Y.children[Y.children.length-1]);for(L=0;L<ea.length;L+=1)ja=ea[L],ja.hideFromMenu||(WALK.setTextContent(va,ja.name),va.onclick=C(ja),Y.appendChild(va),va=va.cloneNode(!0))}e("menu-buttons",T&&!W);T&&T.canStartAutoTour()&&!Da?e("tour-button",
!0):(ua&&ua.isRunning()&&ua.stop(),e("tour-button",!1))}else Ka=a("menu-bar-content"),ea.style.pointerEvents="none",Y.style.left=-Y.offsetWidth+"px",va.style.pointerEvents="none",L.style.top=-L.offsetHeight+"px",ja.style.pointerEvents="none",za.style.pointerEvents="auto",Ca.style.right=-Ka.offsetWidth+"px",za.children[0].style.transform="rotate(180deg)";ea=ma.helpVisible;WALK.DETECTOR.mobile?e("mobile-help",ea):(e("desktop-help",ea),ea&&(ea=a("desktop-help-switch"),Y=a("desktop-help-content"),va=
Ha?1:0,ea.children[va].classList.add("selected"),d(Y.children[va],!0),ea.children[1-va].classList.remove("selected"),d(Y.children[1-va],!1)))}function da(){ma.visible=!Ba}function aa(){ma.helpVisible=!Ga}function X(){Ha=!1;Q()}function S(){Ha=!0;Q()}function O(){var ea=P();ka.switchToPreviousVisibleView(ea?0:void 0)}function la(){var ea=P();ka.switchToNextVisibleView(ea?0:void 0)}function R(ea){if(!(ea.ctrlKey||ea.altKey||ea.metaKey)){var Y=ea.target||ea.srcElement;Y=Y.nodeType===Node.ELEMENT_NODE?
Y.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(Y))if(67===ea.keyCode&&WALK.DEBUG)ea.shiftKey?WALK.DETECTOR.gl.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.gl.extension("WEBGL_lose_context").loseContext();else if(null!==T){switch(ea.keyCode){case 27:P();break;case 70:J&&q();break;case 76:ha&&u();break;case 72:aa();break;case 77:da();break;case 86:K&&n();break;case 80:l||(ea.shiftKey?wa.screenToLocalImage(!0,4E3,2E3):wa.screenToLocalImage(!1,window.innerWidth,window.innerHeight));
break;case 85:WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/qrcode.js"),h);break;case 219:O();break;case 221:la()}Y=ea.keyCode-48;if(1<=Y&&9>=Y){--Y;var va=null===T?[]:T.visibleViews();Y=va.length>Y?va[Y]:null;null!==Y&&C(Y)(ea)}}}}function ra(ea){switch(ea.action){case WALK.GAMEPAD_ACTION.PREVIOUS:O();break;case WALK.GAMEPAD_ACTION.NEXT:la()}}var ma=this,xa={type:"visibilityChanged"},T=null,ka=null,ua=null,wa=null,K=!1,J=!1,ha=!1,W=!1,Da=!1,Ba=!0,Ga=!1,Ha=!1,pa=null;this.cover=null;Object.defineProperty(this,
"visible",{get:function(){var ea=Da&&WALK.DETECTOR.mobile;return Ba&&!ea},set:function(ea){var Y=this.visible;Ba=ea;Y!==this.visible&&this.dispatchEvent(xa);Q()}});Object.defineProperty(this,"helpVisible",{get:function(){var ea=Da&&WALK.DETECTOR.mobile;return Ga&&!ea&&!W},set:function(ea){Ga=ea;Q()}});this.updateCover=function(ea){this.cover=ea;null!==pa&&clearTimeout(pa);pa=setTimeout(function(){pa=null;Q()},5E3);Q()};this.refresh=function(){Q()};this.onFullScreenChange=function(ea){};this.onPointerLockChange=
function(ea){W=ea;Q()};this.onVrChange=function(ea){var Y=this.visible;Da=ea;Y!==this.visible&&this.dispatchEvent(xa);Q()};this.onResize=function(){if(!this.visible){var ea=a("info-bar-slide"),Y=a("menu-bar-slide"),va=a("view-list-slide");ea.style.transition="none";Y.style.transition="none";va.style.transition="none";Q();ea.style.transition="";Y.style.transition="";va.style.transition=""}};this.enablePlayButton=function(ea){var Y=a("play-button");Y.addEventListener("click",ea);d(Y,!0)};this.setVrSupported=
function(ea){K=ea;g("vr-specific",ea)};this.setFullScreenSupported=function(){(J=!l)&&g("fullscreen-specific",!0)};this.setPointerLockSupported=function(){ha=!l};this.addExtraButton=function(ea){var Y=a("tour-button"),va=document.createElement("img");va.src=ea;ea=document.createElement("div");ea.className="menu-button menu-item ui-hoverable ui-panel";ea.appendChild(va);Y.parentNode.insertBefore(ea,Y);return ea};this.removeExtraButton=function(ea){ea.remove()};this.getExtraButonIcon=function(ea){return ea.firstElementChild};
this.sceneLoadStarted=function(){e("play-button",!1);e("primary-progress",!0)};this.loadProgress=function(ea){ea=ea.totalDone()/ea.total;if(null===T){var Y=Math.max(314.159*(1-ea),0);a("primary-progress-done").style.strokeDashoffset=Y}ea=Math.floor(100*ea);a("secondary-progress-done").style.width=ea+"%"};this.sceneReadyToDisplay=function(ea,Y,va,L){T=ea;ka=Y;ka.addEventListener("teleportStarted",U);ka.addEventListener("teleportDone",fa);ua=va;ua.addEventListener("tourStarted",G);ua.addEventListener("tourStopped",
I);wa=L;k(a("cover-image"));k(a("primary-progress"));f(a("secondary-progress"));T.addEventListener("viewAdded",Q);T.addEventListener("viewRemoved",Q);T.addEventListener("viewShifted",Q);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";Q()};this.sceneLoadComplete=function(){e("secondary-progress",!1)};this.init=function(){l&&(g("viewer-specific",!1),g("editor-specific",!0));b("ui-panel",function(va){w(va,function(){})});WALK.DETECTOR.mobile&&c("ui-hoverable");var ea=
a("author-logo"),Y=ea.firstElementChild;Y.onload=function(){d(ea,!0)};Y.onerror=function(){d(ea,!1)};document.addEventListener("keydown",R,!1);v("help-button",aa);v("fullscreen-button",q);v("vr-button",n);v("tour-button",H);v("menu-bar-folder",da);v("view-list-folder",da);v("basic-desktop-help-option",X);v("advanced-desktop-help-option",S);v("close-desktop-help-button",aa);v("close-mobile-help-button",aa);m.addEventListener("actionActivated",ra);Q()};this.contextLost=function(){T=ka=ua=wa=null;Q()}};
THREE.EventDispatcher.prototype.apply(WALK.Menu.prototype)})();(function(){WALK.USER_MSG=new function(){this.hideInfo=function(){document.getElementById("info-message").style.display="none"};this.info=function(a,b){var c=document.getElementById("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3)};this.error=function(a){var b=document.getElementById("error-message");b.innerHTML=a;b.style.display=""}}})();(function(){WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+
b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutorOnce=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}};WALK.DeferringExecutorInterval=function(a,b){function c(){a()}var d=null;this.deferRun=function(){null!==d&&clearInterval(d);d=setInterval(c,b)}}})();(function(){WALK.AnimationController=function(a,b,c){function d(){u(a.vrEnabled())}function e(){u(!1)}var g=this,f=new THREE.Clock,h=!1,k=!1,l=!1,m=0,n=!1,q=function(){k||(h||f.getDelta(),k=!0,a.vrEnabled()?a.requestAnimationFrame(d):requestAnimationFrame(e))};var u=function(p){n&&(k=!1,l?(console.assert(!p),c(f.getDelta(),m)?(m+=1,q()):l=!1):(h=!0,b(f.getDelta(),p),WALK.ALWAYS_RENDER&&g.requestFrame(),h=!1,k||(l=!0,m=0,q())))};this.requestFrame=function(){n&&(l=!1,q())};this.disable=function(){n=
!1};this.enable=function(){n=!0;k=!1;this.requestFrame()};this.isEnabled=function(){return n}}})();(function(){WALK.ExposureController=function(a,b,c){var d=a.camera,e=!1,g=0,f,h,k,l=new WALK.Timer,m=function(u){k=u;g=u-d.exposure;h=Math.sign(g);g=Math.abs(g);f=g/1};this.adaptExposure=function(){if(e&&d.autoExposure){l.reset();var u=c.measureReflectedLuma();0>u?g=0:(m(Math.log2(d.autoExposureDarkness/u)),.3>g&&(g=0))}};this.exposureNeedsUpdate=function(){return 0<g};var n=new THREE.Vector3(Infinity,Infinity,Infinity),q=function(){return function(){if(!e||!d.autoExposure){for(var u=a.cameraVolumes.length-
1;0<=u;--u){var p=a.cameraVolumes[u];if(p.worldCoordinatesInside(n)){m(p.exposure);d.setGamma(p.gamma);return}}m(d.defaultExposure);d.setGamma(d.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(u){u.cameraVolume.addEventListener("updated",q);q()});a.addEventListener("cameraVolumeShifted",q);a.addEventListener("cameraVolumeRemoved",function(u){u.cameraVolume.removeEventListener("cameraVolumeUpdated",q);q()});d.addEventListener("updated",q);this.update=function(u){var p=b.cameraWorldPosition();
n.equals(p)||(n.copy(p),q());this.exposureNeedsUpdate()&&(u=Math.min(f*u,g),g-=u,1E-5>g?(g=0,d.exposure=k):d.exposure+=u*h)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){e=!0;g=0};this.disableAutoExposure=function(){e=!1;q()}}})();(function(){function a(b,c){for(var d=0,e=0,g=0;65536>g;++g){var f=4*g;f=b[f]+255*b[f+1];0!==f&&(e+=1,c[f]+=1,d=Math.max(d,f))}if(256>e)return-1;g=b=0;for(f=1;f<=d;++f)if(c[f]+b<.3*e)b+=c[f],c[f]=0;else break;for(f=d;0<=f;--f)if(c[f]+g<.1*e)g+=c[f],c[f]=0;else break;f=0;for(var h=1;h<=d;++h)f+=c[h]*Math.log(h/255),c[h]=0;return Math.exp(f/(e-b-g))}WALK.LumaMeter=function(b,c){function d(n){g||(console.assert(!g),g=b.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,
stencilBuffer:!1,generateMipmaps:!1}),f=new WALK.AutoClearAlter(b),h=new Uint8Array(262144),k=new Uint32Array(65280),l=new WALK.LumaMaterial(!0),m=new WALK.LumaMaterial(!1));n=n?l:m;f.set(!0,!0,!1);var q=c.gpuMeshes.filter(function(u){return!u.material.transparent});b.renderMeshes(q,n,e,g);b.readPixels(256,256,h);b.setRenderTarget(null);f.restore();return a(h,k)}var e=c.camera,g,f,h,k,l,m;this.measureIncidentLuma=function(){return d(!0)};this.measureReflectedLuma=function(){return d(!1)}}})();(function(){function a(){var b={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};b=new THREE.ShaderPass(b,"inputBuffer");b.material.depthTest=!1;b.material.depthWrite=!1;b.material.blending=THREE.CustomBlending;b.material.blendEquation=GLC.FUNC_ADD;b.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;b.material.blendSrc=GLC.SRC_ALPHA;return b}WALK.SsaaRenderer=function(b,c){var d,
e,g=0,f=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],h=new THREE.RenderPass(c.threeScene,c.camera),k=a(),l=new THREE.ShaderPass(THREE.CopyShader);l.renderToScreen=!0;var m=new WALK.AutoClearAlter(b);this.reset=function(){g=0};this.renderSample=function(){console.assert(g<f.length);m.set(!0,!0,!1);var n=e.width,q=e.height,u=f[g][0]-.5,
p=f[g][1]-.5,w=c.camera,v=n/q,y=Math.tan(.5*THREE.Math.degToRad(w.fov));y=w.near*y/w.zoom;var D=-y,A=D*v;v*=y;n=(v-A)/n;q=(y-D)/q;w.projectionMatrix.makeFrustum(A-u*n,v-u*n,D-p*q,y-p*q,w.near,w.far);h.render(b,d);m.restore();m.set(!1,!1,!1);k.uniforms.weight.value=1/(g+1);k.render(b,e,d);m.restore();c.camera.updateProjectionMatrix();g+=1};this.renderedSamplesCount=function(){return g};this.allSamplesRendered=function(){return g===f.length};this.renderAccumulatedSamplesToScreen=function(){m.set(!0,
!0,!1);l.render(b,void 0,e);m.restore()};this.copyAccumulatedSamplesToBuffer=function(){var n=e.width,q=e.height,u=new Uint8Array(n*q*4);b.readPixels(n,q,u);return u};this.setTargets=function(n,q){console.assert(n.width===q.width&&n.height===q.height);d=n;e=q};this.dispose=function(){k.material.dispose()}}})();(function(){function a(b){return b.split("\n").map(function(c,d){return d+1+": "+c}).join("\n")}WALK.createWebGLShader=function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);var e=!1===b.getShaderParameter(c,b.COMPILE_STATUS);e&&console.error("Shader failed to compile.");if(e||WALK.LOG_INFO)b=b.getShaderInfoLog(c),""!==b&&console.warn("Shader info log: ",b,a(d));return c}})();(function(){WALK.WebGLState=function(a){var b=Array(16).fill(0),c=Array(16).fill(null),d=b.map(function(){return 0}),e=null,g=null,f=null,h=null,k=null,l=null,m=null,n=null,q=null,u=null,p=null,w=null,v=null,y=null,D=null,A=null;this.resetAttributeStates=function(){for(var G=0,I=b.length;G<I;G++)b[G]=0};this.disableAttributeStates=function(){for(var G=0,I=b.length;G<I;G++)a.disableVertexAttribArray(G),b[G]=0};this.enableAttributeArray=function(G){2!==b[G]&&(a.enableVertexAttribArray(G),b[G]=2)};this.disableAttributeArray=
function(G,I){1!==b[G]&&(a.disableVertexAttribArray(G),b[G]=1);c[G]!==I&&(2===I.length?a.vertexAttrib2fv(G,I):3===I.length?a.vertexAttrib3fv(G,I):4===I.length&&a.vertexAttrib4fv(G,I),c[G]=I)};this.resetAttributeDivisors=function(){for(var G=0,I=d.length;G<I;G++)d[G]&&(a.vertexAttribDivisor(G,0),d[G]=0)};this.setAttributeDivisor=function(G,I){a.vertexAttribDivisor(G,I);d[G]=I};this.setBlending=function(G){var I=G.blending;I!==e&&(I===THREE.NoBlending?a.disable(a.BLEND):I===THREE.AdditiveBlending?(a.enable(a.BLEND),
a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):I===THREE.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):I===THREE.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):I===THREE.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),e=I);if(I===THREE.CustomBlending){I=
G.blendEquation;var H=G.blendEquationAlpha||I,P=G.blendSrc,U=G.blendDst,fa=G.blendSrcAlpha||P;G=G.blendDstAlpha||U;if(I!==g||H!==k)a.blendEquationSeparate(I,H),g=I,k=H;if(P!==f||U!==h||fa!==l||G!==m)a.blendFuncSeparate(P,U,fa,G),f=P,h=U,l=fa,m=G}else m=l=k=h=f=g=null};this.setDepthTest=function(G){n!==G&&(G?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),n=G)};this.setDepthWrite=function(G){q!==G&&(a.depthMask(G),q=G)};this.setColorWrite=function(G){u!==G&&(a.colorMask(G,G,G,G),u=G)};this.setDoubleSided=
function(G){p!==G&&(G?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),p=G)};this.setFlipSided=function(G){w!==G&&(G?a.frontFace(a.CW):a.frontFace(a.CCW),w=G)};this.setViewport=function(G,I,H,P){if(v!==G||y!==I||D!==H||A!==P)a.viewport(G,I,H,P),v=G,y=I,D=H,A=P}}})();(function(){function a(d,e){var g=e.index0AttributeName,f=d.createProgram(),h=WALK.createWebGLShader(d,d.VERTEX_SHADER,e.generateVertexShader()),k=WALK.createWebGLShader(d,d.FRAGMENT_SHADER,e.generateFragmentShader());d.attachShader(f,h);d.attachShader(f,k);void 0!==g&&d.bindAttribLocation(f,0,g);d.linkProgram(f);g=d.getProgramInfoLog(f).trim();!1===d.getProgramParameter(f,d.LINK_STATUS)&&console.error("Shader link error: "+d.getError(),"validate status: ",d.getProgramParameter(f,d.VALIDATE_STATUS));
""!==g&&"\x00"!==g&&console.warn("program info log: "+g);d.deleteShader(h);d.deleteShader(k);h={};k=0;for(g=b.length;k<g;k++){var l=b[k];h[l]=d.getUniformLocation(f,l)}this.transformUniformCache=h;h=e.uniforms;k={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var m;for(n in h)h.hasOwnProperty(n)&&(g=d.getUniformLocation(f,n))&&(l=h[n].type,console.assert(k.hasOwnProperty(l)),"i"===l||"f"===l||"t"===l?m=null:"v2"===l?m=[null,null]:"v3"===l||"c"===l?m=[null,null,null]:"v4"===l?m=[null,null,null,null]:
"m4"===l?m=null:console.assert(!1),k[l].push({id:n,value:m,location:g}));this.materialUniformCache=k;e=e.attributes;m={};var n=0;for(h=e.length;n<h;n++)k=e[n],m[k]=d.getAttribLocation(f,k);this.attributes=m;this.attributesKeys=Object.keys(this.attributes);this.id=c++;this.usedTimes=1;this.program=f;return this}var b="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),c=0;WALK.WebGLProgramStore=function(d){var e=new Map;this.assignProgramToMaterial=function(g){console.assert(g instanceof
WALK.BaseMaterial);var f=g.generateProgramId(),h=e[f];h?h.usedTimes++:(h=new a(d,g),e[f]=h);g.program&&this.resetProgramAssignment(g);g.program=h};this.resetProgramAssignment=function(g){var f=g.program;g.program=null;--f.usedTimes;if(0===f.usedTimes){for(var h in e)if(e.hasOwnProperty(h)&&e[h]===f){delete e[h];break}d.deleteProgram(f.program)}}}})();(function(){function a(){this.texture=null;this.locked=!1;this.usedCount=0}function b(c){for(var d=[],e=0;e<c;e+=1)d[e]=new a;return d}WALK.WebGLTextureSlotter=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=b(d);this.setSlot=function(g,f){var h=g.__webglSlot;if(null!==h){var k=e[h];k.usedCount+=1;k.locked=k.locked||f;return!1}for(var l=Infinity,m=0;m<d;m+=1)k=e[m],!k.locked&&k.usedCount<l&&(l=k.usedCount,h=m);null===h&&(console.warn("Not enough texture units"),h=0);k=e[h];k.texture&&
(k.texture.__webglSlot=null);k.texture=g;k.usedCount=1;k.locked=f;g.__webglSlot=h;return!0};this.unlockAllSlots=function(){for(var g=0;g<d;g+=1)e[g].locked=!1};this.freeSlot=function(g){if(null!==g.__webglSlot){var f=e[g.__webglSlot];g.__webglSlot=null;f.texture=null;f.locked=!1;f.usedCount=0}}};WALK.WebGLTextureSlotterSequential=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),e=0;this.setSlot=function(g,f){e===d&&(console.warn("Not enough texture units"),e=0);g.__webglSlot=e;f&&(e+=1);
return!0};this.unlockAllSlots=function(){e=0};this.freeSlot=function(g){g.__webglSlot=null}}})();(function(){function a(d,e){d.drawArraysInstanced=function(g){for(var f=[],h=0;h<arguments.length;++h)f[h-0]=arguments[h];return e.drawArraysInstancedANGLE.apply(e,$jscomp.arrayFromIterable(f))};d.drawElementsInstanced=function(g){for(var f=[],h=0;h<arguments.length;++h)f[h-0]=arguments[h];return e.drawElementsInstancedANGLE.apply(e,$jscomp.arrayFromIterable(f))};d.vertexAttribDivisor=function(g){for(var f=[],h=0;h<arguments.length;++h)f[h-0]=arguments[h];return e.vertexAttribDivisorANGLE.apply(e,
$jscomp.arrayFromIterable(f))}}function b(d,e){for(var g={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},f=$jscomp.makeIterator(Object.entries(GLC)),h=f.next();!h.done;h=f.next()){var k=$jscomp.makeIterator(h.value);h=k.next().value;k=k.next().value;var l=g[h];void 0!==l?(l=e.gl.extension(l))&&console.assert(l[h]===k):console.assert(d[h]===k)}}function c(d){return WALK.DETECTOR.gl.disableTextureSlotReuse?new WALK.WebGLTextureSlotterSequential(d):
new WALK.WebGLTextureSlotter(d)}WALK.WebGLRenderer=function(d,e){function g(K,J){if(!WALK.DETECTOR.gl.webgl2)return K;if(J===GLC.FLOAT){if(K===GLC.RGB)return e.RGB32F;console.assert("Missing mapping")}return K}function f(){O=!!WALK.DETECTOR.gl.instances;da=Q=null;aa=-1;S=X=null;!WALK.DETECTOR.gl.webgl2&&O&&a(e,WALK.DETECTOR.gl.instances);la=new WALK.WebGLState(e);R=new WALK.WebGLProgramStore(e);e.clearColor(0,0,0,1);e.clearDepth(1);e.clearStencil(0);e.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);
e.cullFace(e.BACK);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);la.setViewport(0,0,d.width,d.height);e.clearColor(H.r,H.g,H.b,P);WALK.DETECTOR.ie||e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE)}function h(K){K=K.target;K.removeEventListener("dispose",h);delete K.__webglInit;K=K.attributes;for(var J in K)if(K.hasOwnProperty(J)){var ha=K[J];void 0!==ha.buffer&&(e.deleteBuffer(ha.buffer),delete ha.buffer)}la.disableAttributeStates();
X=null}function k(K){K=K.target;K.removeEventListener("dispose",k);T.freeSlot(K);K.__webglTexture&&(e.deleteTexture(K.__webglTexture),K.__webglTexture=null)}function l(K){K=K.target;K.removeEventListener("dispose",l);T.freeSlot(K);K.__webglTexture&&(e.deleteTexture(K.__webglTexture),K.__webglTexture=null);if(K.isCube)for(var J=0;6>J;J++)e.deleteFramebuffer(K.__webglFramebuffer[J]),e.deleteRenderbuffer(K.__webglRenderbuffer[J]);else e.deleteFramebuffer(K.__webglFramebuffer),e.deleteRenderbuffer(K.__webglRenderbuffer);
K.__webglFramebuffer=null;K.__webglRenderbuffer=null}function m(K){K=K.target;K.removeEventListener("dispose",m);R.resetProgramAssignment(K)}function n(K,J,ha){var W=ha.attributes,Da=J.attributes;J=J.attributesKeys;ha=16*(ha.instanceId||0);for(var Ba=0,Ga=J.length;Ba<Ga;Ba++){var Ha=J[Ba],pa=Da[Ha];if(0<=pa){var ea=W[Ha];if(void 0!==ea){Ha=ea.itemSize;var Y=ea.glType;e.bindBuffer(e.ARRAY_BUFFER,ea.buffer);ea=ea.divisor||0;la.enableAttributeArray(pa);e.vertexAttribPointer(pa,Ha,Y,!1,0,ha*ea);O&&la.setAttributeDivisor(pa,
ea)}else la.disableAttributeArray(pa,K.defaultAttributeValues[Ha])}}}function q(K,J){var ha=WALK.DETECTOR;e.texParameteri(K,e.TEXTURE_WRAP_S,J.wrapS);e.texParameteri(K,e.TEXTURE_WRAP_T,J.wrapT);e.texParameteri(K,e.TEXTURE_MAG_FILTER,J.magFilter);e.texParameteri(K,e.TEXTURE_MIN_FILTER,J.minFilter);var W=ha.gl.extension("EXT_texture_filter_anisotropic");W&&1<J.anisotropy&&e.texParameterf(K,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(J.anisotropy,ha.gl.maxAnisotropy))}function u(K,J){var ha=K.material,W=J.material,
Da=ha.program,Ba=W.program;return Da&&Ba&&Da.id!==Ba.id?Da.id-Ba.id:ha.id-W.id||K.id-J.id}function p(K,J){var ha=K.material.transparentRenderOrder-J.material.transparentRenderOrder;return ha?ha:J.cameraDistance-K.cameraDistance||K.id-J.id}function w(K,J,ha){if(ha||!1!==K.visible){K instanceof THREE.Mesh&&(!1===K.frustumCulled||!0===ra.intersectsObject(K))&&((J||K.material).transparent?(!0===C.sortObjects&&(K.cameraDistance=ra.nearPlaneDistanceToCenter(K)),fa.push(K)):U.push(K));for(var W=0,Da=K.children.length;W<
Da;W++)w(K.children[W],J,ha)}}function v(K){la.setDoubleSided(K.side===THREE.DoubleSide);la.setFlipSided(K.side===THREE.BackSide)}function y(K){K.__webglTexture||(K.addEventListener("dispose",k),K.__webglTexture=e.createTexture());e.activeTexture(e.TEXTURE0+K.__webglSlot);e.bindTexture(e.TEXTURE_2D,K.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,K.flipY);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha);e.pixelStorei(e.UNPACK_ALIGNMENT,K.unpackAlignment);var J=K.image,ha=THREE.Math.isPowerOfTwo(J.width)&&
THREE.Math.isPowerOfTwo(J.height),W=K.format,Da=K.type,Ba=g(W,Da);q(e.TEXTURE_2D,K);var Ga=K.mipmaps;if(K instanceof WALK.DataTexture)if(0<Ga.length&&ha){for(var Ha=0,pa=Ga.length;Ha<pa;Ha++)J=Ga[Ha],e.texImage2D(e.TEXTURE_2D,Ha,Ba,J.width,J.height,0,W,Da,J.data),K.releaseOnLoadedToGpu&&(J.data=null);K.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,Ba,J.width,J.height,0,W,Da,J.data),K.releaseOnLoadedToGpu&&(J.data=null);else if(K instanceof WALK.CompressedTexture)for(Ha=0,pa=Ga.length;Ha<pa;Ha++)J=
Ga[Ha],K.format!==GLC.RGBA&&K.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_2D,Ha,Ba,J.width,J.height,0,J.data):e.texImage2D(e.TEXTURE_2D,Ha,Ba,J.width,J.height,0,W,Da,J.data),K.releaseOnLoadedToGpu&&(J.data=null);else if(0<Ga.length&&ha){Ha=0;for(pa=Ga.length;Ha<pa;Ha++)J=Ga[Ha],e.texImage2D(e.TEXTURE_2D,Ha,Ba,W,Da,J);K.releaseOnLoadedToGpu&&(K.mipmaps=null);K.generateMipmaps=!1}else e.texImage2D(e.TEXTURE_2D,0,Ba,W,Da,K.image),K.releaseOnLoadedToGpu&&(K.image=null);K.generateMipmaps&&ha&&e.generateMipmap(e.TEXTURE_2D);
K.needsUpdate=!1}function D(K){la.setBlending(K);la.setDepthTest(K.depthTest);la.setDepthWrite(K.depthWrite);la.setColorWrite(K.colorWrite)}function A(K,J,ha){if(ha){var W=ha;D(W);v(W)}for(var Da=0,Ba=K.length;Da<Ba;Da+=1){var Ga=K[Da],Ha=Ga.geometry,pa=Ga.material;ha?ha.doNotOverrideSide&&pa&&v(pa):(W=pa,D(W),v(W));pa=W;if(!1!==pa.visible&&0!==Ha.vertexCnt){var ea=J;var Y=pa;Y.programNeedsUpdate&&(R.assignProgramToMaterial(Y),Y.addEventListener("dispose",m),Y.programNeedsUpdate=!1);console.assert(!Y.morphTargets);
var va=!1,L=!1;var ja=Y.program;var Ca=ja.transformUniformCache;var za=Y.uniforms;ja.id!==Q&&(e.useProgram(ja.program),Q=ja.id,L=va=!0);Y.id!==aa&&(aa=Y.id,L=!0);if(va||ea!==S)e.uniformMatrix4fv(Ca.projectionMatrix,!1,ea.projectionMatrix.elements),ea!==S&&(S=ea),console.assert(Y instanceof WALK.BaseMaterial),null!==Ca.cameraPosition&&(xa.setFromMatrixPosition(ea.matrixWorld),e.uniform3f(Ca.cameraPosition,xa.x,xa.y,xa.z)),null!==Ca.viewMatrix&&e.uniformMatrix4fv(Ca.viewMatrix,!1,ea.matrixWorldInverse.elements);
Y.refreshPerObjectUniforms&&Y.refreshPerObjectUniforms(Ga,za)&&(L=!0);if(L){var Ka=ja;L=za;va=Ka.materialUniformCache.i;Y=0;for(za=va.length;Y<za;Y+=1){var ya=va[Y];var Oa=ya.id;var Ja=L[Oa].value;ya.value!==Ja&&(e.uniform1i(ya.location,Ja),ya.value=Ja)}va=Ka.materialUniformCache.f;Y=0;for(za=va.length;Y<za;Y+=1)ya=va[Y],Oa=ya.id,Ja=L[Oa].value,ya.value!==Ja&&(e.uniform1f(ya.location,Ja),ya.value=Ja);va=Ka.materialUniformCache.v2;Y=0;for(za=va.length;Y<za;Y+=1){ya=va[Y];Oa=ya.id;Ja=L[Oa].value;var $a=
Ja.x;var Za=Ja.y;if(ya.value[0]!==$a||ya.value[1]!==Za)e.uniform2f(ya.location,$a,Za),ya.value[0]=$a,ya.value[1]=Za}va=Ka.materialUniformCache.v3;Y=0;for(za=va.length;Y<za;Y+=1)if(ya=va[Y],Oa=ya.id,Ja=L[Oa].value,$a=Ja.x,Za=Ja.y,Oa=Ja.z,ya.value[0]!==$a||ya.value[1]!==Za||ya.value[2]!==Oa)e.uniform3f(ya.location,$a,Za,Oa),ya.value[0]=$a,ya.value[1]=Za,ya.value[2]=Oa;va=Ka.materialUniformCache.c;Y=0;for(za=va.length;Y<za;Y+=1)if(ya=va[Y],Oa=ya.id,Ja=L[Oa].value,$a=Ja.r,Za=Ja.g,Oa=Ja.b,ya.value[0]!==
$a||ya.value[1]!==Za||ya.value[2]!==Oa)e.uniform3f(ya.location,$a,Za,Oa),ya.value[0]=$a,ya.value[1]=Za,ya.value[2]=Oa;va=Ka.materialUniformCache.v4;Y=0;for(za=va.length;Y<za;Y+=1)if(ya=va[Y],Oa=ya.id,Ja=L[Oa].value,$a=Ja.x,Za=Ja.y,Oa=Ja.z,Ja=Ja.w,ya.value[0]!==$a||ya.value[1]!==Za||ya.value[2]!==Oa||ya.value[3]!==Ja)e.uniform4f(ya.location,$a,Za,Oa,Ja),ya.value[0]=$a,ya.value[1]=Za,ya.value[2]=Oa,ya.value[3]=Ja;va=Ka.materialUniformCache.m4;Y=0;for(za=va.length;Y<za;Y+=1)ya=va[Y],Oa=ya.id,e.uniformMatrix4fv(location,
!1,L[Oa].value.elements);va=Ka.materialUniformCache.t;Y=0;for(za=va.length;Y<za;Y+=1)if(ya=va[Y],Oa=ya.id,Za=L[Oa].value,Oa=T.setSlot(Za,!0),Ka=Za.__webglSlot,ya.value!==Ka&&(e.uniform1i(ya.location,Ka),ya.value=Ka),Oa||Za.needsUpdate)if(Za.isCube){if(ya=Za,e.activeTexture(e.TEXTURE0+ya.__webglSlot),e.bindTexture(e.TEXTURE_CUBE_MAP,ya.__webglTexture),ya.needsUpdate){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,ya.flipY);Ka=ya instanceof WALK.CompressedTexture;Oa=ya.image;Za=ya.format;$a=ya.type;Ja=g(Za,$a);
q(e.TEXTURE_CUBE_MAP,ya);for(var xb=0;6>xb;xb++)if(Ka)for(var Db=Oa[xb].mipmaps,nb=0,db=Db.length;nb<db;nb++){var N=Db[nb];ya.format!==GLC.RGBA&&ya.format!==GLC.RGB?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+xb,nb,Ja,N.width,N.height,0,N.data):e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+xb,nb,Ja,N.width,N.height,0,Za,$a,N.data);ya.releaseOnLoadedToGpu&&(N.data=null)}else e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+xb,0,Ja,Za,$a,Oa[xb]),ya.releaseOnLoadedToGpu&&(Oa[xb]=null);ya.generateMipmaps&&
e.generateMipmap(e.TEXTURE_CUBE_MAP);ya.needsUpdate=!1}}else ya=Za,ya.needsUpdate?y(ya):(e.activeTexture(e.TEXTURE0+ya.__webglSlot),e.bindTexture(e.TEXTURE_2D,ya.__webglTexture));T.unlockAllSlots()}za=ea;ea=Ca;Ga.matrixWorld?(ua.multiplyMatrices(za.matrixWorldInverse,Ga.matrixWorld),za=ua):za=za.matrixWorldInverse;e.uniformMatrix4fv(ea.modelViewMatrix,!1,za.elements);ea.normalMatrix&&(wa.getNormalMatrix(za),e.uniformMatrix3fv(ea.normalMatrix,!1,wa.elements));null!==Ca.modelMatrix&&(Ga.matrixWorld?
e.uniformMatrix4fv(Ca.modelMatrix,!1,Ga.matrixWorld.elements):e.uniformMatrix4fv(Ca.modelMatrix,!1,ka));ea=ja;za=!1;if(Ha.id!==X||ea.id!==Q)X=Ha.id,za=!0;console.assert(Ga instanceof THREE.Mesh);Ga=e.TRIANGLES;(Y=Ha.attributes.index)?(ja=Y.glType,Ca=Ha.indexUint?4:2,za&&(n(pa,ea,Ha),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,Y.buffer)),void 0!==Ha.indexOffset?(pa=Ha.indexCnt,Ca*=Ha.indexOffset):(pa=Y.length,Ca=0),Ha.isInstanced?e.drawElementsInstanced(Ga,pa,ja,Ca,Ha.instanceCount):e.drawElements(Ga,pa,ja,
Ca)):(za&&n(pa,ea,Ha),pa=Ha.attributes.position,void 0!==Ha.vertexOffset?(ja=Ha.vertexCnt,pa=Ha.vertexOffset):(ja=pa.length/pa.itemSize,pa=0),Ha.isInstanced?e.drawArraysInstanced(Ga,pa,ja,Ha.instanceCount):e.drawArrays(Ga,pa,ja));O&&la.resetAttributeDivisors()}}}function G(K,J){e.bindRenderbuffer(e.RENDERBUFFER,K);J.depthBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,J.width,J.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,K)):e.renderbufferStorage(e.RENDERBUFFER,
e.RGBA4,J.width,J.height)}function I(K,J){J.addEventListener("dispose",l);J.__webglTexture=e.createTexture();var ha=J.format,W=J.type,Da=g(ha,W);T.setSlot(J,!1);e.activeTexture(e.TEXTURE0+J.__webglSlot);if(K){e.bindTexture(e.TEXTURE_CUBE_MAP,J.__webglTexture);q(e.TEXTURE_CUBE_MAP,J);for(K=0;6>K;K++){J.__webglFramebuffer[K]=e.createFramebuffer();J.__webglRenderbuffer[K]=e.createRenderbuffer();e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,Da,J.width,J.height,0,ha,W,null);var Ba=e.TEXTURE_CUBE_MAP_POSITIVE_X+
K,Ga=J.__webglTexture;e.bindFramebuffer(e.FRAMEBUFFER,J.__webglFramebuffer[K]);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,Ba,Ga,0);G(J.__webglRenderbuffer[K],J)}J.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP)}else J.__webglFramebuffer=e.createFramebuffer(),J.__webglRenderbuffer=J.shareDepthFrom?J.shareDepthFrom.__webglRenderbuffer:e.createRenderbuffer(),e.bindTexture(e.TEXTURE_2D,J.__webglTexture),q(e.TEXTURE_2D,J),e.texImage2D(e.TEXTURE_2D,0,Da,J.width,J.height,0,ha,W,null),
ha=e.TEXTURE_2D,W=J.__webglTexture,e.bindFramebuffer(e.FRAMEBUFFER,J.__webglFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,ha,W,0),J.shareDepthFrom?J.depthBuffer&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,J.__webglRenderbuffer):G(J.__webglRenderbuffer,J),J.generateMipmaps&&e.generateMipmap(e.TEXTURE_2D);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)}var H=new THREE.Color(0),P=0,U=[],fa=[];this.domElement=
d;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var C=this,Q,da,aa,X,S,O,la,R,ra=new WALK.Frustum,ma=new THREE.Matrix4,xa=new THREE.Vector3;f();b(e,WALK.DETECTOR);this.webGLContextRestored=function(){f()};this.context=e;this.state=la;var T=c(e),ka=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(K,J){d.width=K;d.height=J;null===da&&this.setViewport(0,0,K,J)};this.setViewport=function(K,J,ha,W){la.setViewport(K,J,ha,
W)};this.setScissor=function(K,J,ha,W){e.scissor(K,J,ha,W)};this.enableScissorTest=function(K){K?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)};this.setClearColor=function(K,J){H.copy(K);P=void 0!==J?J:1;e.clearColor(H.r,H.g,H.b,P)};this.getClearColor=function(){return H};this.getClearAlpha=function(){return P};this.clear=function(K,J,ha){var W=0;K&&(W|=e.COLOR_BUFFER_BIT);J&&(W|=e.DEPTH_BUFFER_BIT);ha&&(W|=e.STENCIL_BUFFER_BIT);e.clear(W)};this.clearColor=function(){e.clear(e.COLOR_BUFFER_BIT)};
this.clearDepth=function(){e.clear(e.DEPTH_BUFFER_BIT)};this.clearStencil=function(){e.clear(e.STENCIL_BUFFER_BIT)};var ua=new THREE.Matrix4,wa=new THREE.Matrix3;this.setRenderTarget=function(K){if(K){var J=K.isCube?K.__webglFramebuffer[K.activeCubeFace]:K.__webglFramebuffer;var ha=K.x;var W=K.y;var Da=K.width;K=K.height}else J=null,W=ha=0,Da=d.width,K=d.height;J!==da&&(e.bindFramebuffer(e.FRAMEBUFFER,J),da=J);la.setViewport(ha,W,Da,K)};this.render=function(K,J,ha,W){this.renderMeshes(K.children,
K.overrideMaterial,J,ha,W)};this.renderMeshes=function(K,J,ha,W,Da,Ba){X=null;aa=-1;S=null;ha.matrixWorldInverse.getInverse(ha.matrixWorld);ma.multiplyMatrices(ha.projectionMatrix,ha.matrixWorldInverse);ra.setFromMatrix(ma);U.length=0;fa.length=0;Ba=void 0===Ba?!1:Ba;for(var Ga=0;Ga<K.length;Ga+=1)w(K[Ga],J,Ba);!0===C.sortObjects&&(U.sort(u),fa.sort(p));this.setRenderTarget(W);(this.autoClear||Da)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);A(U,ha,J);A(fa,ha,J);W&&W.generateMipmaps&&
(K=T.setSlot(W,!1),e.activeTexture(e.TEXTURE0+W.__webglSlot),W.isCube?(K&&e.bindTexture(e.TEXTURE_CUBE_MAP,W.__webglTexture),e.generateMipmap(e.TEXTURE_CUBE_MAP)):(K&&e.bindTexture(e.TEXTURE_2D,W.__webglTexture),e.generateMipmap(e.TEXTURE_2D)));la.setDepthTest(!0);la.setDepthWrite(!0);la.setColorWrite(!0);la.resetAttributeStates()};this.uploadNewBuffers=function(K){var J=K.geometry;K=J.attributes;var ha=J.attributesKeys;void 0===J.__webglInit&&(J.__webglInit=!0,J.addEventListener("dispose",h));console.assert(J instanceof
THREE.BufferGeometry);J=0;for(var W=ha.length;J<W;J+=1){var Da=ha[J],Ba=K[Da];Da="index"===Da?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(Ba.buffer)!0===Ba.needsUpdate&&console.assert(!1);else{Ba.buffer=e.createBuffer();e.bindBuffer(Da,Ba.buffer);var Ga=Ba.array;WALK.DETECTOR.ios&&Da===e.ARRAY_BUFFER&&console.assert(0===Ba.itemSize*Ga.BYTES_PER_ELEMENT%4);e.bufferData(Da,Ga,e.STATIC_DRAW);Ga instanceof Float32Array?Ba.glType=e.FLOAT:Ga instanceof Int8Array?Ba.glType=e.BYTE:Ga instanceof Int16Array?Ba.glType=
e.SHORT:Ga instanceof Uint16Array?Ba.glType=e.UNSIGNED_SHORT:Ga instanceof Uint32Array?Ba.glType=e.UNSIGNED_INT:console.assert(!1);Ba.releaseOnLoadedToGpu&&(Ba.array=null);Ba.needsUpdate=!1}}};this.uploadTexture=function(K){T.setSlot(K,!1);y(K)};this.copyBufferToCubeFaceMip=function(K,J,ha,W,Da){T.setSlot(Da,!1);e.activeTexture(e.TEXTURE0+Da.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,Da.__webglTexture);e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ha,K,e.RGBA,J,J,0,e.RGBA,e.UNSIGNED_BYTE,W)};this.createCubeTexture=
function(K,J){var ha=new WALK.Texture;ha.isCube=!0;ha.minFilter=J?GLC.LINEAR_MIPMAP_NEAREST:GLC.LINEAR;ha.generateMipmaps=!1;ha.needsUpdate=!1;ha.addEventListener("dispose",k);ha.__webglTexture=e.createTexture();T.setSlot(ha,!1);e.activeTexture(e.TEXTURE0+ha.__webglSlot);e.bindTexture(e.TEXTURE_CUBE_MAP,ha.__webglTexture);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);
e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);J?e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var W=0;6>W;W+=1)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,e.RGBA,K,K,0,e.RGBA,e.UNSIGNED_BYTE,null);J&&e.generateMipmap(e.TEXTURE_CUBE_MAP);return ha};this.createFrameBufferRenderTarget=function(K){return new WALK.WebGLRenderTargetVR(K)};this.createRenderTarget=function(K,J,ha){K=
new WALK.WebGLRenderTarget(K,J,ha);I(!1,K);return K};this.createRenderTargetCube=function(K,J,ha){K=new WALK.WebGLRenderTargetCube(K,J,ha);I(!0,K);return K};this.readPixels=function(K,J,ha){e.readPixels(0,0,K,J,e.RGBA,e.UNSIGNED_BYTE,ha)}}})();(function(){var a={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};WALK.createRenderer=function(b,c){void 0===c.alpha&&(c.alpha=!1);void 0===c.depth&&(c.depth=!0);void 0===c.stencil&&(c.stencil=!1);void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0);void 0===c.antialias&&(c.antialias=!0);void 0===c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);try{var d=(WALK.FORCE_WEBGL1||WALK.DETECTOR.ios?null:b.getContext("webgl2",c))||b.getContext("webgl",
c)||b.getContext("experimental-webgl",c)}catch(e){d=null}c=d;if(!c)return null;WALK.DETECTOR.resetGlDetector(c);WALK.DETECTOR.gl.reportToConsole();return new WALK.WebGLRenderer(b,c)};WALK.createWebwalkRenderer=function(b){if(b=WALK.createRenderer(b,{antialias:!WALK.FORCE_FXAA}))b.autoClear=!0,b.autoClearColor=!1,b.autoClearDepth=!0,b.autoClearStencil=!1,b.sortObjects=!0;return b};WALK.Renderer=function(b,c,d,e){var g=null,f,h,k=d.camera,l=d.threeScene,m=function(){var n=new WALK.Frustum,q=new THREE.Matrix4;
return function(u){if(0!==d.mirrors.length){u.matrixWorldInverse.getInverse(u.matrixWorld);q.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse);n.setFromMatrix(q);for(var p=0;p<d.mirrors.length;p+=1){var w=d.mirrors[p];w.updateCameraPosition(u,n);w.inFrustum()&&w.render(b)}}}}();this.resize=function(n){if(!n){var q=window.innerWidth;var u=window.innerHeight;var p=q*window.devicePixelRatio;var w=u*window.devicePixelRatio;k.aspect=p/w;k.updateProjectionMatrix();b.setCanvasSize(p,w);b.domElement.style.width=
q+"px";b.domElement.style.height=u+"px";f&&(f.configureTarget(p,w,a),h.setTargets(f.renderTarget1,f.renderTarget2));g&&g.uniforms.resolution.value.set(1/p,1/w)}q=w;n?(n=p/2,p=70):(n=p,p=k.fov);u=n/q;for(w=0;w<d.mirrors.length;w+=1)d.mirrors[w].configure(n,q,u,p)};this.renderIdle=function(n,q){0===q&&(e.adaptExposure(),h&&h.reset());if(e.exposureNeedsUpdate())return this.renderToScreen(n,!1),!0;if(!h)return!1;h.renderSample();4<=h.renderedSamplesCount()&&h.renderAccumulatedSamplesToScreen();return!h.allSamplesRendered()};
this.renderToScreen=function(n,q){e.update(n);q?c.render(l,k.matrixWorld,m):(m(k),g?f.render(n):b.render(l,k))};this.enableAutoExposure=function(){e.enableAutoExposure()};this.disableAutoExposure=function(){e.disableAutoExposure()};(function(){if(WALK.DETECTOR.gl.antialiasPostprocess){f=new THREE.EffectComposer(b);if(!WALK.DETECTOR.gl.antialiasNative){WALK.log("using FXAA");b.autoClear=!1;g=new THREE.ShaderPass(THREE.FXAAShader);g.clear=!1;g.renderToScreen=!0;g.material.depthTest=!1;g.material.depthWrite=
!1;g.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);var n=new THREE.RenderPass(l,k);f.addPass(n);f.addPass(g)}h=new WALK.SsaaRenderer(b,d)}})()}})();(function(){WALK.ScreenshotTaker=function(a,b,c){function d(){var n=(document.body.offsetWidth-document.body.offsetHeight*f)/2,q=n+"px";n=Math.max(n,0)+"px";h.style.width=n;k.style.width=n;l.style.left=q;l.style.right=q}function e(n,q,u,p){var w=new WALK.CubeCamera(b.camera.near,b.camera.far);w.rotateZ(q);w.position.copy(n);w.updateMatrixWorld();n=a.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(q=0;6>q;q+=1)n.activeCubeFace=
q,a.render(b.threeScene,w.sideCameras[q],n);w=a.createRenderTarget(u,p,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});q={uniforms:{panoramaCube:{type:"t",value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};q=new THREE.ShaderPass(q,"panoramaCube");q.render(a,w,n);q.dispose();n.dispose();n=new Uint8Array(u*p*4);a.readPixels(u,p,n);w.dispose();return n}function g(n,
q){var u=a.createRenderTarget(n,q,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});n=a.createRenderTarget(n,q,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});q=new WALK.SsaaRenderer(a,b);for(q.setTargets(u,n);!q.allSamplesRendered();)q.renderSample();var p=q.copyAccumulatedSamplesToBuffer();u.dispose();n.dispose();q.dispose();return p}var f=null,h=null,k=null,l=null,m=new THREE.Vector3;
this.markArea=function(n){function q(p,w){p.style.zIndex=1;p.style.pointerEvents="none";p.style.position="absolute";p.style.top=0;p.style.bottom=0;p.style[w]=0;p.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function u(p){p.style.zIndex=1;p.style.pointerEvents="none";p.style.position="absolute";p.style.boxSizing="border-box";p.style.top=0;p.style.bottom=0;p.style.border="4px solid rgba(35, 181, 233, 0.5)"}l||(h=document.createElement("div"),q(h,"left"),k=document.createElement("div"),q(k,"right"),l=
document.createElement("div"),u(l),document.body.appendChild(h),document.body.appendChild(k),document.body.appendChild(l),window.addEventListener("resize",d));f=n;d()};this.unmarkArea=function(){l&&(h.remove(),k.remove(),l.remove(),window.removeEventListener("resize",d),l=k=h=f=null)};this.screenToBuffer=function(n,q,u){return n?e(c.cameraWorldPosition(),c.getYawAngle(),q,u):g(q,u)};this.screenToDataUrl=function(n,q,u){n=this.screenToBuffer(n,q,u);for(var p=0;p<u;++p)for(var w=0;w<q;++w){var v=4*
(p*q+w);if(p<u/2)for(var y=4*((u-p-1)*q+w),D=0;3>D;++D){var A=n[v+D];n[v+D]=n[y+D];n[y+D]=A}n[v+3]=255}n=new Uint8ClampedArray(n);n=new ImageData(n,q,u);p=document.createElement("canvas");p.width=q;p.height=u;p.getContext("2d").putImageData(n,0,0);return p.toDataURL("image/jpeg")};this.screenToLocalImage=function(n,q,u){n=this.screenToDataUrl(n,q,u);navigator.msSaveOrOpenBlob?fetch(n).then(function(p){return p.blob()}).then(function(p){return navigator.msSaveOrOpenBlob(p,"screen.jpg")}):(q=document.createElement("a"),
document.body.appendChild(q),q.style.cssText="display: none",q.href=n,q.download="screenshot",q.click(),window.URL.revokeObjectURL(n),q.parentNode.removeChild(q))};this.coverToServer=function(n,q){var u=g(n,q);WALK.ajaxPost("screenshot?width="+n+"&height="+q,"application/binary",u)};this.panoramaToServer=function(n,q){n.position?m.fromArray(n.position):m.copy(c.cameraWorldPosition());var u=void 0!==n.width?n.width:8E3,p=void 0!==n.height?n.height:4E3,w=$jscomp,v=w.makeIterator;var y=Math.min(WALK.MAX_PANORAMA_SIZE,
WALK.DETECTOR.gl.maxRenderBufferSize);if(u<=y&&p<=y)u=[u,p];else{var D=u/p;u=u>p?[y,Math.floor(y/D)]:[Math.floor(y*D),y]}p=v.call(w,u);u=p.next().value;p=p.next().value;w=void 0!==n.rotation?THREE.Math.degToRad(n.rotation):0;w=e(m,w,u,p);WALK.ajaxPost("panorama?width="+u+"&height="+p+"&name="+n.name,"application/binary",w,q,q)}}})();(function(){WALK.InteractionDispatcher=function(a,b,c,d,e,g,f,h){function k(I,H){I=I?e:d;for(var P=0;P<I.length;P+=1)if(I[P](H.object,H.point,H.distance))return!0;return!1}function l(){return b.findIntersectionAtPosition(0,0,!0,w)}function m(){k(!1,w)}function n(I,H,P){h&&h.reset();return b.findIntersectionAtPosition(I,H,!0,D)?k(P,D):!1}function q(I){h&&h.reset();I.action===WALK.GAMEPAD_ACTION.TRIGGER&&n(0,0,!1)}function u(I,H){for(var P=0;P<g.length&&!g[P](I,H);P+=1);}var p=!1,w=new WALK.RayIntersection,
v=null;h&&h.setGazeHandlers(l,m);var y=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=y.callbacks;var D=new WALK.RayIntersection,A=null,G=null;a.onPointerMove=function(I,H){console.assert(p);0!==g.length&&(A=I,G=H,c());return!1};a.onClick=function(I,H){return n(I,H,!1)};a.onDoubleClick=function(I,H){return n(I,H,!0)};f.addEventListener("actionActivated",q);this.handleHover=function(){if(p&&0!==g.length){var I=b.findObstacleMeshAtPosition(A,G,!0);null===I?v&&(u(v,!1),
v=null):I!==v&&(v&&u(v,!1),u(I,!0),v=I)}};this.enable=function(){p=!0;y.enable();console.assert(null===v)};this.disable=function(){p=!1;null!==v&&(u(v,!1),v=null);y.disable()};this.dispose=function(){this.disable();f.removeEventListener("actionActivated",q)};this.enable()}})();(function(){function a(V,ta){return Da.renderIdle(V,ta)}function b(V,ta){ta&&nb.update();Y.update(V);wa.enableCollisions&&!ta&&Ba.handleCollisions(V);pa&&pa.handleHover();ka.update(V);Ga&&Ga.updateCameraHeight(V);Ha&&Ha.updateCameraHeight();ta&&!Y.teleportingToPoint&&(xa.update(),ua.requestFrame());va&&(ta&&!nb.hasGamepads()?va.update(V):va.reset());for(var Ia=$jscomp.makeIterator(W.getAnimatedMeshes()),Ea=Ia.next();!Ea.done;Ea=Ia.next())Ea.value.update(V,ka.cameraWorldPosition());Ia=!1;Ea=$jscomp.makeIterator(W.getAnimatedMaterials());
for(var na=Ea.next();!na.done;na=Ea.next())na=na.value,na.isPlaying&&(na.update(V),Ia=!0);Ia&&ua.requestFrame();Ca&&Ca.update(V);ia._update(V);Da.renderToScreen(V,ta);Ka&&Ka.animate()}function c(V){V.view&&(Ga&&Ga.disable(),pa&&pa.disable())}function d(V){!Ga||Ga.isEnabled()||xa.vrEnabled()||Ga.enable();if(Ha&&xa.vrEnabled())Ha.onTeleportDone();V.view&&pa&&pa.enable();xa.vrEnabled()&&ka.hmdReset()}function e(){if("hidden"===document.visibilityState){if(W)for(var V=$jscomp.makeIterator(W.getAnimatedMaterials()),
ta=V.next();!ta.done;ta=V.next())ta.value.sleepAnimation()}else if("visible"===document.visibilityState&&W){V=$jscomp.makeIterator(W.getAnimatedMaterials());for(ta=V.next();!ta.done;ta=V.next())ta.value.wakeAnimation();ua.requestFrame()}}function g(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0));Da.resize(xa.vrEnabled());ua.requestFrame();db.onResize()}function f(){return document.pointerLockElement===R||document.mozPointerLockElement===
R||document.webkitPointerLockElement===R}function h(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function k(){if(f()){ka.mousePressLook=!1;db.onPointerLockChange(!0);var V=WALK.urlHashContains("gazeinpointerlock");V?Db.enableMode():Db.disableMode();ia.anchorsVisible=V}else ka.mousePressLook=!0,db.onPointerLockChange(!1),Db.disableMode(),ia.anchorsVisible=!0;Ka&&dat.GUI.toggleHide()}
function l(){if(h())db.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else db.onFullScreenChange(!1)}function m(){var V=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==V.mozRequestFullScreen||
void 0!==V.webkitRequestFullscreen||void 0!==V.msRequestFullscreen||void 0!==V.requestFullscreen}function n(V){ma.uploadNewBuffers(V);ua&&ua.requestFrame()}function q(V){ma.uploadTexture(V);V.isAtlas()?V.forEachAtlasEntry(function(ta){console.assert(null===ta.isCutout);ya.isCutoutTexture(ta)}):null===V.isCutout&&ya.isCutoutTexture(V);ua&&ua.requestFrame()}function u(V){V=[];var ta=[],Ia=[];V.push(ia._clickListener);var Ea=ia._createHoverListener();Ea&&Ia.push(Ea);ea=new WALK.ClickNavigator(Ba,ka,
Y);ta.push(ea.onMeshClicked);ra||V.push(ea.onMeshClicked);pa=new WALK.InteractionDispatcher(K,Ba,function(){ua.requestFrame()},V,ta,Ia,nb,va)}function p(){Ga&&Ga.disable();Ha&&Ha.enable();ka.mouseControlsPitch=!1;ka.hmdReset();Y.onVrChange(!0);Db.enableMode();db.onVrChange(!0);ia._vrChange(!0);g()}function w(V){ua.isEnabled()&&(V?p():(ka.resetRollAngle(),ka.resetPitchAngle(),ka.mouseControlsPitch=!0,console.assert(!xa.vrEnabled()),Ha&&Ha.disable(),Ga&&Ga.enable(),Y.onVrChange(!1),Db.disableMode(),
db.onVrChange(!1),ia._vrChange(!1),g(),setTimeout(g,1E3)))}function v(V){ra||WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||db.setVrSupported(V)}function y(V,ta){if(Ha&&null!==ta)Ha.onHmdPositionUpdate(ta);ka.onHmdUpdate(V,ta)}function D(V,ta){V&&ka.cameraWorldPosition().set(V[0],V[1],V[2]);ta&&(V=new WALK.Euler,V.setFromDegTriple(ta),ka.setYawAngle(V.yaw),ka.setPitchAngle(V.pitch))}function A(V){for(var ta=
0;ta<V.length;ta+=1)if(!V[ta].lightProbe)return!1;return!0}function G(V,ta,Ia){Ba=new WALK.Collider(V,ta,Ia);ta.visitAllNodes(function(Ea){Ea.mesh&&Ba.addStaticObstacle(Ea.mesh)})}function I(){var V=THREE.Scene.prototype.add;THREE.Object3D.prototype.add=function(ta){ta instanceof THREE.Mesh&&ma.uploadNewBuffers(ta);V.call(this,ta)}}function H(V){var ta=WALK.urlHashGetArgument("view"),Ia=null;ta&&(Ia=V.findViewByName(ta));return Ia||V.views[0]}function P(V){function ta(){ua.requestFrame()}W=V;W.adjustSkiesAndCameraFarToSpanWholeScene();
W.headLight=WALK.HEAD_LIGHT;W.addEventListener("updated",function(){return ua.requestFrame()});W.addEventListener("anyViewUpdated",function(){return db.refresh()});W.disableLightProbesForMaterials();ka.enable();W.threeScene.updateMatrixWorld(!0);xa.setCameraFar(W.camera.far);Da=new WALK.Renderer(ma,xa,W,ha);K=new WALK.PointerEventDispatcher(ma.domElement,ra);((V=wa.enableCollisions)||ra)&&G(ma,W,ka);Y=new WALK.Teleport(W,ka,Ba,ua);Y.addEventListener("teleportStarted",c);Y.addEventListener("teleportDone",
d);ja=new WALK.AutoTour(W,Y);V&&W.camera.autoClimb&&(Ga=new WALK.StepsClimber(Ba,ka,ua));V&&(Ha=new WALK.VRHeightController(ka,Ba));Y.switchToView(H(W),0);ha.updateWithoutDelay();L=new WALK.HashChangeTeleport(W,Y);Oa=new WALK.ScreenshotTaker(ma,W,ka);V&&!WALK.urlHashContains("nogazeteleport")&&(va=new WALK.GazePointer(W,ka,ta,Db));ia._sceneReadyToDisplay(ma,W,ka,Y,ja,Ba,Oa,J,Db,K,ua);u(V);document.addEventListener("visibilitychange",e);window.addEventListener("resize",function(){WALK.DETECTOR.ios?
setTimeout(g,1E3):g()},!1);m()&&db.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||db.setPointerLockSupported();db.sceneReadyToDisplay(W,Y,ja,Oa);g();WALK.DEBUG&&WALK.DebugUI&&(Ka=new WALK.DebugUI(W,ka,g,ua));WALK.DETECTOR.ios||R.focus();WALK.DEBUG_SHARED_BUFFERS&&(W.threeScene.overrideMaterial=new WALK.DebugMaterial);W.startAutoTourOnLoad()&&ja.start();ua.enable();
xa.vrEnabled()&&p();xb=za.elapsedLoadTimeSec()}function U(V){ra||WALK.urlHashContains("nostats")||0!==Ja||db.cover.sendStats&&WALK.ajaxPost("./stats/"+V,null,null)}function fa(V,ta){function Ia(Na){function eb(){Ua.delete(qb);null!==V.findLightProbe(qb.id)&&(ta.assignLightProbesToObjects(),ta.createLightProbeTexture(qb,!1),ua.requestFrame())}var qb=Na.target;Na=Ua.get(qb);void 0===Na&&(Na=new WALK.DeferringExecutorOnce(eb,1E3),Ua.set(qb,Na));Na.deferRun()}function Ea(Na){Na=Na.target;ta.createLightProbeTexture(Na,
!0);if(!Na.isBoundingBoxInitialized()){var eb=Na.boxMax;Na.boxMin.copy(Na.position).addScalar(-1);eb.copy(Na.position).addScalar(1);Na.enableBoundingBox()}}function na(Na){for(Na=0;Na<V.materials.length;Na+=1)V.materials[Na].forceObjectUniformsRefresh()}var Ua=new Map;V.addEventListener("lightProbeAdded",function(Na){Na=Na.lightProbe;ta.assignLightProbesToObjects();ta.createLightProbeTexture(Na,!0);Na.isBoundingBoxInitialized()||Na.disableBoundingBox();Na.addEventListener("boundsInit",Ea);Na.addEventListener("positionUpdated",
Ia);Na.addEventListener("boundsUpdated",na)});V.addEventListener("lightProbeRemoved",function(){ta.assignLightProbesToObjects()});for(var Xa=0;Xa<V.lightProbes.length;Xa+=1)V.lightProbes[Xa].addEventListener("positionUpdated",Ia),V.lightProbes[Xa].addEventListener("boundsInit",Ea),V.lightProbes[Xa].addEventListener("boundsUpdated",na)}function C(V,ta,Ia){function Ea(Ua){if(Ua===V.length)Ia();else{var Xa=V[Ua],Na=Xa.name;na.has(Na)?Ea(Ua+1):(na.add(Na),ta.panoramaToServer(Xa,function(){return Ea(Ua+
1)}))}}var na=new Set;Ea(0)}function Q(V){function ta(){if(wa.onSceneLoaded)wa.onSceneLoaded(new WALK.EditorHooks(V,db,ka,Y,Ca,T,Oa,ua));db.sceneLoadComplete();for(var Na=$jscomp.makeIterator(V.getAnimatedMaterials()),eb=Na.next();!eb.done;eb=Na.next())eb.value.play();ia._sceneLoadComplete();ua.requestFrame();Na=za.elapsedLoadTimeSec();U("loaded?readyToDisplayTime="+xb.toFixed(1)+"&loadTime="+Na.toFixed(1));za=null}var Ia=WALK.urlHashContains("headless");ya.dispose();ya=null;if(0<V.lightProbes.length||
ra){var Ea=new WALK.LightProbeMaker(V,ma,WALK.DETECTOR.gl.textureLod,WALK.DETECTOR.gl.mirrorCubeMaps,ra);0===V.lightProbes.length&&ra&&V.autoAddLightProbes&&WALK.arrangeLightProbes(V,Ea,Ia);if(0<V.lightProbes.length){A(V.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),Ea.assignLightProbesToObjects());var na;for(na=0;na<V.views.length&&"orbit"===V.views[na].mode;na+=1);na===V.views.length&&(na=0);Y.executeWithViewVisibilitySettings(V.views[na],function(){Ea.createAllLightProbeTextures()});
V.enableLightProbesForMaterials()}}V.hasLightMap()&&Da.enableAutoExposure();if(ra){Ea?fa(V,Ea):console.warn("Cube maps support is required in the edit mode");na=new WALK.LightControls(V,ua);var Ua=new WALK.LightProbeControls(V,ua),Xa=new WALK.CameraVolumeControls(V,ua);Ca=new WALK.EditorSelector(K,V,ma,Ba,na,Ua,Xa,ua,ka);Oa.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);D(wa.forcedInitialCameraPosition,wa.forcedInitialCameraRotation)}else Ea&&(Ea.dispose(),Ea=null);ra&&Ia?C(za.panoramas,
Oa,ta):ta()}function da(){$a&&($a=!1,za.load(),db.sceneLoadStarted(),WALK.urlHashContains("help")&&(db.helpVisible=!0),U("play"))}function aa(V){db.updateCover(V);T.updateConfig(V.extensions||[]);WALK.DETECTOR.brotliJsDecode=!0===V.brotliJsDecode;ra||T.startExtensions();ia._viewerConfigLoaded(V);ya=new WALK.CutoutTextureDetector(ma);$a=!0;V=new WALK.Scene(ka.camera());za=new WALK.SceneLoader(V,wa.assetsUrl,ra,N);J=new WALK.LumaMeter(ma,V);ha=new WALK.ExposureController(V,ka,J);za.onProgress=db.loadProgress;
za.onTextureLoaded=q;za.onMeshBuffersLoaded=n;za.onReadyToDisplay=P;za.onComplete=Q;WALK.urlHashContains("autoplay")||Za||0<Ja?da():WALK.urlHashContains("hideplay")||db.enablePlayButton(da)}function X(V){V.preventDefault();Ja+=1;ua.disable();!ra&&null===za&&Ja<=WALK.CONTEXT_LOST_RESTORE_LIMIT?(T.stopExtensions(),ia._contextLost(),L.dispose(),L=null,pa.dispose(),pa=null,ea&&(ea.dispose(),ea=null),db.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}function S(V){V.preventDefault();
!ra&&null===za&&Ja<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.DETECTOR.resetGlDetector(ma.context),WALK.DETECTOR.gl.reportToConsole(),ma.webGLContextRestored(),aa(db.cover))}function O(){WALK.ajaxGet(WALK.COVER_JSON_URL,!1,function(V){WALK.DETECTOR.onAsyncPropertiesDetected(function(){aa(V)})},function(){WALK.USER_MSG.error("Failed to initialize the scene.")})}function la(V){I();wa=V;if(ma=WALK.createWebwalkRenderer(R))if(WALK.DETECTOR.gl.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.gl.missingCapabilities);
else{R.addEventListener("webglcontextlost",X,!1);R.addEventListener("webglcontextrestored",S,!1);db.init();T=new WALK.ExtensionsManager;V=null;try{WALK.urlHashContains("vrlo")?WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:WALK.urlHashContains("vrhi")&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=1.5),V=new WebXRPolyfill(WebXRConfig)}catch(ta){WALK.log("Failed to initialize WebXR polyfill")}xa=new WALK.VRManager(ma,nb,V,v,y,function(ta){ta?ua.disable():ua.enable()},w);ua=new WALK.AnimationController(xa,
b,a);ua.disable();V=new WALK.Camera;ka=new WALK.Controls(V,R,nb,ua);ka.mousePressLook=!0;WALK.urlHashContains("flipmouse")&&(ka.flipMouseLook=!0);ka.disable();O();WALK.getExtraAssetUrl=function(ta){return ta.startsWith("extra-assets/")?wa.assetsUrl+ta:wa.assetsUrl+"extra-assets/"+ta}}else WALK.USER_MSG.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}var R=document.getElementById("walk-canvas"),ra=WALK.EDIT_MODE,ma,xa,T,ka,ua,wa,K,J,ha,W,Da,Ba,Ga,Ha,pa,ea,Y,va,L,ja,Ca,za=null,Ka=null,ya,Oa,Ja=0,$a=!1,Za=!1,xb,Db=new WALK.GazeModeObserver;var nb=new WALK.GamepadManager;var db=new WALK.Menu(ra,nb,function(){xa.vrEnabled()?xa.disableVr():
(ja.isRunning()&&ja.stop(),xa.enableVr(ma.context))},function(){if(h())h()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());else{var V=document.body;(V.mozRequestFullScreen||V.webkitRequestFullscreen||V.msRequestFullscreen||V.requestFullscreen).call(V);document.addEventListener("fullscreenchange",l,!1);document.addEventListener("mozfullscreenchange",l,!1);document.addEventListener("webkitfullscreenchange",
l,!1);document.addEventListener("MSFullscreenChange",l,!1)}},function(){f()?f()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(R.requestPointerLock=R.requestPointerLock||R.mozRequestPointerLock||R.webkitRequestPointerLock,R.requestPointerLock(),document.addEventListener("pointerlockchange",k,!1),document.addEventListener("mozpointerlockchange",k,!1),document.addEventListener("webkitpointerlockchange",
k,!1))});var N=new WALK.MergeConfig;ra&&N.setAllMaterialsEditable();var ia=new WALK.Viewer(ra,db,N);var Aa={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};WALK.loadFontFamilies=function(V,ta){var Ia={};V.forEach(function(Ea){console.assert(Aa[Ea],"Font "+JSON.stringify(Ea)+" is not supported.");Ia[Ea]=Aa[Ea]});WebFont.load({custom:{families:V,testStrings:Ia},active:ta,fontinactive:function(Ea){console.error("Cannot load font: "+Ea);WALK.USER_MSG.info("Cannot load required fonts.")}})};
WALK.getViewerAssetUrl=function(){var V=function(){for(var ta=document.getElementsByTagName("script"),Ia=0;Ia<ta.length;++Ia){var Ea=ta[Ia].src.match(/^(.*\/)walk(\.min)?\.js$/);if(Ea)return Ea[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(ta){return V+ta}}();WALK.initEditMode=function(V){var ta=document.createElement("base");ta.target="_blank";document.head.appendChild(ta);WALK.loadFontFamilies(Object.keys(Aa),function(){la(V)})};WALK.init=function(V){ra||
la(V)};WALK.play=function(){$a?da():Za=!0};WALK.getViewer=function(){return ia};WALK.Extensions={}})();(function(){WALK.ExtensionsManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionsManager.prototype={constructor:WALK.ExtensionsManager,updateConfig:function(a){this.extensions=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(e,g){return e.some(function(f){return f.name===g&&f.config.type===a.type})}a.name=a.name.toString();for(var c=a.name,d=2;b(this.extensions,a.name);)a.name=
c+d.toString(),d+=1;c=new this.extensionTypes[a.type](a);this.extensions.push(c);return c},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(d,e){return d.concat(e)},[]).filter(function(d,e,g){return e===g.indexOf(d)});0<c.length&&!WALK.EDIT_MODE?
WALK.loadFontFamilies(c,a):a()},_getFonts:function(a){return this.extensionTypes[a.type].definition.properties.map(function(b){return"trigger"===b.type&&a[b.id]&&a[b.id].icon&&WALK.ICONS[a[b.id].icon].fontFamily}).filter(function(b){return b})},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=$jscomp.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);
c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],b=$jscomp.makeIterator(this.extensions),c=b.next();!c.done;c=b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,
1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})}}})();(function(){function a(){}function b(d,e){var g=new THREE.Vector3,f=new THREE.Vector3;if("node"!==e.type){g.fromArray(e.position);var h=e.radius}else h=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(k){"node"===e.type&&(f.copy(d.getCameraPosition()),f.sub(k),f.normalize().multiplyScalar(h),g.copy(k).add(f));return g};this.getRadius=function(){return h}}var c={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down",
"\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card","\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film",
"\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt","\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench",
"\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};WALK.Extension=function(d){function e(k){return g.definition.properties.some(function(l){return l.id===k})}var g=this;this.triggers=[];var f=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();this.running=!1;var h=[];this.config=WALK.readOnlyCopy(function(k){k=WALK.cloneObject(k);if(void 0!==k.anchor&&void 0===k.trigger&&!e("anchor")&&e("trigger")){var l=k.anchor;
l.icon&&l.icon.font&&(l.icon=c[l.icon.value]);k.trigger=l;k.anchor=void 0}l=$jscomp.makeIterator(g.definition.properties);for(var m=l.next();!m.done;m=l.next())m=m.value,void 0===k[m.id]&&void 0!==m.defaultValue&&(k[m.id]=m.defaultValue);return k}(d));Object.defineProperty(this,"name",{get:function(){return this.config.name}});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(k){this.stop();this.config=WALK.readOnlyCopy(k);this.start()};this.doStop=this.doStart=
a;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var k=$jscomp.makeIterator(f),l=k.next();!l.done;l=k.next())this.viewerApi.removeAnchor(l.value);k=$jscomp.makeIterator(h);for(l=k.next();!l.done;l=k.next())l=l.value,this.viewerApi.removeOnNodeTypeClicked(l[0],l[1]);h.length=0;this.triggers.length=0;f.length=0;this.running=!1}};this._vrChanged=function(k){k&&!this.definition.vrCompatible?this.stop():k||this.definition.vrCompatible||
this.start()};this.addTrigger=function(k,l){function m(n,q,u){l(n,q,u);return!0}"node"===k.type?(k=k.nodeType,h.push([k,m]),this.viewerApi.onNodeTypeClicked(k,m),this.triggers.push.apply(this.triggers,$jscomp.arrayFromIterable(this.viewerApi.findNodesOfType(k)))):(k=this.viewerApi.addAnchor(k,l),k.extension=this,f.push(k),this.triggers.push(k))};this.viewerApi.onVrChange(this._vrChanged.bind(this))};WALK.Extensions.HtmlLabel=function(d){function e(g){if(g instanceof HTMLVideoElement||g instanceof
HTMLIFrameElement)return!0;g=$jscomp.makeIterator(g.children);for(var f=g.next();!f.done;f=g.next())if(e(f.value))return!0;return!1}WALK.Extension.call(this,d);this.id=WALK.Extensions.HtmlLabel.nextId;++WALK.Extensions.HtmlLabel.nextId;this.toggleDisplay=function(){var g=this,f=g.viewerApi,h=document.getElementById("ext-html-label"),k=h.dataset.id===this.id.toString(),l=void 0!==h.dataset.animatedMaterialsSleeping,m=h.querySelector("#ext-html-label-content");k?(h.style.display="none",delete h.dataset.id,
m.innerHTML="",l&&(f.wakeAnimatedMaterials(),delete h.dataset.animatedMaterialsSleeping)):(void 0===h.dataset.id&&(h.style.display=""),h.dataset.id=this.id,k=WALK.getExtraAssetUrl("").slice(0,-1),k=this.config.content.replace(/\$EXTRA_ASSETS/g,k),m.innerHTML=k,e(m)?l||(f.sleepAnimatedMaterials(),h.dataset.animatedMaterialsSleeping=""):l&&(f.wakeAnimatedMaterials(),delete h.dataset.animatedMaterialsSleeping),h.querySelector("#ext-html-label-close").onclick=function(){g.toggleDisplay()})};this.doStart=
function(){var g=this;g.viewerApi.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,function(){g.toggleDisplay()})})};this.doStop=function(){this.display&&this.toggleDisplay()}};WALK.Extensions.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"content",type:"textArea",label:"Content",optional:"true",defaultValue:"Content to display..."}],vrCompatible:!1};WALK.Extensions.HtmlLabel.nextId=0;WALK.Extensions.Audio=function(d){function e(){u?
m.pause():m.play()}function g(){var p=f.config;p.trigger&&f.addTrigger(p.trigger,e);p.menuButton&&(n=h.addMenuButton(l.src),n.addEventListener("click",e),q=h.getMenuButtonIcon(n));if(p.autoplay)f.viewerApi.onNextPageInteraction(function(){e()})}d.url&&!d.file&&(d.file={file:d.url.split("/").pop(),url:d.url},delete d.url);d.file.path&&d.file.url&&delete d.file.url;WALK.Extension.call(this,d);var f=this,h=this.viewerApi,k=null,l=null,m=null,n=null,q=null,u=!1;this.doStart=function(){WALK.log("Audio start");
this.config.menuButton&&!k&&(k=WALK.preloadImage(h.getViewerAssetUrl("img/audio-on.svg")),l=WALK.preloadImage(h.getViewerAssetUrl("img/audio-off.svg")));m=document.createElement("audio");this.config.file&&(this.config.file.path?m.src=WALK.getExtraAssetUrl(this.config.file.path):this.config.file.url&&(m.src=this.config.file.url));m.src&&(m.loop=this.config.loop,m.addEventListener("play",function(){u=!0;q&&(q.src=k.src)}),m.addEventListener("pause",function(){u=!1;q&&(q.src=l.src)}),document.body.appendChild(m),
h.onSceneReadyToDisplay(g))};this.doStop=function(){WALK.log("Audio stop");u=!1;n&&(this.viewerApi.removeMenuButton(n),q=n=null);m.pause();m.remove();m=null}};WALK.Extensions.Audio.definition={name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",
optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialPicker=function(d){function e(){return(l.config.toReplace?[l.config.toReplace]:[]).concat(l.config.toPick||[])}function g(u){l.viewerApi.apiUserChangeState(q,u.name)}function f(u,p){console.assert(u===q);if(u=l.viewerApi.findMaterial(p))for(p=0;p<m.length;p+=1)l.viewerApi.setMaterialForMesh(u,m[p])}function h(u,p,w){u=e().map(function(v){return l.viewerApi.findMaterial(v)});l.viewerApi.openMaterialPicker(u,g,n.getPosition(p),n.getRadius())}function k(){l.addTrigger(l.config.trigger,
h);m=l.viewerApi.findMeshesWithMaterial(l.config.toReplace||[])}WALK.Extension.call(this,d);var l=this,m=[],n=new b(l.viewerApi,l.config.trigger),q="MaterialPicker:"+this.name;this.config.materials&&(d=WALK.cloneObject(this.config),0<d.materials.length&&(d.toReplace=d.materials[0],d.toPick=d.materials.slice(1)),d.materials=void 0,this.config=WALK.readOnlyCopy(d));l.viewerApi.isSceneReadyToDisplay()||e().map(function(u){l.viewerApi.setMaterialEditable(u)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(k);
this.viewerApi.onApiUserStateChanged(q,f)};this.doStop=function(){var u=l.viewerApi.findMaterial(l.config.toReplace);u&&g(u);this.viewerApi.removeOnApiUserStateChanged(q,f)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker=
function(d){function e(){for(var y=new Set,D=$jscomp.makeIterator(v),A=D.next();!A.done;A=D.next()){A=$jscomp.makeIterator(A.value);for(var G=A.next();!G.done;G=A.next())G=G.value,y.add(G.toReplace),y.add(G.toUse)}return y}function g(){for(var y=[v[0][0].toReplace],D=$jscomp.makeIterator(v),A=D.next();!A.done;A=D.next())y.push(A.value[0].toUse);return y}function f(){for(var y=0;y<v.length;++y)for(var D=0;D<v[y].length;++D)for(var A=w.findMaterial(v[y][D].toReplace),G=$jscomp.makeIterator(q[y][D]),
I=G.next();!I.done;I=G.next())w.setMaterialForMesh(A,I.value)}function h(y,D){w.apiUserChangeState(p,D)}function k(y,D){console.assert(y===p);f();if(0!==D)for(y=D-1,D=0;D<v[y].length;++D){var A=w.findMaterial(v[y][D].toUse);if(A)for(var G=$jscomp.makeIterator(q[y][D]),I=G.next();!I.done;I=G.next())w.setMaterialForMesh(A,I.value)}}function l(y,D,A){y=g().map(function(G){return w.findMaterial(G)});w.openMaterialPicker(y,h,u.getPosition(D),u.getRadius())}function m(){n.addTrigger(n.config.trigger,l);
for(var y=0;y<v.length;++y){q[y]=[];for(var D=$jscomp.makeIterator(v[y]),A=D.next();!A.done;A=D.next())q[y].push(w.findMeshesWithMaterial(A.value.toReplace))}}WALK.Extension.call(this,d);var n=this,q=[],u=new b(n.viewerApi,n.config.trigger),p="MaterialComboPicker:"+this.name,w=this.viewerApi,v=n.config.options;w.isSceneReadyToDisplay()||e().forEach(function(y){w.setMaterialEditable(y)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(m);this.viewerApi.onApiUserStateChanged(p,k)};this.doStop=
function(){f();this.viewerApi.removeOnApiUserStateChanged(p,k)}};WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"}]}}],vrCompatible:!0};WALK.Extensions.VideoTextureControl=function(d){function e(){k.isPlaying?
k.pause():k.play()}function g(){var l=k.baseColorTexture,m=h.config;l.loop=m.loop;if(!m.autoplay)l.pause(),l.muted=m.muted;else if(!m.muted)h.viewerApi.onNextPageInteraction(function(){l.muted=!1});m.trigger&&h.addTrigger(m.trigger,e)}function f(){var l=h.config;(k=h.viewerApi.findMaterial(l.material))?k.baseColorTexture&&k.baseColorTexture instanceof WALK.VideoTexture?k.baseColorTexture.addLoadedListener(g):(console.error("Material '"+l.material+"' for video texture control '"+(l.name+"' does not have a video texture")),
k=null):console.error("Material '"+l.material+"' for video texture control '"+(l.name+"' does not exist"))}WALK.Extension.call(this,d);var h=this,k=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi.onSceneLoadComplete(f)};this.doStop=function(){k&&(k.baseColorTexture.muted=!0,k.pause(),k=null)}};WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",
label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.OpenWebsite=function(d){function e(){g.viewerApi.openUrl(g.config.url,g.config.newWindow)}WALK.Extension.call(this,d);var g=this;this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,
e)})}};WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.ChangeView=function(d){function e(){g.viewerApi.switchToView(g.config.views[f],void 0,g.config.doNotMoveCamera);f=(f+1)%g.config.views.length}WALK.Extension.call(this,d);var g=this,f=0;this.doStart=function(){var h=this.viewerApi;f=0;h.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,
e)})}};WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1}],vrCompatible:!0};WALK.Extensions.HideAnchors=function(d){function e(){h.anchorsVisible=!h.anchorsVisible}function g(q){n.src=q?k.src:l.src}WALK.Extension.call(this,d);var f=this,h=f.viewerApi,k=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-on.svg")),
l=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-off.svg")),m=null,n=null;this.doStart=function(){h=f.viewerApi;h.onAnchorsVisibilityChanged(g);m=h.addMenuButton(k.src);n=h.getMenuButtonIcon(m);m.addEventListener("click",e);var q=f.config;h.onSceneReadyToDisplay(function(){return h.anchorsVisible=q.visibleOnStart})};this.doStop=function(){h.removeAnchorsVisibilityChangedListener(g);h.removeMenuButton(m);n=m=null;h.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",
properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.Script=function(d){function e(){try{(new Function('"use strict"; '+g.config.code))()}catch(f){console.error("Script extension error: "+f)}}WALK.Extension.call(this,d);var g=this;this.doStart=function(){var f=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return f.addTrigger(f.config.trigger,e)});else e()}};WALK.Extensions.Script.definition={name:"Script",
properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ProjectionScreen=function(d){function e(){var v=w.getVideoTexture1();u.baseColorTexture=v?v:p}function g(){WALK.log("Presentation stop");w&&(w.uuid===q.myUuid&&q.stopShareScreen(),
w.removeEventListener("dispose",g),w.removeEventListener("avatarUpdated",e));w=null;u.baseColorTexture=p;m.triggers[0].material.highlightMix=0}function f(){var v=q.myUuid;w&&w.getVideoTexture1()?w.uuid===v&&(WALK.log("Requesting presentation stop"),m.viewerApi.apiUserChangeState(n,null)):(WALK.log("Requesting scren share "+v),q.startShareScreen(function(){m.viewerApi.apiUserChangeState(n,v)},function(){m.viewerApi.apiUserChangeState(n,null)},function(){}))}function h(v,y){console.assert(v===n);y?
(w&&w.uuid!==y&&(WALK.log("Changing presenting user"),g()),w||(WALK.log("New presenting user "+y),(w=m.viewerApi.findAvatar(y)||null)?(w.addEventListener("dispose",g),w.addEventListener("avatarUpdated",e),v=m.triggers[0].material,v.highlight=w.getMainMaterial().baseColor,v.setUniforms(),v.highlightMix=.7,e()):console.log("Cannot attach presentation stream of a user "+y+" The user was not found."))):g()}function k(){h(n,m.viewerApi.getApiUserState(n))}function l(v){var y=m.config;(u=m.viewerApi.findMaterial(y.material))?
(q=v,p=u.baseColorTexture,m.addTrigger(y.trigger,f),m.viewerApi.onApiUserStateChanged(n,h),m.viewerApi._onAvatarListChanged(k)):(console.error("Material for a projection screen is missing"),u=null)}WALK.Extension.call(this,d);var m=this,n="ProjectionScreen:"+this.name,q=null,u=null,p=null,w=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi._onMeetingJoined(l)};this.doStop=function(){this.viewerApi._removeOnMeetingJoined(l);
q&&(this.viewerApi.removeOnApiUserStateChanged(n,h),this.viewerApi._removeOnAvatarListChanged(k));u=q=null}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0};WALK.Extensions.SwitchObjects=function(d){function e(){if(0!==g.config.nodeTypes.length){for(var m=$jscomp.makeIterator(k),n=m.next();!n.done;n=m.next())n.value.hide();h+=1;if(h===
g.config.nodeTypes.length){if(g.config.hideAllAfterLast){h=-1;k.length=0;f.requestFrame();return}h=0}k=f.findNodesOfType(g.config.nodeTypes[h]);m=$jscomp.makeIterator(k);for(n=m.next();!n.done;n=m.next())n.value.show();f.requestFrame()}}WALK.Extension.call(this,d);var g=this,f=this.viewerApi,h,k;if(!f.isSceneReadyToDisplay()){d=$jscomp.makeIterator(this.config.nodeTypes);for(var l=d.next();!l.done;l=d.next())f.setNodeTypeEditable(l.value)}this.doStart=function(){var m=this;f.onSceneReadyToDisplay(function(){for(var n=
0;n<m.config.nodeTypes.length;++n)if(0<n||m.config.hideAllOnStart){var q=f.findNodesOfType(m.config.nodeTypes[n]),u=$jscomp.makeIterator(q);for(q=u.next();!q.done;q=u.next())q.value.hide()}if(0<m.config.nodeTypes.length&&!m.config.hideAllOnStart)for(h=0,k=f.findNodesOfType(m.config.nodeTypes[0]),n=$jscomp.makeIterator(k),q=n.next();!q.done;q=n.next())q.value.show();else h=-1,k=[];m.addTrigger(m.config.trigger,e);f.requestFrame()})};this.doStop=function(){for(var m=0;m<this.config.nodeTypes.length;++m)if(m!==
h){var n=f.findNodesOfType(this.config.nodeTypes[m]);n=$jscomp.makeIterator(n);for(var q=n.next();!q.done;q=n.next())q.value.show()}f.requestFrame()}};WALK.Extensions.SwitchObjects.definition={name:"Switch objects",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],
vrCompatible:!0};WALK.Extensions.VideoStream=function(d){function e(){function u(p){var w=document.createElement("video");w.classList.add("video-js");w.autoplay=!0;w.muted=!0;w.type="application/x-mpegURL";if(Hls.isSupported()){var v=new Hls;v.loadSource(p);v.attachMedia(w)}else w.canPlayType("application/vnd.apple.mpegurl")?w.src=p:console.log("No Hls support");return n.createStreamTextureFromHtmlVideo(w)}(function(){var p=u(q.config.streamUrl);p.addLoadedListener(function(){m=!1;q.running&&(console.log(p),
h=k.baseColorTexture,k.baseColorTexture=p,q.viewerApi.onNextPageInteraction(function(){p.muted=!1}),l=!0)});m=!0;p.play();return!0})()}function g(){m||(l||m?k.baseColorTexture.isPlaying?k.baseColorTexture.pause():k.baseColorTexture.play():e())}function f(){var u=q.config;(k=n.findMaterial(u.material))?k.baseColorTexture?WALK.loadScriptAndExecute(WALK.getViewerAssetUrl("lib/Hls.js"),function(){u.trigger&&q.addTrigger(u.trigger,g);!u.autoplay&&u.trigger||g()},function(){return WALK.USER_MSG.error("Cannot load required library")}):
(console.error("Material '"+u.material+"' for stream texture control '"+(u.name+"' does not have a stream texture")),k=null):console.error("Material '"+u.material+"' for stream texture control '"+(u.name+"' does not exist"))}WALK.Extension.call(this,d);var h=null,k=null,l=!1,m=!1,n=WALK.getViewer(),q=this;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi.onSceneLoadComplete(f)};this.doStop=function(){if(k){if(l){l=
!1;var u=k.baseColorTexture;k.baseColorTexture=h;u.dispose();h=null}k=null}}};WALK.Extensions.VideoStream.definition={name:"Video Stream",properties:[{id:"material",type:"material",label:"Material with stream"},{id:"streamUrl",type:"text",label:"Stream URL"},{id:"trigger",type:"trigger",label:"Trigger",defaultValue:!1,optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0}],vrCompatible:!0}})();var MeetingUiUtils$$module$extensions$MeetingUiUtils={};
(function(){function a(d){d.style.display=""}function b(d){d.style.display="none"}function c(d){var e=null,g=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.modal=this.foremost=this.top=!1;this.open=function(){null===g&&(this.modal?(e=document.createElement("div"),e.className="modal-backdrop",document.body.appendChild(e),g=document.createElement("div"),e.appendChild(g)):(g=document.createElement("div"),document.body.appendChild(g)),this.update(d))};this.update=function(f){var h=this;
g.innerHTML='\n       <div class="ext-popup '+(this.top?"ui-top ui-center":"ui-all-center")+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+f+"\n         </div>"+(this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"")+"\n       </div>";this.showDismiss&&(g.getElementsByClassName("ext-popup-close-button")[0].onclick=function(){return h.dismiss()})};
this.getElementsByClassName=function(f){return g.getElementsByClassName(f)};this.dismiss=function(){if(null!==g&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==g&&(this.modal?(document.body.removeChild(e),e=null):document.body.removeChild(g),g=null,this.onClose))this.onClose()}}MeetingUiUtils$$module$extensions$MeetingUiUtils={removeChildren:function(d){for(;d.firstChild;)d.removeChild(d.firstChild)},addClickHandler:function(d,e){document.getElementById(d).onclick=
e},show:a,hide:b,setVisibility:function(d,e){e?a(d):b(d)},setButtonHighlight:function(d,e){e?d.classList.add("ext-meeting-button-highlight"):d.classList.remove("ext-meeting-button-highlight")},highlightInput:function(d){d.classList.add("ext-meeting-input-missing");window.setTimeout(function(){d.classList.remove("ext-meeting-input-missing")},200)},highlightText:function(d){d.classList.add("ext-meeting-text-highlighted");window.setTimeout(function(){d.classList.remove("ext-meeting-text-highlighted")},
200)},UiPopup:c,showMessage:function(d,e){var g="";e&&(g='<h3 class="ext-meeting-dialog-title">'+e+"</h3>");var f=new c(g+('\n      <div class="ext-meeting-dialog-message">\n        '+d+'\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));f.showDismiss=!1;f.foremost=!0;f.modal=!0;f.open();f.getElementsByClassName("ext-meeting-button")[0].onclick=function(){f.close()}}}})();
var module$extensions$MeetingUiUtils={get MeetingUiUtils(){return MeetingUiUtils$$module$extensions$MeetingUiUtils}};var SoundUtils$$module$extensions$SoundUtils={};
(function(){function a(){null===b&&(b=new (window.AudioContext||window.webkitAudioContext));return b}var b=null,c=function(e,g,f){this._frequencyDiv=g;this._noSoundThreshold=f;this._maxFrequencyIndex=this._minFrequencyIndex=-1;this._noSoundCalls=0;this._source=null;this._analyser=a().createAnalyser();this._analyser.fftSize=2*this._frequencyDiv;this._analyser.smoothingTimeConstant=.5;e=new MediaStream([e.mediaStreamTrack]);this._source=a().createMediaStreamSource(e);this._source.connect(this._analyser);
e=a().sampleRate/this._frequencyDiv;this._minFrequencyIndex=Math.floor(c._minVoiceFrequency/e);this._maxFrequencyIndex=Math.floor(c._maxVoiceFrequency/e);this._dataArray=new Uint8Array(this._maxFrequencyIndex+1)};c.prototype.measureSoundVolume=function(){var e=this._getOverallSoundVolume();return this._shouldSkipNoSoundNotification(e)?null:e};c.prototype.dispose=function(){null!==this._source&&(this._source.disconnect(),this._source=null)};c.prototype._getOverallSoundVolume=function(){this._analyser.getByteFrequencyData(this._dataArray);
for(var e=0,g=this._minFrequencyIndex;g<=this._maxFrequencyIndex;g++)this._dataArray[g]>e&&(e=this._dataArray[g]);return e};c.prototype._shouldSkipNoSoundNotification=function(e){if(e<this._noSoundThreshold)return this._noSoundCalls++,this._noSoundCalls<c._skippedNoSoundCalls;this._noSoundCalls=0;return!1};c._minVoiceFrequency=85;c._maxVoiceFrequency=350;c._skippedNoSoundCalls=3;var d=function(e,g,f,h){this._width=e;this._height=g;this._bottomMargin=void 0!==h?h:0;this._volumeRect=null;this._rectId=
d._baseRectId+d._counter;d._counter++;this._noSoundThreshold=f;this._lengthCoef=e/(255-this._noSoundThreshold)};d.prototype.getHTML=function(){this._volumeRect=null;return'\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: '+this._bottomMargin.toString()+'px;"\n             width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n          <rect id="'+this._rectId+'"\n                x = "'+(this._width/2-1).toString()+
'" y = "0"\n                width="'+(1).toString()+'"\n                height="'+this._height.toString()+'"\n                fill="red"/>\n        </svg>\n      '};d.prototype.getEmptyHTML=function(){return'\n        <svg width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n        </svg>\n      '};d.prototype.update=function(e){null===this._volumeRect&&(this._volumeRect=document.getElementById(this._rectId));console.assert(null!==this._volumeRect,"Volume visualizer HTML not attached to any element");
if(null!==e){var g=this._getColor(e),f=Math.max(d._minimalDisplayedValue,Math.max(e,this._noSoundThreshold)-this._noSoundThreshold);e=this._width/2-f*this._lengthCoef/2;f*=this._lengthCoef;this._volumeRect.setAttribute("fill",g);this._volumeRect.setAttribute("x",e.toString());this._volumeRect.setAttribute("width",f.toString())}};d.prototype._getColor=function(e){return e<this._noSoundThreshold?"red":e<d._lowSoundThreshold?"orange":"green"};d._counter=0;d._baseRectId="ext-meeting-mic-bar-";d._lowSoundThreshold=
180;d._minimalDisplayedValue=20;SoundUtils$$module$extensions$SoundUtils={VolumeMeter:c,VolumeVisualizer:d}})();var module$extensions$SoundUtils={get SoundUtils(){return SoundUtils$$module$extensions$SoundUtils}};var MeetingStarter$$module$extensions$MeetingStarter;
(function(){function a(m,n){return m?n[0].toUpperCase()+n.slice(1):n[0].toLowerCase()+n.slice(1)}function b(m,n){var q=void 0!==n;q=a(!0,m.name)+(q?" and "+a(!1,n.name):"");m=m.error.name;console.assert(void 0===n||n.error.name===m);return"NotFoundError"===m?q+" not found":"NotAllowedError"===m?q+" blocked":"Error"===m?"Error":q+" not available"}function c(m,n){var q=void 0!==n,u=q?"they are":"it is",p=q?"them":"it",w=m.error.name;return"NotFoundError"===w?"Check if your "+(a(!1,m.name)+(q?" and "+
a(!1,n.name):""))+" "+(q?"are":"is")+" properly connected.":"NotAllowedError"===w?WALK.DETECTOR.mobile?WALK.DETECTOR.ios?"Unblock "+p+" by clicking "+(q?m.unblockIcon+" and "+n.unblockIcon:"the "+m.unblockIcon)+" "+(q?"buttons":"button")+".":"Unblock "+p+" in the browser settings for this webpage.":"Unblock "+p+" by clicking the "+(q?n.unblockIcon:m.unblockIcon)+" button in the browser\u2019s address bar and refresh the webpage.":"Error"===w?"Your browser doesn't support video meetings. Open the meeting link in another browser.":
"If "+u+" connected, close all other applications using "+(p+" and refresh the webpage.")}var d={name:"mic"},e={name:"camera",facingMode:"user"},g=function(m,n,q,u){this._firstErrorDiv=document.getElementById(m);this._secondErrorDiv=document.getElementById(n);this._devicePreview1=q;this._devicePreview2=u};g.prototype._reset=function(){this._devicePreview1.setErrorDiv(null);this._devicePreview2.setErrorDiv(null);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._firstErrorDiv);MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._secondErrorDiv)};
g.prototype._displayAndLogErrorMessage=function(m,n,q){function u(v){if(void 0!==v)return v.device}var p=b(n.device,u(q)),w=c(n.device,u(q));m.innerHTML='\n        <div class="ext-meeting-join-error-title">'+p+'</div>\n        <div class="ext-meeting-join-error-description">'+w+"</div>\n      ";n.setErrorDiv(m);n.device.logError();void 0!==q&&(q.setErrorDiv(m),q.device.logError())};g.prototype.update=function(){this._reset();var m=this._devicePreview1.device.error,n=this._devicePreview2.device.error;
if(null!==m||null!==n)null!==m&&null!==n?m.name===n.name?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1,this._devicePreview2):(this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1),this._displayAndLogErrorMessage(this._secondErrorDiv,this._devicePreview2)):null!==m?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1):this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview2)};var f=function(m,n,q){this._name=m;this._active=
!1;this._unblockIcon=n;this._defaultTrackOptions=q;this._error=this._track=null};f.prototype.logError=function(){null!==this._error&&WALK.log("Can't create local "+this.name+" track : "+(this._error.name+", "+this._error.message))};f.prototype.getErrorMessageInfo=function(){if(null===this._error)return null;var m=b(this),n=c(this);return{title:m,description:n}};$jscomp.global.Object.defineProperties(f.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},track:{configurable:!0,
enumerable:!0,get:function(){return this._track},set:function(m){this._track=m}},active:{configurable:!0,enumerable:!0,get:function(){return this._active},set:function(m){this._active=m}},unblockIcon:{configurable:!0,enumerable:!0,get:function(){return this._unblockIcon}},error:{configurable:!0,enumerable:!0,get:function(){return this._error},set:function(m){this._error=m}},defaultTrackOptions:{configurable:!0,enumerable:!0,get:function(){return this._defaultTrackOptions}}});var h=function(m,n,q,
u,p,w,v,y){this._device=new f(m,v,y);this._width=q;this._height=u;this._toggleButton=document.getElementById(p);this._previewContainer=document.getElementById(w);this._errorDiv=null;this._meetingStarter=n;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler(this._toggleButton.id,this._onToggleButtonClicked.bind(this));this._onStoppedBound=this._onStopped.bind(this)};h.prototype.isAvailable=function(){return null!==this._device.track};h.prototype.dispose=function(){null!==this._device.track&&
this._device.track.removeListener("stopped",this._onStoppedBound);this._close()};h.prototype.setErrorDiv=function(m){this._errorDiv=m};h.prototype.showInTestNeededMode=function(){this.setError({name:"Test needed"})};h.prototype.showInPreviewMode=function(){this.setError({name:"Initializing"});this.setToggleButtonVisibility(!0)};h.prototype.setTrack=function(m,n){null!==m&&void 0!==n?console.assert("Invalid setTrack parameters : track and error set"):null===m&&void 0===n&&console.assert("Invalid setTrack parameters : track and error not set");
this._disposeTrack();this._device.track=m;null!==this._device.track?(this._device.track.on("stopped",this._onStoppedBound),this._device.active=!0,this._showTrack(),this.setError(null)):(this._device.active=!1,this._hideTrack(),this.setError(n));this._updateToggleButtonState()};h.prototype.setError=function(m){this._device.error=m};h.prototype.getDefaultTrackOptions=function(){return WALK.cloneObject(this._device.defaultTrackOptions)};h.prototype.setToggleButtonVisibility=function(m){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton,
m)};h.prototype._updateToggleButtonState=function(){this._device.active?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],!1)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(this._toggleButton,!0),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[0],
!1),MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(this._toggleButton.children[1],!0))};h.prototype._disposeTrack=function(){if(null!==this._device.track){var m=this._device.track;m.removeListener("stopped",this._onStoppedBound);m.detach();m.stop()}this._device.track=null};h.prototype._onStopped=function(){null!==this._device.track&&(this.setTrack(null,{name:"NotReadableError",message:"Stopped"}),this._meetingStarter.updateErrorMessage())};h.prototype._close=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(this._previewContainer)};
h.prototype._setPreviewInnerHTML=function(m){this._close();this._previewContainer.innerHTML=m;MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer)};h.prototype._setPreviewElement=function(m){this._close();null!==m&&(m.style.width=this._width.toString()+"px",m.style.height=this._height.toString()+"px",this._previewContainer.appendChild(m),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(this._previewContainer))};h.prototype._showTrack=function(){this._device.active=!0;
this._device.track.enable()};h.prototype._hideTrack=function(){this._device.active=!1};h.prototype._onToggleButtonClicked=function(){var m=this;this.isAvailable()?(this._device.active?this._onSwitchOff():this._onSwitchOn(),this._updateToggleButtonState()):this.createDefaultTrack().then(function(n){m.setTrack(n);m._meetingStarter.updateErrorMessage()}).catch(function(n){m.setTrack(null,n);m._meetingStarter.updateErrorMessage();MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightText(m._errorDiv)})};
h.prototype._onSwitchOff=function(){this._hideTrack();this._device.track.disable()};h.prototype._onSwitchOn=function(){this._showTrack();this._device.track.enable()};h.prototype.createDefaultTrack=function(){throw Error("Not implemented");};$jscomp.global.Object.defineProperties(h.prototype,{device:{configurable:!0,enumerable:!0,get:function(){return this._device}}});var k=function(m,n,q,u,p){return h.call(this,"Camera",m,n,q,u,p,'<span class="fa-video-slash"></span>',e)||this};$jscomp.inherits(k,
h);k.prototype.showInTestNeededMode=function(){h.prototype.showInTestNeededMode.call(this);this._showPlaceholder()};k.prototype.showInPreviewMode=function(){h.prototype.showInPreviewMode.call(this);this._showPlaceholder()};k.prototype._showPlaceholder=function(){this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')};k.prototype._hideTrack=function(){h.prototype._hideTrack.call(this);
this._showPlaceholder()};k.prototype._showTrack=function(){h.prototype._showTrack.call(this);this._setPreviewElement(this._device.track.attach())};k.prototype._onSwitchOff=function(){h.prototype._onSwitchOff.call(this);this.setTrack(null,null)};k.prototype.createDefaultTrack=function(){return Twilio.Video.createLocalVideoTrack(this.getDefaultTrackOptions())};var l=function(m,n,q,u,p){m=h.call(this,"Microphone",m,n,q,u,p,'<span class="fa-microphone-slash"></span>',d)||this;m._noSoundThreshold=80;m._volumeVisualizer=
new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(n,q,m._noSoundThreshold);m._volumeMeter=null;m._measurementIntervalId=null;return m};$jscomp.inherits(l,h);l.prototype.showInTestNeededMode=function(){h.prototype.showInTestNeededMode.call(this);this._setPreviewElement(null)};l.prototype.showInPreviewMode=function(){h.prototype.showInPreviewMode.call(this);this._setPreviewElement(null)};l.prototype.dispose=function(){this._isMeasurementActive()&&this._stopMeasurement();h.prototype.dispose.call(this)};
l.prototype.createDefaultTrack=function(){return Twilio.Video.createLocalAudioTrack(this.getDefaultTrackOptions())};l.prototype._measure=function(){this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())};l.prototype._hideTrack=function(){h.prototype._hideTrack.call(this);this._isMeasurementActive()&&this._stopMeasurement();this._setPreviewElement(null)};l.prototype._showTrack=function(){h.prototype._showTrack.call(this);this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());this._startMeasurement()};
l.prototype._startMeasurement=function(){var m=this;this._volumeMeter=new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._device.track,512,this._noSoundThreshold);this._measurementIntervalId=setInterval(function(){return m._measure()})};l.prototype._stopMeasurement=function(){clearInterval(this._measurementIntervalId);this._measurementIntervalId=null;this._volumeMeter.dispose();this._volumeMeter=null};l.prototype._isMeasurementActive=function(){return null!==this._measurementIntervalId};
l.prototype._disposeTrack=function(){this._isMeasurementActive()&&this._stopMeasurement();h.prototype._disposeTrack.call(this)};MeetingStarter$$module$extensions$MeetingStarter=function(m){this._onJoinCallback=m;this._joinMode=!1;this._micVolumePreview=this._cameraPreview=this._dialog=null;this._cameraPreviewHeight=198;this._cameraPreviewWidth=264;this._micVolumePreviewHeight=4;this._micVolumePreviewWidth=40};MeetingStarter$$module$extensions$MeetingStarter.prototype.show=function(){var m=this;this._blurHelp();
this._createDialog();this._cameraPreview=new k(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");this._micVolumePreview=new l(this,this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container",1024);this._errorMessageGenerator=new g("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,this._cameraPreview);this._checkPermissions().then(function(){m._runPreviewMode(!1);
m._createDefaultMediaTracksSeparately(function(){return m._onMediaInitialized()})}).catch(function(n){void 0!==n&&WALK.log("Error checking audio/video devices permissions: "+n.name+": "+n.message);m._runTestNeededMode()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkPermissions=function(){return new Promise(function(m,n){return navigator.mediaDevices.enumerateDevices().then(function(q){var u=q.filter(function(p){return"audioinput"===p.kind&&""!==p.deviceId&&""!==p.label});q=q.filter(function(p){return"videoinput"===
p.kind&&""!==p.deviceId&&""!==p.label});0<u.length||0<q.length?m():n()}).catch(function(q){n(q)})})};MeetingStarter$$module$extensions$MeetingStarter.prototype._createDialog=function(){this._dialog=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name">\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <a href="https://www.shapespark.com/terms" target="_blank">\n          Terms of Service\n        </a> and <a href="https://www.shapespark.com/privacy" target="_blank">\n          Privacy Policy\n        </a>.\n        </div>\n      ');
this._dialog.showDismiss=!1;this._dialog.foremost=!0;this._dialog.open();this._initializeDisplayName()};MeetingStarter$$module$extensions$MeetingStarter.prototype._createDefaultMediaTracksSeparately=function(m){var n=this;Promise.all([this._micVolumePreview.createDefaultTrack().then(function(q){return n._onCreateAudioTrack(q)}).catch(function(q){return n._onFailAudioTrack(q)}),this._cameraPreview.createDefaultTrack().then(function(q){return n._onCreateVideoTrack(q)}).catch(function(q){return n._onFailVideoTrack(q)})]).then(m)};
MeetingStarter$$module$extensions$MeetingStarter.prototype._createDefaultMediaTracksTogether=function(){var m={audio:this._micVolumePreview.getDefaultTrackOptions(),video:this._cameraPreview.getDefaultTrackOptions()};return Twilio.Video.createLocalTracks(m)};MeetingStarter$$module$extensions$MeetingStarter.prototype._runTestNeededMode=function(){this._setTestNeededMode();this._cameraPreview.showInTestNeededMode();this._micVolumePreview.showInTestNeededMode()};MeetingStarter$$module$extensions$MeetingStarter.prototype._runPreviewMode=
function(m){this._setPreviewMode(m);m?(this._cameraPreview.setToggleButtonVisibility(!0),this._micVolumePreview.setToggleButtonVisibility(!0)):(this._cameraPreview.showInPreviewMode(),this._micVolumePreview.showInPreviewMode())};MeetingStarter$$module$extensions$MeetingStarter.prototype._onCreateAudioTrack=function(m){null!==m?this._micVolumePreview.setTrack(m):this._micVolumePreview.setTrack(null,{name:"Unknown error",message:""})};MeetingStarter$$module$extensions$MeetingStarter.prototype._onFailAudioTrack=
function(m){this._micVolumePreview.setTrack(null,m)};MeetingStarter$$module$extensions$MeetingStarter.prototype._onCreateVideoTrack=function(m){null!==m?this._cameraPreview.setTrack(m):this._cameraPreview.setTrack(null,{name:"Unknown error",message:""})};MeetingStarter$$module$extensions$MeetingStarter.prototype._onFailVideoTrack=function(m){this._cameraPreview.setTrack(null,m)};MeetingStarter$$module$extensions$MeetingStarter.prototype._onCreateMediaTrack=function(m){var n=m.filter(function(q){return"audio"===
q.kind});m=m.filter(function(q){return"video"===q.kind});0<n.length?this._onCreateAudioTrack(n[0]):this._onCreateAudioTrack(null);0<m.length?this._onCreateVideoTrack(m[0]):this._onCreateVideoTrack(null)};MeetingStarter$$module$extensions$MeetingStarter.prototype._testCamera=function(){var m=this;this._createDefaultMediaTracksTogether().then(function(n){m._onCreateMediaTrack(n);m._runPreviewMode(!0)}).catch(function(n){m._createDefaultMediaTracksSeparately(function(){return m._runPreviewMode(!0)})})};
MeetingStarter$$module$extensions$MeetingStarter.prototype._setTestNeededMode=function(){var m=this;this._joinMode=!1;var n=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(n);n.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-test-button",
function(){return m._testCamera()})};MeetingStarter$$module$extensions$MeetingStarter.prototype._setPreviewMode=function(m){var n=this;if(!this._joinMode){this._joinMode=!0;var q=document.getElementById("ext-meeting-join-button-container");MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(q);q.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-join-button",
function(){return n._joinMeeting()});m?this.updateErrorMessage():this.setJoinButtonEnabled(!1)}};MeetingStarter$$module$extensions$MeetingStarter.prototype._onMediaInitialized=function(){this.setJoinButtonEnabled(!0);this.updateErrorMessage()};MeetingStarter$$module$extensions$MeetingStarter.prototype.setJoinButtonEnabled=function(m){document.getElementById("ext-meeting-join-button").disabled=!m};MeetingStarter$$module$extensions$MeetingStarter.prototype._initializeDisplayName=function(){var m=document.getElementById("ext-meeting-join-name"),
n=localStorage.getItem("extMtgDisplayName");n&&(m.value=n);m.focus();m.select()};MeetingStarter$$module$extensions$MeetingStarter.prototype._checkDisplayName=function(){var m=document.getElementById("ext-meeting-join-name"),n=m.value.trim();if(n)return n;MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(m)};MeetingStarter$$module$extensions$MeetingStarter.prototype._blurHelp=function(){document.getElementById("help-and-primary-progress").classList.add("ui-blur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._unblurHelp=
function(){var m=document.getElementById("help-and-primary-progress");m.classList.remove("ui-blur");m.classList.add("ui-unblur")};MeetingStarter$$module$extensions$MeetingStarter.prototype._joinMeeting=function(){var m=this._checkDisplayName();if(void 0!==m){localStorage.setItem("extMtgDisplayName",m);var n=this._micVolumePreview.device,q=this._cameraPreview.device;this._dispose();this._onJoinCallback(m,n,q)}};MeetingStarter$$module$extensions$MeetingStarter.prototype.updateErrorMessage=function(){this._errorMessageGenerator.update()};
MeetingStarter$$module$extensions$MeetingStarter.prototype._dispose=function(){this._dialog.close();this._unblurHelp();this._cameraPreview.dispose();this._micVolumePreview.dispose();this._micVolumePreview=this._cameraPreview=this._dialog=null}})();var module$extensions$MeetingStarter={get MeetingStarter(){return MeetingStarter$$module$extensions$MeetingStarter}};(function(){function a(){var C=window.location.hostname;return C.endsWith(".shapespark.com")?"https://cloud"+C.substr(C.indexOf(".")):C.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":WALK.DEVEL_MEETING_CLOUD_URL||"https://cloud.shapespark.com"}function b(C){C=new Date(C);var Q=new Date;return Q.getDate()===C.getDate()&&Q.getMonth()===C.getMonth()&&Q.getFullYear()===C.getFullYear()?C.toLocaleTimeString():C.toLocaleDateString()+" "+C.toLocaleTimeString()}function c(C,Q,da,aa){var X=
document.createElement("li");X.classList.add("ext-meeting-list-entry");var S=X.appendChild(document.createElement("span"));S.classList.add("ext-meeting-list-name");S.innerText=C;S.style.color=da;aa&&(X.onclick=aa,X.style.cursor="pointer");Q&&(X.appendChild(document.createElement("br")),C=X.appendChild(document.createElement("small")),C.innerText=Q,C.style.color="white");return X}function d(C,Q,da){return{color:"#0775e8",icon:"edit",opacity:1,position:[C,Q,da],radius:.07,type:"sphere"}}function e(C,
Q,da,aa){aa=void 0===aa?!0:aa;var X=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("<div>\n         "+C+'\n       </div>\n       <div class ="ext-meeting-dialog-buttons">\n         <button class="ext-meeting-dialog-ok ext-meeting-button">\n           '+Q+"\n         </button>\n         "+(aa?'<button class="ext-meeting-dialog-cancel ext-meeting-button">\n         Cancel\n        </button>':"")+"\n       </div>");X.showDismiss=!1;X.open();aa&&(X.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick=
function(){return X.dismiss()});X.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick=function(){X.close();da()}}function g(C,Q){Q=Q.attach();C=C.createTextureFromHtmlVideo(Q);C.play();return C}function f(C){C.detach().forEach(function(Q){return Q.remove()})}function h(C){return C&&C.isStarted&&C.isEnabled&&!C.isStopped}function k(C,Q,da){this._viewer=C;this._uuid=Q;C=parseInt(Q.substring(2));this._color=WALK.AVATAR_COLORS[C%WALK.AVATAR_COLORS.length];this._twilioParticipant=this._avatar=this._displayName=
null;this._lastRenderedPosition=[];this._lastRenderedPositionLength=0;this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._noSoundThreshold=80;this._soundVolumeUpdatesScheduler=da;this._volumeVisualizer=new SoundUtils$$module$extensions$SoundUtils.VolumeVisualizer(20,3,this._noSoundThreshold,3);this._volumeMeter=null}function l(C,Q,da,aa,X,S){k.call(this,C,Q,aa,!0);this._displayName=da;this._setUpAvatar();this._avatar.hideBody();this._isPublishingTracksDuringConnecting=!1;
this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._micDevice=X;this._cameraDevice=S;this._micTrack=this._micDevice.track;null!==this._micTrack&&this._subscribeToMicEvents();this._updateSoundMeasurementState();this._cameraTrack=this._cameraDevice.track;null!==this._cameraTrack&&(console.assert(this._cameraDevice.active,"Got inactive camera track from MeetingStarter"),this._subscribeToCameraEvents());this._lastPosition=
null;this._positionMessage=[Q,da,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=null}function m(C,Q,da,aa){k.call(this,C,Q,da,!1);this._onUiRefreshNeeded=aa;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function n(C,Q,da,aa,X,S){var O=new PubNub({publishKey:Q.publishKey,
subscribeKey:Q.subscribeKey,authKey:Q.authKey,uuid:C.uuid,ssl:!0}),la=Q.channel;O.subscribe({channels:[la],withPresence:!0});O.addListener({message:function(R){WALK.log("listener received message",R);"SceneState"===R.message.type&&X(R.message.state)},presence:function(R){R.uuid!==C.uuid&&(WALK.log("listener presence event",R),"join"===R.action?da(R.uuid):"leave"===R.action&&aa(R.uuid))},status:function(R){"PNAccessDeniedCategory"!==R.category&&"PNNetworkIssuesCategory"!==R.category&&"PNNetworkDownCategory"!==
R.category&&"PNTimeoutCategory"!==R.category||S(R.category)}});O.hereNow({channels:[la],includeUUIDs:!0,includeState:!0},function(R,ra){WALK.log("herenow",R,ra);ra.channels[la].occupants.forEach(function(ma){ma.uuid!==C.uuid&&da(ma.uuid)})});this.dispose=function(){O.unsubscribeAll()}}function q(C,Q,da,aa,X,S,O){function la(K){var J=K.identity.match(/^u-\d+/);J=J&&J[0];return J?J:(WALK.warn("Unknown participant",K.identity),null)}function R(K){WALK.log('Participant "%s" connected',K.identity);var J=
la(K);J&&da(J,K)}function ra(K){WALK.log('Participant "%s" disconnected',K.identity);var J=la(K);J&&aa(J,K)}var ma=Q.avToken,xa=Q.channel,T=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],ka=null,ua=!1,wa=0;this.isConnected=function(){return ua};this.disconnect=function(){ua=!1;ka&&ka.disconnect();C.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!ua);ua=!0;C.startedConnectingToTwilio();WALK.log('Connecting to room "%s"',
xa);Twilio.Video.connect(ma,{name:xa,tracks:C.getAllTracks()}).then(function(K){ka=K;WALK.log("Connected to room");ka.participants.forEach(R);ka.on("participantConnected",R);ka.on("participantDisconnected",ra);ka.on("reconnecting",function(J){wa+=1});ka.on("reconnected",function(J){wa=0});ka.once("disconnected",function(J){ua&&(ka.participants.forEach(ra),C.disconnectedFromTwilio(),0<wa?S("TDisconnected"+J.code):O())});C.connectedToTwilio(ka.localParticipant)}).catch(function(K){C.failedToConnectToTwilio();
T.includes(K.name)?X(K):S("T"+K.code)})}}function u(C,Q){function da(la,R){var ra=document.createElement("span");ra.classList.add("ext-meeting-status-list-name");ra.innerText=la;ra.style.color=R;return ra}function aa(la){var R=document.createElement("span");R.classList.add("ext-meeting-status-list-mic-indicator");la?R.classList.add("fa-microphone"):R.classList.add("fa-microphone-slash");return R}function X(la){console.assert(null!==la.volumeVisualizer,"volumeVisualizer not initialized");var R=document.createElement("span");
la.isSoundMeasurementActive()?R.innerHTML=la.volumeVisualizer.getHTML():R.innerHTML=la.volumeVisualizer.getEmptyHTML();return R}var S=document.getElementById("ext-meeting-status"),O=document.getElementById("ext-meeting-who-list");this.update=function(la){MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(O);var R=O.appendChild,ra=document.createElement("li");ra.classList.add("ext-meeting-status-list-entry");ra.appendChild(X(C));ra.appendChild(da(C.displayName+" (me)",C.color));var ma=
h(C.micTrack);ra.appendChild(aa(ma));R.call(O,ra);la=$jscomp.makeIterator(Object.values(la));for(R=la.next();!R.done;R=la.next())if(ma=R.value,ma.hasDisplayName){R=O;ra=R.appendChild;var xa=document.createElement("li");xa.classList.add("ext-meeting-status-list-entry");xa.appendChild(X(ma));var T=da(ma.displayName,ma.color);T.onclick=ma.seeAvatar.bind(ma);T.style.cursor="pointer";xa.appendChild(T);xa.appendChild(aa(ma.micTrack&&ma.micTrack.isEnabled));ra.call(R,xa)}};this.show=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.show(S)};
this.hide=function(){MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(S)};this.update([]);this.show()}function p(C){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+C+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-dialog-buttons">\n        Publish\n      </button>\n    '}function w(C,Q){function da(X){var S=aa;null!==X.location&&(S+=":"+
X.location.join(":"));return S}var aa="extMtg:"+C+":"+Q+":";this.getTimeStampOfLastReadNoteAtLocation=function(X){return localStorage.getItem(da(X))||-1};this.isNoteRead=function(X){return X.ts<=this.getTimeStampOfLastReadNoteAtLocation(X)||X.author===Q};this.markAllNotesAtLocationAsRead=function(X){localStorage.setItem(da(X),X.ts)}}function v(C,Q,da,aa,X,S){function O(W){if(W===Q.displayName)return Q.color;for(var Da=$jscomp.makeIterator(Object.values(da)),Ba=Da.next();!Ba.done;Ba=Da.next())if(Ba=
Ba.value,Ba.displayName===W)return Ba.color;return"#ffffff"}function la(){T=!1;aa.show();U.style.cursor="default";ka.dismiss();ua.close()}function R(W){return xa.filter(function(Da){Da=Da.location;var Ba=W.location;Da=null===Da||null===Ba?!1:WALK.deepEqual(Da,Ba);return Da})}function ra(W,Da){function Ba(ea,Y){if(!T){pa.classList.remove("ext-meeting-note-list-unread");pa.classList.add("ext-meeting-note-list-selected");Y&&pa.scrollIntoView();ea.material.highlightMix=.7;C.requestFrame();var va="";Y=
new Map;for(var L=X.getTimeStampOfLastReadNoteAtLocation(W),ja=null,Ca=$jscomp.makeIterator(R(W)),za=Ca.next();!za.done;za=Ca.next()){ja=za.value;za="ext-meeting-note-text"+ja.id;var Ka="ext-meeting-note-author"+ja.id,ya="ext-meeting-note-entry";ja.ts>L&&ja.author!==Q.displayName&&(ya+=" ext-meeting-note-unread");va+='<div class="'+ya+'">\n               <strong id="'+Ka+'"\n                   style="color: '+O(ja.author)+'">\n               </strong> <span>'+b(ja.ts)+'</span>\n               <div id="'+
za+'">\n               </div>\n             </div>';Y.set(za,ja.text);Y.set(Ka,ja.author)}va+=p("Type your response");wa?wa.update(va):(wa=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(va),wa.top=!0,wa.onClose=function(){pa.classList.remove("ext-meeting-note-list-selected");ea.material.highlightMix=0;C.requestFrame();wa=null});X.markAllNotesAtLocationAsRead(ja);K=W.location;wa.open();Y.forEach(function(Oa,Ja){document.getElementById(Ja).innerText=Oa});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",
function(){var Oa=document.getElementById("ext-meeting-note-text"),Ja=Oa.value.trim();if(Ja){var $a=ea.position;S(Ja,[$a.x,$a.y,$a.z]);Oa.value=""}else MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(Oa)})}}var Ga=C.addAnchor(d(W.location[0],W.location[1],W.location[2],"#0775e8"),function(ea){return Ba(ea,!0)});Ga.material.highlight=P;Ga.material.setUniforms();ma.push(Ga);var Ha=W.author;var pa=c(Ha,b(W.ts),O(Ha),function(){C.seeItem(Ga);Ba(Ga,!1)});X.isNoteRead(W)||pa.classList.add("ext-meeting-note-list-unread");
Da.appendChild(pa);null!==wa&&WALK.deepEqual(K,W.location)&&Ba(Ga,!0)}var ma=[],xa=[],T=!1,ka=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");ka.top=!0;var ua=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup(p("Type your note"));ua.top=!0;var wa=null,K=null;MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-add-note",function(){T=!0;aa.hide();U.style.cursor="pointer";wa&&
wa.close();C.onNodeTypeClicked(ha);ka.onDismiss=function(){C.removeOnNodeTypeClicked(ha);la()};ka.open()});var J=new THREE.Vector3;var ha=function(W,Da,Ba){U.style.cursor="default";J.copy(Da);WALK.movePointTowards(J,C.getCameraPosition(),.1);C.removeOnNodeTypeClicked(ha);var Ga=C.addAnchor(d(J.x,J.y,J.z));Ga.material.highlight=P;Ga.material.setUniforms();Ga.material.highlightMix=.7;ka.close();ua.onClose=function(){C.removeAnchor(Ga);la()};ua.open();MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-note-publish",
function(){var Ha=document.getElementById("ext-meeting-note-text"),pa=Ha.value.trim();pa?S(pa,[J.x,J.y,J.z]):MeetingUiUtils$$module$extensions$MeetingUiUtils.highlightInput(Ha)});return!0};C.onApiUserStateChanged("MeetingNotes",function(W,Da){console.assert("MeetingNotes"===W);xa=Da.sort(function(pa,ea){var Y=X.isNoteRead(pa),va=X.isNoteRead(ea);return Y!==va?Y?-1:1:pa.ts-ea.ts});la();W=$jscomp.makeIterator(ma);for(Da=W.next();!Da.done;Da=W.next())C.removeAnchor(Da.value);ma.length=0;W=document.getElementById("ext-meeting-note-list");
MeetingUiUtils$$module$extensions$MeetingUiUtils.removeChildren(W);Da=new Map;for(var Ba=xa.length-1;0<=Ba;Ba--){var Ga=xa[Ba];if(null!==Ga.location){var Ha=Ga.location.join("/");Da.has(Ha)||(Da.set(Ha,Ba),ra(Ga,W),W.lastChild.scrollIntoView())}}})}function y(C,Q){function da(){la=O=null;S.pointerX=null;S.pointerY=null;S.pointerZ=null;C._enableControls()}function aa(){S.isEnabled()?(U.style.cursor="default",da(),ra.disable(),R.close(),Q.show()):(U.style.cursor="pointer",R.open(),ra.enable(),R.onDismiss=
aa,Q.hide())}var X=this,S=this,O=null,la=null,R=new MeetingUiUtils$$module$extensions$MeetingUiUtils.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");R.top=!0;var ra=C._createPointerEventHelper(0);ra.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return ra.isEnabled()};this.showPointer=function(){return null!==this.pointerX};C.onBeforeRender(function(){if(null!==O){var ma=C._findIntersectionAtPosition(O,la);Infinity!==ma.distance&&(X.pointerX=
ma.point.x,X.pointerY=ma.point.y,X.pointerZ=ma.point.z)}});ra.callbacks.onPointerDown=function(ma,xa){O=ma;la=xa;C._disableControls();C.requestFrame();return!0};ra.callbacks.onPointerMove=function(ma,xa){if(null===O)return!1;O=ma;la=xa;C.requestFrame();return!0};ra.callbacks.onPointerUp=function(){da();C.requestFrame();return!0};MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-pointer",function(){aa()})}function D(){var C=[0,0,0,0,0],Q=[0,0,0,0,0,0,0,0],da=null,aa=!1;
this.newUpdateWithPointer=function(){aa=!1;da!==Q&&(aa=!0,da=Q)};this.newUpdateNoPointer=function(){aa=!1;da!==C&&(aa=!0,da=C)};this.set=function(X,S){da[X]!==S&&(da[X]=S,aa=!0)};this.getFilledArray=function(){return aa?da:null}}function A(){function C(O){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(O.children[0],!0);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(O.children[1],!1)}function Q(O){MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(O.children[0],
!1);MeetingUiUtils$$module$extensions$MeetingUiUtils.setVisibility(O.children[1],!0)}var da=document.getElementById("ext-meeting-mic-toggle"),aa=document.getElementById("ext-meeting-camera-toggle"),X=document.getElementById("ext-meeting-camera-preview"),S=null;this.refreshMicControls=function(O){h(O)?(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(da,!1),C(da)):(MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(da,!0),Q(da))};this.refreshCameraControls=function(O){h(O)?
(S||(S=O.attach(),X.appendChild(S)),MeetingUiUtils$$module$extensions$MeetingUiUtils.show(X),MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(aa,!1),C(aa)):(S&&(O.detach(),S.remove(),S=null),MeetingUiUtils$$module$extensions$MeetingUiUtils.hide(X),MeetingUiUtils$$module$extensions$MeetingUiUtils.setButtonHighlight(aa,!0),Q(aa))};this.setToggleButtonHandlers=function(O,la){da.onclick=O;aa.onclick=la}}function G(C,Q,da,aa){function X(Y){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+
Y+")")}function S(Y,va){Y={meetingKey:Ba,author:C,text:Y,location:va};WALK.ajaxPost(a()+"/meetings/"+Da+"/notes","application/json",JSON.stringify(Y),function(){return WALK.log("Note added.")},function(){return WALK.log("Failed to add note")})}function O(Y){ha.update(J)}function la(Y){var va=J[Y];va||(va=new m(ka,Y,wa,O),J[Y]=va);return va}function R(Y){Y in J&&(J[Y].dispose(),delete J[Y],ha.update(J),ea.isConnected()&&0===Object.keys(J).length&&ea.disconnect())}function ra(Y){Ga=Y;for(var va=$jscomp.makeIterator(Object.keys(Y)),
L=va.next();!L.done;L=va.next())L=L.value,ka.apiUserChangeState(L,Y[L])}function ma(){K.dispose();ea.dispose();pa.dispose();for(var Y in J)J.hasOwnProperty(Y)&&J[Y].dispose();wa.dispose()}function xa(Y){Ha.showPointer()?(ua.newUpdateWithPointer(),ua.set(5,WALK.round(Ha.pointerX,3)),ua.set(6,WALK.round(Ha.pointerY,3)),ua.set(7,WALK.round(Ha.pointerZ,3))):ua.newUpdateNoPointer();Y=ka.getCameraPosition();var va=ka.getCameraRotation();ua.set(0,WALK.round(Y.x,3));ua.set(1,WALK.round(Y.y,3));ua.set(2,WALK.round(Y.z,
3));ua.set(3,WALK.round(va.yaw,1));ua.set(4,WALK.round(va.pitch,1));(Y=ua.getFilledArray())&&K.updatePosition(Y)}function T(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");ma();ha.update({})}var ka=WALK.getViewer(),ua=new D,wa=new fa;this.myUuid=aa.uuid;var K=new l(ka,this.myUuid,C,wa,Q,da),J={},ha=new u(K,ka),W=new A,Da=aa.id,Ba=aa.meetingKey,Ga;W.setToggleButtonHandlers(function(){K.toggleMic()},function(){K.toggleCamera()});K.setAvTracksStateHandlers(function(Y){W.refreshMicControls(Y);
ha.update(J)},function(Y){W.refreshCameraControls(Y)});W.refreshMicControls(K.micTrack);W.refreshCameraControls(K.cameraTrack);var Ha=new y(ka,ha);WALK.urlHashContains("meeting-notes")&&(MeetingUiUtils$$module$extensions$MeetingUiUtils.show(document.getElementById("ext-meeting-notes-preview")),v(ka,K,J,ha,new w(Da,C),S));null!==aa.sceneState&&ra(aa.sceneState);var pa=new n(K,aa,function(Y){la(Y);ea.isConnected()||ea.connect()},R,ra,X);var ea=new q(K,aa,function(Y,va){la(Y).connectedToTwilio(va)},
function(Y,va){R(Y)},function(Y){WALK.USER_MSG.info("Failed to acquire media.<br/>"+Y.message,6E3)},X,function(){WALK.USER_MSG.error("The meeting has been ended.")});MeetingUiUtils$$module$extensions$MeetingUiUtils.addClickHandler("ext-meeting-leave",function(){e("Do you want to leave this meeting?","Leave meeting",function(){ma();document.body.innerHTML='<div id="cover-image"></div>';e("You have left the meeting.","Join again",function(){location.reload()},!1)})});ka.onBeforeRender(xa);xa();ka.onApiUserStateChanged(function(Y,
va){Y=ka.getApiUserState();WALK.deepEqual(Y,Ga)||(Y={meetingKey:Ba,sceneState:Y},WALK.ajaxPost(a()+"/meetings/"+Da+"/scene-state","application/json",JSON.stringify(Y),function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")}))});this.startShareScreen=function(Y,va,L){WALK.log("Screen share start requested");K.startShareScreen(Y,va,L)};this.stopShareScreen=function(){WALK.log("Screen share stop requested");K.stopShareScreen()};null!==aa.remainingTimeSeconds&&
setTimeout(T,1E3*(aa.remainingTimeSeconds+5))}function I(C){(new MeetingStarter$$module$extensions$MeetingStarter(function(Q,da,aa){Q=new G(Q,da,aa,C);WALK.getViewer()._meetingJoined(Q)})).show()}function H(C){WALK.getViewer().onSceneLoadComplete(function(){var Q=WALK.getViewerAssetUrl("3dassets/avatar.obj");WALK.loadGeometriesFromObj(Q,function(da){WALK.setAvatarGeometries(da);C()},function(){return WALK.USER_MSG.error("Failed to load the meeting")})})}if(WALK.urlHashContains("meeting-key")||WALK.urlHashContains("meeting")){WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");
WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var P=new THREE.Color(0,1,0),U=document.getElementById("walk-canvas");k.prototype={constructor:k,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");WALK.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},get displayName(){return this._displayName},
get hasDisplayName(){return null!==this._displayName},_positionChanged:function(C){if(this._lastRenderedPositionLength!==C.length)return!0;for(var Q=0;Q<C.length;Q++)if(1E-5<Math.abs(this._lastRenderedPosition[Q]-C[Q]))return!0;return!1},_setLastRenderedPosition:function(C){this._lastRenderedPositionLength=C.length;for(var Q=0;Q<C.length;Q++)this._lastRenderedPosition[Q]=C[Q]},get volumeVisualizer(){return this._volumeVisualizer},updatePosition:function(C){if(this.hasDisplayName&&this._positionChanged(C)){this._setLastRenderedPosition(C);
var Q=this._avatar;Q.setPositionFromArray(C);Q.rotate(C[3],C[4]);6<=C.length?Q.placePointer(C[5],C[6],C[7]):Q.hidePointer();Q.visible&&(Q.updateMatrixWorld(!0),this._viewer.requestFrame())}},updateSoundVolumeVisualization:function(){console.assert(null!==this._volumeMeter,"this._voulmeMeter not created");var C=this._volumeMeter.measureSoundVolume();this._onSoundVolumeUpdated(C)},_onSoundVolumeUpdated:function(C){this._volumeVisualizer.update(C)},dispose:function(){this.isSoundMeasurementActive()&&
this._stopSoundMeasurement();this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())},_updateSoundMeasurementState:function(){null!==this._micTrack&&this._micTrack.isEnabled?this._startSoundMeasurement():this._stopSoundMeasurement()},isSoundMeasurementActive:function(){return null!==this._volumeMeter},_startSoundMeasurement:function(){this.isSoundMeasurementActive()||(this._volumeMeter=new SoundUtils$$module$extensions$SoundUtils.VolumeMeter(this._micTrack,
512,this._noSoundThreshold),this._soundVolumeUpdatesScheduler.registerUser(this))},_stopSoundMeasurement:function(){this.isSoundMeasurementActive()&&(this._soundVolumeUpdatesScheduler.unregisterUser(this),this._volumeMeter.dispose(),this._volumeMeter=null,this._avatar.onSoundSwitchedOff())}};Object.defineProperty(k.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(k.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});l.prototype=Object.create(k.prototype);
l.prototype.constructor=l;Object.defineProperty(l.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(l.prototype,"screenTrack",{get:function(){return this._screenTrack}});l.prototype.getAllTracks=function(){var C=[this._dataTrack];this._micTrack&&C.push(this._micTrack);this._cameraTrack&&C.push(this._cameraTrack);this._screenTrack&&C.push(this._screenTrack);return C};l.prototype._sendPosition=function(C){this._positionMessage[2]=C;this._dataTrack.send(JSON.stringify(this._positionMessage))};
l.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};l.prototype.startedConnectingToTwilio=function(){this._isPublishingTracksDuringConnecting=!0};l.prototype.failedToConnectToTwilio=function(){this._isPublishingTracksDuringConnecting=!1};l.prototype.connectedToTwilio=function(C){var Q=this;this._twilioParticipant=C;C.publishTracks(this.getAllTracks()).finally(function(){Q._isPublishingTracksDuringConnecting=!1});this._resendLastPosition();
this._resendInterval=setInterval(function(){return Q._resendLastPosition()},1E3)};l.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(l.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});l.prototype.updatePosition=function(C){WALK.log("Update local position",C);k.prototype.updatePosition.call(this,C);this._lastPosition=C;this.isConnectedToTwilio&&this._sendPosition(C)};
l.prototype.setAvTracksStateHandlers=function(C,Q){this._onMicTrackStateChanged=C;this._onCameraTrackStateChanged=Q};l.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&this._micTrack.isStopped);WALK.log("Removing stopped local mic track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));this._micTrack=null};l.prototype._subscribeToMicEvents=function(){var C=this,Q=function(){C._updateSoundMeasurementState();
C._onMicTrackStateChanged&&C._onMicTrackStateChanged(C._micTrack)};this._micTrack.on("started",Q);this._micTrack.on("enabled",Q);this._micTrack.on("disabled",Q);this._micTrack.on("stopped",function(){Q();C._removeStoppedMicTrack()})};l.prototype._createMicTrack=function(){var C=this;WALK.log("Creating local mic track");if(this._isCreatingMicTrack)WALK.log("Local mic track is already being created");else{this._isCreatingMicTrack=!0;var Q=null;Twilio.Video.createLocalAudioTrack(this._micDevice.defaultTrackOptions).then(function(da){Q=
da;if(C.isConnectedToTwilio)return WALK.log("Publishing local mic track"),C._twilioParticipant.publishTrack(Q)}).then(function(da){da?WALK.log("Local mic track created and published"):WALK.log("Local mic track created but not yet published");C._micTrack=Q;C._subscribeToMicEvents();C._onMicTrackStateChanged&&C._onMicTrackStateChanged(C._micTrack);C._isCreatingMicTrack=!1}).catch(function(da){Q&&Q.stop();C._micDevice.error=da;C._showCreateTrackError(C._micDevice);C._isCreatingMicTrack=!1})}};l.prototype.toggleMic=
function(){this._micTrack?this._micTrack.isEnabled?(WALK.log("Disabling local mic track"),this._micTrack.disable()):(WALK.log("Enabling local mic track"),this._micTrack.enable()):this._createMicTrack()};l.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);WALK.log("Removing stopped local camera track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=
null};l.prototype._subscribeToCameraEvents=function(){var C=this,Q=function(){C._onCameraTrackStateChanged&&C._onCameraTrackStateChanged(C._cameraTrack)};this._cameraTrack.on("started",Q);this._cameraTrack.on("enabled",Q);this._cameraTrack.on("disabled",Q);this._cameraTrack.on("stopped",function(){Q();C._removeStoppedCameraTrack()})};l.prototype._createCameraTrack=function(){var C=this;WALK.log("Creating local camera track");if(this._isCreatingCameraTrack)WALK.log("Local camera track is already being created");
else{this._isCreatingCameraTrack=!0;var Q=null;Twilio.Video.createLocalVideoTrack(this._cameraDevice.defaultTrackOptions).then(function(da){Q=da;if(C.isConnectedToTwilio)return WALK.log("Publishing local camera track"),C._twilioParticipant.publishTrack(Q)}).then(function(da){da?WALK.log("Local camera track created and published"):WALK.log("Local camera track created but not yet published");C._cameraTrack=Q;C._subscribeToCameraEvents();C._onCameraTrackStateChanged&&C._onCameraTrackStateChanged(C._cameraTrack);
C._isCreatingCameraTrack=!1}).catch(function(da){Q&&Q.stop();C._cameraDevice.error=da;C._showCreateTrackError(C._cameraDevice);C._isCreatingCameraTrack=!1})}};l.prototype._showCreateTrackError=function(C){C=C.getErrorMessageInfo();MeetingUiUtils$$module$extensions$MeetingUiUtils.showMessage(C.description,C.title)};l.prototype.toggleCamera=function(){this._cameraTrack?this._isPublishingTracksDuringConnecting?WALK.log("Cannot disable the camera track during connection process"):this._cameraTrack.stop():
this._createCameraTrack()};l.prototype.startShareScreen=function(C,Q,da){var aa=this;null!==this._screenTrack?C():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia().then(function(X){WALK.log("share screen - stream:",X);var S=new Twilio.Video.LocalVideoTrack(X.getTracks()[0],{name:"screen"});aa._screenTrack=S;X=g(aa._viewer,S);aa._avatar.setVideoTexture1(X);aa._viewer.requestFrame();aa.isConnectedToTwilio&&aa._twilioParticipant.publishTrack(S);C();S.once("stopped",function(){WALK.log("Screen track stopped");
aa.isConnectedToTwilio&&aa._twilioParticipant.unpublishTrack(S);aa._avatar.setVideoTexture1(null);f(S);aa._screenTrack=null;aa._viewer.requestFrame();Q()})}).catch(function(X){da()}))};l.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};l.prototype.dispose=function(){this._micTrack&&this._micTrack.stop();this._cameraTrack&&this._cameraTrack.stop();this._screenTrack&&this._screenTrack.stop();k.prototype.dispose.call(this)};m.prototype=
Object.create(k.prototype);m.prototype.constructor=m;m.prototype._refreshUi=function(){this._onUiRefreshNeeded&&this._onUiRefreshNeeded(this)};m.prototype._setUpMicTrack=function(){var C=this;WALK.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){C._updateSoundMeasurementState();C._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);this._micTrack.on("disabled",this._micTrackStateChangedBound);this._updateSoundMeasurementState();
this._micTrack.attach()};m.prototype._tearDownMicTrack=function(){WALK.log("Tearing down remote mic track for %s:%s",this._uuid,this._displayName);f(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};m.prototype._setUpCameraTrack=function(){var C=this;WALK.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var Q=g(this._viewer,
this._cameraTrack);this._cameraTrackEnabledBound=function(){C._avatar.setVideoTexture0(Q)};this._cameraTrackDisabledBound=function(){C._avatar.setVideoTexture0(null)};this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(Q)};m.prototype._tearDownCameraTrack=function(){WALK.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);f(this._cameraTrack);
this._cameraTrack.removeListener("enabled",this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=null};m.prototype._setUpScreenTrack=function(){WALK.log("Setting up remote screen track for %s:%s",this._uuid,this._displayName);var C=g(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(C)};m.prototype._tearDownScreenTrack=function(){WALK.log("Tearing down remote screen track for %s:%s",
this._uuid,this._displayName);this._avatar.setVideoTexture1(null);f(this._screenTrack)};m.prototype._setDisplayName=function(C){WALK.log("Remote display name known for %s:%s",this._uuid,C);this._displayName=C;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();this._screenTrack&&this._setUpScreenTrack();this._refreshUi()};m.prototype._trackSubscribed=function(C){var Q=this;WALK.log("Remote %s:%s track subscribed for %s:%s",C.kind,C.name,this._uuid,
this._displayName);this._disposed||("data"===C.kind&&"data"===C.name?this._dataTrack?WALK.log("Ignoring duplicate data track"):(this._dataTrack=C,C.on("message",function(da){da=JSON.parse(da);var aa=da[1];da=da[2];Q.hasDisplayName||Q._setDisplayName(aa);Q.updatePosition(da)})):"audio"===C.kind&&"mic"===C.name?this._micTrack?WALK.log("Ignoring duplicate mic track"):(this._micTrack=C,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===C.kind&&("camera"===C.name?this._cameraTrack?
WALK.log("Ignoring duplicate camera track"):(this._cameraTrack=C,this._avatar&&(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===C.name&&(this._screenTrack?WALK.log("Ignoring duplicate screen track"):(this._screenTrack=C,this._avatar&&(this._setUpScreenTrack(),this._viewer.requestFrame())))))};m.prototype._trackUnsubscribed=function(C){WALK.log("Remote %s:%s track unsubscribed for %s:%s",C.kind,C.name,this._uuid,this._displayName);this._disposed||(C===this._dataTrack?this._dataTrack=
null:C===this._micTrack?(this.hasDisplayName&&this._tearDownMicTrack(),this._micTrack=null,this._refreshUi()):C===this._cameraTrack?(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):C===this._screenTrack&&(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null))};m.prototype.connectedToTwilio=function(C){var Q=this;this._twilioParticipant=C;C.on("trackSubscribed",this._trackSubscribedBound);C.on("trackUnsubscribed",
this._trackUnsubscribedBound);C.tracks.forEach(function(da){da.isSubscribed&&Q._trackSubscribed(da.track)})};m.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};m.prototype._onSoundVolumeUpdated=function(C){k.prototype._onSoundVolumeUpdated.call(this,C);this._avatar.onSoundVolumeUpdated(C)};m.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);
this._screenTrack&&this._trackUnsubscribed(this._screenTrack);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);k.prototype.dispose.call(this);this._disposed=!0};var fa=function(){var C=this;this._users=new Set;this._maxIntervalBetweenUpdates=100;this._idleCallback=new WALK.DeferringExecutorInterval(function(){return C._execute()},
this._maxIntervalBetweenUpdates);WALK.getViewer().onBeforeRender(function(){return C._onBeforeRender()})};fa.prototype.registerUser=function(C){this._users.add(C)};fa.prototype.unregisterUser=function(C){this._users.delete(C)};fa.prototype.dispose=function(){this._users.clear()};fa.prototype._onBeforeRender=function(){this._execute();this._idleCallback.deferRun()};fa.prototype._execute=function(){this._users.forEach(function(C){return C.updateSoundVolumeVisualization()})};WALK.loadScriptsUrlAndExecute(["https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.11.min.js",
"https://media.twiliocdn.com/sdk/js/video/releases/2.13.0/twilio-video.min.js"],function(){var C=WALK.urlHashGetArgument("meeting"),Q=WALK.urlHashGetArgument("meeting-key"),da=WALK.urlHashGetArgument("av-mode"),aa={url:WALK.DEVEL_MEETING_SCENE_URL||window.location.href};C&&(aa.meetingName=C);Q&&(aa.meetingKey=Q);da&&(aa.avMode=da);WALK.ajaxPost(a()+"/meetings/join","application/json",JSON.stringify(aa),function(X){return H(function(){return I(X)})},function(X,S){void 0!==S?WALK.USER_MSG.error(S):
WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})},function(){return WALK.USER_MSG.error("Cannot load required library")});WALK.play()}})();var module$extensions$meeting={};
